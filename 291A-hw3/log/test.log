  [1m[35m (8.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (31.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (27.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (22.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (31.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (24.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (21.1ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (50.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (61.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (54.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (106.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (82.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (82.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (55.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (17.9ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (2.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (17.2ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:34.433185', '2025-12-12 06:39:34.433186')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.6ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:34.437168', '2025-12-12 06:39:34.437169')[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('6635911638641068245', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT RELEASE_LOCK('6635911638641068245')[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (12.3ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_1` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (25.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_7` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.8ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_10` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_14` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.9ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_0` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (26.2ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_5` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_13` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_11` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.2ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_4` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.4ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_3` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.8ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_2` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (25.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_8` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (28.5ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_9` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (5.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (5.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (2.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (32.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_15` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (32.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_12` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (32.9ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_6` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (6.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (3.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (46.3ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (51.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (62.9ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (53.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (79.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (76.6ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (10.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (93.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (103.5ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (110.1ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (9.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (119.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (127.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (139.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (94.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (89.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (97.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (90.4ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (133.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (193.9ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (64.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (5.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (198.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (75.2ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (14.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (109.9ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (132.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (242.6ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (56.7ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (165.1ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (264.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (11.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (99.6ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (101.1ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (10.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (63.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (99.1ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (155.2ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (77.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (12.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (123.6ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (172.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (71.3ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (12.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (93.9ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (130.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (260.0ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (10.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (70.1ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (86.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (271.7ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (117.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (11.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (95.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (91.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (214.4ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (100.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (92.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (7.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (76.9ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (115.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (5.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (217.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (82.7ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (9.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (81.4ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (64.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (78.1ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (151.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (107.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (157.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (98.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (66.2ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (65.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (112.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (112.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (333.3ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (9.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (68.0ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (304.3ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (220.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (109.7ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (79.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (89.8ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (56.7ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (189.6ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (206.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (65.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (86.4ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (172.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (144.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (139.7ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (218.0ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (77.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (50.0ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (124.5ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (101.0ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (111.6ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (230.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (57.2ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (216.6ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (337.4ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (52.4ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (138.7ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (222.1ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (122.1ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (3.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (461.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (387.6ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (267.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (328.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (128.8ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (354.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (525.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (352.3ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (657.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (690.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (692.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (391.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (580.1ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (736.5ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (784.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (790.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (289.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (583.1ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1060.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (513.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (888.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (617.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (419.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (529.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (671.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (470.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (664.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (488.4ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (576.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (455.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (885.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (485.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (525.5ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (864.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (756.5ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (694.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (868.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1008.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (615.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (674.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (613.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (680.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (569.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (360.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (606.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (341.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (816.4ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (765.6ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (730.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (690.6ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (361.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (500.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (849.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (710.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (739.1ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (453.9ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (984.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (674.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (419.5ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (767.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (460.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (894.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (678.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (465.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (775.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (532.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (545.8ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1307.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (585.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (645.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (586.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (972.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (499.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (922.9ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (642.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (409.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (615.5ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (588.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (496.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (608.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (659.5ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1008.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (375.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (522.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (84.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (6.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (70.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (535.2ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (7.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (6.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (579.2ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (66.9ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:39.623513', '2025-12-12 06:39:39.623515')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:39.628082', '2025-12-12 06:39:39.628083')[0m
  [1m[35m (1133.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (857.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
------------------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
---------------------------------------------------------------------
  [1m[35m (912.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (4.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.716688', '2025-12-12 06:39:39.716743', '$2a$04$/fdg/rc4UDU30PuwUWiBWOyO4D/5LgismxxWOX0FzZaZCNmGGkXoW', '2025-12-12 06:39:39.716688', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.718862', '2025-12-12 06:39:39.718875', '$2a$04$1L8aQvuw/CoDjE638WKC0.Wi2lQ/gnZTk5b6.RXg9MvH3AgYxRX0S', '2025-12-12 06:39:39.718862', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.728232', NULL, NULL, NULL, '2025-12-12 06:39:39.728232', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b90d59db-476f-43ca-b28f-41bfd237237c) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.734372', 1, NULL, 'waiting', 'Waiting', '2025-12-12 06:39:39.734372')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:39:39.735084', 1, NULL, 'active', 'Assigned', '2025-12-12 06:39:39.735084')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=2" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 1.6ms (9 queries, 0 cached) | GC: 6.5ms)
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.756665', '2025-12-12 06:39:39.756677', '$2a$04$REhRZO5ikhRkTH25msDF.uznlJdFTGWa0l7gchXuvUnqmT7ssAkue', '2025-12-12 06:39:39.756665', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.759059', '2025-12-12 06:39:39.759069', '$2a$04$VJJCzz7G9CMdd0A4Xh/ele/RZG8mdARMpY4uQCbIahAfbwuC5xsqW', '2025-12-12 06:39:39.759059', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.761048', NULL, NULL, NULL, '2025-12-12 06:39:39.761048', 4)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e2c5f7ba-318f-46e2-b2a3-700b70b37474) to Test(default) with arguments: 2
Started GET "/api/messages/updates?userId=3" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "3"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.770119', '2025-12-12 06:39:39.770129', '$2a$04$3W2zJBbkdU2ycwmlnQBxIO97QYP37CwVfpU25FA/fO3JzA7zeL6xO', '2025-12-12 06:39:39.770119', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.772595', '2025-12-12 06:39:39.773191', '$2a$04$x4ZEnav4b//kDg/0/Rp4iOP7fTCmoCnuHE/FE3uFXjpliFmcyMLFa', '2025-12-12 06:39:39.772595', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.774702', NULL, NULL, NULL, '2025-12-12 06:39:39.774702', 6)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 449fe1a2-956c-4264-aef4-8a0f5c077430) to Test(default) with arguments: 3
Started GET "/api/conversations/updates?userId=5" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "5"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.6ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (516.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.782522', '2025-12-12 06:39:39.782532', '$2a$04$LSxTqB7ZHopOkhJYpyNfUuhi9Cdk/07xRKKxPCzwCybM30BJhKe3W', '2025-12-12 06:39:39.782522', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.785355', '2025-12-12 06:39:39.785367', '$2a$04$Jqtz8qPiVDR7mpa24PzGx.A1LQrEOo5cHvLCgHvk1tetjvgKL0BuS', '2025-12-12 06:39:39.785355', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.786853', NULL, NULL, NULL, '2025-12-12 06:39:39.786853', 8)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f4fa0080-b2d5-446f-9155-24a1d2629b60) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.788119', 7, NULL, 'waiting', 'Test', '2025-12-12 06:39:39.788119')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.799167', '2025-12-12 06:39:39.799178', '$2a$04$JX5W0UyjP0doZLKL4YuaQO7wwIvh7FBgbxp038XI1yrlTuHF458k6', '2025-12-12 06:39:39.799167', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.801107', '2025-12-12 06:39:39.801118', '$2a$04$FyKIkzdPPRyzl/3ytB3s/Ov39zLn.HkkYeWwzz2yEdNFM0ghBk.Xy', '2025-12-12 06:39:39.801107', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.803320', NULL, NULL, NULL, '2025-12-12 06:39:39.803320', 10)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 96b04642-5365-426d-90d8-4c79a9c1248c) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:39.805514', 9, NULL, 'active', 'Active', '2025-12-12 06:39:39.805514')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:39.807487', 9, NULL, 'resolved', 'Resolved', '2025-12-12 06:39:39.807487')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=10" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mMessage Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 1.5ms (7 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.818188', '2025-12-12 06:39:39.818201', '$2a$04$3nIyzjGQnBzfxTq0d4.wbOLZA5YxlYrYyKTf3NMWjsBgVzvowSioe', '2025-12-12 06:39:39.818188', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.819842', '2025-12-12 06:39:39.819851', '$2a$04$K9hCs6rLQA2loHpXpwPh3u9EhuGY5XRvt9UZyGGTAgwZHYB9UEQjS', '2025-12-12 06:39:39.819842', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.820567', NULL, NULL, NULL, '2025-12-12 06:39:39.820567', 12)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d619f609-646a-40ec-9070-5ea73dfa3b97) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.821169', 11, NULL, 'waiting', 'Old', '2025-12-12 06:39:39.821169')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:39:39.821612' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.823433', 11, NULL, 'waiting', 'New', '2025-12-12 06:39:39.823433')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=12&since=2025-12-11T06%3A39%3A39Z" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "12", "since" => "2025-12-11T06:39:39Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 12 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 12 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.829734', '2025-12-12 06:39:39.829744', '$2a$04$NOPfeP6sD35r7HPhWoS4oOWEYrMmaWlpYF6F/J7.ynpDSUN3Zk0PS', '2025-12-12 06:39:39.829734', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.832731', '2025-12-12 06:39:39.832741', '$2a$04$3IghW62o6RinbQ7gdtu2aesqO28hOhqlqHTve9YfpeMd1G3ZVrYom', '2025-12-12 06:39:39.832731', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.833586', NULL, NULL, NULL, '2025-12-12 06:39:39.833586', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fb0d855a-e8ac-4f39-8204-7382dac3a018) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.834377', 13, NULL, 'waiting', 'As Initiator', '2025-12-12 06:39:39.834377')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=13" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "13"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mConversation Load (2.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 13 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 2.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.843838', '2025-12-12 06:39:39.843848', '$2a$04$JIs/SdnhWZbGjhQlU4RFy.qNeSFMfzzaxx6q0Y/gotCrHO02CPHnK', '2025-12-12 06:39:39.843838', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.845593', '2025-12-12 06:39:39.845605', '$2a$04$KJ.xf8VtkV/GvKVeDDROH.LzvOlOENOkmmktwhQtUgnqOM4Jk33em', '2025-12-12 06:39:39.845593', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.846427', NULL, NULL, NULL, '2025-12-12 06:39:39.846427', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 717a89b8-3fb7-40f5-b7d2-30fa1a0230d7) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.847068', 15, NULL, 'waiting', 'First', '2025-12-12 06:39:39.847068')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.857687', 15, NULL, 'waiting', 'Second', '2025-12-12 06:39:39.857687')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (564.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.868338', 15, NULL, 'waiting', 'Third', '2025-12-12 06:39:39.868338')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=15" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "15"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mConversation Load (2.5ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 15 OR `conversations`.`assigned_expert_id` = 15) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 11 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 3.0ms (9 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.883433', '2025-12-12 06:39:39.883445', '$2a$04$PBTkuVMB4pghQPv9RkLI6O1op28pes680rELwyF0mOz3Mqh8KEMZu', '2025-12-12 06:39:39.883433', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.885162', '2025-12-12 06:39:39.885172', '$2a$04$nvjyP.S6eBGiT7eIpotyV.hJ2TPsq22byUDr64.BygKq28deSZfDS', '2025-12-12 06:39:39.885162', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.886290', NULL, NULL, NULL, '2025-12-12 06:39:39.886290', 18)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f5f16212-317d-45fd-912f-003abd5ddc95) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.886968', 17, NULL, 'waiting', 'User Conv', '2025-12-12 06:39:39.886968')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.888568', '2025-12-12 06:39:39.888580', '$2a$04$eIMaGutoCMbh6xno9k83EOqmbgcQnQbNKsHp5AL1GpJBQCyuu3HvG', '2025-12-12 06:39:39.888568', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.889092', 19, NULL, 'waiting', 'Other Conv', '2025-12-12 06:39:39.889092')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 12, '2025-12-12 06:39:39.891708', FALSE, 17, 'initiator', '2025-12-12 06:39:39.891708')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.891708', `conversations`.`updated_at` = '2025-12-12 06:39:39.892244' WHERE `conversations`.`id` = 12[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 13, '2025-12-12 06:39:39.892951', FALSE, 19, 'initiator', '2025-12-12 06:39:39.892951')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.892951', `conversations`.`updated_at` = '2025-12-12 06:39:39.893569' WHERE `conversations`.`id` = 13[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "17"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mConversation Pluck (0.4ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 12 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 0.7ms (5 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.906446', '2025-12-12 06:39:39.906457', '$2a$04$iLX9sHqwYuIL9Mol8bHGCeazOnposGQjf6T8LyNKADhs83.hAySfK', '2025-12-12 06:39:39.906446', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.908511', '2025-12-12 06:39:39.908520', '$2a$04$Efnb2HDFnPE6EXk/s0k5r.1P0t/zRhPGpA.uSZpTyYEb4BuSWCI9y', '2025-12-12 06:39:39.908511', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.909363', NULL, NULL, NULL, '2025-12-12 06:39:39.909363', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 22a65059-94c6-4904-8ac1-4311d6225586) to Test(default) with arguments: 10
Started GET "/api/expert-queue/updates?expertId=21" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "21"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.914125', '2025-12-12 06:39:39.914140', '$2a$04$zGAn9F2ngGnksgFsuuMz.eLk2OFyoZu9McPhNhGL8zrRdZrmqQOdq', '2025-12-12 06:39:39.914125', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.915973', '2025-12-12 06:39:39.915985', '$2a$04$cQpoE.q.bhLsPJ4S2xrvae.5qxoXsjiEnmDwhNtrVwaF.7GGopKr2', '2025-12-12 06:39:39.915973', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.917863', NULL, NULL, NULL, '2025-12-12 06:39:39.917863', 23)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ef67bfcb-e6db-4bd7-b065-4704294c95f3) to Test(default) with arguments: 11
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 0ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.924000', '2025-12-12 06:39:39.924012', '$2a$04$MqvzjCGTmG/SAFTjpLI2ZuytJ323e6Iap68Sextwt8mu1wjij48oi', '2025-12-12 06:39:39.924000', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.925642', '2025-12-12 06:39:39.925654', '$2a$04$y9RP7IAwVO5Gkzxc1cvcfeLPukVIWd7OFKPyy0coaKsJrwUWdg9.C', '2025-12-12 06:39:39.925642', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.926788', NULL, NULL, NULL, '2025-12-12 06:39:39.926788', 25)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad02bcc0-b2a8-4cbd-b4e6-e6c5020a749e) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.927554', 24, NULL, 'active', 'First', '2025-12-12 06:39:39.927554')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.6ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.938258', 24, NULL, 'active', 'Second', '2025-12-12 06:39:39.938258')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.949345', 24, NULL, 'active', 'Third', '2025-12-12 06:39:39.949345')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:39:39.949989' WHERE `conversations`.`id` = 14[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=25" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "25"}
  [1m[35m (658.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 25 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 14 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 16 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 15 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.8ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.958216', '2025-12-12 06:39:39.958227', '$2a$04$Pm71jOzDm/Z59yUn7e2iD.TzfPJAnPMfQKbNWg78ip.tjkAaptQqm', '2025-12-12 06:39:39.958216', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.959775', '2025-12-12 06:39:39.959786', '$2a$04$9Z.Fxe6YgV4dSp1J1hdZzubkmHxaj7T/RcmAxv3I0Q9.Awim9Y./K', '2025-12-12 06:39:39.959775', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.960572', NULL, NULL, NULL, '2025-12-12 06:39:39.960572', 27)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 69ec1123-ed7d-4f71-9c70-20cf1fe5e16d) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 06:39:39.961227', 26, NULL, 'active', 'Test', '2025-12-12 06:39:39.961227')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 17, '2025-12-12 06:39:39.961832', FALSE, 27, 'expert', '2025-12-12 06:39:39.961832')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.961832', `conversations`.`updated_at` = '2025-12-12 06:39:39.962230' WHERE `conversations`.`id` = 17[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=26" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "26"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mConversation Pluck (1.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 26 OR `conversations`.`assigned_expert_id` = 26)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 17 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.5ms (5 queries, 0 cached) | GC: 0.1ms)
  [1m[36mTRANSACTION (7.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.975353', '2025-12-12 06:39:39.975365', '$2a$04$hrUYca/2yzeukLCywpt9Zu4rsStZxOr9Nqbu7K56fSpsOevzSmdcq', '2025-12-12 06:39:39.975353', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.976875', '2025-12-12 06:39:39.976885', '$2a$04$r44ZWXXelYQW9EtCtPZl6OYsv92SiXH.TqJyKoBv8748xNdxXzHa.', '2025-12-12 06:39:39.976875', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 29 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.977686', NULL, NULL, NULL, '2025-12-12 06:39:39.977686', 29)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a3d76343-e1da-4a95-a7a2-4bf93d736791) to Test(default) with arguments: 14
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.978344', 28, NULL, 'waiting', 'Old', '2025-12-12 06:39:39.978344')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:39:39.978838' WHERE `conversations`.`id` = 18[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.979232', 28, NULL, 'waiting', 'New', '2025-12-12 06:39:39.979232')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=28&since=2025-12-11T06%3A39%3A39Z" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "28", "since" => "2025-12-11T06:39:39Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 28 OR `conversations`.`assigned_expert_id` = 28) AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 19 AND `messages`.`sender_id` != 28 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (407.0ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
------------------------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.986557', '2025-12-12 06:39:39.986568', '$2a$04$yZUgYopi7WMJkKhkUrOS8.3RxWB5.oJ7qQVQm49qa9iF3n1TNJ9Mi', '2025-12-12 06:39:39.986557', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.988084', '2025-12-12 06:39:39.988094', '$2a$04$RAleZ4HckgJ.YjF1H04GTuczE35Tik/nFwrqYH1j/j9svFAjKMcrK', '2025-12-12 06:39:39.988084', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 31 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.988946', NULL, NULL, NULL, '2025-12-12 06:39:39.988946', 31)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e5f3f4af-885c-4bca-adb6-28c0c382694e) to Test(default) with arguments: 15
Started GET "/api/expert-queue/updates?expertId=31" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
  [1m[36mActiveRecord::InternalMetadata Create (4.5ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:39.985538', '2025-12-12 06:39:39.985540')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "31"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 31 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:39.991470', '2025-12-12 06:39:39.991471')[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.996485', '2025-12-12 06:39:39.996496', '$2a$04$EkcGJZnYRBw3y.2G8Z03Z.e/eUto7rmLcVjZGTJL7eR6tz8F/0VDy', '2025-12-12 06:39:39.996485', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.997890', '2025-12-12 06:39:39.997901', '$2a$04$AZs0.FPTvhWxou3axzMkWOt3vix5Py3It1oTtgSIOohI51yActbqy', '2025-12-12 06:39:39.997890', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 33 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.998609', NULL, NULL, NULL, '2025-12-12 06:39:39.998609', 33)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: bc76623f-a0f6-46c5-b7d4-5a128763187c) to Test(default) with arguments: 16
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (33, '2025-12-12 06:39:39.999497', 32, NULL, 'active', 'Test', '2025-12-12 06:39:39.999497')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 20, '2025-12-12 06:39:40.000047', FALSE, 32, 'initiator', '2025-12-12 06:39:40.000047')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.000047', `conversations`.`updated_at` = '2025-12-12 06:39:40.000816' WHERE `conversations`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 06:39:40.001147' WHERE `messages`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 20, '2025-12-12 06:39:40.001506', FALSE, 33, 'expert', '2025-12-12 06:39:40.001506')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.001506', `conversations`.`updated_at` = '2025-12-12 06:39:40.001914' WHERE `conversations`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=32&since=2025-12-11T06%3A39%3A40Z" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "32", "since" => "2025-12-11T06:39:40Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 32 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 32 LIMIT 1[0m
  [1m[36mConversation Pluck (1.0ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 32 OR `conversations`.`assigned_expert_id` = 32)[0m
  [1m[35m (721.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 20 AND (created_at >= '2025-12-11 06:39:40') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 1.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.009233', '2025-12-12 06:39:40.009243', '$2a$04$sO0VkmX/Ixn2E4DCjMzmROj3bO7ExUujXRREP7BqFJi61kVCoLMQ2', '2025-12-12 06:39:40.009233', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.010677', '2025-12-12 06:39:40.010686', '$2a$04$nQlzmqeJ4M9E2mu4ozxUB.6KG3clE5Dr.3sFIB.Ce6hixvx2IlMSy', '2025-12-12 06:39:40.010677', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 35 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.011357', NULL, NULL, NULL, '2025-12-12 06:39:40.011357', 35)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eeead569-9eb7-4bac-8c95-131bceebc9a1) to Test(default) with arguments: 17
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (35, '2025-12-12 06:39:40.011953', 34, NULL, 'active', 'Test', '2025-12-12 06:39:40.011953')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.1ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 21, '2025-12-12 06:39:40.012502', FALSE, 34, 'initiator', '2025-12-12 06:39:40.012502')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.012502', `conversations`.`updated_at` = '2025-12-12 06:39:40.012824' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 21, '2025-12-12 06:39:40.023372', FALSE, 35, 'expert', '2025-12-12 06:39:40.023372')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.023372', `conversations`.`updated_at` = '2025-12-12 06:39:40.023903' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.028460', '2025-12-12 06:39:40.028516', '$2a$04$SQQ5DGT3iqOwbUCmfM3ifezhpnXS8hGnf/NdVLUgmwbEah99ez5Ma', '2025-12-12 06:39:40.028460', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.030376', '2025-12-12 06:39:40.030418', '$2a$04$wvWmvbGySMtoqrFRTvYMY.nkWLiDndfAoJ/yfoXYxcoJlZtVPjCNO', '2025-12-12 06:39:40.030376', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 21, '2025-12-12 06:39:40.034690', FALSE, 34, 'initiator', '2025-12-12 06:39:40.034690')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.034690', `conversations`.`updated_at` = '2025-12-12 06:39:40.035328' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.035396', NULL, NULL, NULL, '2025-12-12 06:39:40.035396', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=34" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "34"}
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad185a28-7f5c-4f4a-81bd-61267b1853f6) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 34 OR `conversations`.`assigned_expert_id` = 34)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 21 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (34, 35)[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (702.1ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.046593', 1, NULL, 'waiting', 'First', '2025-12-12 06:39:40.046593')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (9.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.048992', '2025-12-12 06:39:40.049003', '$2a$04$3f10MxKLIwMY4FHA15lF3.WisNQZzzACmZbtBrnK.qURClte7A1RG', '2025-12-12 06:39:40.048992', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.050410', '2025-12-12 06:39:40.050420', '$2a$04$TXxBx8hwwKuDyaMj6PpV2eY/Fbq7AfM1twUae/1Z/0IRrL6gvFALq', '2025-12-12 06:39:40.050410', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.051131', NULL, NULL, NULL, '2025-12-12 06:39:40.051131', 37)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7997f1e2-96c0-4095-84de-4494402db2e3) to Test(default) with arguments: 18
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (37, '2025-12-12 06:39:40.051766', 36, NULL, 'active', 'As Expert', '2025-12-12 06:39:40.051766')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=37" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "37"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 37 OR `conversations`.`assigned_expert_id` = 37) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 36 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 22 AND `messages`.`sender_id` != 37 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.057346', 1, NULL, 'waiting', 'Second', '2025-12-12 06:39:40.057346')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.058702', '2025-12-12 06:39:40.058712', '$2a$04$D.MQYtlaTwZxE6s1lbSi5emX/wepP40eS0CV7nrCIulx.3HTZyFn6', '2025-12-12 06:39:40.058702', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.060148', '2025-12-12 06:39:40.060158', '$2a$04$IA0axPYVa8gTJ0MPJRXGl.XesM8OqCyKIuxH4V9KZBU8w4HSkFf7S', '2025-12-12 06:39:40.060148', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 39 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.060834', NULL, NULL, NULL, '2025-12-12 06:39:40.060834', 39)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 52167cc9-336a-496f-a74f-dd1a9d9bbd8d) to Test(default) with arguments: 19
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 0ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.068048', 1, NULL, 'waiting', 'Third', '2025-12-12 06:39:40.068048')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (7.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.071291', '2025-12-12 06:39:40.071304', '$2a$04$lrvmxaiEspBUcpF88jKbsOfU9aAeu14YergXVGKi/mJDKYgEt4oTW', '2025-12-12 06:39:40.071291', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.072938', '2025-12-12 06:39:40.072948', '$2a$04$dJk49PwsBCMjbH3XvVUipOFI0cIK7UeatmwKagivsdUGPhddQOi.m', '2025-12-12 06:39:40.072938', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 41 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.073763', NULL, NULL, NULL, '2025-12-12 06:39:40.073763', 41)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e6d02899-9b74-41a5-91b0-2ce345bffa33) to Test(default) with arguments: 20
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=2" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.085137', '2025-12-12 06:39:40.085150', '$2a$04$cVtYU.VxVZms7gGwW7689uXHCLNOyrldK0NXDHp2m92jDkFJ1XMje', '2025-12-12 06:39:40.085137', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 42 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.085961', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.085961', 42)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 061e576a-356c-4c54-bb08-c7738701b898) to Test(default) with arguments: 21
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619] Performing GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) from Test(default) enqueued at 2025-12-12T06:39:40.087153095Z with arguments: 21
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 21 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.089282' WHERE `expert_profiles`.`id` = 21[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619] Performed GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) from Test(default) in 1.86ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) to Test(default) with arguments: 21
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 21 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.6ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.095991', '2025-12-12 06:39:40.096002', '$2a$04$AzCS7CavcQ7Ia2f/JpadQenxVZNGmtfuVB0ugTejucIwKngbt6z6q', '2025-12-12 06:39:40.095991', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 43 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.096756', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.096756', 43)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8d129919-2ac3-4079-9220-cc2106a399c4) to Test(default) with arguments: 22
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf] Performing GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) from Test(default) enqueued at 2025-12-12T06:39:40.097391761Z with arguments: "non-existent-id"
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf] Performed GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) from Test(default) in 0.21ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) to Test(default) with arguments: "non-existent-id"
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.101659', '2025-12-12 06:39:40.101671', '$2a$04$A3/BvxUzYWwuD/YKqscA..4B2T0vTBnVeUpPysa2dXXJqlPX3Rmui', '2025-12-12 06:39:40.101659', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.103186', '2025-12-12 06:39:40.103196', '$2a$04$IwTGG1fKQA6j.OZ7dfr3AOtebHsGeGjKu/MfhlWgRO12JhFSJxVnG', '2025-12-12 06:39:40.103186', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:39:40.103849', 3, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.103849')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.104196', '2025-12-12 06:39:40.104209', '$2a$04$Y1BGF7rrGHi0wOg04mcgiuDa9RPYgYtpTj8tkOCYsKWyY8sShQbDO', '2025-12-12 06:39:40.104196', 'testuser')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.105663', '2025-12-12 06:39:40.105672', '$2a$04$xAUeqeFP1AtgiPH7ROIvfu2cZ33kTSNuvdpplhT21TRBwehapoFky', '2025-12-12 06:39:40.105663', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (45, '2025-12-12 06:39:40.106254', 44, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.106254')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 23, '2025-12-12 06:39:40.106865', FALSE, 44, 'initiator', '2025-12-12 06:39:40.106865')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.106865', `conversations`.`updated_at` = '2025-12-12 06:39:40.107225' WHERE `conversations`.`id` = 23[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/9/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "4", "content" => "Test message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "9"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 45 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 06:39:40.110582', FALSE, 3, 'initiator', '2025-12-12 06:39:40.110582')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.110582', `conversations`.`updated_at` = '2025-12-12 06:39:40.111025' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_includes_senderUsername
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.117592', '2025-12-12 06:39:40.117602', '$2a$04$lyoh9fIUMNriKnJC1fkZUeZOPZz9Rk3ifGnXoOA8N1iuRHPjvw1JC', '2025-12-12 06:39:40.117592', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.119052', '2025-12-12 06:39:40.119061', '$2a$04$DAMup5xEI0HOzGvE0.SDXuvtEZVEHFXhjuJrYGZHPBd502b8UrVgS', '2025-12-12 06:39:40.119052', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:39:40.119620', 5, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.119620')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "5", "content" => "Test message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 06:39:40.121230', FALSE, 5, 'initiator', '2025-12-12 06:39:40.121230')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.121230', `conversations`.`updated_at` = '2025-12-12 06:39:40.121597' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '45' OR conversations.assigned_expert_id = '45') AND `messages`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 06:39:40.122672' WHERE `messages`.`id` = 9[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 9.8ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.128126', '2025-12-12 06:39:40.128140', '$2a$04$KpunQfQHcNgK09wFTLprD.y1/2KmeDCjucp5w3bN.jh.seE1bMVXe', '2025-12-12 06:39:40.128126', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.130821', '2025-12-12 06:39:40.130832', '$2a$04$F0cMlFlbZ1WgVdPwB0mWYeVqf5PD9kDfUnUH9mzf9HZTDP.3uGJKq', '2025-12-12 06:39:40.130821', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.130972', '2025-12-12 06:39:40.130986', '$2a$04$CyIgJO0FGqD01c9XqLTFe.BjqoYDe63ugWX2YLMmZRy/6UHMwN8au', '2025-12-12 06:39:40.130972', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:39:40.131868', 7, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.131868')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.133128', '2025-12-12 06:39:40.133138', '$2a$04$DN..7ORXssPoAemP8AnAx.Iadka.9TzsIFuuD5.5hXA.ogxEHK0Wi', '2025-12-12 06:39:40.133128', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (47, '2025-12-12 06:39:40.133702', 46, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.133702')[0m
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 6, '2025-12-12 06:39:40.133272', FALSE, 7, 'initiator', '2025-12-12 06:39:40.133272')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.133272', `conversations`.`updated_at` = '2025-12-12 06:39:40.134084' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.135185', '2025-12-12 06:39:40.135193', '$2a$04$V0zJwIGu8lGaVT0NDXZaMOGk5Al3Dh/LaEMoN7qyQwm0veepD.pum', '2025-12-12 06:39:40.135185', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/24/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "24"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 48 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 48 OR `conversations`.`assigned_expert_id` = 48) AND `conversations`.`id` = 24 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.144292', '2025-12-12 06:39:40.144301', '$2a$04$ZT1H72jyw6s0kkEiOAfFh.CuZOxBdLwon9MMsEFDSrq3Z4EcuObcK', '2025-12-12 06:39:40.144292', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 6, '2025-12-12 06:39:40.144796', FALSE, 8, 'expert', '2025-12-12 06:39:40.144796')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.145654', '2025-12-12 06:39:40.145663', '$2a$04$EQNxUjsYshYKAvjSyjhSv.owb3vvOUSJnlZdrDvBmr55mKq6wtahS', '2025-12-12 06:39:40.145654', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.144796', `conversations`.`updated_at` = '2025-12-12 06:39:40.145852' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (50, '2025-12-12 06:39:40.146335', 49, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.146335')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "25", "content" => "New message"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 49 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 6, '2025-12-12 06:39:40.156511', FALSE, 7, 'initiator', '2025-12-12 06:39:40.156511')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 25, '2025-12-12 06:39:40.158252', FALSE, 49, 'initiator', '2025-12-12 06:39:40.158252')[0m
  [1m[36mConversation Update (0.6ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.156511', `conversations`.`updated_at` = '2025-12-12 06:39:40.158211' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.158252', `conversations`.`updated_at` = '2025-12-12 06:39:40.158679' WHERE `conversations`.`id` = 25[0m
Started GET "/conversations/6/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.3ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 25 LIMIT 1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "6"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7) AND `conversations`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (7, 8)[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 2.8ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.167908', '2025-12-12 06:39:40.167920', '$2a$04$6sSRH4xG5dK.pYBVDdDsEujvI3A0pUvYjO9U0ZSJD22XAezSb90zS', '2025-12-12 06:39:40.167908', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.169443', '2025-12-12 06:39:40.169452', '$2a$04$LS/mQ.FHsBiG4uHqsGyUjOu68iZNvlLn5PLYJGlQGGtYouwV6oxm2', '2025-12-12 06:39:40.169443', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (52, '2025-12-12 06:39:40.169997', 51, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.169997')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "26", "content" => "Expert reply"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 26 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 26, '2025-12-12 06:39:40.171641', FALSE, 52, 'expert', '2025-12-12 06:39:40.171641')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.171641', `conversations`.`updated_at` = '2025-12-12 06:39:40.172046' WHERE `conversations`.`id` = 26[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.174309', '2025-12-12 06:39:40.174323', '$2a$04$jiGpZghdwB4.sFBXN/CZHuYYUrs4eiqPAGbK6PMBtJB2ulDibxAIi', '2025-12-12 06:39:40.174309', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.176269', '2025-12-12 06:39:40.176279', '$2a$04$DPLjKxKsIGMTrlCg9e3MRurbZp.NykTVaRonBNKlyipRv.iMrkSg6', '2025-12-12 06:39:40.176269', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:40.177754', 9, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.177754')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (820.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.179981', '2025-12-12 06:39:40.179992', '$2a$04$2u5AApsP9XmuSyPoZS3.weR3/lPRg7UO4OmxkYSLZ1FyBlD3FllDm', '2025-12-12 06:39:40.179981', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "7", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (9.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.5ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.186427', '2025-12-12 06:39:40.186439', '$2a$04$wGfCgdQQF.OGx3xiBqykCu8g1AnoXED8N94DsvV/ZlsXysnIQSkw2', '2025-12-12 06:39:40.186427', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.187874', '2025-12-12 06:39:40.187883', '$2a$04$dB9HLXpZtjUfXijyv3Qh/.x5mJH.18NvQ1wxqgvr5k3vqlp4ygCpu', '2025-12-12 06:39:40.187874', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (54, '2025-12-12 06:39:40.188436', 53, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.188436')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 53 LIMIT 1[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (1017.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.192205', '2025-12-12 06:39:40.192216', '$2a$04$ScTyGlE1LE7UBJ2D/1nMwOdSzSsnHY8G5mdIbpzxlLY93GvN7SmeO', '2025-12-12 06:39:40.192205', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.194225', '2025-12-12 06:39:40.194236', '$2a$04$6.sLj5L.zzimHSDhzLqr.O4memSDadY0obzkFPVTDY91lMbyy4A8a', '2025-12-12 06:39:40.194225', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.195693', '2025-12-12 06:39:40.195703', '$2a$04$U8ovQ8hQLssOg6SlrEsEROZPvtX8q2MGrxoQDbCfUf0kYmwooyKFC', '2025-12-12 06:39:40.195693', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 06:39:40.195614', 12, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.195614')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "8", "content" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.197363', '2025-12-12 06:39:40.197373', '$2a$04$T/9s35xRJ6NIVjqe1yEbN.HQuceboulaEW6pkxUg7tTz7.GEfOPK.', '2025-12-12 06:39:40.197363', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (56, '2025-12-12 06:39:40.197944', 55, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.197944')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.199628', '2025-12-12 06:39:40.199640', '$2a$04$rSaTadkCeepn8cVqztYOHOmT6GHOmob4.aba24ho.fpDhIxVcHlWS', '2025-12-12 06:39:40.199628', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.200194', 57, NULL, 'waiting', 'Other', '2025-12-12 06:39:40.200194')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 29, '2025-12-12 06:39:40.200775', FALSE, 57, 'initiator', '2025-12-12 06:39:40.200775')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.200775', `conversations`.`updated_at` = '2025-12-12 06:39:40.201178' WHERE `conversations`.`id` = 29[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/12/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "12"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 55 LIMIT 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '55' OR conversations.assigned_expert_id = '55') AND `messages`.`id` = 12 LIMIT 1[0m
Filter chain halted as :set_message rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.204979', '2025-12-12 06:39:40.204993', '$2a$04$wWWvWV6FnxrRXq5/kHNmh.rAyUOtuKnv74YJ9HfaSTYzuZyutWJzy', '2025-12-12 06:39:40.204979', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.207322', '2025-12-12 06:39:40.207332', '$2a$04$1xKjFiRAw4B9j5uLXxMJNO0aqKOYpz6CNXU9VCfUE72Oo4RkXlgI2', '2025-12-12 06:39:40.207322', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.207596', '2025-12-12 06:39:40.207609', '$2a$04$kjqAiJBPXGybvI8XgdKcIuo/ncN.zFpREvrUH1sn.9Pf.dQcZeE9.', '2025-12-12 06:39:40.207596', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.208709', '2025-12-12 06:39:40.208718', '$2a$04$LxzEcJx/k/MY4/jRDL8Z1.lwIwrIVerlKp9fQz22vaYx3cnsAaHUe', '2025-12-12 06:39:40.208709', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (59, '2025-12-12 06:39:40.209280', 58, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.209280')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 30, '2025-12-12 06:39:40.209812', FALSE, 58, 'initiator', '2025-12-12 06:39:40.209812')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 06:39:40.209964', 14, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.209964')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.209812', `conversations`.`updated_at` = '2025-12-12 06:39:40.210156' WHERE `conversations`.`id` = 30[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/13/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "13"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 58 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '58' OR conversations.assigned_expert_id = '58') AND `messages`.`id` = 13 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 9, '2025-12-12 06:39:40.210542', TRUE, 14, 'initiator', '2025-12-12 06:39:40.210542')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.210542', `conversations`.`updated_at` = '2025-12-12 06:39:40.212315' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/9/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (568.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
Processing by MessagesController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  Parameters: {"conversation_id" => "9"}
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 14 OR `conversations`.`assigned_expert_id` = 14) AND `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.216372', '2025-12-12 06:39:40.216384', '$2a$04$X6h5l/BRbUWZOs04/gj5weCEJ4I8el/tSRT2QTylQjtrifwe6K0mW', '2025-12-12 06:39:40.216372', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 1.5ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.217828', '2025-12-12 06:39:40.217840', '$2a$04$F3QJ5QfHTXoaa/8/OwI5YuoWGh7XEZNPnpcEGsKmjGvBxI8g9hbG2', '2025-12-12 06:39:40.217828', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (61, '2025-12-12 06:39:40.218630', 60, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.218630')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 31, '2025-12-12 06:39:40.219451', FALSE, 60, 'initiator', '2025-12-12 06:39:40.219451')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.219451', `conversations`.`updated_at` = '2025-12-12 06:39:40.219924' WHERE `conversations`.`id` = 31[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/14/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "14"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (10.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.231221', '2025-12-12 06:39:40.231232', '$2a$04$oRHAxPb75AsiH1mttjWz8uuIldt1sZ7mNN2OnGUZnR8c2C44r2U6G', '2025-12-12 06:39:40.231221', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.232512', '2025-12-12 06:39:40.232524', '$2a$04$HIDwMIsUh2eZH2niwNwg.O.TGRoASH9OjjjjtL2qMHk/mUOpoYHDe', '2025-12-12 06:39:40.232512', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.232906', '2025-12-12 06:39:40.232916', '$2a$04$iDlOEZlNgZhQ1GP/gOcGrekZtcnW7dwAYQJtccFALUwl9yonK2BRG', '2025-12-12 06:39:40.232906', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (63, '2025-12-12 06:39:40.233710', 62, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.233710')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/32/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "32"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.235908', '2025-12-12 06:39:40.235918', '$2a$04$kwVbXhhVH/igIaASvHr8fO6AKmfFMOJWHBhz6tbQYVP3adtwLwQ4W', '2025-12-12 06:39:40.235908', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (17, '2025-12-12 06:39:40.237354', 16, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.237354')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 10, '2025-12-12 06:39:40.238427', FALSE, 16, 'initiator', '2025-12-12 06:39:40.238427')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.238427', `conversations`.`updated_at` = '2025-12-12 06:39:40.239217' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.239714', '2025-12-12 06:39:40.239726', '$2a$04$S/F9nLCN.vdr7x7tkVrGseO8YqSUjJT4Of3PMjQrDl7sFEdXY7nfu', '2025-12-12 06:39:40.239714', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.241382', '2025-12-12 06:39:40.241394', '$2a$04$7WFgcc1Zt642/sZ9qw/taem1biubIS1hsjl2mNuCRwQx8278qWSzK', '2025-12-12 06:39:40.241382', 'expertuser')[0m
Started GET "/conversations/10/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (65, '2025-12-12 06:39:40.242005', 64, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.242005')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 16 OR `conversations`.`assigned_expert_id` = 16) AND `conversations`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "33", "content" => "New message"}
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 10 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 33 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 33, '2025-12-12 06:39:40.243490', FALSE, 64, 'initiator', '2025-12-12 06:39:40.243490')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.243490', `conversations`.`updated_at` = '2025-12-12 06:39:40.244025' WHERE `conversations`.`id` = 33[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.248057', '2025-12-12 06:39:40.248071', '$2a$04$8EpWWS5WqtzWhbdBSEtL/uGzuDoNrGBCnIKWpsd/neDgOw5PM0x/i', '2025-12-12 06:39:40.248057', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.249693', '2025-12-12 06:39:40.249703', '$2a$04$wecrYwtYjaeEvVWVNF80tONY97L7n7aAxTM5ZHumd/p0h.tjfNv7G', '2025-12-12 06:39:40.249693', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (687.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.254113', '2025-12-12 06:39:40.254126', '$2a$04$rGt3YVTesk.G6ZBpIBDzY.6Ms4bdP5TVFIwj8kSfCSMRe2C0JS6ti', '2025-12-12 06:39:40.254113', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.256790', '2025-12-12 06:39:40.256799', '$2a$04$9N1ju7CbBWOb8q8EjVsKiu48fa3T7nHWONGKLX4gnlg3BI2OArEjC', '2025-12-12 06:39:40.256790', 'newuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.257669', NULL, NULL, NULL, '2025-12-12 06:39:40.257669', 68)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c614ba9f-b338-42d9-b94d-435c4817712e) to Test(default) with arguments: 23
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.255553', `users`.`updated_at` = '2025-12-12 06:39:40.262253' WHERE `users`.`id` = 18[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 7.0ms (3 queries, 0 cached) | GC: 1.2ms)
Completed 201 Created in 11ms (Views: 0.0ms | ActiveRecord: 6.2ms (6 queries, 0 cached) | GC: 0.2ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (819.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (90.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.273375', '2025-12-12 06:39:40.273387', '$2a$04$n1fsNKyALZGU1ABbCaEiq.x7I6gCauZsgQYg9ek.cPnns0DbIe11C', '2025-12-12 06:39:40.273375', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.275018', '2025-12-12 06:39:40.275030', '$2a$04$3NM8jF61m.gTGy12JKjyBuq.HyTr/dN3UYfMXhieED55jBg/iOW6m', '2025-12-12 06:39:40.275018', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.275633', `users`.`updated_at` = '2025-12-12 06:39:40.276376' WHERE `users`.`id` = 69[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.0ms | ActiveRecord: 0.2ms (1 query, 0 cached) | GC: 0.4ms)
  [1m[35m (7.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.282745', '2025-12-12 06:39:40.282756', '$2a$04$0gHEAWUy2i/Bbw7F6EfWDORJ6ra/bjwfL7zdXVQh.ly/FpWpNlzIS', '2025-12-12 06:39:40.282745', 'test')[0m
-------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#refresh as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[35m (4.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.285065', `users`.`updated_at` = '2025-12-12 06:39:40.285196' WHERE `users`.`id` = 70[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.285688', '2025-12-12 06:39:40.285698', '$2a$04$S7ckdzGcf1n1TisAgUz6yu9Gokk/uzzK4HOniksSHlE1C2bOcGDk.', '2025-12-12 06:39:40.285688', 'testuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.288197', `users`.`updated_at` = '2025-12-12 06:39:40.288344' WHERE `users`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.294343', '2025-12-12 06:39:40.294355', '$2a$04$gXicO6lofRIwregFA7WbEeMQcO.ZJiOXjS7fj7lCp5FlPzKxHRXgC', '2025-12-12 06:39:40.294343', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.296379', `users`.`updated_at` = '2025-12-12 06:39:40.296505' WHERE `users`.`id` = 71[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.2ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#logout as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.1ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.308013', '2025-12-12 06:39:40.308026', '$2a$04$BEsDS/nYEm9jhxkCD4Tcau4W7v4amGtlCxQNLy/rcsylYN/tEEXXq', '2025-12-12 06:39:40.308013', 'testuser3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#refresh as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.314057', '2025-12-12 06:39:40.314067', '$2a$04$vclUYYHfszM1K0qQ55yF1.1gd6UcTJGWbQv9HQYqqE4tE3uyGoQBG', '2025-12-12 06:39:40.314057', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 73 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.314861', NULL, NULL, NULL, '2025-12-12 06:39:40.314861', 73)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 48d03c52-b07e-4b45-8dac-f67e8433c68b) to Test(default) with arguments: 24
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 73 LIMIT 1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.322020', '2025-12-12 06:39:40.322033', '$2a$04$8e7gLBhYz8zg41Dk7xH79eGmsqDBTwqWHq5VgEwbUZOBBGT.1ZTtu', '2025-12-12 06:39:40.322020', 'newexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.323006', NULL, NULL, NULL, '2025-12-12 06:39:40.323006', 74)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2069166e-e222-4d75-a561-772b48047267) to Test(default) with arguments: 25
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
  [1m[35m (547.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.330903', '2025-12-12 06:39:40.330915', '$2a$04$dudzhEK/q/B305Qd9FtjweuIG7ElFxm3FlYSpKUkj103kNYkuk2Ta', '2025-12-12 06:39:40.330903', 'testuser4')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.333096', `users`.`updated_at` = '2025-12-12 06:39:40.333214' WHERE `users`.`id` = 75[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 75 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (53.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.341721', '2025-12-12 06:39:40.341732', '$2a$04$N1f/VAmprGpYJVE1uNCHv.JjFrrFxLe.hsDSSvG5zA0u/t0VfHAgC', '2025-12-12 06:39:40.341721', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.340467', '2025-12-12 06:39:40.340469')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
--------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.347480', '2025-12-12 06:39:40.347491', '$2a$04$j4CHa1IUJ.Hkrtd1PH.y2.kwqEClaOf4KkKkNpQHifHtUtU/lvkNy', '2025-12-12 06:39:40.347480', 'testlogout')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.349466', `users`.`updated_at` = '2025-12-12 06:39:40.349583' WHERE `users`.`id` = 77[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.346783', '2025-12-12 06:39:40.346784')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#logout as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 77 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (776.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (6.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.362343', '2025-12-12 06:39:40.362356', '$2a$04$ql/MrLmOSxJoecatr6ABUe37o4NTwPQS24Cds039Bw5IXMdWK4BN6', '2025-12-12 06:39:40.362343', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.363061', 78, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.363061')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/34" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "34"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 78 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 78 OR `conversations`.`assigned_expert_id` = 78) AND `conversations`.`id` = 34 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 78 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 34 AND `messages`.`sender_id` != 78 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.371628', '2025-12-12 06:39:40.371638', '$2a$04$d18HbpD4GURfmNwQ17hj5.zXXihLiqKNPH/cu84yfdkADS/AZbzIe', '2025-12-12 06:39:40.371628', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.372336', 79, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.372336')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 79 LIMIT 1[0m
  [1m[36mConversation Load (4.5ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 79 OR `conversations`.`assigned_expert_id` = 79) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 79 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 35 AND `messages`.`sender_id` != 79 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 6ms (Views: 0.0ms | ActiveRecord: 4.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (733.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.384287', '2025-12-12 06:39:40.384301', '$2a$04$0KoK1Njf0rhC3lUzFW8kfOXj16GneFUZZ3WaBAPHKMrCfbaMKLfAS', '2025-12-12 06:39:40.384287', 'testuser')[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.384755', '2025-12-12 06:39:40.384833', '$2a$04$.HwWxkFpEpYnqUPALbBeLusxESBJYQoa7/0XFdjXdCPaN3Vu5q0CS', '2025-12-12 06:39:40.384755', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 80 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 80 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.386146', 80, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.386146')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 36 AND `messages`.`sender_id` != 80 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (7.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (530.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.397452', '2025-12-12 06:39:40.397463', '$2a$04$uThXZc1VfT0KptptV.t5COP9HfsY7JoKDoN2/E2gYryIZefIUesXa', '2025-12-12 06:39:40.397452', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.398954', '2025-12-12 06:39:40.398964', '$2a$04$4GQIQdVRlvO/gyLhUmDRueHfzb1aJO.RlolCG/ovt84K1tmqeIw6G', '2025-12-12 06:39:40.398954', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 82 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.399759', NULL, NULL, '[]', '2025-12-12 06:39:40.399759', 82)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 48eccb48-4e5c-4209-a9f3-6c2bda525d76) to Test(default) with arguments: 26
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (82, '2025-12-12 06:39:40.400390', 81, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.400390')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/37" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "37"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 81 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 81 OR `conversations`.`assigned_expert_id` = 81) AND `conversations`.`id` = 37 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 81 LIMIT 1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 82 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 37 AND `messages`.`sender_id` != 81 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 11ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 8.9ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.414009', 1, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.414009')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.416107', '2025-12-12 06:39:40.416118', '$2a$04$XSXQi2uYyklJVEc265sNZeWXJ4Y1omG4TL8f3CYjLMDSduVck6FzC', '2025-12-12 06:39:40.416107', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 1 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.416734', 83, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.416734')[0m
Completed 201 Created in 13ms (Views: 0.2ms | ActiveRecord: 2.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 83 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 83 OR `conversations`.`assigned_expert_id` = 83) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 83 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 38 AND `messages`.`sender_id` != 83 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.421956', '2025-12-12 06:39:40.421970', '$2a$04$5idR7FP6tgTIeu9X9UCVuOxDobblV/2HiOHCEYVgy7hg7PHuPpB02', '2025-12-12 06:39:40.421956', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.423389', '2025-12-12 06:39:40.423399', '$2a$04$OM4kv4ImWiml4ASWH5HGl.XsvVyki.mtT2VajMVebGOBwizNghJ0.', '2025-12-12 06:39:40.423389', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 84 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 84 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.427707', '2025-12-12 06:39:40.427717', '$2a$04$9NWGXtd6atGL6ABbcQI52eFRnDLx/Vt6XX0d9xW7dQzSf8IhzVttC', '2025-12-12 06:39:40.427707', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  Parameters: {"title" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.430432', '2025-12-12 06:39:40.430443', '$2a$04$djvfx78/W.wofta38Gm0UOWp0OIhAapWwyyssvGIPloi6Gt0ApqU2', '2025-12-12 06:39:40.430432', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (34.4ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.431972', '2025-12-12 06:39:40.431982', '$2a$04$Z9txy/A2ECCtIkD/iiM93.1mv4zti2WSLwwK5EpfP96w51KMPX1Na', '2025-12-12 06:39:40.431972', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.432498', 86, NULL, 'waiting', 'Other Conversation', '2025-12-12 06:39:40.432498')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/39" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "39"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 85 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.433364', '2025-12-12 06:39:40.433376', '$2a$04$GJ0EUzPLiRQakJPV0Quje.rHXpAO262eSlJzFHIf2lkd0oYk4tNu.', '2025-12-12 06:39:40.433364', 'testuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 85 OR `conversations`.`assigned_expert_id` = 85) AND `conversations`.`id` = 39 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.435441', '2025-12-12 06:39:40.435452', '$2a$04$z765CYq9czjyyanYMpl6oOP5ANDvU4QG5JeSEXNuCO0ihPyw/cEAK', '2025-12-12 06:39:40.435441', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SchemaMigration Load (4.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (5.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.439940', NULL, NULL, '[]', '2025-12-12 06:39:40.439940', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b4c21535-47a2-43a8-bf1d-04086e64e3df) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
----------------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (5, '2025-12-12 06:39:40.440842', 4, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.440842')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.442250', '2025-12-12 06:39:40.442259', '$2a$04$8Hwj5gnuVQUc9aIj31xt2Obj0DJ.u59oqxw80vGmrCBJ3qm1wJG9q', '2025-12-12 06:39:40.442250', 'testuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 4 OR `conversations`.`assigned_expert_id` = 4) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.442779', 87, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.442779')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 87 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (4.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mConversation Load (6.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 87 OR `conversations`.`assigned_expert_id` = 87) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 87 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 40 AND `messages`.`sender_id` != 87 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 7ms (Views: 0.0ms | ActiveRecord: 6.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (4.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (11.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.457593', '2025-12-12 06:39:40.457605', '$2a$04$nVoP.AR0/uD7nU9WlVCMLe9vL3B7TEyabEKbdp5WV7Zsx3nkr63Iy', '2025-12-12 06:39:40.457593', 'testuser')[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.458097', '2025-12-12 06:39:40.458107', '$2a$04$u6trR7yv7S4GmJFwcS4TMeuHpOT2ozFkVWMKimlXP2ynrjKrL3eDS', '2025-12-12 06:39:40.458097', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (762.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.462998', '2025-12-12 06:39:40.463008', '$2a$04$z/ovokdDwxrBCWughPQbcu6zt/FLrwJGIfFkTiI4rUvrQELa/AfgC', '2025-12-12 06:39:40.462998', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.463074', '2025-12-12 06:39:40.463087', '$2a$04$DmN15Kdmb98w69pZLF9rMuzpkDvqGUb7aOdEwy0VvSOVqVij4e9bG', '2025-12-12 06:39:40.463074', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.464511', '2025-12-12 06:39:40.464521', '$2a$04$N6nEIbPDipFSytM0Arsi4ORmRiMtK4/bhe/cJMSXcRMdIO3lKq.9K', '2025-12-12 06:39:40.464511', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.464695', '2025-12-12 06:39:40.464704', '$2a$04$Flh4.g0M2JmNPaCE1OrqGuR17meaj2Iitqq0VRh48O67Fp5w3sVfK', '2025-12-12 06:39:40.464695', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 90 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.465345', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.465345', 8)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.465438', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.465438', 90)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8ce3305a-7244-44ad-9a48-099a3ea06dad) to Test(default) with arguments: 2
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d753b987-1f46-4eb6-9d39-71289eb73adc) to Test(default) with arguments: 27
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:39:40.466054', 7, NULL, 'active', 'Test', '2025-12-12 06:39:40.466054')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.467060', '2025-12-12 06:39:40.467069', '$2a$04$7Wu9VgjdceBEJAdxX60sUeLA0ZR.Ksy8dlJv1pk58utVjxqkJG.v2', '2025-12-12 06:39:40.467060', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 91 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.4ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.468085', 89, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.468085')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/41/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "41"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 91 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 91 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.470699', 3, '2025-12-12 06:39:40.470824', 8, NULL, 'active', '2025-12-12 06:39:40.470824')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/3/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:39:40.475710' WHERE `conversations`.`id` = 3[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.476985', '2025-12-12 06:39:40.476995', '$2a$04$Pvkbh/QzNATeD.CmZLHqw.AFsrSDRPXo/hY9w9n2GmtCUSB/wCWua', '2025-12-12 06:39:40.476985', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 3 AND `expert_assignments`.`expert_id` = 8 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:39:40.477907', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:39:40.478339' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.478569', '2025-12-12 06:39:40.478578', '$2a$04$Jge1TmcGjMax3LJCB8iYiehrFgsVdMwdWQwoARhb4RQ9qaBx.hkvO', '2025-12-12 06:39:40.478569', 'expertuser')[0m
Completed 200 OK in 7ms (Views: 0.0ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 3.3ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 93 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.479290', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.479290', 93)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 188b269c-dc64-4f21-9a23-68f4eb493afc) to Test(default) with arguments: 28
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.479935', 92, NULL, 'waiting', 'First', '2025-12-12 06:39:40.479935')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.484986', '2025-12-12 06:39:40.484996', '$2a$04$ixDZK.SqriCRe6StyIEBl.sXctjFGdD21xdeqU3XypivHXTb34aji', '2025-12-12 06:39:40.484986', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.486956', '2025-12-12 06:39:40.486968', '$2a$04$9DEW4PVT1y5fd8cdlSGN..aY7iXvfXcElgolYUYSFip85w8elnce6', '2025-12-12 06:39:40.486956', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.488312', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.488312', 10)[0m
  [1m[35m (484.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: cbd4b6c7-8609-4b52-903d-daeb729319c3) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.490565', 92, NULL, 'waiting', 'Second', '2025-12-12 06:39:40.490565')[0m
Processing by ExpertController#profile as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.496727', '2025-12-12 06:39:40.496745', '$2a$04$lBh/d4TC7hOvB43s425rCOeg2/y1q4wTplvORYimVsJUjj2nj8/rS', '2025-12-12 06:39:40.496727', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.499801', '2025-12-12 06:39:40.499812', '$2a$04$/5t8cbw6HE9vAmYKvJzDxOQasoaJlhBvbHace34Bf4NAPt1Fjt3Hq', '2025-12-12 06:39:40.499801', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.501303', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.501303', 12)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1e266599-9eb2-4995-869e-ec9f7c8bdb81) to Test(default) with arguments: 4
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.501404', 92, NULL, 'waiting', 'Third', '2025-12-12 06:39:40.501404')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (172.8ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 93 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 93 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 42 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 43 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 44 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 93 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 1.0ms (10 queries, 0 cached) | GC: 0.2ms)
  [1m[36mActiveRecord::SchemaMigration Load (6.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.514014', '2025-12-12 06:39:40.514024', '$2a$04$y8eUk/PNTRfQL2jJta5K.O4VC6uV.1dWqYjKvro3yTiBxc0H7bISi', '2025-12-12 06:39:40.514014', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.514475', '2025-12-12 06:39:40.514486', '$2a$04$NYtHo/3O3.1we.Qq64DTgeKMnrU5EiXTB1z.CEJZhlZ24qbE93qI.', '2025-12-12 06:39:40.514475', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.515600', '2025-12-12 06:39:40.515612', '$2a$04$CSzC9bhpn3WyafCm4NyTdelepadngkz2SRAoY6kGX29vCQuT27JrK', '2025-12-12 06:39:40.515600', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 95 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.516560', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.516560', 95)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3effee66-0319-4397-9295-65fd2e8d9fe6) to Test(default) with arguments: 29
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.516569', '2025-12-12 06:39:40.516579', '$2a$04$qmtAOJX3UZNAeW15sCr9Guw8DcyQ6L8kJCXclW6VWzwPE..E15qL.', '2025-12-12 06:39:40.516569', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.517319', 94, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 06:39:40.517319')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.518489', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.518489', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (95, '2025-12-12 06:39:40.518250', 94, NULL, 'active', 'Assigned Conversation', '2025-12-12 06:39:40.518250')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 95 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: daec64c7-fa3b-45b4-af24-2ab0a6f1d0b0) to Test(default) with arguments: 5
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 95 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 94 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 45 AND `messages`.`sender_id` != 95 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 95 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 94 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 95 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 46 AND `messages`.`sender_id` != 95 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.525452', '2025-12-12 06:39:40.525463', '$2a$04$fhhEAsnVjvP1zqFU0P9HTOr6BWiI2EB98xcoSFnc32zAWzB4P5oFu', '2025-12-12 06:39:40.525452', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.526619', '2025-12-12 06:39:40.526630', '$2a$04$eeRbkdyc7Y/ag7cGEfn3QOsYXBd.ogABoWOczbho6RSwq2.mOOKxy', '2025-12-12 06:39:40.526619', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.527071', '2025-12-12 06:39:40.527081', '$2a$04$UPYAYbn.d/NZrw9BLKCHOubhEHNDteJD8meYIfUrOdPmHQ01CIYJq', '2025-12-12 06:39:40.527071', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 97 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.527841', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.527841', 97)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: dafba9f2-f80d-4e02-b55a-64844f00a018) to Test(default) with arguments: 30
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.529254', '2025-12-12 06:39:40.529264', '$2a$04$TKLuAFQVkU4ui6zth4RLVeTx3B3DiuE.tvTa8ntLAc0JlXZy2IxmK', '2025-12-12 06:39:40.529254', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.529597', '2025-12-12 06:39:40.529607', '$2a$04$gglNlvcM7xfGi3yQie8dL.1Q6StSP/t32mbgl.O95s.wtxhrlev3a', '2025-12-12 06:39:40.529597', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 98 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.530656', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.530656', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 98 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 98 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0a00c688-f30e-4587-9f3d-ec8da6a98bb4) to Test(default) with arguments: 6
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[35m (147.9ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 1.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.535593', '2025-12-12 06:39:40.535604', '$2a$04$H2LvggaOvboMNHWkytZQ/ue4b11tIYPaOWjAabf/8/hoi2MCHHJ1C', '2025-12-12 06:39:40.535593', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.537043', '2025-12-12 06:39:40.537052', '$2a$04$JrKEPGr54zUudnUd75YzDeoGA32Na0LM1d4f5kG3uMtdGu1zHvhLq', '2025-12-12 06:39:40.537043', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 100 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.537973', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.537973', 100)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 66260159-ee10-4bce-8b1e-8357f23e823b) to Test(default) with arguments: 31
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (100, '2025-12-12 06:39:40.538600', 99, NULL, 'active', 'Test', '2025-12-12 06:39:40.538600')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[35m (95.4ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.542086', '2025-12-12 06:39:40.542097', '$2a$04$RekidpY0FxatiEYICIAHpuYC/At5V.7wOp4XHI6GuTNm3JwSnZkWW', '2025-12-12 06:39:40.542086', 'testuser')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.542879', 47, '2025-12-12 06:39:40.543000', 100, '2025-12-12 06:39:40.539757', 'resolved', '2025-12-12 06:39:40.543000')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 100 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 100 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 100 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 47[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.542767', '2025-12-12 06:39:40.542769')[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.545338', '2025-12-12 06:39:40.545356', '$2a$04$oMctmAfasm9PpH/iuS/BhekGlTxZPYCtkkJ8a.9KVRA0Po5Z3oAEy', '2025-12-12 06:39:40.545338', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
--------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.547892', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.547892', 18)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8bdb4de3-4f3b-4922-89c0-9b51aa655219) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.550123', '2025-12-12 06:39:40.550136', '$2a$04$xcWskzKAsg56.vF0kriS6eGpOqB6x.e5ZKd1VL/BT4KwjQEj17w52', '2025-12-12 06:39:40.550123', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.551601', '2025-12-12 06:39:40.551610', '$2a$04$ws9y7eAxdX5WxrJ37GqiNuBrYRU9coddQ/Tgp0Qs4CNJ/2Ueld1xO', '2025-12-12 06:39:40.551601', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 102 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.552061', '2025-12-12 06:39:40.552074', '$2a$04$anxye1TvJKRebT4jP2o0HOke8whbgrF7UP/57EJOOdYamc1Kj1cZS', '2025-12-12 06:39:40.552061', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.552360', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.552360', 102)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6cbe55d4-e898-461c-a6a5-c6768259be9f) to Test(default) with arguments: 32
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (102, '2025-12-12 06:39:40.553023', 101, NULL, 'active', 'Test', '2025-12-12 06:39:40.553023')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/48/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "48"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Create (6.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.547575', '2025-12-12 06:39:40.547577')[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Filter chain halted as :ensure_expert! rendered or redirected
--------------------------------------------------------------------------------------------
Completed 403 Forbidden in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 1.0ms)
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.558101', '2025-12-12 06:39:40.558111', '$2a$04$KJL1fnZhNOblx/4gkJTBk.gVpCh56Tslytm4bacrHQdpkRULjrVQ6', '2025-12-12 06:39:40.558101', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.559535', '2025-12-12 06:39:40.559547', '$2a$04$ucxe.aJL5Ea.SdXFRQJQYeq5KUcobG77glFX6nCcAPSaxySkZO3Ea', '2025-12-12 06:39:40.559535', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 104 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.560323', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.560323', 104)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1943167c-c103-41d8-94e7-03079d7c4b75) to Test(default) with arguments: 33
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.561876', '2025-12-12 06:39:40.561886', '$2a$04$xGflwINqOfZex7V2AHJYcuPU5NGpgm/O0GOuHH1A4MWlEqGnfuBwW', '2025-12-12 06:39:40.561876', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 105 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:39:40.562576', NULL, NULL, NULL, '2025-12-12 06:39:40.562576', 105)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.562564', '2025-12-12 06:39:40.562574', '$2a$04$py0.DGUEvbZmxpFdoBWF4O5EqaRZ6pWIi9daUhtOyWTKYI/LeqbVu', '2025-12-12 06:39:40.562564', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8e498b33-cef2-43ca-a24b-7c64bcd94da7) to Test(default) with arguments: 34
  [1m[35m (44.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (105, '2025-12-12 06:39:40.563096', 103, NULL, 'active', 'Test', '2025-12-12 06:39:40.563096')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/49/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "49"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 104 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.564024', '2025-12-12 06:39:40.564034', '$2a$04$bUNSpehqKzyC/ucQQ5xRCO3vPRiCWNUEP3MXoewjWSCpAgoLrTHcy', '2025-12-12 06:39:40.564024', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 104 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 49 LIMIT 1[0m
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.1ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.564737', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.564737', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 205f41fa-dcef-4d9f-984b-42eedd3216e7) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.565367', 20, NULL, 'active', 'First', '2025-12-12 06:39:40.565367')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.569619', '2025-12-12 06:39:40.569628', '$2a$04$z.ZvqNJPXs4oU5PQToIdh.ph3cZ1cRWpn4PjYAr0FkylTPml8wVky', '2025-12-12 06:39:40.569619', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.571029', '2025-12-12 06:39:40.571039', '$2a$04$INVfWi3SdyafSkwGLOvIOev3YGhZ/OfhXIMEnKaWjjSVAI.AWDIwe', '2025-12-12 06:39:40.571029', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (109.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 107 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.571811', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.571811', 107)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9ae9fa4b-5dc1-42c4-85d2-81892d36318e) to Test(default) with arguments: 35
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mActiveRecord::InternalMetadata Create (8.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.563956', '2025-12-12 06:39:40.563957')[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 107 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 107 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.573745' WHERE `expert_profiles`.`id` = 35[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 914b063b-3235-477d-85a2-9f7629286ea5) to Test(default) with arguments: 35
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (3 queries, 0 cached) | GC: 0.2ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.576042', 20, NULL, 'active', 'Second', '2025-12-12 06:39:40.576042')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (34.5ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.579432', '2025-12-12 06:39:40.579444', '$2a$04$DykskswHoysnqhOcnAJlAePW6ZoMRS4OdVvOJzrrm4JRBt00ntwGG', '2025-12-12 06:39:40.579432', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.574171', '2025-12-12 06:39:40.574172')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.580917', '2025-12-12 06:39:40.580927', '$2a$04$UcC6s1r2lNC4MDFvMlRZr.WslIP0ynAtmsEHbWe84mwa.g6a3.W2G', '2025-12-12 06:39:40.580917', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 109 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.581686', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.581686', 109)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3fdf846d-93eb-4158-a82c-50871e8ae69f) to Test(default) with arguments: 36
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.582380', 108, NULL, 'resolved', 'First', '2025-12-12 06:39:40.582380')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.582938', 108, NULL, 'resolved', 'Second', '2025-12-12 06:39:40.582938')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.583589', 108, NULL, 'resolved', 'Third', '2025-12-12 06:39:40.583589')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 06:39:40.584020', 50, '2025-12-12 06:39:40.584197', 109, NULL, 'resolved', '2025-12-12 06:39:40.584197')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 06:39:40.584618', 51, '2025-12-12 06:39:40.584755', 109, NULL, 'resolved', '2025-12-12 06:39:40.584755')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 06:39:40.585193', 52, '2025-12-12 06:39:40.585329', 109, NULL, 'resolved', '2025-12-12 06:39:40.585329')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[35m (7.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.579557', '2025-12-12 06:39:40.579558')[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 109 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 109 LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 109 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (52, 51, 50)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.586886', 20, NULL, 'active', 'Third', '2025-12-12 06:39:40.586886')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:39:40.587511' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.587139', '2025-12-12 06:39:40.587140')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.589895', '2025-12-12 06:39:40.589966', '$2a$04$EbURxjh5Fd/yfMdV59WjpOHEMHqq4nmeKL.8K2RZwdr.GUkPP1Y/W', '2025-12-12 06:39:40.589895', 'testuser')[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 21 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.592302', '2025-12-12 06:39:40.592315', '$2a$04$Evo4PqWpKWU0eKdb9mXzhO9xyPqCIApJlbtTDPV1QH8rva0EVATaW', '2025-12-12 06:39:40.592302', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.592801', '2025-12-12 06:39:40.592813', '$2a$04$//qRfMRD4iCIEInKPqabuukxyOQGIxikYjmpgLM4ZTgWgDeggyfNy', '2025-12-12 06:39:40.592801', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.594623', '2025-12-12 06:39:40.594635', '$2a$04$FNaw85rqlUyGFE2YwYFNluzHa5EaI/55caZflBArpPkbBbdUs.Oma', '2025-12-12 06:39:40.594623', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (550.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 111 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.595489', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.595489', 111)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b280f579-3de0-479f-94cf-e59217a1b834) to Test(default) with arguments: 37
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (106.2ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.597092', '2025-12-12 06:39:40.597102', '$2a$04$yMn/sA1z5/Bb5dbaHkhPVucBXTh7YYUcvCE6MlCRBSrsCn2dV48Oy', '2025-12-12 06:39:40.597092', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 112 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 112 LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 112 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.598669', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.598669', 2)[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 96860972-ebef-4146-8d20-873a7c7d5c55) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.600716', '2025-12-12 06:39:40.600730', '$2a$04$4nEJKzLt8WEnWiscG94xA.Zeb073uihBynUwOXC/PeYxADJwwdEJi', '2025-12-12 06:39:40.600716', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.602303', '2025-12-12 06:39:40.602313', '$2a$04$mEUAvkF7wpsGqLiCh0h0dOEJbRc3uZ.IoJyLI7rYaNuEtYGfNj/m2', '2025-12-12 06:39:40.602303', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.603090', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.603090', 23)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 13b72a07-d6dc-42d7-adae-29bfc1f9ca7b) to Test(default) with arguments: 9
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.603596', '2025-12-12 06:39:40.603607', '$2a$04$5up32y8L3hUe6HsRI51fYuhmCk3V38vngppK/9LPzCkRA3XVyIC3i', '2025-12-12 06:39:40.603596', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (5.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.604694', '2025-12-12 06:39:40.604703', '$2a$04$x/J9ReVd36MEovTvWq9IBehCjB62xw/rueKpeL9aodCJcvj/Ul0EC', '2025-12-12 06:39:40.604694', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.605215', '2025-12-12 06:39:40.605224', '$2a$04$NOvK8fa39b0JpcjoAK8azueJnLIaleVdvRCwBSLLv5zGUiyXhAAym', '2025-12-12 06:39:40.605215', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.605162', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.605162')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:39:40.605408', NULL, NULL, NULL, '2025-12-12 06:39:40.605408', 24)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 34991d8e-cedf-4325-813f-cd238fc159a5) to Test(default) with arguments: 10
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 114 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.606006', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.606006', 114)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0966ef66-a5c4-4c3d-b1ef-44db20f39b42) to Test(default) with arguments: 38
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:39:40.606037', 22, NULL, 'active', 'Test', '2025-12-12 06:39:40.606037')[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/7/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "7"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (5.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.611820', '2025-12-12 06:39:40.611834', '$2a$04$G.wtW4oClJOi2oaU8ABe.uUKb4bqA4fcSVuZot4sanEG/oz9VppD6', '2025-12-12 06:39:40.611820', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.613474', '2025-12-12 06:39:40.613487', '$2a$04$3gix8omoIkGLhn1Yc1s1Ou7ZfFQIR/AQ9QC6Jy2Wsbx2CjdS7Xx0m', '2025-12-12 06:39:40.613474', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 116 LIMIT 1[0m
  [1m[35m (663.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.614504', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.614504', 116)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.614637', '2025-12-12 06:39:40.614648', '$2a$04$.js7pCaest7Cd8oca86xOOK8eQfqB23JeT/IwhXRc1vJdIzgRjC52', '2025-12-12 06:39:40.614637', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 88ba66ff-ba2d-4b5d-9c3f-57b5a4f2ef4a) to Test(default) with arguments: 39
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (116, '2025-12-12 06:39:40.615465', 115, NULL, 'active', 'Test', '2025-12-12 06:39:40.615465')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.615539', '2025-12-12 06:39:40.615599', '$2a$04$RgSWpS69z7RDKHdZIqCaUeSvocVgXDyKRdr1GIvh7lMJHZta3v8Rm', '2025-12-12 06:39:40.615539', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.616053', 53, '2025-12-12 06:39:40.616140', 116, NULL, 'active', '2025-12-12 06:39:40.616140')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.616238', '2025-12-12 06:39:40.616248', '$2a$04$xrpc37OITXGVRogN.wmCyegZ9bDG3Ov7tve.0JMtfymai8mzIDFD6', '2025-12-12 06:39:40.616238', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/53/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "53"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 26 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 116 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.617057', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.617057', 26)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f0b99f8-9f8b-4ed3-9d86-8a953a4e7a58) to Test(default) with arguments: 11
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 116 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 53 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.617740', '2025-12-12 06:39:40.617750', '$2a$04$qURp2fcTyIX33gR9dScRPu7OXspoIvsYxOIA.E1iLAihbd9Uqn/VO', '2025-12-12 06:39:40.617740', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:39:40.618124' WHERE `conversations`.`id` = 53[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.618776', '2025-12-12 06:39:40.618787', '$2a$04$MicYbITa5VQgy7edrPNoKuQZ4neqsOTwWKV0wpzC8pX.QkIZ0GeXm', '2025-12-12 06:39:40.618776', 'nonexpert')[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 53 AND `expert_assignments`.`expert_id` = 116 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:39:40.619240', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:39:40.619374' WHERE `expert_assignments`.`id` = 5[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 53 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (36.6ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.625264', '2025-12-12 06:39:40.625275', '$2a$04$9eQKFoiM/engpc0ujEVlA.HcOpBiRiaEW4.x1u.KmwEQD7KOroteu', '2025-12-12 06:39:40.625264', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 117 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.626032', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.626032', 117)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 38f1b034-bec4-4eaa-927f-a3eae903aaaf) to Test(default) with arguments: 40
  [1m[36mExpertProfile Exists? (4.6ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.627519', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.627519', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 87725589-da7b-48a9-a284-9b52600d9403) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (12.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 2, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:39:40.632834' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.633767', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.633767')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
-------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.630426', '2025-12-12 06:39:40.630428')[0m
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.635901', '2025-12-12 06:39:40.635915', '$2a$04$JH63Pg875gw6Er0tWoQPPOnakBaSz.c8zLGN7Bq0w7dWHB9XPiHNe', '2025-12-12 06:39:40.635901', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.636064', '2025-12-12 06:39:40.636079', '$2a$04$KOkAC7MANNV/x1xOx3N.8.y.pHx6zF/WVHnw2fc4EAqVy7vrin1AW', '2025-12-12 06:39:40.636064', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 118 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.636880', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.636880', 118)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.637096', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.637096', 28)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 14797cd3-3a2f-44d4-89e5-583f0068e28b) to Test(default) with arguments: 41
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.636968', 1, '2025-12-12 06:39:40.637080', 2, NULL, 'active', '2025-12-12 06:39:40.637080')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: adb3ad12-56a8-41cb-82c4-be721a25356a) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 2.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.637574' WHERE `expert_profiles`.`id` = 41[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d679fd81-50f8-41fc-8e24-f54db8634ceb) to Test(default) with arguments: 41
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.635758', '2025-12-12 06:39:40.635759')[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.638291', '2025-12-12 06:39:40.638370', '$2a$04$y/zgcsotqXjQ6BirYDt9vuCq87DxkfH4kOg1m0da2CqDZ64Lf/WP6', '2025-12-12 06:39:40.638291', 'testuser')[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (449.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.640670', '2025-12-12 06:39:40.640685', '$2a$04$6qoJuqC9uJgAL1n4dRRI3uf1UbsS6lREy.O7IsB8d9fGfy6kE2kHW', '2025-12-12 06:39:40.640670', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.643948', '2025-12-12 06:39:40.643959', '$2a$04$qqw/zBnUWm9vjAP76VbyFu2M6mB6DEIJyOOYkia2Xrym.2k240GCG', '2025-12-12 06:39:40.643948', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 119 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.644562', '2025-12-12 06:39:40.644579', '$2a$04$0r5vUrYaEzty9qyrfnXGuesdQBY0YKQG.NIVjWCZLMW9plagfK4Ca', '2025-12-12 06:39:40.644562', 'expert3')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.644745', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.644745', 119)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 711ccdd3-d321-41f2-83e2-a7e3259156be) to Test(default) with arguments: 42
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.645596', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.645596', 3)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d93256de-18fc-4c92-8193-567ec6b04fdf) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.646501', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.646501', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.647017' WHERE `expert_profiles`.`id` = 2[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a9bad8f7-81d2-4189-9b7c-1f130b9eff79) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.651839', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.651839')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 2, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:39:40.660322' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (4.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.668565', '2025-12-12 06:39:40.668657', '$2a$04$uNsaxBnGN2iVCB4tZr4Y6eMtDIiMWlZcDBLQEFCxsuW2gQxFpE9ga', '2025-12-12 06:39:40.668565', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.670990', 1, '2025-12-12 06:39:40.671101', 2, NULL, 'active', '2025-12-12 06:39:40.671101')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 0.1ms | ActiveRecord: 7.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[35m (1264.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.675066', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.675066', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 309f3e11-b9d9-411d-bd27-480de0aacb5c) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.676708' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 854ab244-a600-411c-bdaf-c37b064df1a6) to Test(default) with arguments: 1
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (90.5ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (4.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (105.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.717169', '2025-12-12 06:39:40.717171')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.5ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.722003', '2025-12-12 06:39:40.722004')[0m
  [1m[35m (539.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (499.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (56.1ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.774114', '2025-12-12 06:39:40.774117')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.780139', '2025-12-12 06:39:40.780139')[0m
  [1m[35m (164.5ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (489.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (45.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.867422', '2025-12-12 06:39:40.867424')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.872512', '2025-12-12 06:39:40.872513')[0m
  [1m[35m (326.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (179.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (196.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (105.8ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (9.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (9.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (720.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (55.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (9.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (37.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (5.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (5.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (34.5ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (327.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (6.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Create (5.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.000874', '2025-12-12 06:39:41.000875')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (7.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.007823', '2025-12-12 06:39:41.007824')[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (5.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (52.3ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (31.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (5.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.022925', '2025-12-12 06:39:41.022926')[0m
  [1m[35m (6.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (31.2ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.027339', '2025-12-12 06:39:41.027340')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.029708', '2025-12-12 06:39:41.029710')[0m
  [1m[35m (6.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.035622', '2025-12-12 06:39:41.035623')[0m
  [1m[35m (5.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (43.2ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.047716', '2025-12-12 06:39:41.047717')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.052324', '2025-12-12 06:39:41.052324')[0m
  [1m[35m (29.8ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.059924', '2025-12-12 06:39:41.059926')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.3ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.064777', '2025-12-12 06:39:41.064778')[0m
  [1m[35m (27.4ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.076092', '2025-12-12 06:39:41.076096')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.3ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.080597', '2025-12-12 06:39:41.080598')[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:41 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.9ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (16.9ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (31.7ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mTruncate Tables (1201.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
-------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.516881', '2025-12-12 06:43:22.516970', '$2a$04$AT.Uog4eKEHxYSkPr./5tewS6XTSgMmcwPJaljj/aBjfHHNXRSNxa', '2025-12-12 06:43:22.516881', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.523332', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.523332', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f2f301d-4b08-4263-a1c7-629837b61b8f) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.530362' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1a19afb0-42b2-402b-a6ba-bbbcf0c1870d) to Test(default) with arguments: 1
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTruncate Tables (1222.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.547694', '2025-12-12 06:43:22.547804', '$2a$04$6S8mTdEHzLtz6Spyc07SfugUz4U/gUI0Ro3a9tKr6icKcda0cWHYm', '2025-12-12 06:43:22.547694', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (17.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.553913', '2025-12-12 06:43:22.553928', '$2a$04$dYVlB/.6FNz.F49xp6jbE.eEolv2xjzEw50NQfAPIXCh82vKQnVge', '2025-12-12 06:43:22.553913', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.555123', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.555123', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e0248fac-519f-4ae9-b071-a8cb6b1bda09) to Test(default) with arguments: 2
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.558668', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.558668', 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.564605', '2025-12-12 06:43:22.564617', '$2a$04$/xdxWr41acYT2S3pyHVVo.Ilo7E6wDCsQvnd7oluKMsbCloWbDmwG', '2025-12-12 06:43:22.564605', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0c179ea6-1f8b-4dfd-9fb5-9dfedb6f6494) to Test(default) with arguments: 1
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.565552', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.565552', 3)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6647b019-829a-424a-a62e-54fffa7d35b7) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.566185' WHERE `expert_profiles`.`id` = 3[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.577429', '2025-12-12 06:43:22.577440', '$2a$04$.2fI/oYdny63FUkB//zAR.5mCU2qHe2noO7tXHJCfsdiEhBt2/E1S', '2025-12-12 06:43:22.577429', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.578254', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.578254', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b2e1b88d-7f4e-444f-8127-392933a8e3ab) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.578792' WHERE `expert_profiles`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 441565f6-4109-425a-9c0a-745160299a76) to Test(default) with arguments: 4
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.586655', '2025-12-12 06:43:22.586664', '$2a$04$N95DO6smr4.7Ijz3Le4/YOzUp0vvtifNG4vulPcDYUVfs6O9kVm8C', '2025-12-12 06:43:22.586655', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (19.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.587600', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.587600', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eb48b393-b742-4731-9e7f-bba4baf7d943) to Test(default) with arguments: 5
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.600861', '2025-12-12 06:43:22.600876', '$2a$04$/kbjMK7saIuBPSsLiIR0FeFrhFI9Egyh45mJx0.1mJeg06.04qrkW', '2025-12-12 06:43:22.600861', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.603354', '2025-12-12 06:43:22.603368', '$2a$04$eyHl5y6pd2TjnOGpdbSI5uaSZMvjTvwi4kDRq9k5cgetZp93H3kba', '2025-12-12 06:43:22.603354', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.608769', '2025-12-12 06:43:22.608779', '$2a$04$4eZb2cglV2stCK2Ma6aCkuJGvtAuncOvgzQM6G2D3BHni4vYyGNUq', '2025-12-12 06:43:22.608769', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1312.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by AuthController#login as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.632013', `users`.`updated_at` = '2025-12-12 06:43:22.632990' WHERE `users`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 3.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.637289', `users`.`updated_at` = '2025-12-12 06:43:22.638168' WHERE `users`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 2.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1339.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#me as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.645327', '2025-12-12 06:43:22.645339', '$2a$04$3dhb0s8KPlD58HZm70Tp3.SU/wdghSOBSDSKoC5erj.EsY1ih1XMy', '2025-12-12 06:43:22.645327', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.646841', '2025-12-12 06:43:22.646851', '$2a$04$d7Sx5RBziW1SEsUK7efZDuaahTqPB1GhAlBbx/j8oOBsYsgrLzLaa', '2025-12-12 06:43:22.646841', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.647646', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.647646', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: afdb120f-3812-4972-923e-19f74b142aaf) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.650942', '2025-12-12 06:43:22.650954', '$2a$04$ZcoZu40FE02HHW0JxKeLsOuHV6biuojket5aiJ/GY60DMhufhAi7O', '2025-12-12 06:43:22.650942', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.652411', '2025-12-12 06:43:22.652420', '$2a$04$i0bgjxnQz/Q4hY5TztxETO87CEH7rCeFsvoysnmoxYSqNxjbzR3q6', '2025-12-12 06:43:22.652411', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.653413', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.653413', 9)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.653281', 3, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.653281')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fe072648-21a3-46a6-83a6-660dcd32f485) to Test(default) with arguments: 6
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.655500', '2025-12-12 06:43:22.655515', '$2a$04$glkmfDA3vU6cwK2uB1Pfru1kttLH2ZPt4p2SNrTRR1PpCVr8DUKSm', '2025-12-12 06:43:22.655500', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.661826', '2025-12-12 06:43:22.661841', '$2a$04$foONGMZHwGTo06yMLqlfn.Vrc4SBkY3rPXLSxgwkmSZSgW0USTF.q', '2025-12-12 06:43:22.661826', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.663083', '2025-12-12 06:43:22.663095', '$2a$04$LTlKzcHtPAlg3He2uS.iae0iDDIDqyA8zirKJogCuvej8L1.lAHeO', '2025-12-12 06:43:22.663083', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.663386', '2025-12-12 06:43:22.663396', '$2a$04$/1qfH5b1P6TSsEDKFsYRcePFk6HikzAQ3CO2cyKb37YZE5XRBLyRa', '2025-12-12 06:43:22.663386', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.664275', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.664275', 6)[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ed2c49cd-c0d3-4028-8f89-900a94f8a8a3) to Test(default) with arguments: 3
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.664632', '2025-12-12 06:43:22.664641', '$2a$04$9wrzvoHziH6ZGxWWtEDc4e.y379X3FlqCieZxdp8nGs0hdKvlfyqS', '2025-12-12 06:43:22.664632', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.665059', 5, NULL, 'active', 'First', '2025-12-12 06:43:22.665059')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.665447', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.665447', 12)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ab3229df-83c1-4f19-bade-a5186bc1491e) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.668802', '2025-12-12 06:43:22.668865', '$2a$04$ePkpODesvyQCyueueZw0I.prIVHeNJyDKmLAy9yKutQu8a/LBzMpq', '2025-12-12 06:43:22.668802', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.670916', 11, NULL, 'active', 'Test', '2025-12-12 06:43:22.670916')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.675215', 1, '2025-12-12 06:43:22.675308', 12, '2025-12-12 06:43:22.672006', 'resolved', '2025-12-12 06:43:22.675308')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.675965', 5, NULL, 'active', 'Second', '2025-12-12 06:43:22.675965')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.2ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 12 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.686032', '2025-12-12 06:43:22.686046', '$2a$04$xjimusJDbyivlyTnXeMgDeCzbP/4SJyCMMltTxO90p4j4qrtVOms2', '2025-12-12 06:43:22.686032', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.686808', 5, NULL, 'active', 'Third', '2025-12-12 06:43:22.686808')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:43:22.687491' WHERE `conversations`.`id` = 2[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.688026', '2025-12-12 06:43:22.688037', '$2a$04$HPlG1SXrG4vOWef64nly2.ZETxr0OWKK2GSr9vrzEcDukmbtQJkFu', '2025-12-12 06:43:22.688026', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.688880', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.688880', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0b13eb1b-f5ee-428f-9a41-05b353b25fcb) to Test(default) with arguments: 8
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.688846', '2025-12-12 06:43:22.688905', '$2a$04$bfvM21qLVPaIG7q6JM2sHeLfXG0Sce0.QMXcCtJAnSiGsjs0eESTC', '2025-12-12 06:43:22.688846', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.690912', '2025-12-12 06:43:22.690922', '$2a$04$D2FXb5wi07gZMPXn0vlbMONGrmYsrUZI7SCXatViVTncTorzHxod6', '2025-12-12 06:43:22.690912', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.691465', '2025-12-12 06:43:22.691475', '$2a$04$asu92aTJSRVIzSXmalWBcOr6KdJO23AjzAivHDLxbGxN2PKqyOZFm', '2025-12-12 06:43:22.691465', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTruncate Tables (1396.1ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 2.0ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.697587', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.697587', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.698373', '2025-12-12 06:43:22.698390', '$2a$04$6RM1cSf0mYmpKReMWnKDROlUlhm0h/l78VOvWEgLvr/1dVvDkQzOK', '2025-12-12 06:43:22.698373', 'newuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 82e342a8-b552-4937-97d0-df5dce54fe15) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-----------------------------------------------------------
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.701270', '2025-12-12 06:43:22.701283', '$2a$04$wk2DfOxwusqhMsiMNmbNd.9SjUFfPz/RLaFoYYePZrsdhmNfDD7TG', '2025-12-12 06:43:22.701270', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.702501', '2025-12-12 06:43:22.702513', '$2a$04$NJfKebtkF7wx6KHGMAEPVuhvU8m1KqmndOus03gRwSARd1fpGDgsK', '2025-12-12 06:43:22.702501', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.702889', '2025-12-12 06:43:22.702906', '$2a$04$GnPer6ID6CqDt0KYv37Bs.NPlLDYvloB7tinTdwXTjCSuwm9hG7B.', '2025-12-12 06:43:22.702889', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.703804', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.703804', 17)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.703966', '2025-12-12 06:43:22.703975', '$2a$04$.sC9PiP/X37zEKZloAW8WeRF882SH84nHLFhXStfyQ1jEKsE8k7kS', '2025-12-12 06:43:22.703966', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 59a08352-0084-4bc6-b92e-b54bf57dec06) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
Processing by ExpertController#queue as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.704792', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.704792', 8)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.704784', NULL, NULL, NULL, '2025-12-12 06:43:22.704784', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 101257a5-be21-458f-b1ef-c6a7e16e73eb) to Test(default) with arguments: 4
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 614d2489-2802-4699-8e5b-2ceb02fdcd62) to Test(default) with arguments: 1
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#profile as HTML
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
Completed 201 Created in 15ms (Views: 0.1ms | ActiveRecord: 3.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.710453', '2025-12-12 06:43:22.710466', '$2a$04$11sSEigGUtBbZxzcHOX8RudG5RN09sq1uLpSs2H96nuQJmSEVGe0e', '2025-12-12 06:43:22.710453', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.711663', '2025-12-12 06:43:22.711674', '$2a$04$55K0lt52nK/QVKp5AK4stOwjKz4cTsamvEPPQfyI.cI8X1Us8rHMO', '2025-12-12 06:43:22.711663', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.712182', '2025-12-12 06:43:22.712193', '$2a$04$7Pt9FK0fCt8S3mQsh1hrS.kYeVf.m7j5eX3mLeZ/yT6V/WOcJMIkG', '2025-12-12 06:43:22.712182', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.713144', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.713144', 19)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.713290', '2025-12-12 06:43:22.713301', '$2a$04$78RbrFGjTyt2g7qb2CCNO.0bQthaG/iwH1vjSV5oFrQ4vB7nYX5Oi', '2025-12-12 06:43:22.713290', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 76103ca0-73a5-4b34-b51b-1e8568aae337) to Test(default) with arguments: 10
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.714010', 18, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.714010')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.714209', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.714209', 10)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: da6e24d5-b625-4e86-a5da-fdedde068947) to Test(default) with arguments: 5
Started POST "/expert/conversations/2/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.715960', '2025-12-12 06:43:22.715972', '$2a$04$d226O2jvxY2FKGB/iR3jnOIoyZLH92bzLWb5ZOssU1bBREyPNX5Ri', '2025-12-12 06:43:22.715960', 'nonexpert')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 19, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:43:22.716531' WHERE `conversations`.`id` = 2[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.717316', 2, '2025-12-12 06:43:22.717426', 19, NULL, 'active', '2025-12-12 06:43:22.717426')[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.1ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.719423', '2025-12-12 06:43:22.719439', '$2a$04$JfWO8FIzYzjDhSfJshTo6.jgQmWIgNXyR/x4gJZfBd4mLQGFVPll6', '2025-12-12 06:43:22.719423', 'testuser')[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.721125', '2025-12-12 06:43:22.721138', '$2a$04$OpEojFpqUBAqu2e2/3Dh6ennDGqxhfSK1SiLaqi.qTnNt713QQYpi', '2025-12-12 06:43:22.721125', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.722032', '2025-12-12 06:43:22.722042', '$2a$04$tBe/xkleSa.6vyRRgVCJTuGnxCpqgSeqLiyhYHTs.B4jQJ0vR/rd6', '2025-12-12 06:43:22.722032', 'testuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.722021', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.722021', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4a3aa97b-bfbb-4ccf-99e2-07abc5509db2) to Test(default) with arguments: 2
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.723514', '2025-12-12 06:43:22.723523', '$2a$04$Ld6arwArYcsngad1MN043.7RwsnzJT0VcGt/K4rgCep5NQiOsu.kO', '2025-12-12 06:43:22.723514', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.724403', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.724403', 13)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad56452c-131e-4e0b-b400-fcf609b1ef66) to Test(default) with arguments: 6
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.724884', '2025-12-12 06:43:22.724905', '$2a$04$NfGbMB6ZSdz9udG/s0SUEO2Lose64WoCaFJLo3z1Q36th2ryh5ISa', '2025-12-12 06:43:22.724884', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.725104', 12, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.725104')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.726554', '2025-12-12 06:43:22.726564', '$2a$04$d7yQVuwtYLzPiSSoON6CVuZp3N.6/ndig/ejcWSF2Ya1AZNQH3U.K', '2025-12-12 06:43:22.726554', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.727439', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.727439', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 04e751fa-d1fc-4bd4-84e6-4adcd6376fdb) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
Started POST "/expert/conversations/5/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "5"}
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.728659' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.729108', '2025-12-12 06:43:22.729118', '$2a$04$w4dUP3cZTh/ORqgi6eyxCOC6sRJjQbvAOMATkrLMOeuM6k/JKTGwe', '2025-12-12 06:43:22.729108', 'otherexpert')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 560ebedd-2710-49ec-9a29-c83334e0c70b) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:43:22.729959', NULL, NULL, NULL, '2025-12-12 06:43:22.729959', 22)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 05069e0c-0667-4900-83e5-2f1e46301da2) to Test(default) with arguments: 12
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 13, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:43:22.730222' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.730655', 20, NULL, 'active', 'Test', '2025-12-12 06:43:22.730655')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/3/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.731007', 3, NULL, 'active', 'Test', '2025-12-12 06:43:22.731007')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.733826', 5, '2025-12-12 06:43:22.733957', 13, NULL, 'active', '2025-12-12 06:43:22.733957')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 1.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTruncate Tables (1436.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.737765', 1, '2025-12-12 06:43:22.737870', 4, NULL, 'active', '2025-12-12 06:43:22.737870')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
--------------------------------------------------------------------------------------------
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.740539', '2025-12-12 06:43:22.740550', '$2a$04$whFquZKzWsbY1ZJQ9whulOQmxSh3fZBGQ0zpjVuAyIyiQ7OB3ksM.', '2025-12-12 06:43:22.740539', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.740601', '2025-12-12 06:43:22.740612', '$2a$04$mDrpELFW2jzfFytedJ7Ta.RyFu0KFeprTer7OyBJGsB0Ae0MqMqcK', '2025-12-12 06:43:22.740601', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.741121', '2025-12-12 06:43:22.741141', '$2a$04$w3Cj0My6b9LUIrj8dT7Xou2w1cIvNd08Ec/EnV7Q9lgPbu/ebakRG', '2025-12-12 06:43:22.741121', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:43:22.741779' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742143', '2025-12-12 06:43:22.742152', '$2a$04$qQrJ7lowoxd2yWkyQgES/e32GR7V8tScJaKBjmPaosOJptNlBBjIq', '2025-12-12 06:43:22.742143', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742208', '2025-12-12 06:43:22.742218', '$2a$04$huM2B8njMSUEfnIzNqzOQu2KeMCeZJ6cJU/4W5989FBO3/IBS3uUm', '2025-12-12 06:43:22.742208', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.742878', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.742878', 24)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742830', '2025-12-12 06:43:22.742843', '$2a$04$95aQifsK2dbK16ZByEmejejb81EeSjqgvhqX3vA6VGchsfHCiAYJy', '2025-12-12 06:43:22.742830', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.743007', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.743007', 15)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b0abda24-3280-4ab7-8991-a1a540316128) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c5090bff-5efa-4bd6-82ca-7776e30da95a) to Test(default) with arguments: 7
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 1 AND `expert_assignments`.`expert_id` = 4 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.743697', 14, NULL, 'waiting', 'First', '2025-12-12 06:43:22.743697')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.743815', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.743815', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:43:22.743595', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:43:22.743762' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f518aac-276f-4681-8538-820822e52739) to Test(default) with arguments: 2
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.744489', '2025-12-12 06:43:22.744498', '$2a$04$fH/GvsNvhLp1.hPtxp4BL.BfEEaCa3EvIFlPghTZJL9ylbxD0shwS', '2025-12-12 06:43:22.744489', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1445.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:43:22.745280', NULL, NULL, NULL, '2025-12-12 06:43:22.745280', 25)[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7c751f30-e3d9-4f1d-9a51-f5a78935281a) to Test(default) with arguments: 14
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:43:22.746008', 23, NULL, 'active', 'Test', '2025-12-12 06:43:22.746008')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/4/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "4"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.747866', '2025-12-12 06:43:22.747937', '$2a$04$IQxvI6N.MqvQJSPzaU6Zj.JO9pYomhpAUtM.ATMtMWi19OjmM9H1i', '2025-12-12 06:43:22.747866', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750547', '2025-12-12 06:43:22.750558', '$2a$04$FUqUxDty2Q/xFcHwQh/7HucPdw.UirCI.CJzBvTe8cxg3jVgJfXlO', '2025-12-12 06:43:22.750547', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750840', '2025-12-12 06:43:22.750853', '$2a$04$1paChwyDF4UXnTEmS9.9U.Nhxk5eu7y2yqbpZAoUAguehhrjwYFkG', '2025-12-12 06:43:22.750840', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750918', '2025-12-12 06:43:22.750930', '$2a$04$IeP3FlYOy6QXa2wevaTa2OXOjcP3jqpbrEwt/JwEUDXXLagGFEsJ.', '2025-12-12 06:43:22.750918', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.752135', '2025-12-12 06:43:22.752144', '$2a$04$2NMFXsaFIM2cDlzDEbNzeOs0/dNEYkvRSL14/5ScVgbMGS2083zjm', '2025-12-12 06:43:22.752135', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.752377', '2025-12-12 06:43:22.752387', '$2a$04$vqBocly29EYd6vK1WfKvOudAg.jrwuqRH.Cn5otJ7yXgpnhS3WQfK', '2025-12-12 06:43:22.752377', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.753152', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.753152', 6)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.753252', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.753252', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.753449', '2025-12-12 06:43:22.753462', '$2a$04$puVbFpr17kqvz8sPApzsMeRE.Wc//7EI0ZFXT4zhl/IV11DUulNW6', '2025-12-12 06:43:22.753449', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5a80642f-2f2f-4f34-8e91-69b5b1d50034) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 00f51c19-0ab7-4ef8-9d47-6d63c0cd0b00) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.754428', 14, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.754428')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.754942', '2025-12-12 06:43:22.754952', '$2a$04$iTpwS0c0QcLTjzWBpqhjxe94ZiXH3KkPpvr91rUqxzbUs5RvzvBsi', '2025-12-12 06:43:22.754942', 'expertuser')[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.755361', '2025-12-12 06:43:22.755375', '$2a$04$6ySreqLNbJZGvHU0Aw0iBe4DauMXQW2fKs7l1OjXd6zkMM6n.pXLy', '2025-12-12 06:43:22.755361', 'nonexpert')[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.755750', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.755750', 27)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: deda0617-8870-40ad-9c4a-b3d17a781e51) to Test(default) with arguments: 15
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.756404', 5, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.756404')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/2/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.757381', '2025-12-12 06:43:22.757390', '$2a$04$HrzEmIlDGakKJFkeSXf9g.OcFi7FI5PCm5bjuv.oxEKSOTSCcclzK', '2025-12-12 06:43:22.757381', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.760425', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.760425', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1460.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: da09e945-5482-47c4-acdb-a7313c8214ec) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------------
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.763653', 5, NULL, 'resolved', 'First', '2025-12-12 06:43:22.763653')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.764642', 5, NULL, 'resolved', 'Second', '2025-12-12 06:43:22.764642')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.765283', '2025-12-12 06:43:22.765296', '$2a$04$oUsntTjQBDcha70Ay0abEuV4MRc06ULKe/EpkFV34lEyZCCbLWpQm', '2025-12-12 06:43:22.765283', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.765446', '2025-12-12 06:43:22.765462', '$2a$04$W9SM1xs2B/HW8E1UHFJSDeu.MXk6nMXoCRhkllYs8QG0e6bru4b9G', '2025-12-12 06:43:22.765446', 'testuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.765460', 5, NULL, 'resolved', 'Third', '2025-12-12 06:43:22.765460')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.765392', 14, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.765392')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.767030', '2025-12-12 06:43:22.767041', '$2a$04$f4EZIRuTfDef6Vban3lG/.SgrVYZ1I/pvZspCccsxOnO4Tcp/c7NC', '2025-12-12 06:43:22.767030', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.767923', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.767923', 9)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 18f5a40a-76fd-4e04-b2ac-0e5db8fc591c) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.768415', 29, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.768415')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.768770', 1, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 06:43:22.768770')[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.769621', 1, NULL, 'active', 'Assigned Conversation', '2025-12-12 06:43:22.769621')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 15 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 29 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 5ms (Views: 0.1ms | ActiveRecord: 1.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 06:43:22.766859', 1, '2025-12-12 06:43:22.775172', 6, NULL, 'resolved', '2025-12-12 06:43:22.775172')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 06:43:22.775918', 2, '2025-12-12 06:43:22.776120', 6, NULL, 'resolved', '2025-12-12 06:43:22.776120')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 06:43:22.776760', 3, '2025-12-12 06:43:22.776983', 6, NULL, 'resolved', '2025-12-12 06:43:22.776983')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.777637', '2025-12-12 06:43:22.777653', '$2a$04$ePTZJp3sEs5Y0YhHOY6YAurOhz1EUD8OocYPPt0Mt6K7BTWzFiFDC', '2025-12-12 06:43:22.777637', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.777966', '2025-12-12 06:43:22.777986', '$2a$04$Ufi5NPec0XjX/bte6MPFAOJMaL9UZN6.fD6zpjR0Pbna7vw2WiZ3y', '2025-12-12 06:43:22.777966', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.778828', 10, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.778828')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.779086', '2025-12-12 06:43:22.779106', '$2a$04$xgGVAeLF.1vqs6B/DSB9r.mbS91rYul0hYppFdQwA9Vnbkwu8iB1m', '2025-12-12 06:43:22.779086', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.779543', '2025-12-12 06:43:22.779555', '$2a$04$P3UULohcd0txkRyTvDibNuFmiTXC.DCnuvfPF5XCAMfzuuHGrrwDe', '2025-12-12 06:43:22.779543', 'expertuser')[0m
Started GET "/conversations/3" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.779928', 16, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.779928')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 6 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 31 LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "3"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.780666', NULL, NULL, '[]', '2025-12-12 06:43:22.780666', 31)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b2958dd9-7234-4aa6-a944-386e73eca940) to Test(default) with arguments: 16
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
Processing by ConversationsController#index as HTML
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 10 OR `conversations`.`assigned_expert_id` = 10) AND `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (31, '2025-12-12 06:43:22.781593', 30, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.781593')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (3, 2, 1)[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
Processing by ConversationsController#index as HTML
  [1m[36mConversation Load (1.0ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 16 OR `conversations`.`assigned_expert_id` = 16) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 30 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 30 OR `conversations`.`assigned_expert_id` = 30) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 16 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 30 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.2ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 30 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.8ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.788347', '2025-12-12 06:43:22.788366', '$2a$04$Q7Py35cVNYuaCCP9iAUviOb7bONnXBy2IIbwYGT1RMfpUovmv26Te', '2025-12-12 06:43:22.788347', 'testuser')[0m
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-----------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.790104', '2025-12-12 06:43:22.790118', '$2a$04$AIxG5RU.Hkuc691ki4edGuWj8FZqdODXcCSsKByLxxQzze9wPJTLq', '2025-12-12 06:43:22.790104', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.790974', '2025-12-12 06:43:22.790996', '$2a$04$n7A3nQNKBdpOsOxUQVqs1u3DphZa7M4BmZo9eeXjVbIVmTSWGCDVe', '2025-12-12 06:43:22.790974', 'testuser')[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.791115', '2025-12-12 06:43:22.791132', '$2a$04$2/Kh/mM8iCBDM9xDi0y34ebGvSQKfU3r8HpeX99Lla8Ob7iuoG9n6', '2025-12-12 06:43:22.791115', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.791223', 7, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.791223')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test"}
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.792886', '2025-12-12 06:43:22.792905', '$2a$04$RQ./K73k6AzOsB9jI0C79egiccwzieeQ1JWP94jXnc2cy9q2e7Via', '2025-12-12 06:43:22.792886', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.792925', '2025-12-12 06:43:22.793004', '$2a$04$1nv2KZVOmRTpLidNVvnl..Q50uoLegRtN.X//J7/rr/MvJhXKHWBC', '2025-12-12 06:43:22.792925', 'testuser')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.793866', NULL, NULL, '[]', '2025-12-12 06:43:22.793866', 12)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5c797255-45b4-414f-868a-a8d5fc12faa9) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#queue as HTML
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.794668', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.794668')[0m
Completed 201 Created in 5ms (Views: 0.1ms | ActiveRecord: 1.9ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/conversations/4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[31mROLLBACK[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "4"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.795901', '2025-12-12 06:43:22.795920', '$2a$04$39agzbi24KPwo8lmeEvq9e1RnS5RBPfW0OAI2jZFHFIttjv14.TYe', '2025-12-12 06:43:22.795901', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.795514', '2025-12-12 06:43:22.795569', '$2a$04$itMcNancEu0RtxxWhIEMoutzEIthMmBD1uNC.hlPpCgM3ilLbnC2y', '2025-12-12 06:43:22.795514', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 11 OR `conversations`.`assigned_expert_id` = 11) AND `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.798089', '2025-12-12 06:43:22.798102', '$2a$04$xncTDlBDRd2S/J4tJfW7H./kiR64xpg3e221Kh4PyR6TzKOWJT3a2', '2025-12-12 06:43:22.798089', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.798557', '2025-12-12 06:43:22.798571', '$2a$04$8UjRFicJcHiDEAhP8lRGjeplLeIh1E6AYLQh9mMo721jZ0D0djULa', '2025-12-12 06:43:22.798557', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.799341', '2025-12-12 06:43:22.799354', '$2a$04$Tug6C/cT86kyPpWxdKh3pOM3GQ3rn3cm/3XhIcEyYyu/mUkWEnRGe', '2025-12-12 06:43:22.799341', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.799544', '2025-12-12 06:43:22.799560', '$2a$04$cza2i0egM5M8MNEn.EWwVOct3iW3kXAbMRQg116CYbUX2dq.BeKoK', '2025-12-12 06:43:22.799544', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.800107', 33, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.800107')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Processing by ConversationsController#index as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.801541', '2025-12-12 06:43:22.801554', '$2a$04$vkUxgxtFkFQuFtpwPvEhE.Vs8mshuo.oFgyL655u6tLaUJ56etgNW', '2025-12-12 06:43:22.801541', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.802195', 9, NULL, 'waiting', 'Other Conversation', '2025-12-12 06:43:22.802195')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
Started GET "/conversations/5" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "5"}
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 33 OR `conversations`.`assigned_expert_id` = 33) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
----------------------------------------------------------------------
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 8 OR `conversations`.`assigned_expert_id` = 8) AND `conversations`.`id` = 5 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.803781', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.803781', 2)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 33 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 1.3ms)
----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.805093', '2025-12-12 06:43:22.805109', '$2a$04$f917gZm6t4ecVdfZRcxGCeftrb5RIMflymfvOspUUV9W1OwPwfazS', '2025-12-12 06:43:22.805093', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a310b345-c576-4480-9d3a-9a9804bcf3ce) to Test(default) with arguments: 1
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.805856', 13, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.805856')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.805902', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.805902', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.806283', '2025-12-12 06:43:22.806297', '$2a$04$.xFpPyBJbIsQyx5mI5esTOR7maAx/ALb6xQ4HF/KvvI9Ul693/H6e', '2025-12-12 06:43:22.806283', 'testuser2')[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#index as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 2.1ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) ORDER BY `conversations`.`updated_at` DESC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3223fdc4-d623-4f3a-a14e-fe3fd12d10d6) to Test(default) with arguments: 1
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 13 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.808944', `users`.`updated_at` = '2025-12-12 06:43:22.809139' WHERE `users`.`id` = 19[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.809703', '2025-12-12 06:43:22.809718', '$2a$04$.QUQge5mBiw5sMZCttP.W.aW3Mb8k2UbvfkdCdhcXLZ4OGaFowC6G', '2025-12-12 06:43:22.809703', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.812152', '2025-12-12 06:43:22.812166', '$2a$04$tXn6FBcA.3mX2/uatgbVmulgl6Rodb9maU9R9rTaoLNJ1HDZDG3ry', '2025-12-12 06:43:22.812152', 'test')[0m
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.812753', 1, NULL, 'active', 'Test', '2025-12-12 06:43:22.812753')[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.812948', '2025-12-12 06:43:22.812969', '$2a$04$XJ6guM6c3Jd/R58Mu8ugTuQMUESl.L0La0nx2DsH4PpF7NO9V30vq', '2025-12-12 06:43:22.812948', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.813919', '2025-12-12 06:43:22.813931', '$2a$04$Gn5WJlWA30/CoNL9Y0M9kuil/I0Qb489UX6TCuYSFmRAAlUDh72A6', '2025-12-12 06:43:22.813919', 'test')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.814357', 1, NULL, 'active', 'Test', '2025-12-12 06:43:22.814357')[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1480.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.815730', `users`.`updated_at` = '2025-12-12 06:43:22.816377' WHERE `users`.`id` = 34[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.0ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 1.0ms)
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.818155', '2025-12-12 06:43:22.818169', '$2a$04$FxA4E1nNVVUy1byh2uYYqeQZmUTeMSGpVy8NJoyFuXm5xL8Na5E7O', '2025-12-12 06:43:22.818155', 'newexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.817909', '2025-12-12 06:43:22.817987', '$2a$04$au/YmkmQsACnopFRReoD..vlv5rlTrlys1WlR.fsDnQiCEC3NVCOK', '2025-12-12 06:43:22.817909', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (1.0ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.818291', 1, '2025-12-12 06:43:22.818407', 2, NULL, 'active', '2025-12-12 06:43:22.818407')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.819404', NULL, NULL, NULL, '2025-12-12 06:43:22.819404', 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1f139bb3-a282-42f5-876b-1712532e311f) to Test(default) with arguments: 4
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.820087', `users`.`updated_at` = '2025-12-12 06:43:22.820920' WHERE `users`.`id` = 3[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.821102', '2025-12-12 06:43:22.821116', '$2a$04$4zKvjQP9wTxPhFSvPp3CluXeBg7rShKOAjRcATAcZLEr8mGhV93c2', '2025-12-12 06:43:22.821102', 'expertuser')[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.2ms (3 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1510.4ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
Completed 201 Created in 7ms (Views: 0.1ms | ActiveRecord: 2.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.825038', '2025-12-12 06:43:22.825055', '$2a$04$TbbaRP6k3dzS06yf42YNcOi96bNFWj.W0HjHjWc6Ixv8PSQJ15qJ.', '2025-12-12 06:43:22.825038', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.826361', NULL, NULL, NULL, '2025-12-12 06:43:22.826361', 15)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1774f48f-94dc-4552-ab20-776b1c28efd0) to Test(default) with arguments: 6
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Processing by AuthController#me as HTML
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.826958', '2025-12-12 06:43:22.826974', '$2a$04$qJA2N5EnSvTqz7Mvlxv4E.ZXm3AsUV8oT7QfEHcIfZB0mayCE9bpq', '2025-12-12 06:43:22.826958', 'testuser4')[0m
Completed 201 Created in 4ms (Views: 0.0ms | ActiveRecord: 1.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#logout as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.829606', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.829606', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
--------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7f27feca-bcaa-4d62-850d-5a376e02795c) to Test(default) with arguments: 1
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.8ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.832344', `users`.`updated_at` = '2025-12-12 06:43:22.832494' WHERE `users`.`id` = 35[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.832712', '2025-12-12 06:43:22.832728', '$2a$04$ZUCwjwO/jeOfvgSHXl9QZeYYffKNzkObQKOaeLPrs2oAiaomd0qM2', '2025-12-12 06:43:22.832712', 'testlogout')[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-------------------------------------------------------
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Processing by AuthController#login as HTML
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
------------------------------------------------------------
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 1.2ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.835446', `users`.`updated_at` = '2025-12-12 06:43:22.836303' WHERE `users`.`id` = 12[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
Processing by AuthController#me as HTML
Processing by AuthController#logout as HTML
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.839978', '2025-12-12 06:43:22.839997', '$2a$04$.EdNIBj0qyXtZ4cQjqti/u0ju8kSlKoW82r0pY9o6pQH0VxOhR3sS', '2025-12-12 06:43:22.839978', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.9ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.841080', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.841080', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6703b149-8d7c-4adb-bcb4-ca04ee35c574) to Test(default) with arguments: 7
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e] Performing GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) from Test(default) enqueued at 2025-12-12T06:43:22.842372506Z with arguments: "non-existent-id"
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e] Performed GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) from Test(default) in 0.46ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) to Test(default) with arguments: "non-existent-id"
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.842978', '2025-12-12 06:43:22.842997', '$2a$04$KuVYtVl6Q4NKhDg9/Ux11.tLMupgovXsWos/JZWJuCYOiS1Zz1UZC', '2025-12-12 06:43:22.842978', 'expert2')[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.844005', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.844005', 4)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 42c4c25f-dc17-45a1-b833-69cb328c8593) to Test(default) with arguments: 2
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323] Performing GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) from Test(default) enqueued at 2025-12-12T06:43:22.844927688Z with arguments: 2
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:43:22.848636' WHERE `conversations`.`id` = 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.849484', '2025-12-12 06:43:22.849500', '$2a$04$DQQtxxu4FTiYKSrLq2N2t.v3/UzeTzwwq1xmP2SZPlI6VAanU4kt2', '2025-12-12 06:43:22.849484', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.849813', '2025-12-12 06:43:22.849836', '$2a$04$cm0f..0SLCaUCTmJkB3ZFufy.EiLntno0NiHXrrui/SxX7m/uCXuy', '2025-12-12 06:43:22.849813', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.850037', '2025-12-12 06:43:22.850060', '$2a$04$3aczcMuQRufWca/zPVp0eu8GLbIcWZJ.rt6CrwMEM7FETp5iXWZ0S', '2025-12-12 06:43:22.850037', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 1 AND `expert_assignments`.`expert_id` = 2 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851107', '2025-12-12 06:43:22.851117', '$2a$04$mqcwQI35lE6SYZ5jsqkpGeW/SX0UY4Bgxgr9iAi.uisVi4u0AvhgS', '2025-12-12 06:43:22.851107', 'expertuser')[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:43:22.850860', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:43:22.851059' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851151', '2025-12-12 06:43:22.851170', '$2a$04$G64psJmaGDxOMTQ8WM0z1O87wFugf0n0D3jIbMVU7FqkHXSDRvj0K', '2025-12-12 06:43:22.851151', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.2ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851752', '2025-12-12 06:43:22.851768', '$2a$04$WXdPFL0ZocegPH/.j1Z.keEhG2o.MEHIwlsFy0tBPvNmK2qcjyFfG', '2025-12-12 06:43:22.851752', 'expertuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.851910', NULL, NULL, NULL, '2025-12-12 06:43:22.851910', 18)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851950', '2025-12-12 06:43:22.851963', '$2a$04$BIoVzhbncEvLmDBjS/BmoujE/R2/9O77XekT.J4VicdC7aoz416ka', '2025-12-12 06:43:22.851950', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4f0e40fe-46c2-406f-bd4c-09a5d9cdf01f) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.852180' WHERE `expert_profiles`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323] Performed GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) from Test(default) in 7.26ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) to Test(default) with arguments: 2
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.852754', 17, NULL, 'waiting', 'First', '2025-12-12 06:43:22.852754')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.852945', NULL, NULL, NULL, '2025-12-12 06:43:22.852945', 14)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.853049', NULL, NULL, NULL, '2025-12-12 06:43:22.853049', 4)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 74b5ffb5-c6fa-4b9b-94b5-d1d4ab92cab1) to Test(default) with arguments: 5
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8bb3dc89-1ea8-4c4a-8a57-0cd7bce2e1a9) to Test(default) with arguments: 2
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.853643', '2025-12-12 06:43:22.853659', '$2a$04$h.vsrqOOsoKRQU4hWSerPuKdspiim0oqpUbrYHXMyop.St.KrnYhu', '2025-12-12 06:43:22.853643', 'expertuser')[0m
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.854016', 3, NULL, 'waiting', 'Waiting', '2025-12-12 06:43:22.854016')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.854734', 3, NULL, 'active', 'Assigned', '2025-12-12 06:43:22.854734')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Processing by ExpertController#assignment_history as HTML
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.856211', NULL, NULL, NULL, '2025-12-12 06:43:22.856211', 37)[0m
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "4"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8f4ca77b-7d3e-4acd-9c15-4bd3017881c8) to Test(default) with arguments: 17
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.860030', '2025-12-12 06:43:22.860046', '$2a$04$vOfg3YMn0DN/VeQ/BRsCH.6B3HRb.jg8R5EPH6k88jRvlkOT8uEbq', '2025-12-12 06:43:22.860030', 'testuser')[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.860182', '2025-12-12 06:43:22.860199', '$2a$04$bSmMpC0uitD2oDqau7l5f.c7AkSKPR5idZQR8k7E8afuo1Ri4BZOC', '2025-12-12 06:43:22.860182', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-------------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.861454', '2025-12-12 06:43:22.861474', '$2a$04$mJro/tluRtiw8kFwnv6VPempFhIumlaBOvn6kH7NswXYloy48tlSS', '2025-12-12 06:43:22.861454', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.861986', '2025-12-12 06:43:22.861998', '$2a$04$nxvZY/IbmbftsVsu7Kzt3eoqMdISEATKrd1HwbDoabnXBo6iYDMrW', '2025-12-12 06:43:22.861986', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.862044', '2025-12-12 06:43:22.862064', '$2a$04$NROidQkHvg0Sd7R5Gf/x4.xjc6a/SG1f3Ey9H2SFb3hpbAhsennsi', '2025-12-12 06:43:22.862044', 'expertuser')[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 36 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.862993', NULL, NULL, NULL, '2025-12-12 06:43:22.862993', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.863024', '2025-12-12 06:43:22.863047', '$2a$04$4xI5CyeO7QhWj/FCqeRMzuERahfAQus5dUSkL.RpuqZgvcwn7y2VK', '2025-12-12 06:43:22.863024', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 029b9cd8-3ec7-4066-8b69-ec0dffb5a815) to Test(default) with arguments: 3
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.863232', NULL, NULL, NULL, '2025-12-12 06:43:22.863232', 4)[0m
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c252479b-198f-4646-afa4-5b03463ecfa7) to Test(default) with arguments: 2
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.863577', '2025-12-12 06:43:22.863595', '$2a$04$QDchry8pkDicB8z.Vs5pSu/i92XQGF6Tj8oxPmzIQIgn2O/Ej6myi', '2025-12-12 06:43:22.863577', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.863784', 17, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.863784')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.863988', 5, NULL, 'active', 'Active', '2025-12-12 06:43:22.863988')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.864313', 3, NULL, 'active', 'Test', '2025-12-12 06:43:22.864313')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.864679', NULL, NULL, NULL, '2025-12-12 06:43:22.864679', 16)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.864799', '2025-12-12 06:43:22.864810', '$2a$04$a/H53rHJ12oaxPCyS1VSwutTLFniEz0zyfA6cRlUoRoYqo5y8LAxW', '2025-12-12 06:43:22.864799', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.864768', 5, NULL, 'resolved', 'Resolved', '2025-12-12 06:43:22.864768')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b985b4de-f800-40a0-8a82-f2e9686fdea5) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=6" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
Started GET "/api/expert-queue/updates?expertId=16" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.865610', NULL, NULL, NULL, '2025-12-12 06:43:22.865610', 4)[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "16"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8f23937c-9d0c-496e-bbf8-984fe2471d44) to Test(default) with arguments: 2
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 4 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "6"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 1.9ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 2, '2025-12-12 06:43:22.869511', FALSE, 3, 'initiator', '2025-12-12 06:43:22.869511')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.869511', `conversations`.`updated_at` = '2025-12-12 06:43:22.870180' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 06:43:22.870653' WHERE `messages`.`id` = 1[0m
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.870830', '2025-12-12 06:43:22.870844', '$2a$04$xfvcEBc8PbYDTW5d6f15b.w3g5omO6WIelmz9evfmCIPXvpoWbWoi', '2025-12-12 06:43:22.870830', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 2, '2025-12-12 06:43:22.871165', FALSE, 4, 'expert', '2025-12-12 06:43:22.871165')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.871165', 3, NULL, 'active', 'First', '2025-12-12 06:43:22.871165')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.870890', '2025-12-12 06:43:22.870979', '$2a$04$jLSJpElWl2YuMYLUfxSy3.kgXr8NJsq0y7XNx07NBSINHriKxDBKq', '2025-12-12 06:43:22.870890', 'testuser3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.871165', `conversations`.`updated_at` = '2025-12-12 06:43:22.871660' WHERE `conversations`.`id` = 2[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Started GET "/api/messages/updates?userId=3&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872247', '2025-12-12 06:43:22.872264', '$2a$04$d6rbrh17EW0JruKVWZl6IOCjPoJeRXyWIG/ndnQH8fi.EUD621SW2', '2025-12-12 06:43:22.872247', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872572', '2025-12-12 06:43:22.872584', '$2a$04$aNRpalaXp9Kaw65erCa9jeZVBbuflsGWwgbMA0sWu43hCzTQGVED.', '2025-12-12 06:43:22.872572', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872044', '2025-12-12 06:43:22.872062', '$2a$04$zCXt5ZGfTf.rZEAuKfyP5ef1gnqz6f/2mgPll3S2ZkY1Ud20zHhLe', '2025-12-12 06:43:22.872044', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "3", "since" => "2025-12-11T06:43:22Z"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.873589', NULL, NULL, NULL, '2025-12-12 06:43:22.873589', 18)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.873799', '2025-12-12 06:43:22.873809', '$2a$04$AlPUBnzQXCsZAkP/7SM1NeR9D.nP.L0p1DVjZ0xNPxJ8lcdWxmLbu', '2025-12-12 06:43:22.873799', 'expertuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 69420e47-6a09-46b9-bb76-131146d1aec4) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.873852', '2025-12-12 06:43:22.873865', '$2a$04$7tlVfbWomNsSyUKuOjGhkeGZsXnINw.b1EyhK7wN4ZinU4eMX8DA6', '2025-12-12 06:43:22.873852', 'testuser')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 3 OR `conversations`.`assigned_expert_id` = 3)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 06:43:22.874490', 17, NULL, 'active', 'Test', '2025-12-12 06:43:22.874490')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.874712', NULL, NULL, NULL, '2025-12-12 06:43:22.874712', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 320f50d8-ba1e-4c98-8835-e923a409d4b2) to Test(default) with arguments: 3
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 2 AND (created_at >= '2025-12-11 06:43:22') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.874883', 17, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.874883')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.875617', '2025-12-12 06:43:22.875629', '$2a$04$BheLvLnXCd/YvaFSiYNa8ufNZq2eXXh0q.fCaEsz2zY33QKB6TncS', '2025-12-12 06:43:22.875617', 'expertuser')[0m
  Parameters: {"expertId" => "999999"}
Started GET "/api/conversations/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mUser Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.876691', NULL, NULL, NULL, '2025-12-12 06:43:22.876691', 8)[0m
  Parameters: {"userId" => "17"}
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 519af869-5e32-4e01-8e9b-c9e1bec64aad) to Test(default) with arguments: 4
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
Started GET "/api/expert-queue/updates?expertId=8" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.876572', '2025-12-12 06:43:22.876590', '$2a$04$BxBSUj9rHWChv8IFJ4Yy5OG6KPBd7Ak5WJV/qUuMZ9MdzcqV0PjwK', '2025-12-12 06:43:22.876572', 'expertuser')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 6, '2025-12-12 06:43:22.877526', FALSE, 17, 'initiator', '2025-12-12 06:43:22.877526')[0m
  Parameters: {"expertId" => "8"}
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.877526', `conversations`.`updated_at` = '2025-12-12 06:43:22.877985' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 8 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 39 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.879458', NULL, NULL, NULL, '2025-12-12 06:43:22.879458', 39)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e8c37308-14c6-40b2-bf38-77935b9ea0b4) to Test(default) with arguments: 18
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
--------------------------------------------------------------------------
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.882145', 3, NULL, 'active', 'Second', '2025-12-12 06:43:22.882145')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.882731', '2025-12-12 06:43:22.882744', '$2a$04$U7Qyd3fnK5d0klrwRiqU2uExLtMru465YrA5aN4D6cFGFGX56fBji', '2025-12-12 06:43:22.882731', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.882870', '2025-12-12 06:43:22.882884', '$2a$04$La52cRz61u.P53ph18sQyeAipH8XlnAy.n93OGvyii.EBB2MpMV2a', '2025-12-12 06:43:22.882870', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Create (0.5ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.883235', 38, NULL, 'waiting', 'As Initiator', '2025-12-12 06:43:22.883235')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884145', '2025-12-12 06:43:22.884158', '$2a$04$JxAW7wht7MT38eWEf.qKje8JZkwMc02vZC1t2dA7Kj8KuUSUgarai', '2025-12-12 06:43:22.884145', 'testuser')[0m
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884418', '2025-12-12 06:43:22.884428', '$2a$04$UuXGLvmYYJsCyzwL0jwpFO51GZ3Onj.rZ0dFNedOB06YGx8/yCsha', '2025-12-12 06:43:22.884418', 'expertuser')[0m
Started GET "/api/conversations/updates?userId=38" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884575', '2025-12-12 06:43:22.884589', '$2a$04$sl3WCyn2TH10zbUrZsmOpObqbzIQIszQWNVnCXX8V7A7c6Bf86H9e', '2025-12-12 06:43:22.884575', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  Parameters: {"userId" => "38"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.885387', NULL, NULL, NULL, '2025-12-12 06:43:22.885387', 6)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.885500', NULL, NULL, NULL, '2025-12-12 06:43:22.885500', 8)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b5aabd4d-8564-4e57-8c21-1e81bd61f923) to Test(default) with arguments: 3
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2d751d4c-5eb9-4322-a46c-70b41e376162) to Test(default) with arguments: 4
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.885812', '2025-12-12 06:43:22.885825', '$2a$04$LxrJYYpQAyikHCnfivkMfeCWM5HMq2F0CFbQgflHHCuqF0fmQJLPG', '2025-12-12 06:43:22.885812', 'expertuser')[0m
Started GET "/api/messages/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.886127', '2025-12-12 06:43:22.886147', '$2a$04$tC5epkG4FKbjq1b7/FYAo.DGd4lBTWm5SKW0xO/oaKSyvHLVr0A6y', '2025-12-12 06:43:22.886127', 'testuser')[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.886347', 5, NULL, 'waiting', 'Old', '2025-12-12 06:43:22.886347')[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:43:22.886972' WHERE `conversations`.`id` = 3[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.886984', NULL, NULL, NULL, '2025-12-12 06:43:22.886984', 10)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d64a5fad-fb55-4c87-bb24-45af16483c0e) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.887466', 5, NULL, 'waiting', 'New', '2025-12-12 06:43:22.887466')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=9" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 38 OR `conversations`.`assigned_expert_id` = 38) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Started GET "/api/expert-queue/updates?expertId=6&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "9"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.888052', '2025-12-12 06:43:22.888066', '$2a$04$GH4GBww1vSdI2J2r7YPnyemImOUa4VabFOowoXYj/JAjqvoYkEXQC', '2025-12-12 06:43:22.888052', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "6", "since" => "2025-12-11T06:43:22Z"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 38 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 1.8ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 6, '2025-12-12 06:43:22.888659', FALSE, 18, 'expert', '2025-12-12 06:43:22.888659')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.889090', NULL, NULL, NULL, '2025-12-12 06:43:22.889090', 20)[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.888659', `conversations`.`updated_at` = '2025-12-12 06:43:22.889189' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`created_at` ASC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 26848d38-fe55-472f-91e0-387bfb589745) to Test(default) with arguments: 9
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.890058', 19, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.890058')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`updated_at` DESC[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
Started GET "/api/conversations/updates?userId=19" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (6 queries, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "19"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 19 OR `conversations`.`assigned_expert_id` = 19) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.892401', '2025-12-12 06:43:22.892415', '$2a$04$F6XpUHmDOcMWY0SEPGga3OujyXKE3VHEJO7V6E0PIIvw1X1anGjwq', '2025-12-12 06:43:22.892401', 'testuser')[0m
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 19 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.893091', 3, NULL, 'active', 'Third', '2025-12-12 06:43:22.893091')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.893851', '2025-12-12 06:43:22.893863', '$2a$04$P4WXXUNKukNibBhuSC.xJugtISeLiM.fDupJoJziexR1HQ2Ht6dVm', '2025-12-12 06:43:22.893851', 'testuser')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:43:22.893840' WHERE `conversations`.`id` = 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.894027', '2025-12-12 06:43:22.894042', '$2a$04$LeqheYjtaU7y66/NNoN6fuqINCxl3HBiAWUwESgZLYvMxLi5Qvjfq', '2025-12-12 06:43:22.894027', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.894058', '2025-12-12 06:43:22.894071', '$2a$04$UNvyRbqkW82dwCcnYL20U.u.dlUT7leKGfwkpp3eRkjNjFXhoGgp2', '2025-12-12 06:43:22.894058', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.895046', NULL, NULL, NULL, '2025-12-12 06:43:22.895046', 10)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895087', '2025-12-12 06:43:22.895099', '$2a$04$dXVolUavVehbAYOLc3GFG.gav7PV8KQMH3x.zK7SXdsB9DNJNH/jS', '2025-12-12 06:43:22.895087', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7d22fef9-8798-4f72-8fd3-9101d14db5e8) to Test(default) with arguments: 5
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "4"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895529', '2025-12-12 06:43:22.895541', '$2a$04$/L/7rb1fKkVgJPls/Dc/VuH76QgQ/LDQaB.bE2rs23OyQYVVbLpbG', '2025-12-12 06:43:22.895529', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895814', '2025-12-12 06:43:22.895828', '$2a$04$MFJIWf.uHrvuCFbvPJN2Be/Yls1wMOOzthAJg5QrBJD1K2/HNK16y', '2025-12-12 06:43:22.895814', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.896008', 9, NULL, 'waiting', 'First', '2025-12-12 06:43:22.896008')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.896449', NULL, NULL, NULL, '2025-12-12 06:43:22.896449', 12)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 41 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9c8abf0f-2ca2-4ee4-9c3d-0b992d109a0a) to Test(default) with arguments: 6
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.896737', '2025-12-12 06:43:22.896750', '$2a$04$c4PsMjnFN1xe6ceB5y.JYOiH51d51jkiUHmUoMQPfBeWlvapOS8lK', '2025-12-12 06:43:22.896737', 'expertuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.896800', NULL, NULL, NULL, '2025-12-12 06:43:22.896800', 41)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 711ab920-5671-4a1d-9ccd-b45792d1de1e) to Test(default) with arguments: 19
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.897170', 11, NULL, 'waiting', 'Old', '2025-12-12 06:43:22.897170')[0m
Processing by AuthController#refresh as HTML
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.897707', NULL, NULL, NULL, '2025-12-12 06:43:22.897707', 8)[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:43:22.897693' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 42ff07c7-7751-4477-bce8-a7806579c140) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.898207', 11, NULL, 'waiting', 'New', '2025-12-12 06:43:22.898207')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.897707', 40, NULL, 'waiting', 'User Conv', '2025-12-12 06:43:22.897707')[0m
Started GET "/api/conversations/updates?userId=11&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:43:22.898569', 7, NULL, 'active', 'Test', '2025-12-12 06:43:22.898569')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Parameters: {"userId" => "11", "since" => "2025-12-11T06:43:22Z"}
Filter chain halted as :authenticate_with_session! rendered or redirected
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 06:43:22.899321', FALSE, 8, 'expert', '2025-12-12 06:43:22.899321')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.899542', '2025-12-12 06:43:22.899557', '$2a$04$.Ysttp5NnCeLuGMojmzS4usL/fP5lOBZ7CuBe9RzoAiAeEuhDlPzG', '2025-12-12 06:43:22.899542', 'testuser')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.899321', `conversations`.`updated_at` = '2025-12-12 06:43:22.899719' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 4 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 6, '2025-12-12 06:43:22.899867', FALSE, 17, 'initiator', '2025-12-12 06:43:22.899867')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Started GET "/api/messages/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.899867', `conversations`.`updated_at` = '2025-12-12 06:43:22.900404' WHERE `conversations`.`id` = 6[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.900484', '2025-12-12 06:43:22.900498', '$2a$04$/CcX8hMmUhS6Uu7m4Y85buhVGxhbFdmZVHErEkEYeTTdjam5W9xEi', '2025-12-12 06:43:22.900484', 'otheruser')[0m
Processing by AuthController#refresh as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
Started GET "/api/messages/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.901240', '2025-12-12 06:43:22.901250', '$2a$04$Hs3GYFvQyY5CPzqOuebEF.ULO8sviVeWIMjkH0voR0C69VQDSZQ2K', '2025-12-12 06:43:22.901240', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.901205', 42, NULL, 'waiting', 'Other Conv', '2025-12-12 06:43:22.901205')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "17"}
  [1m[36mConversation Pluck (0.3ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7)[0m
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 11 OR `conversations`.`assigned_expert_id` = 11) AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 5 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.902158', NULL, NULL, NULL, '2025-12-12 06:43:22.902158', 22)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Pluck (0.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17)[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (5 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 29412bda-4173-4ef0-a170-340c76acf8d0) to Test(default) with arguments: 10
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 2.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.902987', 21, NULL, 'active', 'As Expert', '2025-12-12 06:43:22.902987')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (17, 18)[0m
Started GET "/api/conversations/updates?userId=22" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "22"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTruncate Tables (1585.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 22 OR `conversations`.`assigned_expert_id` = 22) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 9, '2025-12-12 06:43:22.903998', FALSE, 40, 'initiator', '2025-12-12 06:43:22.903998')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.903998', `conversations`.`updated_at` = '2025-12-12 06:43:22.904920' WHERE `conversations`.`id` = 9[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 22 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 10, '2025-12-12 06:43:22.905427', FALSE, 42, 'initiator', '2025-12-12 06:43:22.905427')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.905427', `conversations`.`updated_at` = '2025-12-12 06:43:22.905851' WHERE `conversations`.`id` = 10[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Started GET "/api/messages/updates?userId=40" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "40"}
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 2.3ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.906911', 9, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.906911')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 40 OR `conversations`.`assigned_expert_id` = 40)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.907906', '2025-12-12 06:43:22.907918', '$2a$04$EL4Jbps92Oqw97H.6NuDpujh5P095IfqUkkBWv2/Rx0wfSa/lnXE.', '2025-12-12 06:43:22.907906', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.908073', '2025-12-12 06:43:22.908087', '$2a$04$3rwHp/BBQA74e5kgGPb/HeZIuX4CCuMMDWU7CjZPsP/Jn5NFGRqdy', '2025-12-12 06:43:22.908073', 'testuser')[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.908238', '2025-12-12 06:43:22.908259', '$2a$04$jw6aZWhyvrVhQ8XyiadBJOITTz/dC9n4bioi/72T2mq4pZsLlYneW', '2025-12-12 06:43:22.908238', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909241', '2025-12-12 06:43:22.909255', '$2a$04$Q1F4tPrnIVgdvFBjRTVhJeqJlOX6gGyhNoIvrGJG0x1XCIuJHYP0C', '2025-12-12 06:43:22.909241', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909551', '2025-12-12 06:43:22.909561', '$2a$04$bHtNWqhBxxSC.tHSkyHRmO2gwhDJtQ29XDSkwGGB7cqbHJGyRv.au', '2025-12-12 06:43:22.909551', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909738', '2025-12-12 06:43:22.909748', '$2a$04$ew8BKhnXwPNNysQImV.Ee.z99d9YdWea9jk1WGLRrHGiq/UyYRq5i', '2025-12-12 06:43:22.909738', 'expertuser')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910025', '2025-12-12 06:43:22.910036', '$2a$04$OFdIc1O7ZSkXEvBjMYJTfukCZYetJEsScTAQEODnkRETyMKpfGsWG', '2025-12-12 06:43:22.910025', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:43:22.910196', 9, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.910196')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (14, '2025-12-12 06:43:22.910419', 13, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.910419')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910541', '2025-12-12 06:43:22.910556', '$2a$04$3FExhiJc0T0S/kScaAilbu/yKHViLiEukT4eDpwp/x3kM9XoEvbrC', '2025-12-12 06:43:22.910541', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910795', '2025-12-12 06:43:22.910808', '$2a$04$3holCPQ18T12aOZh9/BIgeW6BC/ERLY0kiG.UmtXWD8WJHxhSWike', '2025-12-12 06:43:22.910795', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "6", "content" => "Expert reply"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (20, '2025-12-12 06:43:22.911667', 19, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.911667')[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912221', '2025-12-12 06:43:22.912235', '$2a$04$uXeAV94hGfCiS.52xPi5X.rGELqw6WDSlC8neNoyp4EnKs.75syYy', '2025-12-12 06:43:22.912221', 'expertuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912331', '2025-12-12 06:43:22.912347', '$2a$04$VS4qsdd1nZ8Prx7h2nEhxuufdq9GDHhldX/yuvNgmp3woTPlHMPQu', '2025-12-12 06:43:22.912331', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:43:22.912958', 23, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.912958')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 6, '2025-12-12 06:43:22.912987', FALSE, 10, 'expert', '2025-12-12 06:43:22.912987')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912600', '2025-12-12 06:43:22.912660', '$2a$04$6HcH.6zRqV18x13QNIg/2OylXTrEqic8rbuj8m4s2zdG9zyV6roJq', '2025-12-12 06:43:22.912600', 'testuser')[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 7, '2025-12-12 06:43:22.913033', FALSE, 13, 'initiator', '2025-12-12 06:43:22.913033')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.912987', `conversations`.`updated_at` = '2025-12-12 06:43:22.913415' WHERE `conversations`.`id` = 6[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.913033', `conversations`.`updated_at` = '2025-12-12 06:43:22.913515' WHERE `conversations`.`id` = 7[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
Started PUT "/messages/1/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914019', '2025-12-12 06:43:22.914030', '$2a$04$IRbfVBOng2czEBiTScmLBukgsBIy/EarWvvY2390tG4yFbyJ7TCA2', '2025-12-12 06:43:22.914019', 'expertuser')[0m
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by MessagesController#mark_read as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914637', '2025-12-12 06:43:22.914650', '$2a$04$8paod9x2c520EgUk2rZ5eOuEUfDtuKVyFhm0GECBVsbatGwOMnGh2', '2025-12-12 06:43:22.914637', 'testuser')[0m
  Parameters: {"id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914858', '2025-12-12 06:43:22.914870', '$2a$04$vsTj1LzBZcn4VCfwo34FWeEQSpJVbd7Qx/4QFG8VkBpezpE/.qg0a', '2025-12-12 06:43:22.914858', 'expertuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.914775', 5, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.914775')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.916208', '2025-12-12 06:43:22.916218', '$2a$04$.vXfqVEVwYh5vKqn.OqDhu2.9grTfBwlVTkRAaVIjChbNMc4//nOK', '2025-12-12 06:43:22.916208', 'expertuser')[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '13' OR conversations.assigned_expert_id = '13') AND `messages`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 403 Forbidden in 2ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "4", "content" => "Test message"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (44, '2025-12-12 06:43:22.916913', 43, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.916913')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (3, '2025-12-12 06:43:22.916818', 2, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.916818')[0m
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
MessagesTest: test_POST_/messages_includes_senderUsername
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 11, '2025-12-12 06:43:22.917562', FALSE, 43, 'initiator', '2025-12-12 06:43:22.917562')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.917562', `conversations`.`updated_at` = '2025-12-12 06:43:22.917987' WHERE `conversations`.`id` = 11[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.917860', 9, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.917860')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "New message"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.918546', '2025-12-12 06:43:22.918559', '$2a$04$gnz9tng2VN4M8VdbRcjJNO8mENM1KcQO73BDHu/iT9Aj9D8GN40cO', '2025-12-12 06:43:22.918546', 'testuser')[0m
Started GET "/api/expert-queue/updates?expertId=10" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.918609', '2025-12-12 06:43:22.918622', '$2a$04$6kL8aKD/CwaHQa.lyDhOCeTNccP6KZqHgYr1R61H5lmHvg.zclPYK', '2025-12-12 06:43:22.918609', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.920249', '2025-12-12 06:43:22.920262', '$2a$04$qNDDUDW2GdJnDpSGGsRp8ecGAgWCkjXI.ghVfiYbBxga8DtN3Dq..', '2025-12-12 06:43:22.920249', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.920309', '2025-12-12 06:43:22.920321', '$2a$04$/fnDO/dr1IbpOGlbzsVziuBUxqQ/KtEx4AF4OruRWiWb2oEzP1UWu', '2025-12-12 06:43:22.920309', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 06:43:22.920509', FALSE, 5, 'initiator', '2025-12-12 06:43:22.920509')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.920509', `conversations`.`updated_at` = '2025-12-12 06:43:22.920985' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.921089', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.921089')[0m
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.921099', 21, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.921099')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.921604', '2025-12-12 06:43:22.921619', '$2a$04$Bw/RJL1cFw5ROnGpKwvhG.fxpfXsFZK2aZz0JGxWaYJ10knrOxq0C', '2025-12-12 06:43:22.921604', 'testuser')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "8", "content" => "Test message"}
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.922115', 1, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.922115')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 8 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.922763', '2025-12-12 06:43:22.922773', '$2a$04$GIY9ZXgLk2mUqng9HqQkG.SfBSExHm.lSXgWS2LDPub63z2WTMYR6', '2025-12-12 06:43:22.922763', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Started GET "/conversations/7/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.923243', '2025-12-12 06:43:22.923253', '$2a$04$/WTE0tynHIcp7TWyrHoaKOGx/NJVnuu9WVQcjnWuBZ58vasWBxVYi', '2025-12-12 06:43:22.923243', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "7"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 8, '2025-12-12 06:43:22.923291', FALSE, 21, 'initiator', '2025-12-12 06:43:22.923291')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.923291', `conversations`.`updated_at` = '2025-12-12 06:43:22.923804' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (16, '2025-12-12 06:43:22.923877', 15, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.923877')[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) AND `conversations`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "11", "content" => "New message"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 8, '2025-12-12 06:43:22.924605', FALSE, 15, 'initiator', '2025-12-12 06:43:22.924605')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.924605', `conversations`.`updated_at` = '2025-12-12 06:43:22.925010' WHERE `conversations`.`id` = 8[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 11 LIMIT 1[0m
Started PUT "/messages/2/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "2"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.925994', '2025-12-12 06:43:22.926006', '$2a$04$Bcdpbz0qJofqYplNszEoLOyFaOk.u5yGmULE1VJNDNHML81craqrS', '2025-12-12 06:43:22.925994', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '16' OR conversations.assigned_expert_id = '16') AND `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 06:43:22.926711' WHERE `messages`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.927454', '2025-12-12 06:43:22.927464', '$2a$04$FFL1tA.h5tJIulUsONLX9uQencncSbyljsfmMHNKBxpCCM58xk1Lq', '2025-12-12 06:43:22.927454', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 11, '2025-12-12 06:43:22.927708', FALSE, 23, 'initiator', '2025-12-12 06:43:22.927708')[0m
  [1m[36mMessage Create (1.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 06:43:22.926818', FALSE, 1, 'initiator', '2025-12-12 06:43:22.926818')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 1, '2025-12-12 06:43:22.927309', FALSE, 2, 'initiator', '2025-12-12 06:43:22.927309')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:43:22.928091', 7, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.928091')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.927708', `conversations`.`updated_at` = '2025-12-12 06:43:22.928233' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.926818', `conversations`.`updated_at` = '2025-12-12 06:43:22.928390' WHERE `conversations`.`id` = 1[0m
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.927309', `conversations`.`updated_at` = '2025-12-12 06:43:22.928419' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 11, '2025-12-12 06:43:22.928664', FALSE, 44, 'expert', '2025-12-12 06:43:22.928664')[0m
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 2.1ms (4 queries, 0 cached) | GC: 0.0ms)
Started GET "/conversations/1/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 11 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.928664', `conversations`.`updated_at` = '2025-12-12 06:43:22.929189' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.929665', '2025-12-12 06:43:22.929679', '$2a$04$We/xvppB//838b1F1lHdPemC5UnliKOrzYoK51FWs/7H38YFwAUZS', '2025-12-12 06:43:22.929665', 'otheruser')[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "5", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1) AND `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
---------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------------------------------------
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.933644', '2025-12-12 06:43:22.933658', '$2a$04$ope8KRC/OcITLKWxhYz17ebe2iWbA30P5eol9dvLZAUz9vN6lE9y.', '2025-12-12 06:43:22.933644', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934036', '2025-12-12 06:43:22.934053', '$2a$04$REbq1i5WcD84ZHAUkLZlDucztGCoBLgYAEDTAjAUPgqnpxUajcsum', '2025-12-12 06:43:22.934036', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.933997', '2025-12-12 06:43:22.934015', '$2a$04$7aEXL3m2unBK5eRsLYTQSu7jPbJ3SI2EqeebCWum3uWsLJAWgrM8e', '2025-12-12 06:43:22.933997', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934136', '2025-12-12 06:43:22.934157', '$2a$04$6/qpKTRMzbJkkRxrSuJceeG6j.tAT17IOEyJ7KPCLvvsjJRs./x7K', '2025-12-12 06:43:22.934136', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934743', '2025-12-12 06:43:22.934760', '$2a$04$b1ITCjqaeabGmH5iB45.qO1THRaIl9mhk5MKJV1YAhA4g01uJFTG.', '2025-12-12 06:43:22.934743', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934890', '2025-12-12 06:43:22.934912', '$2a$04$PUpLWAS8/FMwfA5CKMXLZe9u/RL9j8Stnp//O/EvcOmkkbh6u5lk.', '2025-12-12 06:43:22.934890', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 1 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935225', '2025-12-12 06:43:22.935235', '$2a$04$he8Yi6YLKpfUj8fHAdrlCuiR/Ly5cMBqFzOjJU/uhMsBMV9UowDVG', '2025-12-12 06:43:22.935225', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935691', '2025-12-12 06:43:22.935701', '$2a$04$Ny.RcJ9XKsXS/Yu5sWaOvuql9303Zph0u.kK3QJhszaqw/xiqEIKi', '2025-12-12 06:43:22.935691', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935844', '2025-12-12 06:43:22.935854', '$2a$04$KD0bg98Zrv1yVBNL83k1Zee4.P7EGF92LLAxbFO6ZJy8vzE8FfVwq', '2025-12-12 06:43:22.935844', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935807', '2025-12-12 06:43:22.935820', '$2a$04$K6rcKP2h.0Qje7VTD9g.YOXhQyL5DcIUPe0qwnKwZ/kSKjeZKyLKu', '2025-12-12 06:43:22.935807', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 06:43:22.935923', 17, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.935923')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 06:43:22.936471', 14, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936471')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.936540', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936540')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 9, '2025-12-12 06:43:22.936625', TRUE, 17, 'initiator', '2025-12-12 06:43:22.936625')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:43:22.936690', 23, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936690')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.936625', `conversations`.`updated_at` = '2025-12-12 06:43:22.937093' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started GET "/conversations/8/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "8"}
Started GET "/conversations/9/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "9"}
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "7", "content" => "Test"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.938420', '2025-12-12 06:43:22.938432', '$2a$04$5Uy70jxEOlx55poWJOd29.ajB6AkAHzkvX7WuNmTd4JZwzRbaUSg2', '2025-12-12 06:43:22.938420', 'otheruser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17) AND `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.939009', 25, NULL, 'waiting', 'Other', '2025-12-12 06:43:22.939009')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 10, '2025-12-12 06:43:22.939680', FALSE, 25, 'initiator', '2025-12-12 06:43:22.939680')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 11, '2025-12-12 06:43:22.939870', FALSE, 43, 'initiator', '2025-12-12 06:43:22.939870')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.939680', `conversations`.`updated_at` = '2025-12-12 06:43:22.940123' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.939870', `conversations`.`updated_at` = '2025-12-12 06:43:22.940343' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/5/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "5"}
Started GET "/conversations/11/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "11"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 43 LIMIT 1[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '23' OR conversations.assigned_expert_id = '23') AND `messages`.`id` = 5 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 43 OR `conversations`.`assigned_expert_id` = 43) AND `conversations`.`id` = 11 LIMIT 1[0m
Filter chain halted as :set_message rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 11 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (43, 44)[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.5ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1655.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.957112', '2025-12-12 06:43:22.957164', '$2a$04$TcUg9/.YXfu/W2qzML062ef9M4jCQRbaMYR2K3CYoqzguSZRmvACm', '2025-12-12 06:43:22.957112', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.960054', '2025-12-12 06:43:22.960065', '$2a$04$Jig4OIEOZ9hjjLIqliIvzOo6BWx7wvBdJI7/D5S0oDUyEU0UBu.B.', '2025-12-12 06:43:22.960054', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.966163', 1, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.966163')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 06:43:22.971711', FALSE, 1, 'initiator', '2025-12-12 06:43:22.971711')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.971711', `conversations`.`updated_at` = '2025-12-12 06:43:22.972314' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/1/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1678.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.2ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1708.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1718.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1755.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:23 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('6635911638641068245', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT RELEASE_LOCK('6635911638641068245')[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.5ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (9.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (8.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (15.8ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mTruncate Tables (1140.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1143.4ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:43.959782', '2025-12-12 07:14:43.959833', '$2a$04$B/P.IJXTInSeOOYT4RpK6uOu826Rm8JspU6l.rTFvkW9ukf7h.s9a', '2025-12-12 07:14:43.959782', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:43.959854', '2025-12-12 07:14:43.959907', '$2a$04$BVh1QmjW6A6zu6I5IdaI3Oe5z8RhPy2xyMtWnQ.qCkKXCHnhp4dZW', '2025-12-12 07:14:43.959854', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:43 +0000
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:43.968860', '2025-12-12 07:14:43.968873', '$2a$04$AGKW8WhDFSViMInJFJkXb.g5hcR7FdPu2wNiSyQV87Wc1nY/0SKF.', '2025-12-12 07:14:43.968860', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:43 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mTruncate Tables (1215.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:43.995016', `users`.`updated_at` = '2025-12-12 07:14:43.995860' WHERE `users`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 6.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.003266', `users`.`updated_at` = '2025-12-12 07:14:44.004164' WHERE `users`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.1ms | ActiveRecord: 6.9ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.008607', '2025-12-12 07:14:44.008621', '$2a$04$PNyq57Bw5Q.C5Wai1SSiqOcQSftnAD9F9FpyW05zvnxNBuAZhg/zu', '2025-12-12 07:14:44.008607', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.015133', 2, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.015133')[0m
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#index as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.016846', '2025-12-12 07:14:44.016858', '$2a$04$39aUoUw54FKRhDEWGgHUWuxohbGRtFqptmIo32yS4SBZwsLU9bu7i', '2025-12-12 07:14:44.016846', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 2 OR `conversations`.`assigned_expert_id` = 2) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.018438', '2025-12-12 07:14:44.018447', '$2a$04$UghnKk2afB1.GOlZpwK1ZuwuRqQ9P5QxtvxsfqesvzsMzg2xYlB0.', '2025-12-12 07:14:44.018438', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mMessage Count (3.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 4.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.024472', NULL, NULL, '[]', '2025-12-12 07:14:44.024472', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a3f3a49a-8dc4-4d25-a7d3-f113cb593001) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 07:14:44.029081', 3, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.029081')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/1" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "1"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.030375', '2025-12-12 07:14:44.030387', '$2a$04$TseAYr/Zm7.gZ1tzd8I6Be8zNgt4zb3VUJetpXkdCmsV51vYkh1Mu', '2025-12-12 07:14:44.030375', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 3 OR `conversations`.`assigned_expert_id` = 3) AND `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.031965', '2025-12-12 07:14:44.031975', '$2a$04$ros/5HXtTRMpyRqwkG6nlO9DBxkhQmoAlLP0n/W7pjUz4McM9HVYm', '2025-12-12 07:14:44.031965', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.033728', '2025-12-12 07:14:44.033776', '$2a$04$wDsDZBc7oibjDeg14hqNleo6a6KHVGw/WdNvCHoYSZ0bLb2QAJAR.', '2025-12-12 07:14:44.033728', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.6ms (5 queries, 0 cached) | GC: 0.0ms)
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.036914', NULL, NULL, '[]', '2025-12-12 07:14:44.036914', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 46c54678-3a23-44ee-8c70-d6e924bad664) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 07:14:44.037966', 3, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.037966')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 3 OR `conversations`.`assigned_expert_id` = 3) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.040372', '2025-12-12 07:14:44.040383', '$2a$04$DOJfAYi5T6ooLe2CEpFWC.MrLsxa/WVF75gNNUoPx56c4.DaDnboy', '2025-12-12 07:14:44.040372', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
Processing by ConversationsController#create as HTML
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1275.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.045794', '2025-12-12 07:14:44.045808', '$2a$04$/.dFT3sfQuwn/89C6.E4Kebn6ot3LVkUgXvuYmXHp3kQReeS5IAuC', '2025-12-12 07:14:44.045794', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.046490', 5, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.046490')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.047103', '2025-12-12 07:14:44.047114', '$2a$04$B95NhI/QTAh.xyPkDZC5H.9fRNrBRt0iExAX5ML6.6l68KvvB.J1i', '2025-12-12 07:14:44.047103', 'testuser')[0m
Started GET "/conversations/3" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "3"}
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 5 OR `conversations`.`assigned_expert_id` = 5) AND `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 5 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.056814', '2025-12-12 07:14:44.056828', '$2a$04$0Qc1DvlqydHc7GiV3tVCW.qN2Y0vPd5HGRLiEsD7aET9W.msfDYr6', '2025-12-12 07:14:44.056814', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.059499', '2025-12-12 07:14:44.059510', '$2a$04$iWXJtOx9UG.9yUyiVYwH2e9YFXubDmXgVlUvikEk4Xn8e.8HKaHBq', '2025-12-12 07:14:44.059499', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.061040', '2025-12-12 07:14:44.061049', '$2a$04$41zzRyo4ksVA47R.gdB/Y.kV/.a2MiFZFowdDT5XFxLII5HGWUrvq', '2025-12-12 07:14:44.061040', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.061540', 7, NULL, 'waiting', 'Other Conversation', '2025-12-12 07:14:44.061540')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.061772', '2025-12-12 07:14:44.061787', '$2a$04$wy7jvQwyxyzben5enhIBLeTCbpclctHnQHPijCxzEQ3QFXHd7G/IG', '2025-12-12 07:14:44.061772', 'newuser')[0m
Started GET "/conversations/4" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "4"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 6 OR `conversations`.`assigned_expert_id` = 6) AND `conversations`.`id` = 4 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.068213', NULL, NULL, NULL, '2025-12-12 07:14:44.068213', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.068568', '2025-12-12 07:14:44.068579', '$2a$04$mSTpiZhxQLTUdBzZGpHnz.4mrP7G0Ze4pYoS06zOeXr9vbmj6YInS', '2025-12-12 07:14:44.068568', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0fd78b55-b81d-42e6-b621-92a2813faf4f) to Test(default) with arguments: 1
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.068845', '2025-12-12 07:14:44.068857', '$2a$04$P3.IQwPcDJC9ZDUf/djb.OonQCROnkW6tXat2.NhlGxzAlV1sPdPy', '2025-12-12 07:14:44.068845', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.069196', 8, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.069196')[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 8 OR `conversations`.`assigned_expert_id` = 8) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.070698', 8, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.070698')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 8 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 8 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1290.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Completed 201 Created in 16ms (Views: 0.1ms | ActiveRecord: 3.6ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.078243', '2025-12-12 07:14:44.078255', '$2a$04$ZZuFxRLJ9dY1Nti4YR9Kce8R0qc.Q5Whh5vsECzdDGPKCapcjMi.C', '2025-12-12 07:14:44.078243', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.078251', '2025-12-12 07:14:44.078262', '$2a$04$2whKE7qubesv.XbwxngYue/FXN7.8F7eBLB6F49EaHo2gqAsx2JVe', '2025-12-12 07:14:44.078251', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.079737', '2025-12-12 07:14:44.079746', '$2a$04$4IpnShAebOW6o4m59n6Q1.ko7Q58DAo61XN98851qzt.NozZNoVOq', '2025-12-12 07:14:44.079737', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.079733', '2025-12-12 07:14:44.079742', '$2a$04$3oSprBWF7rprkZrH49w9D.drZYyTDyDGeSc.qXfZNXiWHVHHE53U2', '2025-12-12 07:14:44.079733', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.080555', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.080555', 10)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.080551', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.080551', 10)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 43f28a79-e12a-4c42-89fc-cc0749569c90) to Test(default) with arguments: 2
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a9b2e35f-9cb2-4997-8039-67bac7ebd5c5) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.081328', 9, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 07:14:44.081328')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:14:44.081345', 9, NULL, 'active', 'First', '2025-12-12 07:14:44.081345')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
  [1m[36mConversation Create (0.1ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:14:44.081978', 9, NULL, 'active', 'Assigned Conversation', '2025-12-12 07:14:44.081978')[0m
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#queue as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.083711', '2025-12-12 07:14:44.083724', '$2a$04$Tsm.ar2b5x7EMdxlYGVRa.7CYorfnGM8KOzpfhtDUTVxPuwdLID0q', '2025-12-12 07:14:44.083711', 'testuser')[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.085549', '2025-12-12 07:14:44.085562', '$2a$04$7sBfoJuSvzJ7Cv.AbdbGLevZvkyyyOvzvdI/xhOd0eX.CzD8YDKgC', '2025-12-12 07:14:44.085549', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.086526', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.086526', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 23355dc8-3bfc-48c4-85d5-43fd493720f9) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.091464', 3, NULL, 'waiting', 'Test', '2025-12-12 07:14:44.091464')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.092196', '2025-12-12 07:14:44.092208', '$2a$04$FQXfq2niDvcrb71SEhEFMeyWb62ZJcsgMTAsK9PyJU.X3xs4MrAG.', '2025-12-12 07:14:44.092196', 'testuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:14:44.092194', 9, NULL, 'active', 'Second', '2025-12-12 07:14:44.092194')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.093878', '2025-12-12 07:14:44.093890', '$2a$04$.4sCAB/cPLVvJCpbhDb1x.iUyBjPCwnTTvmXBDFWm/gk4xjM0g4t2', '2025-12-12 07:14:44.093878', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.094932', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.094932', 12)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d0813a1b-7fd0-4933-9a25-a3cbad4000ad) to Test(default) with arguments: 3
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.095839', 11, NULL, 'waiting', 'Test', '2025-12-12 07:14:44.095839')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/5/claim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "5"}
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 4, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 07:14:44.096328' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 12, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 07:14:44.097804' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (5.0ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:14:44.100015', 1, '2025-12-12 07:14:44.100153', 4, NULL, 'active', '2025-12-12 07:14:44.100153')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.100457', '2025-12-12 07:14:44.100521', '$2a$04$eS3TzWsi538hTCPmx8T5q.cz7kkQEIKNxlElH20QiQAI0vxVnWNRe', '2025-12-12 07:14:44.100457', 'testuser')[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:14:44.102548', 5, '2025-12-12 07:14:44.102648', 12, NULL, 'active', '2025-12-12 07:14:44.102648')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.0ms | ActiveRecord: 2.3ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:14:44.102997', 9, NULL, 'active', 'Third', '2025-12-12 07:14:44.102997')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 07:14:44.103616' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (6.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1340.1ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
------------------------------------------------------------
--------------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.111279', '2025-12-12 07:14:44.111298', '$2a$04$kB4kPvj0lHJarfMFsamFOePUqh/r6HPryrNlLgscV9NeOrot7rjUK', '2025-12-12 07:14:44.111279', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.111383', '2025-12-12 07:14:44.111398', '$2a$04$pePsBDplqKg63g8ka7Kx/O6jHR8P2dqzru9HkFwgY9U3iuzYJArWy', '2025-12-12 07:14:44.111383', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.112905', '2025-12-12 07:14:44.112915', '$2a$04$2CBM54wWSXY5nGmAGlpwPOXi82myQBmToUj4rBxxaOACywKqiniiy', '2025-12-12 07:14:44.112905', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.113552', '2025-12-12 07:14:44.113570', '$2a$04$YJjLpXTlbfO.1AQvcnej3u1cu3mykbuY.oH1jA2ZfzGQE8G.H7ggG', '2025-12-12 07:14:44.113552', 'expertuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.113732', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.113732', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.113835', '2025-12-12 07:14:44.113852', '$2a$04$TC3hj72ioVdOf2pRgKheguBYXiMp.igjecvDDbkuzy0E/CS/yyZ8O', '2025-12-12 07:14:44.113835', 'testuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 47c89748-c962-4460-afda-b972fb666b68) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.114656', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.114656', 14)[0m
Processing by ExpertController#profile as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 20b1c916-3e79-46c3-8a50-3c33a5b2a0d3) to Test(default) with arguments: 4
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (14, '2025-12-12 07:14:44.115448', 13, NULL, 'active', 'Test', '2025-12-12 07:14:44.115448')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.115659', '2025-12-12 07:14:44.115674', '$2a$04$2NudAEAPpM193xRdgOV.VOU8.ktavHlsD0tXVBOKnf9tfo7UPI27q', '2025-12-12 07:14:44.115659', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/6/unclaim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "6"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.116805', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.116805', 12)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: dba10308-6676-48dd-ba18-4126d094cb78) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.117791', 11, NULL, 'waiting', 'First', '2025-12-12 07:14:44.117791')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.119238', '2025-12-12 07:14:44.119252', '$2a$04$6OwXWMiWVGvObfLoxDhH6eJ7n31JwTso5vKbbZrci9kTbCo5CPUUa', '2025-12-12 07:14:44.119238', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.120855', '2025-12-12 07:14:44.120864', '$2a$04$xWTX5xY7iuyQoTq.xFUb8.ocXEiuul95O3c0FF164xmdytp/I.46C', '2025-12-12 07:14:44.120855', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.121687', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.121687', 8)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0e03d109-289a-42c0-bdf5-c0d8209b9c15) to Test(default) with arguments: 4
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.122035', '2025-12-12 07:14:44.122084', '$2a$04$E9SX72Q3Tn4ok6YgJAGGmeh23vxDDH/P5kU9VCqafNw3hZTnC72oC', '2025-12-12 07:14:44.122035', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.123331', '2025-12-12 07:14:44.123343', '$2a$04$uHy1OpYs6mWtFXJm4w4.Pep6DBFFnkdyrvwDbXyCx1Lh2UcI.VRla', '2025-12-12 07:14:44.123331', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.125363', '2025-12-12 07:14:44.125375', '$2a$04$EmmLF1pDlgNTF.biGU1mp.1SQp2Ov22M.NSZQ45sSrRKNvePrBab2', '2025-12-12 07:14:44.125363', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.126855', '2025-12-12 07:14:44.126865', '$2a$04$gjdA.lftkavWoobfjH61jegmuXnXCKg0NoHm.y8FxNPIpKUJa1KMa', '2025-12-12 07:14:44.126855', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.127616', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.127616', 16)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 97b35345-c204-4b9f-b4e8-1b8c58e196d4) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.128304', 15, NULL, 'resolved', 'First', '2025-12-12 07:14:44.128304')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.128602', 11, NULL, 'waiting', 'Second', '2025-12-12 07:14:44.128602')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.128919', 15, NULL, 'resolved', 'Second', '2025-12-12 07:14:44.128919')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.129537', 15, NULL, 'resolved', 'Third', '2025-12-12 07:14:44.129537')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 07:14:44.130024', 7, '2025-12-12 07:14:44.130218', 16, NULL, 'resolved', '2025-12-12 07:14:44.130218')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 07:14:44.130721', 8, '2025-12-12 07:14:44.130872', 16, NULL, 'resolved', '2025-12-12 07:14:44.130872')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 07:14:44.131314', 9, '2025-12-12 07:14:44.131449', 16, NULL, 'resolved', '2025-12-12 07:14:44.131449')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.133013', 1, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.133013')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 16 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.134003', '2025-12-12 07:14:44.134014', '$2a$04$ppuBpBjW0TFrnP11i4IOFeCun0M9T9aPmZOwjsQQUky/BfafeUm7a', '2025-12-12 07:14:44.134003', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (9, 8, 7)[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.135480', '2025-12-12 07:14:44.135489', '$2a$04$iBXSuV3GAeYC0P5UNIm1..qj/Ujga2vWFKSyuPj8NECe5BIwVvNdu', '2025-12-12 07:14:44.135480', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.136270', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.136270', 11)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 231c0fc2-4896-40ed-8242-27c8a5194757) to Test(default) with arguments: 5
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#queue as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.137155', 1, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:14:44.137155')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.139509', 11, NULL, 'waiting', 'Third', '2025-12-12 07:14:44.139509')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.139841', '2025-12-12 07:14:44.139855', '$2a$04$QG0vs3l9phBLzeH6Er1U3eQt/rnP1RnbOtt7LoXXlE1F/82nyiqdu', '2025-12-12 07:14:44.139841', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.141374', '2025-12-12 07:14:44.141383', '$2a$04$5XN2JGwUsWDQgseguxrq6.5V9wDCO10qX9HGf1WCggdCyRHIeE2OK', '2025-12-12 07:14:44.141374', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.142138', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.142138', 18)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 12 AND `messages`.`is_read` = FALSE[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 11015d62-ecf6-4579-8b61-c679606f5ee0) to Test(default) with arguments: 6
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 12 AND `messages`.`is_read` = FALSE[0m
  [1m[36mMessage Count (2.8ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 1 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 11 AND `messages`.`sender_id` != 12 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 17ms (Views: 0.2ms | ActiveRecord: 5.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 12 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.143867', '2025-12-12 07:14:44.143877', '$2a$04$UykmzIyAjfe2iBDRAwJKh.sJcdnJmbGvfOsqNnBZrYPOfXrkU8CUe', '2025-12-12 07:14:44.143867', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#queue as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.145273', '2025-12-12 07:14:44.145285', '$2a$04$WQqV0I3QLYqNvxdMdq1Dw.zJ9wCVkHRr0VMwMZVON0WTL6gMhAGe.', '2025-12-12 07:14:44.145273', 'testuser')[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.146722', '2025-12-12 07:14:44.146732', '$2a$04$ihI6xZz8N9D4uazzShXu1.EEZM69QxM7172SyqDnJbSVijMga9jGa', '2025-12-12 07:14:44.146722', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.147520', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.147520', 13)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 956da3c4-4b4d-4805-bd80-f9f775a92b7e) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 07:14:44.148262', 12, NULL, 'active', 'Test', '2025-12-12 07:14:44.148262')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:14:44.148985', 2, '2025-12-12 07:14:44.149142', 13, NULL, 'active', '2025-12-12 07:14:44.149142')[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/2/unclaim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.150785', '2025-12-12 07:14:44.150798', '$2a$04$drFQWn.CA9qXG4WRGbP5j.yQgjI7RTNKas2iVJe4jwAtxkZhAhmaq', '2025-12-12 07:14:44.150785', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.151212', '2025-12-12 07:14:44.151231', '$2a$04$.U5DGJLiA/0XQfSJZ6fgP.hkMsNemczP7q.ctElrTvyEM9RIgBtO6', '2025-12-12 07:14:44.151212', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 07:14:44.151560' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.152509', '2025-12-12 07:14:44.152521', '$2a$04$rUI7mjRmpiwKo/3Lz8iGyOOkexI3D8GMRfqn/r5tF.oXmgMHJsoeK', '2025-12-12 07:14:44.152509', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.152995', '2025-12-12 07:14:44.153009', '$2a$04$uDccYsTpDRFZKZCTC2nGneQayJYvlSiANTWYumYSzSzIDfa6zjQvG', '2025-12-12 07:14:44.152995', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.2ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 2 AND `expert_assignments`.`expert_id` = 13 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.153530', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.153530', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ddf27bfb-722a-404d-951e-6dca48c95549) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.3ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 07:14:44.153530', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 07:14:44.153706' WHERE `expert_assignments`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.2ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 07:14:44.154249', 20, NULL, 'active', 'Test', '2025-12-12 07:14:44.154249')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.155020', '2025-12-12 07:14:44.155035', '$2a$04$sBqMiOBjPiRq6.mhTSmuDuKvbJgfk3otB14l/rRQG.nRjT.CX.N4i', '2025-12-12 07:14:44.155020', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:14:44.155035', 10, '2025-12-12 07:14:44.155125', 21, '2025-12-12 07:14:44.154924', 'resolved', '2025-12-12 07:14:44.155125')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.156635', '2025-12-12 07:14:44.156645', '$2a$04$fR2y2uiFMY/JGNA.w8oQA.qt.Et7a/rqLSJ5wwUYcdGnblmLogAD2', '2025-12-12 07:14:44.156635', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 21 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 10[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.157493', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.157493', 14)[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 88ab9428-7651-414b-84ed-19c936f9d1f1) to Test(default) with arguments: 4
Processing by ConversationsController#index as HTML
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.158199', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.158199', 3)[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4f3abaa5-2d9e-4da2-8c40-14b90b513ddd) to Test(default) with arguments: 1
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.159272', '2025-12-12 07:14:44.159282', '$2a$04$WKkW6FyaIGshnibpnqIh9O/iigpuHSu7UVOHALTanANNvwgEEcpcC', '2025-12-12 07:14:44.159272', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.160582', '2025-12-12 07:14:44.160599', '$2a$04$T6FxypU6PLDJMYYt5Thy3.tEli3iuZywrg4i.juhjyPmm.yV8T9gK', '2025-12-12 07:14:44.160582', 'nonexpert')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.160676', '2025-12-12 07:14:44.160688', '$2a$04$DdBZcRPKyFW3yybVI23Ygu4tspca2ETP8eKInrz1w2juKm4U7yy.C', '2025-12-12 07:14:44.160676', 'testuser')[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.161703', 2, NULL, 'waiting', 'Test', '2025-12-12 07:14:44.161703')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.162105', '2025-12-12 07:14:44.162116', '$2a$04$3TgOGh/BSz3KinUdZZJ9Suk3kzYVRIUF.iP/xWQNmAIZ5EJYNfA5O', '2025-12-12 07:14:44.162105', 'testuser')[0m
Started POST "/expert/conversations/2/claim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.162262', '2025-12-12 07:14:44.162272', '$2a$04$uUsMsqd5gHxdONj82Q1e7.5X66DEquT7EKL/vZZU8qt.eIn2JQyMa', '2025-12-12 07:14:44.162262', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.163035', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.163035', 15)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 15a8e338-7a1e-4fe7-9ca9-b24570cdd80f) to Test(default) with arguments: 7
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.163702', '2025-12-12 07:14:44.163717', '$2a$04$tA4tznzo.sv2fAPjDmRRz.8oQ50mHTaB6HTHSlWh.C7QaIAU6Hts6', '2025-12-12 07:14:44.163702', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.164617', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.164617', 23)[0m
  [1m[36mUser Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f880cfe-736d-429e-8e70-bbe5d0c6d1b6) to Test(default) with arguments: 8
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.165137', '2025-12-12 07:14:44.165190', '$2a$04$Xj5pw11t/FhjFn8a1LR5dekgU/oE3B46.2BPDNroyNv976xv4GeJu', '2025-12-12 07:14:44.165137', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.166588', '2025-12-12 07:14:44.166598', '$2a$04$VVKqakZ2EEh0nij.ScmF/.7VKx3//lgNEtXh10hctWz4rUAUJdPq6', '2025-12-12 07:14:44.166588', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 1 AND `messages`.`is_read` = FALSE[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mTRANSACTION (6.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.167463', '2025-12-12 07:14:44.167472', '$2a$04$DBW56DuPkCiCZ87W0ARCLunpbb9bvkscB44LCtQDP8rFdCxwerW5.', '2025-12-12 07:14:44.167463', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mTruncate Tables (1399.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.171602', '2025-12-12 07:14:44.171615', '$2a$04$JTitrDH7tg.940wa2XCm6.RLiTuxHJdDkVEtWzMBTqrWI3W0ZS1BG', '2025-12-12 07:14:44.171602', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.171758', '2025-12-12 07:14:44.171775', '$2a$04$GGqB91yk4lSIQv/PL14To.33h902XwF27UkqnEwo.kb1rSV8OtcQ6', '2025-12-12 07:14:44.171758', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.172039', '2025-12-12 07:14:44.172055', '$2a$04$On3z3rDa.V8Q/Cpp8KzWgOnUCe1b5wm0JoePSDYTqt95gU4HCmDxa', '2025-12-12 07:14:44.172039', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.172800', '2025-12-12 07:14:44.172811', '$2a$04$5fFe9tAd8dN6E.XZhL8WJ.eIgKCsxQUUQFrjHkKf7.NKkYbIEw3wG', '2025-12-12 07:14:44.172800', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.173201', '2025-12-12 07:14:44.173222', '$2a$04$7.g5NAFxms/Tr/COfWCcY.JFTSvx8lKYADCxnZWNvnTtNegX0x5W.', '2025-12-12 07:14:44.173201', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.173486', '2025-12-12 07:14:44.173498', '$2a$04$zmu9rhDlM6NyI4genswrNeJTLCKpCKE5CcTH8r7kkglD542CDnWNm', '2025-12-12 07:14:44.173486', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.173691', '2025-12-12 07:14:44.173704', '$2a$04$BsB1fe9SXm/L9MFEmExzp.6LIYsSgzCXFPwy6XdaEekNmZtfMhf3K', '2025-12-12 07:14:44.173691', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.173732', '2025-12-12 07:14:44.173746', '$2a$04$o7jIpw6c5kP1NUV0VCL1tOXeeQh2Pt6FKuKh6IA6rU9DMSUy99VnC', '2025-12-12 07:14:44.173732', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.174246', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.174246', 17)[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.174393', '2025-12-12 07:14:44.174404', '$2a$04$E2Ng43DPX7.S0h970krVe.8yfpto2dIm6fFXam0ofY3xArSAbFdi2', '2025-12-12 07:14:44.174393', 'expertuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 54f6cc49-3b56-4d51-acc8-a86e25417504) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.174578', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.174578', 6)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.174748', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.174748', 17)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3b5462d2-d7ef-4239-a54d-7460f43a9e6f) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#profile as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.175035', '2025-12-12 07:14:44.175045', '$2a$04$LRX5hfIzeXEBFeuOeHPZee1mMial1Gw1PL3ns1cdamx1PYrJxi8MW', '2025-12-12 07:14:44.175035', 'expertuser')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 26 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3ea5d84f-363b-493a-b62a-2577854dacd9) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.175355', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.175355', 26)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3fab6537-5bb3-4a67-8098-71162dcfc0d1) to Test(default) with arguments: 9
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.176439', '2025-12-12 07:14:44.176450', '$2a$04$g0moCYEyXaKL0LJtOYmmz.W1AFy7LR2HgivX72syEYCIZrDiBL73K', '2025-12-12 07:14:44.176439', 'otherexpert')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.176764', '2025-12-12 07:14:44.176778', '$2a$04$7/CB9HoIQ5vDgqd3ZKvWReIME5/86nPsYoeO/NRFpQy1zns23xkTi', '2025-12-12 07:14:44.176764', 'otherexpert')[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 26 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 07:14:44.177219', NULL, NULL, NULL, '2025-12-12 07:14:44.177219', 7)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2eca179e-f0ab-4723-bfc7-077000a9b719) to Test(default) with arguments: 3
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 07:14:44.177803', NULL, NULL, NULL, '2025-12-12 07:14:44.177803', 18)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:14:44.177854', 5, NULL, 'active', 'Test', '2025-12-12 07:14:44.177854')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 272435d7-53ff-4ffd-9134-70f9836cbf87) to Test(default) with arguments: 6
Started POST "/expert/conversations/3/claim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 07:14:44.178554', 16, NULL, 'active', 'Test', '2025-12-12 07:14:44.178554')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
Started POST "/expert/conversations/12/unclaim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "12"}
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.179526' WHERE `expert_profiles`.`id` = 9[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.179512', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.179512', 2)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.179847', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.179847', 3)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a0fbcc01-b229-4076-8888-455ff7d17afb) to Test(default) with arguments: 9
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f01f49d5-6a42-433a-ab49-efd13de3357b) to Test(default) with arguments: 1
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 2.4ms (3 queries, 0 cached) | GC: 0.0ms)
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e4a30741-1259-4ee5-b00b-51e3cdc08447) to Test(default) with arguments: 1
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 12 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 9 LIMIT 1[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (7.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
-------------------------------------------------------------
AutoRespondToQuestionJobTest: test_invokes_auto_responder_service
AutoRespondToQuestionJobTest: test_no-op_when_message_missing
-----------------------------------------------------------------
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.185658', '2025-12-12 07:14:44.185669', '$2a$04$s/U80qY4jkTq/rFxZs9.BuqUnr2fdOR6.2yKrIWnK1.Fkc076WDr2', '2025-12-12 07:14:44.185658', 'asker2')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.185873', '2025-12-12 07:14:44.185884', '$2a$04$myO1DBcZNImBOGtR901OLO00F4n0xoBqLOniMJ8tvWpYPF.sMhTem', '2025-12-12 07:14:44.185873', 'asker2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
------------------------------------------------------------------------
--------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.187142', '2025-12-12 07:14:44.187151', '$2a$04$y81hgLlblxa1k0MsLk2eA.IxnzCMYGyTVtAcUVnbOulhT2t8fowea', '2025-12-12 07:14:44.187142', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.187115', 1, NULL, 'waiting', 'Test', '2025-12-12 07:14:44.187115')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.187399', '2025-12-12 07:14:44.187410', '$2a$04$RMrfNZvNovDsb84ohSrmR.nUN0xZfl5a2utirBwMO71lmxfJYudVW', '2025-12-12 07:14:44.187399', 'expert2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.188109', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:14:44.188109', 19)[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.188326', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:14:44.188326', 9)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.188432', '2025-12-12 07:14:44.188444', '$2a$04$Va2TVyQJY1LuHq48nYiYcOvxqfNmlUh4G65/X2Jq46s1UYw8JqfZ6', '2025-12-12 07:14:44.188432', 'testuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8ea25604-7d80-4063-a31b-5c76e4256d67) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.188580', '2025-12-12 07:14:44.188592', '$2a$04$GZib9DnhQex7Qhb2MMR/x.dRhQm7JHjtk353ZHD7mhihKVMj8xfMO', '2025-12-12 07:14:44.188580', 'testuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2cf658ff-6e60-4239-817f-860ae342151d) to Test(default) with arguments: 4
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.188636', '2025-12-12 07:14:44.188649', '$2a$04$CCa38eWqTo7BF5sGE050ZuxAMoYrMUdoFKwHz36rWs8krPjk.jxAe', '2025-12-12 07:14:44.188636', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (9, '2025-12-12 07:14:44.189018', 8, NULL, 'active', 'Need help', '2025-12-12 07:14:44.189018')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (19, '2025-12-12 07:14:44.189000', 18, NULL, 'active', 'Need help', '2025-12-12 07:14:44.189000')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.189937', '2025-12-12 07:14:44.189947', '$2a$04$eP5GWrzs.QpwQNLm0uExAOwpqNDcVolzUmqT9NGyoAukO1zBV0B3O', '2025-12-12 07:14:44.189937', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.190120', '2025-12-12 07:14:44.190131', '$2a$04$S52N6lbbyZ4hX7KyLkOmcu5EZLwQ74DMGUs3LWcgERrzobqSSnrwW', '2025-12-12 07:14:44.190120', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.190297', '2025-12-12 07:14:44.190310', '$2a$04$u4.3HFeoL0Q5EYTQ1DZXOuRKkJ0OPTh3vihPkGWBVMSWq.WVMmuO2', '2025-12-12 07:14:44.190297', 'expertuser')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.190753', NULL, NULL, NULL, '2025-12-12 07:14:44.190753', 28)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.190952', NULL, NULL, NULL, '2025-12-12 07:14:44.190952', 5)[0m
[ActiveJob] [AutoRespondToQuestionJob] [f6108832-e24b-4cf0-baaa-535e74f7b102] Performing AutoRespondToQuestionJob (Job ID: f6108832-e24b-4cf0-baaa-535e74f7b102) from Test(default) enqueued at 2025-12-12T07:14:44.190417591Z with arguments: "missing"
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: adbbd773-7041-4edb-b7ff-7e660f2c8f67) to Test(default) with arguments: 10
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c87b6cad-00c7-437d-b417-577d157feb97) to Test(default) with arguments: 2
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.191229', NULL, NULL, NULL, '2025-12-12 07:14:44.191229', 20)[0m
[ActiveJob] [AutoRespondToQuestionJob] [f6108832-e24b-4cf0-baaa-535e74f7b102]   [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = NULL LIMIT 1[0m
[ActiveJob] [AutoRespondToQuestionJob] [f6108832-e24b-4cf0-baaa-535e74f7b102] Performed AutoRespondToQuestionJob (Job ID: f6108832-e24b-4cf0-baaa-535e74f7b102) from Test(default) in 0.38ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=28" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: f6108832-e24b-4cf0-baaa-535e74f7b102) to Test(default) with arguments: "missing"
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 07f46d62-ea45-4d29-84a6-0281901f6bdf) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.191646', 4, NULL, 'waiting', 'Old', '2025-12-12 07:14:44.191646')[0m
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "28"}
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 07:14:44.192214' WHERE `conversations`.`id` = 2[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.192740', 4, NULL, 'waiting', 'New', '2025-12-12 07:14:44.192740')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
Started GET "/api/expert-queue/updates?expertId=5&since=2025-12-11T07%3A14%3A44Z" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 28 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "5", "since" => "2025-12-11T07:14:44Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 3, '2025-12-12 07:14:44.194493', FALSE, 18, 'initiator', '2025-12-12 07:14:44.194493')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 07:14:44') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.194493', `conversations`.`updated_at` = '2025-12-12 07:14:44.195051' WHERE `conversations`.`id` = 3[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 5 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 5 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 07:14:44') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] [AutoRespondToQuestionJob] [36c97a57-b6a2-45bb-b845-5bf9db90c5f5] Performing AutoRespondToQuestionJob (Job ID: 36c97a57-b6a2-45bb-b845-5bf9db90c5f5) from Test(default) enqueued at 2025-12-12T07:14:44.195926229Z with arguments: 1
[ActiveJob] [AutoRespondToQuestionJob] [36c97a57-b6a2-45bb-b845-5bf9db90c5f5]   [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 1 LIMIT 1[0m
[ActiveJob] [AutoRespondToQuestionJob] [36c97a57-b6a2-45bb-b845-5bf9db90c5f5] Performed AutoRespondToQuestionJob (Job ID: 36c97a57-b6a2-45bb-b845-5bf9db90c5f5) from Test(default) in 0.52ms
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 36c97a57-b6a2-45bb-b845-5bf9db90c5f5) to Test(default) with arguments: 1
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
------------------------------------------------------------------------
---------------------------------------------------------------------
-------------------------------------------------------------------------------------------
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
-------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.198882', '2025-12-12 07:14:44.198894', '$2a$04$Xfdk/aZAvtWf4LxrQ.mWH.eecXkVHGbcpv.Ur0nFtYQzkyuDwsdU.', '2025-12-12 07:14:44.198882', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.198928', '2025-12-12 07:14:44.198943', '$2a$04$GAfCsHwxAYNV9JvJ.DEovuCO.26YFkmf/EFGUFd/A9zh8vQgeoDSm', '2025-12-12 07:14:44.198928', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.199003', '2025-12-12 07:14:44.199018', '$2a$04$SgKmIa.GG.OwWO6z6qDareTK1hhqcs7SRhm./mja2K5NOv45hzjvC', '2025-12-12 07:14:44.199003', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.200388', '2025-12-12 07:14:44.200397', '$2a$04$EVQTPQUaBxLDdpENho9t7u5/x.Fddqni0i9PT5I0vBlYV9uDqtXti', '2025-12-12 07:14:44.200388', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.200658', '2025-12-12 07:14:44.200668', '$2a$04$MzDpUyhM.rKU5Y3Hz5kYaue8YAd7L.YVjl1UpwZkMFcPRWxUdJTcW', '2025-12-12 07:14:44.200658', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.200638', '2025-12-12 07:14:44.200653', '$2a$04$kjWE1JaINvSgb8tO9kkyKudcMtPK9USzhtm1HCqYs/F6.e1SJU4s6', '2025-12-12 07:14:44.200638', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 30 LIMIT 1[0m
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.201307', NULL, NULL, NULL, '2025-12-12 07:14:44.201307', 22)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6774ded9-fdf1-4820-a7fd-a780998ff3f0) to Test(default) with arguments: 8
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.201509', NULL, NULL, NULL, '2025-12-12 07:14:44.201509', 30)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7a38e64c-0aaa-4f7e-a7af-9789206fce6f) to Test(default) with arguments: 11
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.201701', NULL, NULL, NULL, '2025-12-12 07:14:44.201701', 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 887136e0-53b7-4185-8a10-9629e92c92f4) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=29" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.202000', 21, NULL, 'waiting', 'User Conv', '2025-12-12 07:14:44.202000')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "29"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.202578', 10, NULL, 'waiting', 'Waiting', '2025-12-12 07:14:44.202578')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.202838', '2025-12-12 07:14:44.202851', '$2a$04$qPkfkiJMDSLvqzPE7dxdRepq/js/XY7dccmLC52IMEHD19iD1twEm', '2025-12-12 07:14:44.202838', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (11, '2025-12-12 07:14:44.203275', 10, NULL, 'active', 'Assigned', '2025-12-12 07:14:44.203275')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.203643', '2025-12-12 07:14:44.203654', '$2a$04$.5ePzdYyAQIqsEkOF.pBk.a3G0Dojp.7tVXnq7RN4FxozcItD8PBe', '2025-12-12 07:14:44.203643', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=11" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.204163', 23, NULL, 'waiting', 'Other Conv', '2025-12-12 07:14:44.204163')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.204481', '2025-12-12 07:14:44.204494', '$2a$04$IMyGlH31aNnjnlofc2E4EO7j91hpI6Vpnyn1Rd0v1JBBgo3Zeyy7a', '2025-12-12 07:14:44.204481', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "11"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.205542', '2025-12-12 07:14:44.205557', '$2a$04$TKjqTJz.654yDOT7ce7a7uaeSBzwsRi7o3dzk7iA6HJAIbwDGUkRS', '2025-12-12 07:14:44.205542', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.205650', NULL, NULL, NULL, '2025-12-12 07:14:44.205650', 7)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: edc64460-2d16-4913-9285-44be10b4fa4c) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 13, '2025-12-12 07:14:44.206583', FALSE, 21, 'initiator', '2025-12-12 07:14:44.206583')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.206792', '2025-12-12 07:14:44.206802', '$2a$04$gpfeVnBBZynmykls6xLngeMgQByrUpT4wRD5ARlHVOpxk1tx5ogoa', '2025-12-12 07:14:44.206792', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:14:44.206834', 6, NULL, 'active', 'First', '2025-12-12 07:14:44.206834')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.206583', `conversations`.`updated_at` = '2025-12-12 07:14:44.207023' WHERE `conversations`.`id` = 13[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.207181', '2025-12-12 07:14:44.207191', '$2a$04$l.OdnfacsvUUTusVzKydlusGm/UMBoxfuk8D/nSAFwzxuq9LEAdzG', '2025-12-12 07:14:44.207181', 'expertuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 11 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 14, '2025-12-12 07:14:44.207505', FALSE, 23, 'initiator', '2025-12-12 07:14:44.207505')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.207505', `conversations`.`updated_at` = '2025-12-12 07:14:44.207874' WHERE `conversations`.`id` = 14[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.207998', NULL, NULL, NULL, '2025-12-12 07:14:44.207998', 21)[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e7e3a73a-60e2-4a8b-aa48-a369c08a4d61) to Test(default) with arguments: 10
Started GET "/api/messages/updates?userId=21" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.208234', '2025-12-12 07:14:44.208244', '$2a$04$/NV4aRFqSgXjylUbPR1vpOeq15rdm6gIxNibVMtXBib0i.uXW4PQ.', '2025-12-12 07:14:44.208234', 'expertuser')[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "21"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 32 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.208979', NULL, NULL, NULL, '2025-12-12 07:14:44.208979', 32)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8615293b-3a9d-4f8c-9556-11af8ac08661) to Test(default) with arguments: 12
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 21 OR `conversations`.`assigned_expert_id` = 21)[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.209708', 31, NULL, 'waiting', 'Old', '2025-12-12 07:14:44.209708')[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 13 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 07:14:44.210189' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.210616', 31, NULL, 'waiting', 'New', '2025-12-12 07:14:44.210616')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21[0m
Processing by ExpertController#claim as HTML
Started GET "/api/conversations/updates?userId=31&since=2025-12-11T07%3A14%3A44Z" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  Parameters: {"conversation_id" => "1"}
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "31", "since" => "2025-12-11T07:14:44Z"}
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 31 OR `conversations`.`assigned_expert_id` = 31) AND (updated_at >= '2025-12-11 07:14:44') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 12 AND `messages`.`sender_id` != 31 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.8ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.215377', '2025-12-12 07:14:44.215391', '$2a$04$I6RNN3fzD4A.YRNTXG.NM.iu.C7imE..2eh/NVLDr.h2Bep2JeRHa', '2025-12-12 07:14:44.215377', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.216349', '2025-12-12 07:14:44.216360', '$2a$04$Nr1PQL0dkruXqiy6nw/BDOJgPAYSmVDRXTeTdldjVSoRvzRWev3vK', '2025-12-12 07:14:44.216349', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.217059', '2025-12-12 07:14:44.217074', '$2a$04$nKEi03s0bxPIC6wjbddwTeVSjCbjdFWneJdo98mWuzj2v7tZZ3zKK', '2025-12-12 07:14:44.217059', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.217907', '2025-12-12 07:14:44.217916', '$2a$04$SGJiEbkE8rUJ8czAaeuXEeoxmsN.t.UzM2vihXS0mYPMrNxdc4Pfq', '2025-12-12 07:14:44.217907', 'expertuser')[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:14:44.217704', 6, NULL, 'active', 'Second', '2025-12-12 07:14:44.217704')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.218192', NULL, NULL, NULL, '2025-12-12 07:14:44.218192', 13)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 92aec437-fa8f-457d-8fc0-f25734879940) to Test(default) with arguments: 6
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.218729', NULL, NULL, NULL, '2025-12-12 07:14:44.218729', 25)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 99976267-d258-46ef-a4cb-df4fc50abac0) to Test(default) with arguments: 9
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 07:14:44.218971', 12, NULL, 'active', 'Active', '2025-12-12 07:14:44.218971')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=25" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "25"}
  [1m[36mConversation Create (0.1ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 07:14:44.219557', 12, NULL, 'resolved', 'Resolved', '2025-12-12 07:14:44.219557')[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (7.2ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/expert-queue/updates?expertId=13" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "13"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
-------------------------------------------------------------------
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 13 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 13 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.222509', '2025-12-12 07:14:44.222528', '$2a$04$tP7MYogI//cg2T65F/zsHu8uW97vStc.FJlU.FYmmS2CdoUnvWhiu', '2025-12-12 07:14:44.222509', 'testuser')[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.222700', '2025-12-12 07:14:44.222760', '$2a$04$WiVD1XmamqS.VIipYM2sqen2ouLFGWbeZ74RNPG4m.eTd5WsO/G3a', '2025-12-12 07:14:44.222700', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.223475', '2025-12-12 07:14:44.223488', '$2a$04$d.tnZCw6g.TcbOFq8JIUceAGOL/nKN.eIVUuE98msgfAezd8w7oii', '2025-12-12 07:14:44.223475', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.224173', '2025-12-12 07:14:44.224183', '$2a$04$Dszss.KHpPQMTiwneFDHi.Ab7rpnaS9lrU0vrp1pefIcWh8HC2CI.', '2025-12-12 07:14:44.224173', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.224753', '2025-12-12 07:14:44.224765', '$2a$04$tUQlzP.Uw2GFmATYT5BuuOXM6ANXDoheP2nIZ0OftMyvpnf501NVu', '2025-12-12 07:14:44.224753', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.225054', NULL, NULL, NULL, '2025-12-12 07:14:44.225054', 4)[0m
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (14.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d1b54070-5e83-4861-8c63-43bbc602804c) to Test(default) with arguments: 2
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.225150', '2025-12-12 07:14:44.225160', '$2a$04$qcdNiw71VRJYK7jjjHnBl.FV2q2plXGG2JqWajZYIFYVzO5GyTKcu', '2025-12-12 07:14:44.225150', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 34 LIMIT 1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.226726', NULL, NULL, NULL, '2025-12-12 07:14:44.226726', 34)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.227775', '2025-12-12 07:14:44.227787', '$2a$04$PCWmBEFdlxq.IoPdOQ3xLOqEVssjpJsX48Lsnsls8U2Ei.oPdM0RO', '2025-12-12 07:14:44.227775', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.227963', '2025-12-12 07:14:44.227983', '$2a$04$Pn1Kl0fSj.P0aNwgcUoR3.1GN59ZcOulp44Cxyg0q/WHMm7NlJ7ue', '2025-12-12 07:14:44.227963', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5347cbf7-3100-4a20-88f6-2de25bfa2e3b) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:14:44.228617', 6, NULL, 'active', 'Third', '2025-12-12 07:14:44.228617')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.229141', '2025-12-12 07:14:44.229154', '$2a$04$udCkvPhF9ZBToy4hR/JSo.JXvIP.DvGIOXN0MXz5u25L3tA5UQ3PG', '2025-12-12 07:14:44.229141', 'testuser')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 07:14:44.229164' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.229461', '2025-12-12 07:14:44.229471', '$2a$04$WBQij88Slkqt.MsxVTPEKepf3EudHc/1EqLuafuaPJiX96RCOYReS', '2025-12-12 07:14:44.229461', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=7" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.229712', '2025-12-12 07:14:44.229724', '$2a$04$wHHI16fCyaIitJAlxArpk.7atK1LJ54O5ERUONH4zXQkXV.Z/MSfK', '2025-12-12 07:14:44.229712', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "7"}
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.230246', NULL, NULL, NULL, '2025-12-12 07:14:44.230246', 27)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=33" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e31ad941-1572-4f57-9b6d-97e59f243265) to Test(default) with arguments: 10
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  Parameters: {"userId" => "33"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.230648', NULL, NULL, NULL, '2025-12-12 07:14:44.230648', 23)[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.230967', '2025-12-12 07:14:44.230980', '$2a$04$WbWPlEBLUsHaUsJkPul06./WowjdWpMBzY0mugMkfS2Jq3hdgt2gK', '2025-12-12 07:14:44.230967', 'expertuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9e3057ed-5f5a-4b0f-980a-4368112fc626) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 07:14:44.231057', 26, NULL, 'active', 'Test', '2025-12-12 07:14:44.231057')[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 7 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.231568', 22, NULL, 'waiting', 'As Initiator', '2025-12-12 07:14:44.231568')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.231844', NULL, NULL, NULL, '2025-12-12 07:14:44.231844', 15)[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 15, '2025-12-12 07:14:44.231811', FALSE, 26, 'initiator', '2025-12-12 07:14:44.231811')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=22" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 998cf40d-f9b7-403a-8673-134952ff63d8) to Test(default) with arguments: 7
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.231811', `conversations`.`updated_at` = '2025-12-12 07:14:44.232290' WHERE `conversations`.`id` = 15[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "22"}
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 07:14:44.232677' WHERE `messages`.`id` = 3[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 07:14:44.232751', 14, NULL, 'active', 'As Expert', '2025-12-12 07:14:44.232751')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.232796', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.232796', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 15, '2025-12-12 07:14:44.233076', FALSE, 27, 'expert', '2025-12-12 07:14:44.233076')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
Started GET "/api/conversations/updates?userId=15" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.233076', `conversations`.`updated_at` = '2025-12-12 07:14:44.233410' WHERE `conversations`.`id` = 15[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 22 OR `conversations`.`assigned_expert_id` = 22) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ee31bdc3-4894-472b-b85a-a4091b25d6ae) to Test(default) with arguments: 1
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "15"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
Started GET "/api/messages/updates?userId=26&since=2025-12-11T07%3A14%3A44Z" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "26", "since" => "2025-12-11T07:14:44Z"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 22 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 15 OR `conversations`.`assigned_expert_id` = 15) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mConversation Pluck (0.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 26 OR `conversations`.`assigned_expert_id` = 26)[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 15 AND (created_at >= '2025-12-11 07:14:44') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Create (10.4ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.226129', 3, NULL, 'waiting', 'First', '2025-12-12 07:14:44.226129')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.238564', '2025-12-12 07:14:44.238576', '$2a$04$3tR33rnRK2nPMuSbMS6Cr.T4uj/I1YukwjiaqT/nQRd7lwBqsXCie', '2025-12-12 07:14:44.238564', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.239971', '2025-12-12 07:14:44.239984', '$2a$04$ryL6zorEL3omUhYT3fB5BOtVSe3ZysPEbRb9iE75p0CHJ3YfTF0H.', '2025-12-12 07:14:44.239971', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.239982', '2025-12-12 07:14:44.239995', '$2a$04$lWzmGP.A79GhnCEzVDoLIeVT6XY/yzXa.A9hJOtxGwaDnzIFhmeIm', '2025-12-12 07:14:44.239982', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:14:44.240157', 1, NULL, 'active', 'Test', '2025-12-12 07:14:44.240157')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.241282', '2025-12-12 07:14:44.241292', '$2a$04$IcAtHPzbP9Sf.thpxcNMIOfCYOcUJbsvzknLpKkOv2wQmifUTgviS', '2025-12-12 07:14:44.241282', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.241395', '2025-12-12 07:14:44.241406', '$2a$04$Snoq/8qMHx0ATcYDI7qQveND8hJzyYBxBAYo2xpDmRUDK33/jtYau', '2025-12-12 07:14:44.241395', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.241425', '2025-12-12 07:14:44.241435', '$2a$04$ZetPUcxu/TOmaFUVH3VZZ.9tAOVOWJS92CfKoE11JWEwHCNbgg2OS', '2025-12-12 07:14:44.241425', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.241470', '2025-12-12 07:14:44.241479', '$2a$04$3UGzNICwDAbgFYI0dqx7e.cevlGEmY91hSF1UjzUOVPvdRwleuLcK', '2025-12-12 07:14:44.241470', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
  [1m[36mTRANSACTION (5.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.242201', NULL, NULL, NULL, '2025-12-12 07:14:44.242201', 25)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.242315', NULL, NULL, NULL, '2025-12-12 07:14:44.242315', 9)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: faecd555-a252-42ec-9417-9b7729f1aaea) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 36 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 67caec8a-fa70-4ff5-b656-234e5853812d) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.242805', '2025-12-12 07:14:44.242818', '$2a$04$ivCgmoq1/AoaRCvpZ76FPerspMTG7uJ0ik.tbYhtazoniM4NUESqa', '2025-12-12 07:14:44.242805', 'expertuser')[0m
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.242909', NULL, NULL, NULL, '2025-12-12 07:14:44.242909', 36)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.243271', 8, NULL, 'waiting', 'Test', '2025-12-12 07:14:44.243271')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=8" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 06bf8ed8-57bb-48ca-8a20-a13b94969c45) to Test(default) with arguments: 14
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.243851', NULL, NULL, NULL, '2025-12-12 07:14:44.243851', 17)[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "8"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.244157', '2025-12-12 07:14:44.244168', '$2a$04$vYRhN2GyZRgyKaRUvd3L7uYTN37/2/cyKdMK/bwaZb6kgriakOvjW', '2025-12-12 07:14:44.244157', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1f53cbca-44dc-4e44-9c7c-88b3c8a6798b) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (36, '2025-12-12 07:14:44.244441', 35, NULL, 'active', 'Test', '2025-12-12 07:14:44.244441')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 8 OR `conversations`.`assigned_expert_id` = 8) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (17, '2025-12-12 07:14:44.244874', 16, NULL, 'active', 'Test', '2025-12-12 07:14:44.244874')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 8 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.245680', '2025-12-12 07:14:44.245691', '$2a$04$q0JT.xU0jydwRSH5Q4lv.uaZ1Lhr6q5.cqY.GtSnKsCPlXu6Uh8r.', '2025-12-12 07:14:44.245680', 'expertuser')[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:14:44.245513', 1, '2025-12-12 07:14:44.245637', 2, NULL, 'active', '2025-12-12 07:14:44.245637')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:14:44.246699', NULL, NULL, NULL, '2025-12-12 07:14:44.246699', 29)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 27684ea3-4387-42d4-8d98-ea7997b9e9fc) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.247287', 3, NULL, 'waiting', 'Second', '2025-12-12 07:14:44.247287')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.247552', 28, NULL, 'waiting', 'First', '2025-12-12 07:14:44.247552')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 10, '2025-12-12 07:14:44.247756', FALSE, 16, 'initiator', '2025-12-12 07:14:44.247756')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.247756', `conversations`.`updated_at` = '2025-12-12 07:14:44.248269' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.248912', '2025-12-12 07:14:44.248926', '$2a$04$Q4NYQECQRFchCwgHwXqsKOPTdkSAAfgKQ4Z3j5p7TC/DhbbH.W1ae', '2025-12-12 07:14:44.248912', 'expert2')[0m
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 26 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.249867', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.249867', 26)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 59f6a1fc-38fc-49e4-807e-2b40b6d200a6) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4] Performing GenerateExpertFaqJob (Job ID: 4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4) from Test(default) enqueued at 2025-12-12T07:14:44.250685090Z with arguments: "non-existent-id"
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.250623', '2025-12-12 07:14:44.250636', '$2a$04$pZmRo89HSfb8rK5xLmIBGepILjXJskQNHbEEobovKrm5q.kzTQTYq', '2025-12-12 07:14:44.250623', 'expert2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4] Performed GenerateExpertFaqJob (Job ID: 4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4) from Test(default) in 0.34ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4fc18789-43b4-4ac8-8ab4-f7dea2c8f5d4) to Test(default) with arguments: "non-existent-id"
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.251572', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.251572', 10)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4e2e9e33-bda4-4815-921d-c8c73cf6539f) to Test(default) with arguments: 5
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86] Performing GenerateExpertFaqJob (Job ID: c01975db-d946-4a01-820e-924073d3ec86) from Test(default) enqueued at 2025-12-12T07:14:44.252454610Z with arguments: 5
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 5 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86]   [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.254329' WHERE `expert_profiles`.`id` = 5[0m
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86]   [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [c01975db-d946-4a01-820e-924073d3ec86] Performed GenerateExpertFaqJob (Job ID: c01975db-d946-4a01-820e-924073d3ec86) from Test(default) in 1.76ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c01975db-d946-4a01-820e-924073d3ec86) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 13, '2025-12-12 07:14:44.254424', FALSE, 36, 'expert', '2025-12-12 07:14:44.254424')[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.254424', `conversations`.`updated_at` = '2025-12-12 07:14:44.255514' WHERE `conversations`.`id` = 13[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.257458', '2025-12-12 07:14:44.257471', '$2a$04$Q32eKE77ME4npBdXKfEMhu6ta5LBekatQZN05Fr/6MlSyL.m6Y63G', '2025-12-12 07:14:44.257458', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.258252', 3, NULL, 'waiting', 'Third', '2025-12-12 07:14:44.258252')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.258408', 28, NULL, 'waiting', 'Second', '2025-12-12 07:14:44.258408')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
Started GET "/api/messages/updates?userId=35" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 10, '2025-12-12 07:14:44.259047', FALSE, 17, 'expert', '2025-12-12 07:14:44.259047')[0m
Started GET "/api/conversations/updates?userId=3" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.259047', `conversations`.`updated_at` = '2025-12-12 07:14:44.259583' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "35"}
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "3"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 35 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mConversation Pluck (0.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 35 OR `conversations`.`assigned_expert_id` = 35)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.262688', '2025-12-12 07:14:44.262701', '$2a$04$A1E98CogEx9T40xZN4UkuOKbjCVyrYTWdN0TzyMLybMoljmplsdqS', '2025-12-12 07:14:44.262688', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.260252', `users`.`updated_at` = '2025-12-12 07:14:44.262799' WHERE `users`.`id` = 27[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 13 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 2.9ms (3 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 3 OR `conversations`.`assigned_expert_id` = 3) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 36[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.6ms (5 queries, 0 cached) | GC: 3.0ms)
Processing by AuthController#me as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#logout as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.269039', '2025-12-12 07:14:44.269050', '$2a$04$qANcwdWyJIR3D.f33rvryuu4TaI3L9jgvIEz464845li/KfJDsNHa', '2025-12-12 07:14:44.269039', 'test')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.269327', 28, NULL, 'waiting', 'Third', '2025-12-12 07:14:44.269327')[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.8ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.270111', NULL, NULL, NULL, '2025-12-12 07:14:44.270111', 12)[0m
Started GET "/api/expert-queue/updates?expertId=29" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3c204de1-d4ee-41b7-84c0-09b379c062c2) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Processing by UpdatesController#expert_queue_updates as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
--------------------------------------------------------------------
  Parameters: {"expertId" => "29"}
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 10, '2025-12-12 07:14:44.270389', FALSE, 16, 'initiator', '2025-12-12 07:14:44.270389')[0m
Processing by AuthController#me as HTML
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.270389', `conversations`.`updated_at` = '2025-12-12 07:14:44.270999' WHERE `conversations`.`id` = 10[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
Started GET "/api/messages/updates?userId=16" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "16"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 16 AND `messages`.`sender_id` != 29 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 17 AND `messages`.`sender_id` != 29 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.273403', '2025-12-12 07:14:44.273418', '$2a$04$pfI8P8YXxf3tEGwT4oCcZulMBHN7M/xrO7mR1eIHHbxpoJkSZd0GW', '2025-12-12 07:14:44.273403', 'test')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 18 AND `messages`.`sender_id` != 29 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 29 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 07:14:44.274332' WHERE `conversations`.`id` = 1[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.2ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 1 AND `expert_assignments`.`expert_id` = 2 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.3ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 07:14:44.276099', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 07:14:44.276273' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mConversation Pluck (3.6ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 16 OR `conversations`.`assigned_expert_id` = 16)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 10 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
Completed 201 Created in 9ms (Views: 0.0ms | ActiveRecord: 5.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.277325', '2025-12-12 07:14:44.277341', '$2a$04$OBctaSVarElmnWwHNquXhOOFHXKngOT4qCEsxX3UWtM2fBZgmeiha', '2025-12-12 07:14:44.277325', 'newexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (16, 17)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 3.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.278510', NULL, NULL, NULL, '2025-12-12 07:14:44.278510', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 39e34713-b7bb-46ed-9e8c-4b0fde7228fc) to Test(default) with arguments: 3
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.278854', `users`.`updated_at` = '2025-12-12 07:14:44.279014' WHERE `users`.`id` = 37[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 0.9ms (3 queries, 0 cached) | GC: 2.1ms)
  [1m[36mTRANSACTION (7.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (10.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
Completed 201 Created in 7ms (Views: 0.1ms | ActiveRecord: 2.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
-------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
Processing by AuthController#refresh as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.285140', '2025-12-12 07:14:44.285156', '$2a$04$.CZnniKHkEF075tE6NJjxOa1DAzI9V8dvY8B/kFP/X9gkR.iZVD1m', '2025-12-12 07:14:44.285140', 'testuser3')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.285140', '2025-12-12 07:14:44.285156', '$2a$04$9fuKOX2uBHOxDpBmaIGasut.osWShzuXK08WOn1cT3UxhjBh1i2E6', '2025-12-12 07:14:44.285140', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.285376', '2025-12-12 07:14:44.285393', '$2a$04$u.WyftbgaNMJAq4BqhaM0.2c1tbxvZCiVlToFiMrE9mv0DAGYPsUe', '2025-12-12 07:14:44.285376', 'testuser4')[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.285792', '2025-12-12 07:14:44.285804', '$2a$04$byTXmQ9MgovprJ.Wv8.LSe2gVzTT9i3PE1zIzdXtAsA/0Z9ZX0cTG', '2025-12-12 07:14:44.285792', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------
-------------------------------------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
--------------------------------------------------------
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
-------------------------------------------------------------------------------------
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#login as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.287476', '2025-12-12 07:14:44.287487', '$2a$04$8c978cIF1wJT49.ZAqiIDuHIkI4R7l4WEQGDfVdcl7jJn9j9tCIlS', '2025-12-12 07:14:44.287476', 'testlogout')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.287587', '2025-12-12 07:14:44.287603', '$2a$04$LOpJi.37wk1ZsZOOgBiRY.SB9CFUcuXKj4F1GGkBIhZGekDZqab4C', '2025-12-12 07:14:44.287587', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.287885', `users`.`updated_at` = '2025-12-12 07:14:44.288060' WHERE `users`.`id` = 30[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.288198', `users`.`updated_at` = '2025-12-12 07:14:44.288337' WHERE `users`.`id` = 28[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.288642', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.288642', 3)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8ed1943c-30eb-46d7-b490-b44305dbfe95) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:14:44.289851', `users`.`updated_at` = '2025-12-12 07:14:44.290014' WHERE `users`.`id` = 38[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.290085' WHERE `expert_profiles`.`id` = 2[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4349bb3f-94d5-4929-8a71-651758fd41a2) to Test(default) with arguments: 2
Processing by AuthController#me as HTML
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.291965', '2025-12-12 07:14:44.291977', '$2a$04$JeROo9cwq14b6WJSWLEYjORFtp9Pc/dKE31WOd5HA2DC7nMPE1.96', '2025-12-12 07:14:44.291965', 'expert1')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.291991', '2025-12-12 07:14:44.292003', '$2a$04$uazjWoZcurrkzO4XaXPj0eVa2jeDfJubsN.lEf8FeHMd68sORfrcO', '2025-12-12 07:14:44.291991', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by AuthController#logout as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.292836', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.292836', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.292933', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.292933', 19)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 467e5681-c023-4416-b628-f13549901460) to Test(default) with arguments: 4
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b16b02a9-dcd7-466d-8c2d-9bca8e00dd6b) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
-------------------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.8ms (7 queries, 0 cached) | GC: 0.0ms)
---------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.294816', '2025-12-12 07:14:44.294830', '$2a$04$j3YN8D/zdi8OjM8cVknh6eab/x3bWwrtflbHEazrhdHy1NNXuJYuO', '2025-12-12 07:14:44.294816', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.296240', '2025-12-12 07:14:44.296252', '$2a$04$PqV7wPLl.eNzw5JQmIRpCOQ9Ny24Fw5YQldGR0IipoLprJcPiC6.C', '2025-12-12 07:14:44.296240', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.296439', '2025-12-12 07:14:44.296449', '$2a$04$mD2THshnoG1eAFrjSu260eOzOskEfeNf5E3CAR04xn4ub3NobMZj.', '2025-12-12 07:14:44.296439', 'expertuser')[0m
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 07:14:44.297123', 14, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.297123')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.298061', '2025-12-12 07:14:44.298073', '$2a$04$PFwxmMukUfia/ALKuD8IVu97HhEmYL/Geo81rK0MFpJuTk1hoMIdS', '2025-12-12 07:14:44.298061', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.298312', '2025-12-12 07:14:44.298322', '$2a$04$HeBuruHRezThVqqRuNXXOOerzBUu69vDI06POPVjvUi.8Pdr0hlg.', '2025-12-12 07:14:44.298312', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1530.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (5, '2025-12-12 07:14:44.299170', 4, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.299170')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 8, '2025-12-12 07:14:44.299528', FALSE, 14, 'initiator', '2025-12-12 07:14:44.299528')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.299804', '2025-12-12 07:14:44.299814', '$2a$04$4iHhXMlu/.pP/kQqOLdUhOkOQ0PUJ5jUMraBhq/.nTNLCYmuxDvEe', '2025-12-12 07:14:44.299804', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.299843', '2025-12-12 07:14:44.299856', '$2a$04$Wbq93paKLsKGxn6g3tmqWuJ4GnLpMi205YZ9X0bAQuTekzjsgieLe', '2025-12-12 07:14:44.299843', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.299843', '2025-12-12 07:14:44.299857', '$2a$04$LAn4AoTTHi2VJOHCkAlDEO1wngSf7.yKjzyLb.Lr8bv264Bq7nQj.', '2025-12-12 07:14:44.299843', 'testuser')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.299528', `conversations`.`updated_at` = '2025-12-12 07:14:44.299945' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.300125', '2025-12-12 07:14:44.300136', '$2a$04$BD2vDGC2GxuW94O3/G/LMeQXDxWZwAD1DyjiJ2wl8Lka8iznQAV76', '2025-12-12 07:14:44.300125', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (30, '2025-12-12 07:14:44.300660', 29, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.300660')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.301711', '2025-12-12 07:14:44.301722', '$2a$04$0C7uzGGCq5alHlDAodFzDOKC3m53CmmyqHF7WOuqz7aXvcK1AI24C', '2025-12-12 07:14:44.301711', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.301695', '2025-12-12 07:14:44.301708', '$2a$04$tJV6qrJC8Rq7KT.BXbma1eBcb/islBgZOHssym2JvOAR5BMDTIlQe', '2025-12-12 07:14:44.301695', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.301695', '2025-12-12 07:14:44.301708', '$2a$04$BPFuRS7WrC5N9mBK2V6Zneo0enNB/bth8RTbeqcX9ru..r3TKAreu', '2025-12-12 07:14:44.301695', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.302378', '2025-12-12 07:14:44.302390', '$2a$04$V4TZMvu3M08yxZ8KGwhPMuwxP5PAsvQYrZTo/J4Qb7t0xGrn1QtwC', '2025-12-12 07:14:44.302378', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 07:14:44.302441', 7, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.302441')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (40, '2025-12-12 07:14:44.302485', 39, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.302485')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 07:14:44.302526', 20, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.302526')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "5", "content" => "Test"}
Processing by MessagesController#create as HTML
Processing by MessagesController#create as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  Parameters: {"conversationId" => "14", "content" => "New message"}
  Parameters: {"conversationId" => "11", "content" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 39 LIMIT 1[0m
  [1m[36mTruncate Tables (1525.1ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 14 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 07:14:44.304826', TRUE, 7, 'initiator', '2025-12-12 07:14:44.304826')[0m
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 14, '2025-12-12 07:14:44.305101', FALSE, 39, 'initiator', '2025-12-12 07:14:44.305101')[0m
Completed 403 Forbidden in 2ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 1.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.304826', `conversations`.`updated_at` = '2025-12-12 07:14:44.305260' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/5/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.305101', `conversations`.`updated_at` = '2025-12-12 07:14:44.305514' WHERE `conversations`.`id` = 14[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 01350223-1b3b-4d6e-a5db-3699fafddd2b) to Test(default) with arguments: 2
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.4ms)
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "5"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.306508', '2025-12-12 07:14:44.306520', '$2a$04$md557i6o8QGbUlDtFYGPzul1/RwDz9sg14IWKRafDSKcxqfJXLF6a', '2025-12-12 07:14:44.306508', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7) AND `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 5 ORDER BY `messages`.`created_at` ASC[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.308033', '2025-12-12 07:14:44.308042', '$2a$04$5UGMr4jds6Xwv8dKynN.HOpc/0.y1Bh75JMPY7S38FtDJ38gL2TLy', '2025-12-12 07:14:44.308033', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:14:44.308735', 6, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.308735')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "3", "content" => "Test message"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.309544', '2025-12-12 07:14:44.309555', '$2a$04$wscyBmXR3IOIPeAKIMtvoe7gKWvR78spzgyjW9EJbwPMG7dCZZgNy', '2025-12-12 07:14:44.309544', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.311059', '2025-12-12 07:14:44.311069', '$2a$04$ZKcvZq0cWPlR7LRu3eO9sOMdK2sPUk65NPA8.EqaUVBCdU5Pwu0za', '2025-12-12 07:14:44.311059', 'expertuser')[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 8, '2025-12-12 07:14:44.310801', FALSE, 15, 'expert', '2025-12-12 07:14:44.310801')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.310801', `conversations`.`updated_at` = '2025-12-12 07:14:44.311435' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (23, '2025-12-12 07:14:44.311731', 22, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.311731')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.312213', '2025-12-12 07:14:44.312226', '$2a$04$xHtW/w4rt5fOMECqLu046.GMelta5Zp5yUtCJeonJ6qkYoUJIfhr.', '2025-12-12 07:14:44.312213', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 12, '2025-12-12 07:14:44.312379', FALSE, 22, 'initiator', '2025-12-12 07:14:44.312379')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.312379', `conversations`.`updated_at` = '2025-12-12 07:14:44.312828' WHERE `conversations`.`id` = 12[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
Started GET "/conversations/12/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.313373', '2025-12-12 07:14:44.313389', '$2a$04$K2ml4WVabCQHflAQ4KLvTu7qX5Zmq.Ubxr7JivE6rlpKWwhYyqQ6m', '2025-12-12 07:14:44.313373', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by MessagesController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Parameters: {"conversation_id" => "12"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.313830', '2025-12-12 07:14:44.313840', '$2a$04$VgxNkDWDX9RMmesLXdVQVOfrvaj4jUSDYk5beL8bmJOyLx/mM3r5q', '2025-12-12 07:14:44.313830', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 22 OR `conversations`.`assigned_expert_id` = 22) AND `conversations`.`id` = 12 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (42, '2025-12-12 07:14:44.314565', 41, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.314565')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.314875', '2025-12-12 07:14:44.314889', '$2a$04$Xe0kEJtI0TCwyXHQ2sgyk.nZXxwdQHHzdPJM6hmj/KOUa1tvjS3MW', '2025-12-12 07:14:44.314875', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 12 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 3, '2025-12-12 07:14:44.314931', FALSE, 6, 'initiator', '2025-12-12 07:14:44.314931')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.314931', `conversations`.`updated_at` = '2025-12-12 07:14:44.315657' WHERE `conversations`.`id` = 3[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.315721', '2025-12-12 07:14:44.315732', '$2a$04$BKH76iyU8FeY7Fi0pLarq.N484/dWgBtkQn0y8COHDes.oCp5dcki', '2025-12-12 07:14:44.315721', 'expertuser')[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: fca01488-d199-485d-9640-d31452f56fe4) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 201 Created in 7ms (Views: 0.1ms | ActiveRecord: 2.2ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.316432', '2025-12-12 07:14:44.316441', '$2a$04$tIMJMuit/QXH2wyaiozBtOdbRMG6NByvrK9ZCM6Ftxqo8nAb.xrVG', '2025-12-12 07:14:44.316432', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:14:44.317242', 9, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.317242')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (33, '2025-12-12 07:14:44.316757', 32, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.316757')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 6, '2025-12-12 07:14:44.318006', FALSE, 9, 'initiator', '2025-12-12 07:14:44.318006')[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.318006', `conversations`.`updated_at` = '2025-12-12 07:14:44.318355' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started PUT "/messages/2/read" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "2"}
--------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.319097', '2025-12-12 07:14:44.319108', '$2a$04$JJrjIA0N7HqPkaIVl8Is0.JcSNQvxB8KCEaD8A6MYV9P0PizaL.Mq', '2025-12-12 07:14:44.319097', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_includes_senderUsername
---------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.320424', '2025-12-12 07:14:44.320435', '$2a$04$B4W6dWQqI0XKFnNykeSVt.Ecf.0dfRhzQ3BudC.LA/86lJb2/tZa.', '2025-12-12 07:14:44.320424', 'testuser')[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '10' OR conversations.assigned_expert_id = '10') AND `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 07:14:44.320954' WHERE `messages`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/conversations/6/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.321668', '2025-12-12 07:14:44.321680', '$2a$04$cCvvNzgm1k.Ncq/7J.XrbO6zsG6Us9QtMrQhOIMudKt1sQM5wDx0u', '2025-12-12 07:14:44.321668', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.321928', '2025-12-12 07:14:44.321937', '$2a$04$.hIx0RzX5B.Vc18mXY2I3Ot1SwueZaqriym6E4jMZwDV8ldWzo8ku', '2025-12-12 07:14:44.321928', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 8, '2025-12-12 07:14:44.322147', FALSE, 14, 'initiator', '2025-12-12 07:14:44.322147')[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "6"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 07:14:44.322533', 24, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.322533')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.322147', `conversations`.`updated_at` = '2025-12-12 07:14:44.322733' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 34 OR `conversations`.`assigned_expert_id` = 34) AND `conversations`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.323193', '2025-12-12 07:14:44.323204', '$2a$04$Hm80UrPyeYkjewmDPNqzAe0TUiVjQya2BrboCwAbk5Fz4eBleSLXS', '2025-12-12 07:14:44.323193', 'expertuser')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 13, '2025-12-12 07:14:44.323183', FALSE, 24, 'initiator', '2025-12-12 07:14:44.323183')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/8/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.323183', `conversations`.`updated_at` = '2025-12-12 07:14:44.323540' WHERE `conversations`.`id` = 13[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started PUT "/messages/5/read" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Filter chain halted as :set_conversation rendered or redirected
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (9, '2025-12-12 07:14:44.323822', 8, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.323822')[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.7ms)
Processing by MessagesController#mark_read as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Parameters: {"id" => "5"}
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "8"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "4", "content" => "Test message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 14 OR `conversations`.`assigned_expert_id` = 14) AND `conversations`.`id` = 8 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "15", "content" => "New message"}
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '24' OR conversations.assigned_expert_id = '24') AND `messages`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 07:14:44.325641', FALSE, 8, 'initiator', '2025-12-12 07:14:44.325641')[0m
Completed 403 Forbidden in 2ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 8 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.325641', `conversations`.`updated_at` = '2025-12-12 07:14:44.326048' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 6365487d-369a-48b8-966e-7c7bb5aa4a35) to Test(default) with arguments: 2
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 41 LIMIT 1[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 15 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (14, 15)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
---------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
---------------------------------------------------------------------------------------
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 15, '2025-12-12 07:14:44.327504', FALSE, 41, 'initiator', '2025-12-12 07:14:44.327504')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.327504', `conversations`.`updated_at` = '2025-12-12 07:14:44.328083' WHERE `conversations`.`id` = 15[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 6c66de57-5fc5-4ad2-a21d-c51430d319b6) to Test(default) with arguments: 3
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (4 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 15 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.329265', '2025-12-12 07:14:44.329282', '$2a$04$xKDu7M4WysHRC/hkxYcR4OV9Nro6/uZlOrSj3ob3R8gqETXSR5A/S', '2025-12-12 07:14:44.329265', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.331034', '2025-12-12 07:14:44.331047', '$2a$04$hez8Pf6iTXOwelle4gVxg.I8C83wn/FiR9q6/yrBj05I6b5fOq.FO', '2025-12-12 07:14:44.331034', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 07:14:44.331795', 11, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.331795')[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (7.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/7/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "7"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.334546', '2025-12-12 07:14:44.334564', '$2a$04$xF/qA.rz9z4Qq8WMkRa7fuNrMr8cJ7Kij2Vdlq9nGjS/Tb4yfw20q', '2025-12-12 07:14:44.334546', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1558.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
--------------------------------------------------------------------------------
----------------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.336323', '2025-12-12 07:14:44.336336', '$2a$04$jEbdxT2NV6qS2N3yB3zL/.8E6pYuq8DC4k1mfeJq4.3ZnOxoKmpXS', '2025-12-12 07:14:44.336323', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.337173', '2025-12-12 07:14:44.337194', '$2a$04$WW7S13UsqZGwfiP1.kqgVOxDRbhQiIbNNvNAKiZDw5eLWC0YIhJkq', '2025-12-12 07:14:44.337173', 'testuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 07:14:44.337234', 26, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.337234')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
AutoResponderServiceTest: test_responds_to_first_initiator_message_when_FAQ_is_present
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.337942', '2025-12-12 07:14:44.337961', '$2a$04$7SfX/HsI4/FPXjDopku4ruAfX.WbnqJDhfbMuoQCd5b09oaEO2jli', '2025-12-12 07:14:44.337942', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 14, '2025-12-12 07:14:44.338010', FALSE, 26, 'initiator', '2025-12-12 07:14:44.338010')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.338070', '2025-12-12 07:14:44.338090', '$2a$04$3yp95jreSFxyPAYEs3h4YOCviu0FZzclEFtVKEyAM1wM9Gw34Pw6e', '2025-12-12 07:14:44.338070', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.338226', '2025-12-12 07:14:44.338247', '$2a$04$u1KxhaikG3OR4fQaPcIaVu8hMLqK6dDjvm3XoZPICJkqWC.cQFNTC', '2025-12-12 07:14:44.338226', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.338010', `conversations`.`updated_at` = '2025-12-12 07:14:44.338540' WHERE `conversations`.`id` = 14[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 43 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started PUT "/messages/6/read" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.338994', '2025-12-12 07:14:44.339006', '$2a$04$3zIb8sJKqGNT/Pr1QPLQpedSpuP/tW./DCwwb2DyRM4kwraE6EgeW', '2025-12-12 07:14:44.338994', 'asker')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.339096', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.339096', 43)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "6"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.339359', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.339359', 10)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: cc73091d-89cd-4812-b5d7-923d9b1671d2) to Test(default) with arguments: 15
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b254885b-6b69-4d5f-9b5b-f3cb4f9ee742) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.339931' WHERE `expert_profiles`.`id` = 15[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.340020' WHERE `expert_profiles`.`id` = 3[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2de2b1b0-2449-41c1-9256-6cc7720c6f48) to Test(default) with arguments: 3
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.340617', '2025-12-12 07:14:44.340631', '$2a$04$3MvVggS5BOnrkPrQDIqjKuSzhvLz09SM8d63DvcCqo/cUooC0128e', '2025-12-12 07:14:44.340617', 'expert')[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
AutoResponderServiceTest: test_skips_when_not_the_first_message_from_initiator
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.341583', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:14:44.341583', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e2eeda38-cf6b-454d-a45c-33541f12f644) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (14, '2025-12-12 07:14:44.342234', 13, NULL, 'active', 'Need help', '2025-12-12 07:14:44.342234')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 8, '2025-12-12 07:14:44.343121', FALSE, 13, 'initiator', '2025-12-12 07:14:44.343121')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.343121', `conversations`.`updated_at` = '2025-12-12 07:14:44.343515' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------
AutoResponderServiceTest: test_skips_when_expert_has_no_FAQ
-----------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.344097', '2025-12-12 07:14:44.344113', '$2a$04$8WjySWng6Q7tmRoIajVGB.cavjOFzL8FGKgO3DPQPWIvnkVWcf7dG', '2025-12-12 07:14:44.344097', 'asker')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 8 ORDER BY `messages`.`created_at` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('A: Use the FAQ guidance.', 8, '2025-12-12 07:14:44.345204', FALSE, 14, 'expert', '2025-12-12 07:14:44.345204')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.345302', '2025-12-12 07:14:44.345318', '$2a$04$DbQOwdGPM2bxk7TvEBxbS.615YRDG9GGqa2wfEVRhkZd7FsZu1KsO', '2025-12-12 07:14:44.345302', 'asker')[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.345204', `conversations`.`updated_at` = '2025-12-12 07:14:44.345659' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 8 ORDER BY `messages`.`created_at` DESC LIMIT 1[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
Processing by HealthController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
Completed 200 OK in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
  [1m[36mConversation Delete All (0.4ms)[0m  [1m[31mDELETE FROM `conversations`[0m
Processing by HealthController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.346782', '2025-12-12 07:14:44.346797', '$2a$04$WkmmKe80f2EPmrZL4564UuwY2yKUDcC6Hw6qGkYqopnJz4tq4p8yO', '2025-12-12 07:14:44.346782', 'expert')[0m
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.347065', '2025-12-12 07:14:44.347079', '$2a$04$9KfmLM8yRpMghBKf2bWNR.Q.96bfVa/RmeoLjIZggv/wvu6efwzZW', '2025-12-12 07:14:44.347065', 'expert')[0m
Completed 200 OK in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.348136', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:14:44.348136', 18)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f548075f-ec9a-4572-8ce4-f2247196071f) to Test(default) with arguments: 7
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.348717', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:14:44.348717', 37)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 07:14:44.348961', 17, NULL, 'active', 'Need help', '2025-12-12 07:14:44.348961')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = NULL, `expert_profiles`.`updated_at` = '2025-12-12 07:14:44.349569' WHERE `expert_profiles`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 9, '2025-12-12 07:14:44.350540', FALSE, 17, 'initiator', '2025-12-12 07:14:44.350540')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7923c5f7-47bc-4bf1-9989-9292a543c600) to Test(default) with arguments: 14
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.350540', `conversations`.`updated_at` = '2025-12-12 07:14:44.350998' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (37, '2025-12-12 07:14:44.351493', 36, NULL, 'active', 'Need help', '2025-12-12 07:14:44.351493')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First question', 7, '2025-12-12 07:14:44.353052', FALSE, 36, 'initiator', '2025-12-12 07:14:44.353052')[0m
  [1m[36mConversation Delete All (1.7ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mConversation Update (0.7ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.353052', `conversations`.`updated_at` = '2025-12-12 07:14:44.354040' WHERE `conversations`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (3.5ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second question', 7, '2025-12-12 07:14:44.355851', FALSE, 36, 'initiator', '2025-12-12 07:14:44.355851')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.355851', `conversations`.`updated_at` = '2025-12-12 07:14:44.357419' WHERE `conversations`.`id` = 7[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.356994', '2025-12-12 07:14:44.357050', '$2a$04$pv.IQN0l0IFArm4UJWg2xO4OfkP0g380eV92XlS7XKCYl4XQX3k0e', '2025-12-12 07:14:44.356994', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.356981', '2025-12-12 07:14:44.357054', '$2a$04$GbFuo6yjMrjxbsL649M4Qu0lJQ8UEaXzVaCo8ui8c926foE/WAi/C', '2025-12-12 07:14:44.356981', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.357387', '2025-12-12 07:14:44.357454', '$2a$04$EeznbfVvs29rHsiLmc2.Bu9kkesIUVj6QcHjuHlhhsOpWz06f5sHm', '2025-12-12 07:14:44.357387', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.359031', '2025-12-12 07:14:44.359041', '$2a$04$eMomD5x/gKDE8K18XkR2UOGNejP4uUet4nrV8yPUJpkqv74fyY2tK', '2025-12-12 07:14:44.359031', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.359275', '2025-12-12 07:14:44.359289', '$2a$04$TMtby6AO2uaGd0gNaZn7/ejfLYNVUAJA/wl/T6yKDILMHxsiP.Jte', '2025-12-12 07:14:44.359275', 'expertuser')[0m
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 7 ORDER BY `messages`.`created_at` ASC LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:14:44.367617', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.367617')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:14:44.367816', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:14:44.367816')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mConversation Delete All (4.6ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Exists? (6.0ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:14:44.369660', '2025-12-12 07:14:44.369672', '$2a$04$CycoahjApmA1f5.9.VZnROESq6c.uhtj6BvQrHZ1EIaEhnKFFzQza', '2025-12-12 07:14:44.369660', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:14:44.369823', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:14:44.369823', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:14:44.370389', 3, NULL, 'waiting', 'Other', '2025-12-12 07:14:44.370389')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 77d32077-1275-48ba-b947-81c641bf438f) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1586.8ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 2, '2025-12-12 07:14:44.375946', FALSE, 3, 'initiator', '2025-12-12 07:14:44.375946')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.375946', `conversations`.`updated_at` = '2025-12-12 07:14:44.377349' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/1/read" for 127.0.0.1 at 2025-12-12 07:14:44 +0000
  [1m[36mTruncate Tables (1618.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "Expert reply"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 1, '2025-12-12 07:14:44.399063', FALSE, 2, 'expert', '2025-12-12 07:14:44.399063')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:14:44.399063', `conversations`.`updated_at` = '2025-12-12 07:14:44.399731' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 7051a038-046c-4415-9b93-056d31c768f5) to Test(default) with arguments: 1
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 1.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '1' OR conversations.assigned_expert_id = '1') AND `messages`.`id` = 1 LIMIT 1[0m
Filter chain halted as :set_message rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1701.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1706.8ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1718.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1760.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:14:45 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 30 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (31.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (32.5ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (32.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (32.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (32.0ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (33.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mTruncate Tables (928.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (5.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.490893', '2025-12-12 07:16:08.490973', '$2a$04$J4f1axPbXhGSBg/x4neI8eeRS/MdZKY9N25EZoNFm8TKsOis4m4Ia', '2025-12-12 07:16:08.490893', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.497300', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.497300', 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e274c649-9e7e-4f95-b508-42b448d2dda7) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 07:16:08.499082' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 84ebde88-5e16-4f1d-bab8-8d03cebdd9fc) to Test(default) with arguments: 1
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.506844', '2025-12-12 07:16:08.506857', '$2a$04$fRGJQtTV.HNsj4R9lE/veucv6W2Cw9bm0S2iG5HF/MHM95YWhZYjC', '2025-12-12 07:16:08.506844', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.507744', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.507744', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 45d9cc45-c2d4-4083-a775-a59c50a1beb9) to Test(default) with arguments: 2
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (6.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.517349', '2025-12-12 07:16:08.517361', '$2a$04$pZ/XhKoy0agvr7f52suuZuhvxxPbhVFXLxOsWQalZ20emvXpyS2Yq', '2025-12-12 07:16:08.517349', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.518219', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.518219', 3)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: dd10d99f-3b44-4f3b-afb2-1fb89ed5b76d) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.3ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 07:16:08.518852' WHERE `expert_profiles`.`id` = 3[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
AutoRespondToQuestionJobTest: test_no-op_when_message_missing
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (17.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.542189', '2025-12-12 07:16:08.542203', '$2a$04$8e9hpUNeRvJFWFrZJfMrNeqoAppnjIibkGrtb9om0IckOBGtdAJ/S', '2025-12-12 07:16:08.542189', 'asker2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.543845', '2025-12-12 07:16:08.543855', '$2a$04$DTCtXbMu/IqVvljaRzigbe59aF32si5//xAdTQ0Vshrv4k25HRdP6', '2025-12-12 07:16:08.543845', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.544644', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:16:08.544644', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4e0c3032-a6cb-497e-8e5c-452f2b2db8f9) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (5, '2025-12-12 07:16:08.550315', 4, NULL, 'active', 'Need help', '2025-12-12 07:16:08.550315')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [AutoRespondToQuestionJob] [5f2c8b79-bec6-4c91-9268-4fea354e4791] Performing AutoRespondToQuestionJob (Job ID: 5f2c8b79-bec6-4c91-9268-4fea354e4791) from Test(default) enqueued at 2025-12-12T07:16:08.552300164Z with arguments: "missing"
[ActiveJob] [AutoRespondToQuestionJob] [5f2c8b79-bec6-4c91-9268-4fea354e4791]   [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = NULL LIMIT 1[0m
[ActiveJob] [AutoRespondToQuestionJob] [5f2c8b79-bec6-4c91-9268-4fea354e4791] Performed AutoRespondToQuestionJob (Job ID: 5f2c8b79-bec6-4c91-9268-4fea354e4791) from Test(default) in 1.84ms
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 5f2c8b79-bec6-4c91-9268-4fea354e4791) to Test(default) with arguments: "missing"
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (11.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
AutoRespondToQuestionJobTest: test_invokes_auto_responder_service
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.570266', '2025-12-12 07:16:08.570276', '$2a$04$AA2iISNwFRvjfiule33aKeJ/DzfhJIWDW1JqusOSXMFceMiZ8nrr.', '2025-12-12 07:16:08.570266', 'asker2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.571640', '2025-12-12 07:16:08.571649', '$2a$04$lgQEYiEHf5OnEMkcOWJUP.ZnpCTk3iBiBJt8Hn84wjoTpXW.lCHxu', '2025-12-12 07:16:08.571640', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.572323', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:16:08.572323', 7)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fd04eaba-799a-4b53-aad6-7377e4c0623a) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (7, '2025-12-12 07:16:08.572833', 6, NULL, 'active', 'Need help', '2025-12-12 07:16:08.572833')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 2, '2025-12-12 07:16:08.576441', FALSE, 6, 'initiator', '2025-12-12 07:16:08.576441')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.576441', `conversations`.`updated_at` = '2025-12-12 07:16:08.577829' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [AutoRespondToQuestionJob] [937a8f6e-86fa-488e-a49d-cd6c272bfe18] Performing AutoRespondToQuestionJob (Job ID: 937a8f6e-86fa-488e-a49d-cd6c272bfe18) from Test(default) enqueued at 2025-12-12T07:16:08.578390627Z with arguments: 1
[ActiveJob] [AutoRespondToQuestionJob] [937a8f6e-86fa-488e-a49d-cd6c272bfe18]   [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 1 LIMIT 1[0m
[ActiveJob] [AutoRespondToQuestionJob] [937a8f6e-86fa-488e-a49d-cd6c272bfe18] Performed AutoRespondToQuestionJob (Job ID: 937a8f6e-86fa-488e-a49d-cd6c272bfe18) from Test(default) in 0.35ms
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 937a8f6e-86fa-488e-a49d-cd6c272bfe18) to Test(default) with arguments: 1
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.593698', '2025-12-12 07:16:08.593708', '$2a$04$RWugvQXm9/c8rSBtwINLtOHWt6BakV72JxfNd6cM2HMFAjI2OVJVS', '2025-12-12 07:16:08.593698', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.641615', '2025-12-12 07:16:08.641629', '$2a$04$roesp4CrAl7jwZcLFJxb/uEjbWup1fhCi6KshnbNkRn6qa5uxPari', '2025-12-12 07:16:08.641615', 'newuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.642660', NULL, NULL, NULL, '2025-12-12 07:16:08.642660', 9)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a10c5261-3d2f-49a3-8cd2-1fa0e24371f1) to Test(default) with arguments: 6
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 2.5ms (6 queries, 0 cached) | GC: 0.6ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.656520', '2025-12-12 07:16:08.656530', '$2a$04$lXeZzCzLC1IBP063eNrPUe1qJ45/S/AjlCIscmhfoa6YUgVh4DxiC', '2025-12-12 07:16:08.656520', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:08.658732', `users`.`updated_at` = '2025-12-12 07:16:08.659595' WHERE `users`.`id` = 10[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.1ms (3 queries, 0 cached) | GC: 0.1ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.666722', '2025-12-12 07:16:08.666732', '$2a$04$zwTaWu4j2TTVe2sTK5bmZeP2nnvI5RCsS1kX40VQGHQZW/j97bw96', '2025-12-12 07:16:08.666722', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.674250', '2025-12-12 07:16:08.674262', '$2a$04$jNkA/Leirnc7Xbe2fiJO6ON.A9smnVCaWlb3uga9PqHjxlrebob76', '2025-12-12 07:16:08.674250', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:08.676376', `users`.`updated_at` = '2025-12-12 07:16:08.676491' WHERE `users`.`id` = 12[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.684147', '2025-12-12 07:16:08.684159', '$2a$04$UJbFdXIMQmwhg8.lJsLgpOgp.1GF.0/womGUho0IcdYF0hqqKpMnm', '2025-12-12 07:16:08.684147', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#create as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.693462', '2025-12-12 07:16:08.693472', '$2a$04$YsTVzbEhwtM9EJ6V.pQyJOR0pVJFZp.wef.YnXYQe2BAapb4kbIK.', '2025-12-12 07:16:08.693462', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.694084', 14, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.694084')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/3" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 14 OR `conversations`.`assigned_expert_id` = 14) AND `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 14 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.701458', '2025-12-12 07:16:08.701468', '$2a$04$5dF5YRtyyQfu/PnY1JQzMeNFqk0w3.fxCLAgPFGvaHMDt53o21CPm', '2025-12-12 07:16:08.701458', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.702935', '2025-12-12 07:16:08.702944', '$2a$04$ZhPucsnKEngYOYRS.G.jHOt/16L91UOepOE.MMvHu4ofiZ1A2hOBy', '2025-12-12 07:16:08.702935', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.703451', 16, NULL, 'waiting', 'Other Conversation', '2025-12-12 07:16:08.703451')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/4" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "4"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 15 OR `conversations`.`assigned_expert_id` = 15) AND `conversations`.`id` = 4 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.713400', '2025-12-12 07:16:08.713411', '$2a$04$eCYztkO17Q8FUuG64yZvAuRtTWLTUPqzg.LbI4HUoTt17Ag7jAY6O', '2025-12-12 07:16:08.713400', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.714023', 17, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.714023')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.723183', '2025-12-12 07:16:08.723193', '$2a$04$.3WeryIO8wtFr1pAkD7Wqun4sGJQDm86dut7qgjpLL133.NP24rBu', '2025-12-12 07:16:08.723183', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.724495', 18, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.724495')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 18 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.729434', '2025-12-12 07:16:08.729444', '$2a$04$GKQkMc/YSAUEtm.RDfwKJ.Xkjj85uFsBaGDlQrJqbAK3ehNs/8l3q', '2025-12-12 07:16:08.729434', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.729983', 19, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.729983')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 19 OR `conversations`.`assigned_expert_id` = 19) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 19 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.9ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.736400', '2025-12-12 07:16:08.736410', '$2a$04$nKCDSKrx7nFIgb9RBNYHIu8xmItxZ7SZS4HYn62jkJyS2iZR4rTHC', '2025-12-12 07:16:08.736400', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.737976', '2025-12-12 07:16:08.737989', '$2a$04$bZfCZBizB2LbjtUv3kOtKO5VxSuzD1.PqTQmhQ.w3siuB79Nphs0q', '2025-12-12 07:16:08.737976', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.738764', NULL, NULL, '[]', '2025-12-12 07:16:08.738764', 21)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0ebef567-7a95-4b37-9be4-2e30fff2b21d) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 07:16:08.739397', 20, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:08.739397')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/8" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "8"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 20 OR `conversations`.`assigned_expert_id` = 20) AND `conversations`.`id` = 8 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 20 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (6.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.750354', '2025-12-12 07:16:08.750365', '$2a$04$giDL/7ltGyEK6jDfLhd9/OxQbTE9yil4cHwtBCWlWKgcWi1yZgxbG', '2025-12-12 07:16:08.750354', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.758350', '2025-12-12 07:16:08.758360', '$2a$04$kObPfLS.eXdKh9QY0wh5Uum6/ntLBdj0SBUPFu7Ua7C6FntDGEm5i', '2025-12-12 07:16:08.758350', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.759804', '2025-12-12 07:16:08.759813', '$2a$04$1.4V2/2AgXxVCrF1PZCHt.McvQkgV/h6G5bE5k9bkMBMecytnmuGG', '2025-12-12 07:16:08.759804', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.760584', NULL, NULL, '[]', '2025-12-12 07:16:08.760584', 24)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 37308124-0e66-4a77-a496-e789a1aecd0f) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 07:16:08.761205', 23, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:08.761205')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 23 OR `conversations`.`assigned_expert_id` = 23) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 23 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (10.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.775891', '2025-12-12 07:16:08.775910', '$2a$04$N3KqxEwDLQPsnyBwJbscwOvRpeDRcYUUOTErDSUv3dH9sk.EXEAg.', '2025-12-12 07:16:08.775891', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.776447', 25, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.776447')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 25 OR `conversations`.`assigned_expert_id` = 25) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.784086', '2025-12-12 07:16:08.784099', '$2a$04$0L.BczX5pbIE4vm.tzWcxOVezYrB7b2otEtOzm4Rtv6IqBsMcqzoC', '2025-12-12 07:16:08.784086', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.788925', '2025-12-12 07:16:08.788935', '$2a$04$lRT8zFEW81QfLfaUTCZ6Suh1Gmsbt4C4AjgHm7.IoR5/ljQAHbIHi', '2025-12-12 07:16:08.788925', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.790468', 27, NULL, 'waiting', 'Test Conversation', '2025-12-12 07:16:08.790468')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 11 AND `messages`.`sender_id` != 27 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.802249', '2025-12-12 07:16:08.802259', '$2a$04$fHbDZ/LaMBlqNk0PtHeCEOeNlzU7NkRY4Ap0IDovpfQ5QS9b9SqyS', '2025-12-12 07:16:08.802249', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.806373', '2025-12-12 07:16:08.806384', '$2a$04$EI3We6eHIFNncmAFxhrILusXVdCEQfpnropBq1qbfew1rDsZaF3j.', '2025-12-12 07:16:08.806373', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.811660', '2025-12-12 07:16:08.811671', '$2a$04$HzdjDQ5/UX9q4AeElWsXAew1JXfzs0HQYvUyfu9ze7zvBdKvSg7ia', '2025-12-12 07:16:08.811660', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 30 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.812401', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.812401', 30)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 431ff079-5a79-47ca-80cb-edffae6eaf26) to Test(default) with arguments: 9
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mTruncate Tables (1315.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.817306', '2025-12-12 07:16:08.817318', '$2a$04$mfOsTqtmMiYXMieTf34kHeAcSydMX3o95sg0Uq0M2N71d5LyZgiF6', '2025-12-12 07:16:08.817306', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 31 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.818048', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.818048', 31)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c988a35e-839a-4301-8750-d23b8238b67c) to Test(default) with arguments: 10
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
-------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.824865', '2025-12-12 07:16:08.824877', '$2a$04$kRvPB720QECYfT..f5gV4OuBh584PFjGJTtdUozTsNckOSgeYIuJa', '2025-12-12 07:16:08.824865', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.826400', '2025-12-12 07:16:08.826409', '$2a$04$GYXgNKxNcGK6JpMep3IaLejq6ObYGS22l0Cw9snAw8yLCbZ/NYD3m', '2025-12-12 07:16:08.826400', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 33 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.827110', NULL, NULL, NULL, '2025-12-12 07:16:08.827110', 33)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5a300e00-7890-4e7a-b14b-337396fa2bf8) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (33, '2025-12-12 07:16:08.827716', 32, NULL, 'active', 'Active', '2025-12-12 07:16:08.827716')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (33, '2025-12-12 07:16:08.828309', 32, NULL, 'resolved', 'Resolved', '2025-12-12 07:16:08.828309')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=33" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "33"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 33 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 32 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 12 AND `messages`.`sender_id` != 33 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.833100', '2025-12-12 07:16:08.833280', '$2a$04$zGNatocshJvbi37mAQnWuOk8RVL5DqgIwHfLRq9WI.IO68/4AeMgi', '2025-12-12 07:16:08.833100', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.837355', '2025-12-12 07:16:08.837365', '$2a$04$LhLACiFwL2aHAX66cEbSSeX/aIAffI3PeSo4sb5JnpzxdrxxbQ.IC', '2025-12-12 07:16:08.837355', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.838746', '2025-12-12 07:16:08.838755', '$2a$04$U7/4V4U6Lug/5Lo/6w0PDeprvJHnTqMsrn4j/PqGqqehBq5Dl644S', '2025-12-12 07:16:08.838746', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.839652', NULL, NULL, NULL, '2025-12-12 07:16:08.839652', 35)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0c988e91-6542-4006-8180-84c23c143ebf) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.840395', 34, NULL, 'waiting', 'Test', '2025-12-12 07:16:08.840395')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:08.840232', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:08.840232', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=34" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "34"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 34 OR `conversations`.`assigned_expert_id` = 34) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 14 AND `messages`.`sender_id` != 34 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1df4d7b8-694a-41ef-815b-0710020a70ff) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.847461', '2025-12-12 07:16:08.847471', '$2a$04$W2EgGjqLltj9TssLaBgDMeYwLJSVJw.r/eWFJUApnI45ShDEo733a', '2025-12-12 07:16:08.847461', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 07:16:08.848025' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0edfb2a4-6e6a-408c-9b0a-d25a51ec472d) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.848939', '2025-12-12 07:16:08.848949', '$2a$04$Xo5NRmmnyrWHiixfHbofeeBFc/ZtI1h.21hatpaQvTY6riLKvwIY6', '2025-12-12 07:16:08.848939', 'expertuser')[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.849628', NULL, NULL, NULL, '2025-12-12 07:16:08.849628', 37)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 35f74358-ff92-4d18-abb4-8e03ed6d4fa3) to Test(default) with arguments: 13
Started GET "/api/conversations/updates?userId=36" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "36"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.855607', '2025-12-12 07:16:08.855619', '$2a$04$sy4fam3yBvDe8pmlg.CQxe3Ekzv5RgRTFmVm8FMYfRcK6efXKuojG', '2025-12-12 07:16:08.855607', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.857119', '2025-12-12 07:16:08.857128', '$2a$04$t.ZlClMcHRqdVunqlegtnu7JbsXt7aerx9ciup/teTx6u4qh9yYIa', '2025-12-12 07:16:08.857119', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 39 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.857816', NULL, NULL, NULL, '2025-12-12 07:16:08.857816', 39)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 988ca9a1-3729-4a5d-a9ea-2bf99c82883e) to Test(default) with arguments: 14
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (39, '2025-12-12 07:16:08.858452', 38, NULL, 'active', 'Test', '2025-12-12 07:16:08.858452')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 15, '2025-12-12 07:16:08.859017', FALSE, 39, 'expert', '2025-12-12 07:16:08.859017')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.859017', `conversations`.`updated_at` = '2025-12-12 07:16:08.859394' WHERE `conversations`.`id` = 15[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=38" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "38"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 38 OR `conversations`.`assigned_expert_id` = 38)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 15 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 39[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.867400', '2025-12-12 07:16:08.867410', '$2a$04$YzrOis86tjf7Zp8B0p9t5OlhiC8jH0VhBKuWlXAKxZxBFmQujjjcG', '2025-12-12 07:16:08.867400', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.868829', '2025-12-12 07:16:08.868839', '$2a$04$0eveQ6Rwted1vX1s5gM1COaPkYAEnuvwZDbT/ZN0cKy7jrd0Sk0tW', '2025-12-12 07:16:08.868829', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 41 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.869609', NULL, NULL, NULL, '2025-12-12 07:16:08.869609', 41)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3e52b910-4578-4db1-8a7e-63b4b476a6a6) to Test(default) with arguments: 15
Started GET "/api/expert-queue/updates?expertId=41" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "41"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 41 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 41 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 41 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.876480', '2025-12-12 07:16:08.876491', '$2a$04$2gTQrwlQKDI7EMpHSpd8CO8MVMKt0BICy/Et5bM4hzruairAYrUh.', '2025-12-12 07:16:08.876480', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.877972', '2025-12-12 07:16:08.877982', '$2a$04$HFantmTI9Nsf2pEqD4i.SuvkndwezKeGJNw1aFP2SsH8Ja5ZGDTQa', '2025-12-12 07:16:08.877972', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 43 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.878779', NULL, NULL, NULL, '2025-12-12 07:16:08.878779', 43)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8d8fd681-91e7-4668-9829-374b35531725) to Test(default) with arguments: 16
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.879458', 42, NULL, 'waiting', 'As Initiator', '2025-12-12 07:16:08.879458')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=42" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mTruncate Tables (1379.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "42"}
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 42 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 42 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 42 OR `conversations`.`assigned_expert_id` = 42) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 42 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 16 AND `messages`.`sender_id` != 42 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.884628', '2025-12-12 07:16:08.884646', '$2a$04$fXD5TucZIZcIU/GpSOG2t.pWMu0wwr9PdVNAuV1HIj4uKNPCHE8Oi', '2025-12-12 07:16:08.884628', 'testuser')[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.886338', '2025-12-12 07:16:08.886348', '$2a$04$764azykL28T0XJBA6QuIfO0n4Zpn52prKDt4ZnxKfSwsZax6k5fT2', '2025-12-12 07:16:08.886338', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.886626', '2025-12-12 07:16:08.886638', '$2a$04$HJcv.xH99d3M/5KWtNsS1erv5snD/LBGUy6uua7lzEReuUYqEdJuW', '2025-12-12 07:16:08.886626', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.887440', NULL, NULL, NULL, '2025-12-12 07:16:08.887440', 3)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4982db35-1450-4d31-affe-8ca40e80678e) to Test(default) with arguments: 2
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.887887', '2025-12-12 07:16:08.887904', '$2a$04$JZ1UnMIuz36yWignJKT4Eeva7TmC5Ok3NJob5mvpcZmmSElaPOyc6', '2025-12-12 07:16:08.887887', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 45 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.888720', NULL, NULL, NULL, '2025-12-12 07:16:08.888720', 45)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 18bd6d96-5e51-41bd-b079-74b67500f721) to Test(default) with arguments: 17
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 44 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (3, '2025-12-12 07:16:08.893238', 2, NULL, 'active', 'First', '2025-12-12 07:16:08.893238')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.896080', '2025-12-12 07:16:08.896092', '$2a$04$IjChZIEceOiVJxxnAuyb5OyLylLyL4QHstdB1jNaPa3YU12oUtpM.', '2025-12-12 07:16:08.896080', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.897473', '2025-12-12 07:16:08.897482', '$2a$04$LrMAILpvhG9xRWfSoq3iyOnNGTgxUrz5Ci1c2a5tu5gjVmK5EIroG', '2025-12-12 07:16:08.897473', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 47 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.898198', NULL, NULL, NULL, '2025-12-12 07:16:08.898198', 47)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: dc4cdc71-9c6a-4f6d-8259-14a56a190c0a) to Test(default) with arguments: 18
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (47, '2025-12-12 07:16:08.898822', 46, NULL, 'active', 'As Expert', '2025-12-12 07:16:08.898822')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=47" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "47"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 47 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 47 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 47 OR `conversations`.`assigned_expert_id` = 47) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 46 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 47 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 17 AND `messages`.`sender_id` != 47 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (3, '2025-12-12 07:16:08.905038', 2, NULL, 'active', 'Second', '2025-12-12 07:16:08.905038')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.910432', '2025-12-12 07:16:08.910444', '$2a$04$9fz4guBROxTYG3hah61LQOCU/JT16SkvyHkeZQ03K.F7QFh/p3CI2', '2025-12-12 07:16:08.910432', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.912055', '2025-12-12 07:16:08.912071', '$2a$04$EH59/Nj0IcHFpLG5XQVSOOMUbEkIo74GfHvD7FwieTtK1Wa3sdHvq', '2025-12-12 07:16:08.912055', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 49 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.913000', NULL, NULL, NULL, '2025-12-12 07:16:08.913000', 49)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2933178d-742e-41bd-ba93-79b0d92dd6c0) to Test(default) with arguments: 19
Started GET "/api/messages/updates?userId=48" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "48"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1412.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (3, '2025-12-12 07:16:08.915817', 2, NULL, 'active', 'Third', '2025-12-12 07:16:08.915817')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 07:16:08.916513' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.920404', '2025-12-12 07:16:08.920417', '$2a$04$S9SyRCkiv13aXOmWL7sdpuywR7aImw6P4IQd2IYeDpwI/u9hwHlSq', '2025-12-12 07:16:08.920404', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.922011', '2025-12-12 07:16:08.922020', '$2a$04$b67qZNlqvOgOAkF6qj9jReI7KJzWn6y.iNmxC/2EFYYDS/HsZZZWO', '2025-12-12 07:16:08.922011', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1387.8ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 51 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.922753', NULL, NULL, NULL, '2025-12-12 07:16:08.922753', 51)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8f6d550c-eae1-42b3-b216-3e6c3b7ec261) to Test(default) with arguments: 20
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.923554', 50, NULL, 'waiting', 'Old', '2025-12-12 07:16:08.923554')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 07:16:08.924141' WHERE `conversations`.`id` = 18[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.924619', 50, NULL, 'waiting', 'New', '2025-12-12 07:16:08.924619')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
-------------------------------------------------------------------------------------------
Started GET "/api/conversations/updates?userId=50&since=2025-12-11T07%3A16%3A08Z" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "50", "since" => "2025-12-11T07:16:08Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 50 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 50 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 50 OR `conversations`.`assigned_expert_id` = 50) AND (updated_at >= '2025-12-11 07:16:08') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 50 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 19 AND `messages`.`sender_id` != 50 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=3" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.930275', '2025-12-12 07:16:08.930336', '$2a$04$KjahA0VoQ1rcJujafOO0quwUnRLqo34CEilnEM/LAEHGB2qiVubW6', '2025-12-12 07:16:08.930275', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.932946', '2025-12-12 07:16:08.932960', '$2a$04$U/VdA5SRgZbEm1BkPStpiudcJPbuLBalU8nOnQA1iJo5vdVFF87KK', '2025-12-12 07:16:08.932946', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.933556', '2025-12-12 07:16:08.933569', '$2a$04$wsNTn/qzFi.CeYwQfm50EeQzBWib5cRy7IxGNHhh5eYlzK/WK7wJa', '2025-12-12 07:16:08.933556', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.934695', '2025-12-12 07:16:08.934708', '$2a$04$RG94AdFtzVSa4Wuuj64u/upEDQ5hAMASWz.UJyfmVP9EfubwtfBnS', '2025-12-12 07:16:08.934695', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 53 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.935703', NULL, NULL, NULL, '2025-12-12 07:16:08.935703', 53)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5ecbaee1-b307-4b91-823b-d06e1abfa91f) to Test(default) with arguments: 21
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.936585', 52, NULL, 'waiting', 'First', '2025-12-12 07:16:08.936585')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mExpertProfile Exists? (4.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 3 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.944053', NULL, NULL, NULL, '2025-12-12 07:16:08.944053', 2)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 40e871dd-8b06-4537-a188-ac9af501605d) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.947439', 52, NULL, 'waiting', 'Second', '2025-12-12 07:16:08.947439')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (1.5ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 3 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 3.4ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.958329', 52, NULL, 'waiting', 'Third', '2025-12-12 07:16:08.958329')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/api/conversations/updates?userId=52" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.959315', '2025-12-12 07:16:08.959333', '$2a$04$NsmpztokY5YlYCeUBeKe9u5To5ik0hW5Qg6M4HCNJhZh7CnI92WG6', '2025-12-12 07:16:08.959315', 'testuser')[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "52"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 52 OR `conversations`.`assigned_expert_id` = 52) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.960920', '2025-12-12 07:16:08.960933', '$2a$04$5tRrDffdXVLmxpZ8ePmAQOyNdoksBvjJoRBteLg4aDpJoJndtf/qC', '2025-12-12 07:16:08.960920', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 22 AND `messages`.`sender_id` != 52 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.961828', NULL, NULL, NULL, '2025-12-12 07:16:08.961828', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7f7a5b39-4f50-48d9-8b78-5c6db82ca625) to Test(default) with arguments: 3
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 21 AND `messages`.`sender_id` != 52 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
Started GET "/api/expert-queue/updates?expertId=5" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "5"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 20 AND `messages`.`sender_id` != 52 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "999999"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.969363', '2025-12-12 07:16:08.969377', '$2a$04$LeeM9BnunVkdki/p3n03ieDqKmhSCR1ApOyT8pxzrOMkEsfuKjHSm', '2025-12-12 07:16:08.969363', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.968125', '2025-12-12 07:16:08.968206', '$2a$04$9ch/rU7/hpHn801ByXLCeOzvM7sMEZeW4KqS4zeZLAPQxBpM.sz0C', '2025-12-12 07:16:08.968125', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.969541', '2025-12-12 07:16:08.969554', '$2a$04$ktcePrATswUWMtNaSCLTY.Oj7.BHGz.zDKrgk9JCWvKk/2kEuoJQK', '2025-12-12 07:16:08.969541', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.971117', '2025-12-12 07:16:08.971128', '$2a$04$oAHpyOwQuNHLEUGyMuOe..qABdi6psxA3mog2kS4PNaBUhbM2VAie', '2025-12-12 07:16:08.971117', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.971226', '2025-12-12 07:16:08.971236', '$2a$04$OyFReDODvP5Ox2mXJtmN8uddf49mJwgCcoNp1LfEXRrxaikivlKGu', '2025-12-12 07:16:08.971226', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.971225', '2025-12-12 07:16:08.971235', '$2a$04$ZWbQKre7EeoVG5S4aug4YOE8X3q.SCbMhdin9tEUO2zvJn2964VOm', '2025-12-12 07:16:08.971225', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 55 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.971993', NULL, NULL, NULL, '2025-12-12 07:16:08.971993', 55)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.972162', NULL, NULL, NULL, '2025-12-12 07:16:08.972162', 7)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 47b03c81-71b4-4179-a990-3c87828deb0e) to Test(default) with arguments: 22
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 977d449c-1b73-46ec-906a-c2dd96bee523) to Test(default) with arguments: 4
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.971697', '2025-12-12 07:16:08.971753', '$2a$04$Xv7Z.fCNz3ZIX0cDirEC5.O5pBO.Qf6eQpjV5aSaJta0qYr2XUpOe', '2025-12-12 07:16:08.971697', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.972846', 54, NULL, 'waiting', 'Waiting', '2025-12-12 07:16:08.972846')[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (55, '2025-12-12 07:16:08.973509', 54, NULL, 'active', 'Assigned', '2025-12-12 07:16:08.973509')[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=55" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "55"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 55 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.974631', '2025-12-12 07:16:08.974641', '$2a$04$I98YwHq7au3AK.9T8zaVxu90udbS2jkl8NajD17wavSblyPk9z7hi', '2025-12-12 07:16:08.974631', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 55 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 54 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 23 AND `messages`.`sender_id` != 55 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 55 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 54 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 55 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 24 AND `messages`.`sender_id` != 55 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.7ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.977242', NULL, NULL, NULL, '2025-12-12 07:16:08.977242', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4f433854-a25d-4372-95c5-872848f22a05) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (6.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.980495', NULL, NULL, NULL, '2025-12-12 07:16:08.980495', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ceb5059a-6fb6-48dd-a3fc-eb8be118c779) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.982995', '2025-12-12 07:16:08.983005', '$2a$04$rJXJ4n3Pvke.2NQD04YnKejJERLoWvRef.X4k35HU3.qZWKpojcmW', '2025-12-12 07:16:08.982995', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.983217', '2025-12-12 07:16:08.983228', '$2a$04$4Wp4TnLW1V1oNJEZZ5aT.uvBZLVEDAY.SaPa5.5UIICCMnB6NQdrW', '2025-12-12 07:16:08.983217', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.983434', '2025-12-12 07:16:08.983458', '$2a$04$0CSm7/1.U35W7a7k.9GktO02Mc7XdcQKIcVthy20kRREb0Gy8/wte', '2025-12-12 07:16:08.983434', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.984454', '2025-12-12 07:16:08.984463', '$2a$04$LSPblruGob2hfj1sJEVNr./bvHPw3oHVJgkouHL/GynaihNW.hAse', '2025-12-12 07:16:08.984454', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 57 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.984792', 1, NULL, 'waiting', 'User Conv', '2025-12-12 07:16:08.984792')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.984935', '2025-12-12 07:16:08.984948', '$2a$04$dV4wds08UUNq0Xh1RGo6h.xGxe0FX0EpVj5bxub0RizS.N1ZPdin.', '2025-12-12 07:16:08.984935', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.985241', NULL, NULL, NULL, '2025-12-12 07:16:08.985241', 57)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.985187', '2025-12-12 07:16:08.985201', '$2a$04$e9RmTgn1M6oIW1LoNoP6NuaQKcaE.pLrMJic/5jOIDyIrf99jYVj6', '2025-12-12 07:16:08.985187', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 67108b06-6571-4c23-afa4-023885c78090) to Test(default) with arguments: 23
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.985886', 56, NULL, 'waiting', 'First', '2025-12-12 07:16:08.985886')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.985920', NULL, NULL, NULL, '2025-12-12 07:16:08.985920', 9)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:08.986151', NULL, NULL, NULL, '2025-12-12 07:16:08.986151', 4)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 906942df-10a0-47d7-888f-6c9fa67fa2a6) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:08.986470', '2025-12-12 07:16:08.986481', '$2a$04$U/5Pm3ncVGvCFf2A9yLQEOLK7ddcSPW/YSGiUha6xt74/upLZuK7C', '2025-12-12 07:16:08.986470', 'otheruser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5ed5c318-89d5-4c0d-a41e-ba179508ce86) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (9, '2025-12-12 07:16:08.986875', 8, NULL, 'active', 'Test', '2025-12-12 07:16:08.986875')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.986984', 3, NULL, 'waiting', 'Other Conv', '2025-12-12 07:16:08.986984')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 4, '2025-12-12 07:16:08.989263', FALSE, 8, 'initiator', '2025-12-12 07:16:08.989263')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.989263', `conversations`.`updated_at` = '2025-12-12 07:16:08.989749' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 07:16:08.990279' WHERE `messages`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 4, '2025-12-12 07:16:08.990776', FALSE, 9, 'expert', '2025-12-12 07:16:08.990776')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.990776', `conversations`.`updated_at` = '2025-12-12 07:16:08.991162' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=8&since=2025-12-11T07%3A16%3A08Z" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "8", "since" => "2025-12-11T07:16:08Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.991935', 3, NULL, 'waiting', 'Old', '2025-12-12 07:16:08.991935')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:16:08.992544', 1, NULL, 'active', 'Test', '2025-12-12 07:16:08.992544')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 07:16:08.992602' WHERE `conversations`.`id` = 1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 8 OR `conversations`.`assigned_expert_id` = 8)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 1, '2025-12-12 07:16:08.992626', FALSE, 1, 'initiator', '2025-12-12 07:16:08.992626')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.993139', 3, NULL, 'waiting', 'New', '2025-12-12 07:16:08.993139')[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 4 AND (created_at >= '2025-12-11 07:16:08') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.992626', `conversations`.`updated_at` = '2025-12-12 07:16:08.993228' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=4&since=2025-12-11T07%3A16%3A08Z" for 127.0.0.1 at 2025-12-12 07:16:08 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 2, '2025-12-12 07:16:08.993881', FALSE, 3, 'initiator', '2025-12-12 07:16:08.993881')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "4", "since" => "2025-12-11T07:16:08Z"}
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.993881', `conversations`.`updated_at` = '2025-12-12 07:16:08.994278' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 07:16:08') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:08.996601', 56, NULL, 'waiting', 'Second', '2025-12-12 07:16:08.996601')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 1, '2025-12-12 07:16:08.997893', FALSE, 1, 'initiator', '2025-12-12 07:16:08.997893')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:08.997893', `conversations`.`updated_at` = '2025-12-12 07:16:08.998695' WHERE `conversations`.`id` = 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 4 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 07:16:08') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 1.6ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
AutoResponderServiceTest: test_skips_when_not_the_first_message_from_initiator
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=1" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.003583', '2025-12-12 07:16:09.003596', '$2a$04$zwdsrLwnivBe89/NK4vbj.clTe8bs4FWJpWN8eOi5yKfGA3JX.7zu', '2025-12-12 07:16:09.003583', 'asker')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
AutoResponderServiceTest: test_skips_when_expert_has_no_FAQ
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.005326', '2025-12-12 07:16:09.005336', '$2a$04$WAA0wv645iWvK5PKVqkogepzqRlSmPiEdvxf443/tZDpsfsxJ0Jqq', '2025-12-12 07:16:09.005326', 'expert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.006101', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:16:09.006101', 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9f852803-e0f4-412e-97c3-9f627865ee18) to Test(default) with arguments: 6
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.006297', '2025-12-12 07:16:09.006311', '$2a$04$xsTp9hPmwe1JknKetZLR3erV2hnyic2wZLBC2jhaDSZXec1Y0qp3m', '2025-12-12 07:16:09.006297', 'asker')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (11, '2025-12-12 07:16:09.006792', 10, NULL, 'active', 'Need help', '2025-12-12 07:16:09.006792')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.007393', 56, NULL, 'waiting', 'Third', '2025-12-12 07:16:09.007393')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First question', 5, '2025-12-12 07:16:09.007773', FALSE, 10, 'initiator', '2025-12-12 07:16:09.007773')[0m
Started GET "/api/expert-queue/updates?expertId=57" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.008020', '2025-12-12 07:16:09.008032', '$2a$04$6dVh/hrGEzN84Da95weieOWY5wCac2r1d22l.cT7epEYlyfNd2cqG', '2025-12-12 07:16:09.008020', 'expert')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "57"}
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.007773', `conversations`.`updated_at` = '2025-12-12 07:16:09.008227' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 57 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 57 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second question', 5, '2025-12-12 07:16:09.008793', FALSE, 10, 'initiator', '2025-12-12 07:16:09.008793')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.009010', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:16:09.009010', 6)[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.008793', `conversations`.`updated_at` = '2025-12-12 07:16:09.009167' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7dcc698c-02bd-486f-a0c8-07b629eac10f) to Test(default) with arguments: 3
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 56 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 25 AND `messages`.`sender_id` != 57 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 07:16:09.009738', 5, NULL, 'active', 'Need help', '2025-12-12 07:16:09.009738')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 56 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 5 ORDER BY `messages`.`created_at` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 26 AND `messages`.`sender_id` != 57 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 56 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 1, '2025-12-12 07:16:09.010261', FALSE, 2, 'expert', '2025-12-12 07:16:09.010261')[0m
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 27 AND `messages`.`sender_id` != 57 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.010261', `conversations`.`updated_at` = '2025-12-12 07:16:09.010727' WHERE `conversations`.`id` = 1[0m
  [1m[36mConversation Delete All (0.2ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 57 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = NULL, `expert_profiles`.`updated_at` = '2025-12-12 07:16:09.011268' WHERE `expert_profiles`.`id` = 3[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 3, '2025-12-12 07:16:09.013591', FALSE, 5, 'initiator', '2025-12-12 07:16:09.013591')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.013591', `conversations`.`updated_at` = '2025-12-12 07:16:09.014067' WHERE `conversations`.`id` = 3[0m
Processing by UpdatesController#messages_updates as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Parameters: {"userId" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
AutoResponderServiceTest: test_responds_to_first_initiator_message_when_FAQ_is_present
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'asker' LIMIT 1[0m
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.015969', '2025-12-12 07:16:09.015985', '$2a$04$6QBKXB5Zvgs9NckItprwjevDgDkQxbjQKwvAFal3cYE8tCsdiADkO', '2025-12-12 07:16:09.015969', 'asker')[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.016854', '2025-12-12 07:16:09.016874', '$2a$04$eTeZe2g2dKx0/SIugSx1hO4VYy5Pl8DS/.9OG0lFX7qhMZqVCvP/i', '2025-12-12 07:16:09.016854', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 58 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.017785', '2025-12-12 07:16:09.017797', '$2a$04$Za2OIgWKEXbC1vtSNpxmyO94LIdQPwjVel2ldt5NHR5uZvAZuqa3K', '2025-12-12 07:16:09.017785', 'expert')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.017895', NULL, NULL, NULL, '2025-12-12 07:16:09.017895', 58)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c0b56978-1956-4926-9a70-8f43156da30b) to Test(default) with arguments: 24
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 58 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.018612', 'Q: How?\nA: Like this.', NULL, NULL, '2025-12-12 07:16:09.018612', 13)[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 1 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7bc13a41-60dc-491b-b0e3-465d91244cfd) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.0ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.1ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 07:16:09.019251', 12, NULL, 'active', 'Need help', '2025-12-12 07:16:09.019251')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('How do I do this?', 6, '2025-12-12 07:16:09.019946', FALSE, 12, 'initiator', '2025-12-12 07:16:09.019946')[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.019946', `conversations`.`updated_at` = '2025-12-12 07:16:09.020298' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 ORDER BY `messages`.`created_at` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (4.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('A: Use the FAQ guidance.', 6, '2025-12-12 07:16:09.021329', FALSE, 13, 'expert', '2025-12-12 07:16:09.021329')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 1, '2025-12-12 07:16:09.021430', FALSE, 1, 'initiator', '2025-12-12 07:16:09.021430')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.021329', `conversations`.`updated_at` = '2025-12-12 07:16:09.021752' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.021430', `conversations`.`updated_at` = '2025-12-12 07:16:09.021871' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 ORDER BY `messages`.`created_at` DESC LIMIT 1[0m
  [1m[36mMessage Delete All (0.1ms)[0m  [1m[31mDELETE FROM `messages`[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Delete All (0.1ms)[0m  [1m[31mDELETE FROM `conversations`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.023360', '2025-12-12 07:16:09.023374', '$2a$04$gUrF7WG0kc5IFTAgSz4usOOI76NBhvakPKIKr..fJdyB9.P9uXUkG', '2025-12-12 07:16:09.023360', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.024795', '2025-12-12 07:16:09.024805', '$2a$04$uiTtEL3yUff9q5U1uO4Yvu2e8BBk59/bL4gB3N.CUri8FT7mPkG46', '2025-12-12 07:16:09.024795', 'testuser4')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
Processing by AuthController#login as HTML
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTruncate Tables (1525.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.026642', '2025-12-12 07:16:09.026656', '$2a$04$wVs1yLphjlLZCWSw5jqVvuAYDXWinerGERIEPeYI/lftHWHNLir9G', '2025-12-12 07:16:09.026642', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:09.026886', `users`.`updated_at` = '2025-12-12 07:16:09.027087' WHERE `users`.`id` = 59[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.027887', '2025-12-12 07:16:09.027906', '$2a$04$bAoyXQ4iVIa2kAs2uI8koOr86ONiazVXZjjA9Yp7KRzbT7dTEJTPu', '2025-12-12 07:16:09.027887', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 59 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:09.030775', `users`.`updated_at` = '2025-12-12 07:16:09.031561' WHERE `users`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.3ms (3 queries, 0 cached) | GC: 0.0ms)
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
Started GET "/api/messages/updates?userId=1" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:09.033152', `users`.`updated_at` = '2025-12-12 07:16:09.033971' WHERE `users`.`id` = 4[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.0ms | ActiveRecord: 2.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#me as HTML
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.038097', '2025-12-12 07:16:09.038108', '$2a$04$2v4Bk1fZqp1BVv6PY.kPreu1GfxlzhtC8yFuxHw2034AwBmVy1zjy', '2025-12-12 07:16:09.038097', 'test')[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by AuthController#me as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.038812', '2025-12-12 07:16:09.038823', '$2a$04$Mct60xf6Vu29Xns2cunclOiik/gaP5LTQ42OW0IbVuyAkmrrtjJ9C', '2025-12-12 07:16:09.038812', 'newexpert')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.039840', NULL, NULL, NULL, '2025-12-12 07:16:09.039840', 15)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 28ffd475-5e14-4084-be06-bd9e610356f0) to Test(default) with arguments: 8
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Processing by AuthController#logout as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#me as HTML
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[31mROLLBACK[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
--------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Completed 201 Created in 9ms (Views: 0.1ms | ActiveRecord: 4.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.046399', '2025-12-12 07:16:09.046410', '$2a$04$/hNCbPN0RAZ/LO8o53p5Z.9PJlDMHgvfw/YRVr0wA06aaY51uenz.', '2025-12-12 07:16:09.046399', 'testlogout')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.046427', '2025-12-12 07:16:09.046440', '$2a$04$szZ4jVlFryjTAZbnMlL9euLUAOJsD6f46/uQnXta.JVYaZ42w6jSi', '2025-12-12 07:16:09.046427', 'testuser3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
Processing by AuthController#refresh as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:09.048747', `users`.`updated_at` = '2025-12-12 07:16:09.048967' WHERE `users`.`id` = 61[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 1 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
Processing by AuthController#logout as HTML
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (1, 2)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.051145', '2025-12-12 07:16:09.051159', '$2a$04$C9Sh4lAodl5Ujyqh8PJKGOHxBB7GTVJMN.C0qXZkTsOAUGLCKVFCq', '2025-12-12 07:16:09.051145', 'testuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 61 LIMIT 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.052354', '2025-12-12 07:16:09.052365', '$2a$04$q1dwFTmqONg4E7/Z9bV9X.x0Wfx1IzxoQgeydYNeDqBo4j9OYMUIq', '2025-12-12 07:16:09.052354', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.8ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.053338', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.053338', 9)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 95e56cb3-524b-4cc9-9092-e13655590530) to Test(default) with arguments: 4
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 07:16:09.053369', `users`.`updated_at` = '2025-12-12 07:16:09.053529' WHERE `users`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91] Performing GenerateExpertFaqJob (Job ID: 8016aab6-ea2c-4661-8ed8-2d1b39581b91) from Test(default) enqueued at 2025-12-12T07:16:09.054264208Z with arguments: 4
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 4 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91]   [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 07:16:09.055485' WHERE `expert_profiles`.`id` = 4[0m
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91]   [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [8016aab6-ea2c-4661-8ed8-2d1b39581b91] Performed GenerateExpertFaqJob (Job ID: 8016aab6-ea2c-4661-8ed8-2d1b39581b91) from Test(default) in 1.14ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8016aab6-ea2c-4661-8ed8-2d1b39581b91) to Test(default) with arguments: 4
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.061734', '2025-12-12 07:16:09.061745', '$2a$04$D3OyEXKBlAXaXNrH/8uVye.m0rkDQNuHVhrTa1HP0jcWE7Br4pPG6', '2025-12-12 07:16:09.061734', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.061891', '2025-12-12 07:16:09.061912', '$2a$04$u54NdNLtdBPbg/bmRE8IJ.ZASYXPIQOrAVsqojp.xPYbINK.Qwr.O', '2025-12-12 07:16:09.061891', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 62 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.062432', '2025-12-12 07:16:09.062450', '$2a$04$f.BIbNDwHaac0CcUzmID6ORaObLz5H2T55Zvt8yCQkbjnA2TNpe8a', '2025-12-12 07:16:09.062432', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.062559', '2025-12-12 07:16:09.062571', '$2a$04$GyPWMyTlkJv8jy0jRmAbFOc8XwMq9PrFkISs9F2sG.QvRa61Kpav2', '2025-12-12 07:16:09.062559', 'testuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 07:16:09.062590', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.062590', 62)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8640a629-d2d4-4f7f-9feb-c8cc32cf16c7) to Test(default) with arguments: 25
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29] Performing GenerateExpertFaqJob (Job ID: 31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29) from Test(default) enqueued at 2025-12-12T07:16:09.063389907Z with arguments: "non-existent-id"
[ActiveJob] [GenerateExpertFaqJob] [31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29] Performed GenerateExpertFaqJob (Job ID: 31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29) from Test(default) in 0.31ms
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.063524', '2025-12-12 07:16:09.063534', '$2a$04$Fm9MAaFbp2Qu.RG702zzTeP9bvqQR7hzFm2NQNj3YTB.7oLA6UTzq', '2025-12-12 07:16:09.063524', 'expertuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 31b4d8b4-385f-4287-a9ec-8f3b5b6a6a29) to Test(default) with arguments: "non-existent-id"
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.064157', '2025-12-12 07:16:09.064169', '$2a$04$o3RTFPOfgltHH/HoqXU4IOZJGTuhdx2iGz5IonX/C3kI7cJVcJNce', '2025-12-12 07:16:09.064157', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.064090', '2025-12-12 07:16:09.064103', '$2a$04$FJpSIXBWsgRkbyqloIZnRuN/McD32Eybzo5X/3Ub3E3Nx6z96pKx.', '2025-12-12 07:16:09.064090', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.064434', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.064434', 17)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9e0ea7bc-c9dc-4bff-a7fd-2004ed8d5c2f) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.065143', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.065143', 4)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.065143', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.065143', 11)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ba89287b-27e3-467f-89e1-c6cf78dde1be) to Test(default) with arguments: 5
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f8f6326f-9293-4669-ad64-d75ec4d00b21) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.066171', '2025-12-12 07:16:09.066181', '$2a$04$PL3RreJJKNe2rZWlV8b2H.upHyZoKYkNHsVvZMjcgr0oJCo7X4p5W', '2025-12-12 07:16:09.066171', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.067018', '2025-12-12 07:16:09.067031', '$2a$04$0ySqihuLIn4ZWxz1hCUVq.xirMw3vY9pnrA9gCPuZI7JEdjfuKpVe', '2025-12-12 07:16:09.067018', 'nonexpert')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.067039', 16, NULL, 'waiting', 'Test', '2025-12-12 07:16:09.067039')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/7/claim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "7"}
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
Processing by ExpertController#queue as HTML
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.070241', '2025-12-12 07:16:09.070252', '$2a$04$p4UtJX88g5eoyT7veWUjKe2KURFUuMfOG7svkL0i7yFO/AGkbmQRq', '2025-12-12 07:16:09.070241', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.071710', '2025-12-12 07:16:09.071719', '$2a$04$wNMiYKrKdSggx0fVHG3X7eU5mFvRlrL7IJMhH6CtwT4WDi0BdtMSG', '2025-12-12 07:16:09.071710', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.071852', '2025-12-12 07:16:09.071865', '$2a$04$AZL0I5xe1urLUfufhRvPMOTlT2N7b6rFGMnUKAHYTUV2iyb72Njv.', '2025-12-12 07:16:09.071852', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 64 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.072567', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.072567', 64)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: caf0ea31-6727-4d0c-bcc9-50a6390b108f) to Test(default) with arguments: 26
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (64, '2025-12-12 07:16:09.073254', 63, NULL, 'active', 'First', '2025-12-12 07:16:09.073254')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.073395', '2025-12-12 07:16:09.073405', '$2a$04$iGs.JOkUGTKQw6.CiSUu0eUvZ5JgQMXyXwIWz6NOIT1c6NPwGqtE6', '2025-12-12 07:16:09.073395', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.074349', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.074349', 13)[0m
  [1m[36mTRANSACTION (5.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 42a7f653-a6e0-4fba-8f5a-c8fce232502d) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.076046', '2025-12-12 07:16:09.076059', '$2a$04$/F0T3FMO4P97ZN8hFlbQ6eRF4DHSzMFfBT6fy6wL9Uv5CNYkDtKom', '2025-12-12 07:16:09.076046', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.076771', '2025-12-12 07:16:09.076782', '$2a$04$yo8e7EVTPcSSdEM4kKPtm.APFGMLqppW7vz.o5JpZJgPqv16qSdU2', '2025-12-12 07:16:09.076771', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.076875', '2025-12-12 07:16:09.076887', '$2a$04$F3k8D6sz9/zSt4Lj0vCwc.jSszIBjMcy0.jX.CVbc3SOA9RheEgn6', '2025-12-12 07:16:09.076875', 'testuser')[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.078335', '2025-12-12 07:16:09.078344', '$2a$04$wiA0OZLXL4Shhsloy1njcOk6to2Vxe0Y7VH5vUY09BU96cbK9EjRG', '2025-12-12 07:16:09.078335', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.078616', '2025-12-12 07:16:09.078629', '$2a$04$1vcaGT2R6SETVNi4/u0meesdyhYjep9DAsl.iqPlC11WbJl8G5tZC', '2025-12-12 07:16:09.078616', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.079175', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.079175', 20)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fdf0c851-6763-45b9-9a85-08e276121086) to Test(default) with arguments: 10
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.079561', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.079561', 7)[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e490f1b1-b04f-4e32-8735-6ab3a4833948) to Test(default) with arguments: 3
Processing by ExpertController#profile as HTML
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.083910', '2025-12-12 07:16:09.083926', '$2a$04$aoX93v6OHMwYMnKwJzxHVeMYpdbAXxpjM77yRBuE6ab4a1O9cdtvO', '2025-12-12 07:16:09.083910', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (64, '2025-12-12 07:16:09.084067', 63, NULL, 'active', 'Second', '2025-12-12 07:16:09.084067')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.085386', '2025-12-12 07:16:09.085397', '$2a$04$07.fqsbelEKlR57fjzKeBeDERONuNahhyQI9ozaMUUgXE1gJymTl2', '2025-12-12 07:16:09.085386', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.085499', '2025-12-12 07:16:09.085508', '$2a$04$hOXA7v3pXTXyP28wA4JmiORKBEoWKgbS6ZVRyCcH3w4vaeSZq7zoi', '2025-12-12 07:16:09.085499', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.085627', '2025-12-12 07:16:09.085637', '$2a$04$n3GlNRFaiQZOvvF6Rbt0a.Zf16Lqjyi9hoBIGb5vjqrPJ5Tqfg32y', '2025-12-12 07:16:09.085627', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.086505', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.086505', 16)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: db5189e4-44cb-4207-9671-11fd39f2a8ff) to Test(default) with arguments: 7
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.086961', '2025-12-12 07:16:09.086970', '$2a$04$4OXirf77j9otQaMutCxDZ.MQZFIDf/kbfSomcdyZfrICo8TW5hF8a', '2025-12-12 07:16:09.086961', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.086979', '2025-12-12 07:16:09.086992', '$2a$04$JlhyOdKha4Dort/.Bac7rukpSlqjA6W1gv9GoCFSc022x7M5B4j22', '2025-12-12 07:16:09.086979', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.087293', 15, NULL, 'waiting', 'Test', '2025-12-12 07:16:09.087293')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
Started POST "/expert/conversations/4/claim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.087794', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.087794', 22)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "4"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.087951', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.087951', 9)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1e0c459e-4c4a-4cf4-9858-2b0dee3980ef) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 34a4b594-26d5-4b06-9af2-294c1f7c0eae) to Test(default) with arguments: 4
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.089439', '2025-12-12 07:16:09.089449', '$2a$04$J0XU6.Wpg3Q2KLatZqXAJuSR5Qa/Azg59bRehHIuerSx2Vw/VMAli', '2025-12-12 07:16:09.089439', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#update_profile as HTML
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 16, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 07:16:09.089490' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 07:16:09.090193', NULL, NULL, NULL, '2025-12-12 07:16:09.090193', 23)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ddecf98a-2eb7-4e67-bc0e-5a60718d8235) to Test(default) with arguments: 12
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (23, '2025-12-12 07:16:09.090822', 21, NULL, 'active', 'Test', '2025-12-12 07:16:09.090822')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/8/unclaim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by AuthController#refresh as HTML
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "8"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 8 LIMIT 1[0m
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (64, '2025-12-12 07:16:09.094876', 63, NULL, 'active', 'Third', '2025-12-12 07:16:09.094876')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 07:16:09.095477' WHERE `conversations`.`id` = 28[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 07:16:09.095820' WHERE `expert_profiles`.`id` = 4[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 21454915-42bf-49cb-8fc6-2fe3834f8310) to Test(default) with arguments: 4
Completed 200 OK in 6ms (Views: 0.0ms | ActiveRecord: 5.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 4 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 64 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 64 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:16:09.098091', 4, '2025-12-12 07:16:09.098187', 16, NULL, 'active', '2025-12-12 07:16:09.098187')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.0ms | ActiveRecord: 5.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 63 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 28 AND `messages`.`sender_id` != 64 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 63 LIMIT 1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 30 AND `messages`.`sender_id` != 64 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 63 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 29 AND `messages`.`sender_id` != 64 AND `messages`.`is_read` = FALSE[0m
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.101558', '2025-12-12 07:16:09.101568', '$2a$04$9PU83SrMAQXls1rpTgl/du.deECrFXVcs8xkkxfh4Mwlt3nNNZbwe', '2025-12-12 07:16:09.101558', 'testuser')[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.102080', '2025-12-12 07:16:09.102094', '$2a$04$rvofOwYR2Q.nSxyNYYc/F.MAsZwhXmdppajT5ROTMl23Axj4tLqpy', '2025-12-12 07:16:09.102080', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.103131', '2025-12-12 07:16:09.103140', '$2a$04$oO7AdAjUXnqghWnbxV3Sw.IkHwR4uIWnbM8WqT3IFji07eNFs1YQS', '2025-12-12 07:16:09.103131', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.103197', '2025-12-12 07:16:09.103207', '$2a$04$7spib4Wd81dHlrNEvX7JEuVGMprl/wnWdAUFMtrfFvmfg2OmhypHa', '2025-12-12 07:16:09.103197', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.103668', '2025-12-12 07:16:09.103679', '$2a$04$UQU/eFPfa0CqAxv0AaYUvuhvf3rfBK2pesnq49U9TLEg8QeKgKZwC', '2025-12-12 07:16:09.103668', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.103924', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.103924', 25)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e4884aba-c7a9-4b0d-a882-4871434ccd1c) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.103880', '2025-12-12 07:16:09.103937', '$2a$04$vJhOdDDf3gDc1Z9Abeedu.wOVZ179cQt/OhIrjffIwAIJL4dvYq8i', '2025-12-12 07:16:09.103880', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.104509', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.104509', 11)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.104599', '2025-12-12 07:16:09.104608', '$2a$04$0TrVWdLnpdL5soY2xEsCqukMj5BtcCtiPmCkAAlGuc5.XSEdtk82u', '2025-12-12 07:16:09.104599', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2cfd44fb-7a56-41f5-bede-936ffb5e457f) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 07:16:09.104664', 24, NULL, 'active', 'Test', '2025-12-12 07:16:09.104664')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.105423', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.105423', 18)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 605767eb-f311-47df-bd39-fe31413572d4) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
--------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.105876', '2025-12-12 07:16:09.105890', '$2a$04$gnJLMp8lOxCOipsmwkVly.qniS5keYuizZ0SjsLBWn111rqH.wQbC', '2025-12-12 07:16:09.105876', 'expertuser')[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.107499', '2025-12-12 07:16:09.107511', '$2a$04$nG2INHPe6Z/y6TBDMcEhsuG9N4Lx4TKDREK3Anul1AFV5vLD2sWHC', '2025-12-12 07:16:09.107499', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.109064', '2025-12-12 07:16:09.109073', '$2a$04$tB5XPnz6wiavY9slkgD9suCsls9bqSuxAKuNIHM86iobhBq9iWzJy', '2025-12-12 07:16:09.109064', 'expertuser')[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 66 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.109939', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.109939', 66)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:16:09.109823', 9, '2025-12-12 07:16:09.109948', 25, NULL, 'active', '2025-12-12 07:16:09.109948')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: bbb7c81b-6c1f-4675-89df-16d0021e9f3b) to Test(default) with arguments: 27
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/9/unclaim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (66, '2025-12-12 07:16:09.110738', 65, NULL, 'active', 'Test', '2025-12-12 07:16:09.110738')[0m
  Parameters: {"conversation_id" => "9"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started POST "/expert/conversations/31/unclaim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "31"}
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.111446', '2025-12-12 07:16:09.111458', '$2a$04$6IZlTx07rKNH/pLE3RTB7.lIvBCf1sZoLlDNgiZwS4SlE9EOIsPYK', '2025-12-12 07:16:09.111446', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.111541', '2025-12-12 07:16:09.111551', '$2a$04$OZ3XPtdmeurCMow23EyUgOphe5jPJHjJER37MwjodCdxpnEGTtWA.', '2025-12-12 07:16:09.111541', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.111709', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.111709', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 07:16:09.112128' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1eae732f-379b-40a9-8e0e-64d444e2a590) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 9 AND `expert_assignments`.`expert_id` = 25 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.113001', '2025-12-12 07:16:09.113012', '$2a$04$YFmI7gqPE4v12Ty1xuhmxeUogVBL1UX2dAwNcvfDRn5AcEzbZWcuO', '2025-12-12 07:16:09.113001', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.113042', '2025-12-12 07:16:09.113052', '$2a$04$SQI.DyEpuWEeTLLSBbPvIevN2Xz1ALIxKwddFnut2SuFYQbZwWbNe', '2025-12-12 07:16:09.113042', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 07:16:09.113136', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 07:16:09.113268' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.113789', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.113789', 13)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.113836', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.113836', 20)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9206528c-c159-45a6-90cd-d5e99f859288) to Test(default) with arguments: 6
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 31089ad2-da43-446a-9c29-80bcc6aff3eb) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.114514', '2025-12-12 07:16:09.114525', '$2a$04$MuiQz/AZZFGIzdRXsxv3x./FPljm4klesk9XMJ2sGUKEv.B3jYFcm', '2025-12-12 07:16:09.114514', 'nonexpert')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 07:16:09.114484', 12, NULL, 'active', 'Test', '2025-12-12 07:16:09.114484')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.114471', 19, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 07:16:09.114471')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (20, '2025-12-12 07:16:09.115234', 19, NULL, 'active', 'Assigned Conversation', '2025-12-12 07:16:09.115234')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
Processing by ExpertController#queue as HTML
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
Processing by ExpertController#assignment_history as HTML
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 20 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 20 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.118169', '2025-12-12 07:16:09.118182', '$2a$04$1i26BVlzoLL9oegxzTJSOulOhAM/oGhoJhaEvN38CkXO7cZ/H4gdW', '2025-12-12 07:16:09.118169', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 20 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.8ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:16:09.119082', 2, '2025-12-12 07:16:09.119201', 13, NULL, 'active', '2025-12-12 07:16:09.119201')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/2/unclaim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.119688', '2025-12-12 07:16:09.119697', '$2a$04$QS/NhmkDe0NdDKBfu40noOyKwDmoCo/zUhb6u3uIsCLS9mCeMCKtq', '2025-12-12 07:16:09.119688', 'expertuser')[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.120475', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.120475', 68)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 455178d7-4973-4af5-a1e3-3f2e0b17e402) to Test(default) with arguments: 28
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.120768', '2025-12-12 07:16:09.120779', '$2a$04$52wgQo1hdR6Ghkbq7alfye.ASlCIXPmyo7JDuFkj7yrT6v2T49Xn.', '2025-12-12 07:16:09.120768', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.121152', 67, NULL, 'resolved', 'First', '2025-12-12 07:16:09.121152')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 07:16:09.121066' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.121688', 67, NULL, 'resolved', 'Second', '2025-12-12 07:16:09.121688')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 2 AND `expert_assignments`.`expert_id` = 13 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.122291', 67, NULL, 'resolved', 'Third', '2025-12-12 07:16:09.122291')[0m
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 07:16:09.122620', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 07:16:09.122745' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.122762', '2025-12-12 07:16:09.122775', '$2a$04$g6fuL8I1.yfWklA.w/Y7juX.yH4waaEsB5BsOMP/jzpdUESt8qnaS', '2025-12-12 07:16:09.122762', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.123831', '2025-12-12 07:16:09.123841', '$2a$04$Hlvg7mEFOLinVZtYZ8itnuXAQ6YQ1EdrVT2IxQplgKqjgbIq/8TJa', '2025-12-12 07:16:09.123831', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.124268', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.124268', 27)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b43099c5-4414-4186-8c38-bd45be3c7ea9) to Test(default) with arguments: 14
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.125311', '2025-12-12 07:16:09.125320', '$2a$04$cX.ve8AznuCpNStENjGUdOMcdX1mgDQRD6J7Scr4Nut/QpM.ajlJ.', '2025-12-12 07:16:09.125311', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 07:16:09.125477', 26, NULL, 'active', 'Test', '2025-12-12 07:16:09.125477')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.126039', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.126039', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 50567571-1748-4f1b-ab4d-a5de91830684) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 07:16:09.123504', 32, '2025-12-12 07:16:09.127058', 68, NULL, 'resolved', '2025-12-12 07:16:09.127058')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:16:09.126626', 10, '2025-12-12 07:16:09.126725', 27, '2025-12-12 07:16:09.126523', 'resolved', '2025-12-12 07:16:09.126725')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.127717', '2025-12-12 07:16:09.127726', '$2a$04$ovCuO4l4er1cv9Z8Xc6A2uNOCV80OWdLqyArc6mGWSeslRyKFacQe', '2025-12-12 07:16:09.127717', 'nonexpert')[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 07:16:09.127589', 33, '2025-12-12 07:16:09.127735', 68, NULL, 'resolved', '2025-12-12 07:16:09.127735')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.128365', '2025-12-12 07:16:09.128398', '$2a$04$OirYrcNvZC7InyezZZsUp.pFTQNTV2j0r6fZwfAH92FFpyKYAw64W', '2025-12-12 07:16:09.128365', 'testuser')[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 07:16:09.128237', 34, '2025-12-12 07:16:09.128373', 68, NULL, 'resolved', '2025-12-12 07:16:09.128373')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.128644', '2025-12-12 07:16:09.128656', '$2a$04$st65cZjJSIOt7hKwbEg/YOSju3UnqeP9AjucQtRXYndNQ898ZZmGy', '2025-12-12 07:16:09.128644', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 68 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.129968', '2025-12-12 07:16:09.129979', '$2a$04$yKr7g.gh0rEfi0CxsR1v/uc6lq9VWmijexYW1L4qwBe7MwWuZj7P6', '2025-12-12 07:16:09.129968', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.130132', '2025-12-12 07:16:09.130142', '$2a$04$tHD88UrlZrdGeHTmcCj3veJl5KLDp8T.g0gU0ZxXclido7Cwd26Pm', '2025-12-12 07:16:09.130132', 'expertuser')[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 68 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 27 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (34, 33, 32)[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 10[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.130737', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.130737', 22)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.130850', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.130850', 15)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: df53539d-9959-41b1-9ee5-b8d7f8cb9182) to Test(default) with arguments: 10
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9431072b-8fe2-448e-896b-ca022b38c41e) to Test(default) with arguments: 7
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 1.3ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.131518', 21, NULL, 'waiting', 'Test', '2025-12-12 07:16:09.131518')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/7/claim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "7"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.132557', '2025-12-12 07:16:09.132567', '$2a$04$MLPzEAl0aJQIzUfYpUKyaOKAOK6DeWVn8lNAi.2Hi1ByM8qu6imUm', '2025-12-12 07:16:09.132557', 'otherexpert')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 07:16:09.133396', NULL, NULL, NULL, '2025-12-12 07:16:09.133396', 16)[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f0f1305d-db19-491f-af71-5e8684504f3b) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 22, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 07:16:09.133696' WHERE `conversations`.`id` = 7[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (16, '2025-12-12 07:16:09.133997', 14, NULL, 'active', 'Test', '2025-12-12 07:16:09.133997')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/3/claim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 07:16:09.134517', 7, '2025-12-12 07:16:09.134647', 22, NULL, 'active', '2025-12-12 07:16:09.134647')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.135064', '2025-12-12 07:16:09.135079', '$2a$04$rqT3SuTfYL1b5JJLMHoMAuQAE2Kos3NKRlwupilQbwg6cpZ.Fo0sG', '2025-12-12 07:16:09.135064', 'testuser')[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.136572', '2025-12-12 07:16:09.136583', '$2a$04$aWw5wWYgG6lcok7QzIRP9eeEafBxK.Q8gmPfVkP935eeM4vK.n5bW', '2025-12-12 07:16:09.136572', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.136796', '2025-12-12 07:16:09.136806', '$2a$04$dHh.nHyd58x/gJUMyJ/u5.u1bbJA4goSQViPgKIY2U6ktdAB9cOae', '2025-12-12 07:16:09.136796', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.137438', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.137438', 8)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0052a912-b752-4ba2-942d-708ded0cf5af) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.138191', '2025-12-12 07:16:09.138202', '$2a$04$2VdFgrkYPVXl7GU6dIB1C.q30KIP/Ndzh4VBGA7ZbTTn9IROAafty', '2025-12-12 07:16:09.138191', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 70 LIMIT 1[0m
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 07:16:09.138918', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 07:16:09.138918', 70)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 14cdc023-114b-47f3-96a6-cadff1da9c4c) to Test(default) with arguments: 29
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.139655', 69, NULL, 'waiting', 'First', '2025-12-12 07:16:09.139655')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
  [1m[36mTRANSACTION (5.1ms)[0m  [1m[31mROLLBACK[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
------------------------------------------------------------
Processing by HealthController#index as HTML
Started GET "/health" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.5ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.142692', 7, NULL, 'waiting', 'Test', '2025-12-12 07:16:09.142692')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.143292', '2025-12-12 07:16:09.143306', '$2a$04$LT8oUn54Km3OdwQtuymLGeqEuRc72TDTzmFIy84XtX.1wEQ9qZRxC', '2025-12-12 07:16:09.143292', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
Processing by ExpertController#claim as HTML
-------------------------------------------------------------------------------------------------------
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.143889', '2025-12-12 07:16:09.143905', '$2a$04$8W0PpyuONJZ1RQAMkOGYM.qviqtk1YYbuQZkfVYdtTJg8oS0LHUG2', '2025-12-12 07:16:09.143889', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.144934', '2025-12-12 07:16:09.144945', '$2a$04$d.84wnkcCM16VrILcruuvuVbF474R3gAG0VxHsbYbJRS8YkD5Bstm', '2025-12-12 07:16:09.144934', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 07:16:09.145728', 23, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.145728')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.145698', '2025-12-12 07:16:09.145714', '$2a$04$hYE1jYXZ9AWvELUl1ouw0OK9Ec5Xbi53762VMmMitjMqHjBPLzkaS', '2025-12-12 07:16:09.145698', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.145697', '2025-12-12 07:16:09.145716', '$2a$04$rrKgUiw1HkgnZ.JyCQR92.L0xpFVTOhbZbfuWWcJaGwWqMov4FQYm', '2025-12-12 07:16:09.145697', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 07:16:09.146449', 17, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.146449')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.147340', '2025-12-12 07:16:09.147353', '$2a$04$UTlKUml9orVPccJK04Z.V.qftdJ6rgdpZ/Un04fUCJA1I6BCCcACS', '2025-12-12 07:16:09.147340', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
---------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Started GET "/conversations/8/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.147940', '2025-12-12 07:16:09.147950', '$2a$04$Qkf5F5d83D1lr.L0OGGMg.KaOzkfPsZjHMntN4GYWNIkQM/nK75SK', '2025-12-12 07:16:09.147940', 'otheruser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.148487', 19, NULL, 'waiting', 'Other', '2025-12-12 07:16:09.148487')[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "8"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.148291', '2025-12-12 07:16:09.148302', '$2a$04$qiXyRHigfg1LWxmLvK2.ce4tt4AcCDbQMPdKo8X6mwCrE5.robUGa', '2025-12-12 07:16:09.148291', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.149027', '2025-12-12 07:16:09.149040', '$2a$04$4RrTqAPqFjcdNLxhNNWFheoYQVdMHIGd2k0q87LqiBnrErxPluq3.', '2025-12-12 07:16:09.149027', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 5, '2025-12-12 07:16:09.149286', FALSE, 19, 'initiator', '2025-12-12 07:16:09.149286')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 25 OR `conversations`.`assigned_expert_id` = 25) AND `conversations`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.149286', `conversations`.`updated_at` = '2025-12-12 07:16:09.149747' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/4/read" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (29, '2025-12-12 07:16:09.150100', 28, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.150100')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.150382', 69, NULL, 'waiting', 'Second', '2025-12-12 07:16:09.150382')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.150612', '2025-12-12 07:16:09.150621', '$2a$04$HX4KsI7TMRynVCAjoOEwm.wFjVCvhhCIPpLVyxcjRKOnKIW7AD2AC', '2025-12-12 07:16:09.150612', 'expertuser')[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "4"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 07:16:09.151195', 9, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.151195')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 11, '2025-12-12 07:16:09.151294', FALSE, 28, 'initiator', '2025-12-12 07:16:09.151294')[0m
Started GET "/conversations/2/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.151294', `conversations`.`updated_at` = '2025-12-12 07:16:09.151676' WHERE `conversations`.`id` = 11[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '17' OR conversations.assigned_expert_id = '17') AND `messages`.`id` = 4 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Filter chain halted as :set_message rendered or redirected
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Completed 404 Not Found in 2ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.154491', '2025-12-12 07:16:09.154501', '$2a$04$TAqL1LogMBA32ieYMtrOK.I5qBurfisRflb0u6bb3jQSdZ7GoZTUC', '2025-12-12 07:16:09.154491', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.156036', '2025-12-12 07:16:09.156047', '$2a$04$bBAI58c0LJNeo.nysG6K5.fyn2FeQ49WOCjtHe5LPnFGxjHhKn1Cm', '2025-12-12 07:16:09.156036', 'expertuser')[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 07:16:09.156727', 26, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.156727')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.157559', '2025-12-12 07:16:09.157569', '$2a$04$R33NR8QNsrHFDBNA9KCcTuZTy5dBHDg8vVTj5WSTuu..nal8nw9PG', '2025-12-12 07:16:09.157559', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.157607', '2025-12-12 07:16:09.157619', '$2a$04$5QdtxjzXVQcXS7DuZrrq5eIS0gK90kL8VcV/wfzEVRYL17DOtKAuq', '2025-12-12 07:16:09.157607', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 9, '2025-12-12 07:16:09.157557', FALSE, 26, 'initiator', '2025-12-12 07:16:09.157557')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.157557', `conversations`.`updated_at` = '2025-12-12 07:16:09.158061' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/2/read" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "2"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.158996', '2025-12-12 07:16:09.159006', '$2a$04$oT4Z2RRcp4q1o0iUCwt40u3rEAaizOwbB2IfYdA.dyQn4RjtUCK5e', '2025-12-12 07:16:09.158996', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.159174', '2025-12-12 07:16:09.159184', '$2a$04$nW9ggxamVjACMT9gTRDfjOdgPL2/cLP4e0Lml2lYNTx/ozzTKEfxa', '2025-12-12 07:16:09.159174', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 07:16:09.159547', 20, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.159547')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 07:16:09.159726', 11, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.159726')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "3", "content" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 07:16:09.161151', 69, NULL, 'waiting', 'Third', '2025-12-12 07:16:09.161151')[0m
  [1m[36mTruncate Tables (1659.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 70 LIMIT 1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 70 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.163207', '2025-12-12 07:16:09.163221', '$2a$04$qj3h39vjKtabFa00Jkp.D.LhPr.myESniDHpAGtc8s1tjZQewTs72', '2025-12-12 07:16:09.163207', 'testuser')[0m
----------------------------------------------------------------------
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 69 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 11, '2025-12-12 07:16:09.162704', FALSE, 29, 'expert', '2025-12-12 07:16:09.162704')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 35 AND `messages`.`sender_id` != 70 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 69 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.162704', `conversations`.`updated_at` = '2025-12-12 07:16:09.163817' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 36 AND `messages`.`sender_id` != 70 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.164703', '2025-12-12 07:16:09.164716', '$2a$04$CBubOWNbMp.f0iMKogMwYuEUBPtKW5msBVJb7mjClarTbE3OPlUNm', '2025-12-12 07:16:09.164703', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 69 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.164871', '2025-12-12 07:16:09.164883', '$2a$04$rF7dfj9nHv81F43OH14zCOgWZDnA4dBNNqAh1BOeWKQiuBgY42p1m', '2025-12-12 07:16:09.164871', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.165025', '2025-12-12 07:16:09.165038', '$2a$04$X7ioE8huMTmn07tEaAAvHOocrz4jDg1FCmJeDYYNM2MWkOcBBzPLu', '2025-12-12 07:16:09.165025', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 37 AND `messages`.`sender_id` != 70 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 70 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.9ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (29, '2025-12-12 07:16:09.165704', 28, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.165704')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.166290', '2025-12-12 07:16:09.166302', '$2a$04$X6QrRR0wRef5kG7NtBeArOjkp9VBsE/byrNBeeYySIb8AjU17PVc6', '2025-12-12 07:16:09.166290', 'expertuser')[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "10", "content" => "Test message"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.166641', '2025-12-12 07:16:09.166653', '$2a$04$dbMu5.voLIYBPq5oREptwuydEticYfmG/CmRA/A3WWkVIoZrZFCh.', '2025-12-12 07:16:09.166641', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 10 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (14, '2025-12-12 07:16:09.167020', 13, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.167020')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (23, '2025-12-12 07:16:09.167279', 22, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.167279')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 10, '2025-12-12 07:16:09.167714', FALSE, 28, 'initiator', '2025-12-12 07:16:09.167714')[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1667.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.167714', `conversations`.`updated_at` = '2025-12-12 07:16:09.168179' WHERE `conversations`.`id` = 10[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: ed2bcf07-61f2-4e23-b063-e4ef9081e297) to Test(default) with arguments: 3
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.170203', '2025-12-12 07:16:09.170214', '$2a$04$tnVIMEFbvHB2t0g8XYsjiO0cy9DcklsNlh0HwMCjCSDDY65LohD62', '2025-12-12 07:16:09.170203', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.171672', '2025-12-12 07:16:09.171682', '$2a$04$zuerUEBlcwzU6YCg2uF1iO8BuO8lTDoQ7qQOYq4qXbeIqJjSnadfu', '2025-12-12 07:16:09.171672', 'expertuser')[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 07:16:09.171601', FALSE, 13, 'initiator', '2025-12-12 07:16:09.171601')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.171601', `conversations`.`updated_at` = '2025-12-12 07:16:09.172195' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (72, '2025-12-12 07:16:09.172377', 71, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.172377')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/4/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "4"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.173194', '2025-12-12 07:16:09.173204', '$2a$04$9ta0LaROw4Vf97OBlk9I/uTz7W.rU5lKK2MIlnJ5aOyHD54ui13Ie', '2025-12-12 07:16:09.173194', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "38", "content" => "New message"}
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) AND `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 38 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.174670', '2025-12-12 07:16:09.174679', '$2a$04$DlDPZMTjfnVAy7WxDNjmdeNOnl..mj.FMZDbS5lqnebYCwgQxuEzK', '2025-12-12 07:16:09.174670', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 11, '2025-12-12 07:16:09.174926', FALSE, 28, 'initiator', '2025-12-12 07:16:09.174926')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.1ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (31, '2025-12-12 07:16:09.175251', 30, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.175251')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.174926', `conversations`.`updated_at` = '2025-12-12 07:16:09.175383' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 11, '2025-12-12 07:16:09.175912', FALSE, 30, 'initiator', '2025-12-12 07:16:09.175912')[0m
Started GET "/conversations/11/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.175912', `conversations`.`updated_at` = '2025-12-12 07:16:09.176430' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/4/read" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "4"}
  [1m[36mTruncate Tables (1642.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 4 ORDER BY `messages`.`created_at` ASC[0m
---------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "7", "content" => "New message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "11"}
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '31' OR conversations.assigned_expert_id = '31') AND `messages`.`id` = 4 LIMIT 1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 07:16:09.179294' WHERE `messages`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 7, '2025-12-12 07:16:09.179773', FALSE, 22, 'initiator', '2025-12-12 07:16:09.179773')[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 4 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.179773', `conversations`.`updated_at` = '2025-12-12 07:16:09.180247' WHERE `conversations`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: dd589e66-2ebb-4ca6-8473-f214c332fe8b) to Test(default) with arguments: 5
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 28 OR `conversations`.`assigned_expert_id` = 28) AND `conversations`.`id` = 11 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 11 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (28, 29)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1683.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 3.2ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.184953', '2025-12-12 07:16:09.184972', '$2a$04$SN.DHAjOO0szQYZTC1p9n.r2sHI9e1nFbn1ecfW4mMahHnonoNsFe', '2025-12-12 07:16:09.184953', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.186691', '2025-12-12 07:16:09.186702', '$2a$04$H97ydRRFFkfsIVjOXGN.buZevSlsenHie.2sLQPyf8Pt1YlRkgOJi', '2025-12-12 07:16:09.186691', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 38, '2025-12-12 07:16:09.174754', FALSE, 71, 'initiator', '2025-12-12 07:16:09.174754')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (16, '2025-12-12 07:16:09.187571', 15, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.187571')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_includes_senderUsername
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.174754', `conversations`.`updated_at` = '2025-12-12 07:16:09.187938' WHERE `conversations`.`id` = 38[0m
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 4a152e59-935d-4fe8-b412-9a044532055c) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 201 Created in 15ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 12.4ms)
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 07:16:09.188389', FALSE, 15, 'initiator', '2025-12-12 07:16:09.188389')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.188389', `conversations`.`updated_at` = '2025-12-12 07:16:09.188882' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/2/read" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '15' OR conversations.assigned_expert_id = '15') AND `messages`.`id` = 2 LIMIT 1[0m
Completed 403 Forbidden in 2ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1658.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTruncate Tables (1705.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1709.1ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.215435', '2025-12-12 07:16:09.215499', '$2a$04$BrInQJyvOixiRAw9YSYKZemFEZZzbgCHtDUvrdTARhrGaHsXjy4j.', '2025-12-12 07:16:09.215435', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.218235', '2025-12-12 07:16:09.218246', '$2a$04$Znuay3reZ1uOSCXkwvp5KuH1Oq0QpBjvPP0VKuHzW.BcZebun6.BG', '2025-12-12 07:16:09.218235', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (5.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.226560', '2025-12-12 07:16:09.226633', '$2a$04$0iHgCgNbWRuKvpVoUOM/ZenkSdX8dPCLq88ZZmZpuXQ7MohLgd4cS', '2025-12-12 07:16:09.226560', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1694.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.229658', '2025-12-12 07:16:09.229669', '$2a$04$zip5Z0Hh8QqbkEgaeKFI1eDS8YzDa6QfwoH9DPvhVgKa3qVKIFTBi', '2025-12-12 07:16:09.229658', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.229872', '2025-12-12 07:16:09.229952', '$2a$04$Le/PDRW3WFzDoPotGr0FDONMA3wmT3Xommz2.Umc8uU0aewXBkXM.', '2025-12-12 07:16:09.229872', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:16:09.232221', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.232221')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.233087', '2025-12-12 07:16:09.233100', '$2a$04$cTlH/SqUJuKygVWVsSSbeO0dtTpBkH/i7l9.Yc3f2guLvEoGH8I/G', '2025-12-12 07:16:09.233087', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.234398', '2025-12-12 07:16:09.234456', '$2a$04$uZxLsfWwpY5kaWFlou2rSO4nFFiLzyyDocZuuyDm/XLlwTetl70x6', '2025-12-12 07:16:09.234398', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.237581', '2025-12-12 07:16:09.237591', '$2a$04$v7S5dfMG/LvpfYTtcxyxT.DlXCsSoT7nliPlnZJ38ZHviiXyG0UoK', '2025-12-12 07:16:09.237581', 'expertuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:16:09.237456', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.237456')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1703.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 07:16:09.238108', TRUE, 1, 'initiator', '2025-12-12 07:16:09.238108')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.238108', `conversations`.`updated_at` = '2025-12-12 07:16:09.238794' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:16:09.241737', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.241737')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 07:16:09.245469', 1, NULL, 'active', 'Test Conversation', '2025-12-12 07:16:09.245469')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 07:16:09.247149', '2025-12-12 07:16:09.247159', '$2a$04$k8O3/1jQURhQ0nB35k.8r.kP5rwYriRhLiY6PwfFpFIra6oxp67ES', '2025-12-12 07:16:09.247149', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Started GET "/conversations/1/messages" for 127.0.0.1 at 2025-12-12 07:16:09 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1) AND `conversations`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "Expert reply"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 1 ORDER BY `messages`.`created_at` ASC[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "Test message"}
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "Test"}
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 1, '2025-12-12 07:16:09.269439', FALSE, 2, 'expert', '2025-12-12 07:16:09.269439')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.269439', `conversations`.`updated_at` = '2025-12-12 07:16:09.270229' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 6b6450d9-af6b-4a1b-8c39-41a7226d4b2a) to Test(default) with arguments: 1
Completed 201 Created in 11ms (Views: 0.1ms | ActiveRecord: 1.9ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Completed 403 Forbidden in 5ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 07:16:09.272551', FALSE, 1, 'initiator', '2025-12-12 07:16:09.272551')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 07:16:09.272551', `conversations`.`updated_at` = '2025-12-12 07:16:09.273286' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued AutoRespondToQuestionJob (Job ID: 82aa0618-c20e-4ef0-8187-fa6970d86bb4) to Test(default) with arguments: 1
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 1.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1824.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 07:16:10 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (10.9ms)[0m  [1m[31mROLLBACK[0m
