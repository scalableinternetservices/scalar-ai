  [1m[35m (8.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (31.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (27.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (22.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (31.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (24.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (1.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (21.1ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (50.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (61.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (54.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (106.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (82.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (82.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (55.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (17.9ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (2.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (2.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (17.2ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:34.433185', '2025-12-12 06:39:34.433186')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.6ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:34.437168', '2025-12-12 06:39:34.437169')[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT GET_LOCK('6635911638641068245', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT RELEASE_LOCK('6635911638641068245')[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (12.3ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_1` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (25.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_7` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.8ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_10` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_14` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.9ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_0` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (26.2ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_5` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_13` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (24.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_11` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.2ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_4` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.4ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_3` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (27.8ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_2` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (25.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_8` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (28.5ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_9` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (5.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (5.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (2.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (32.0ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_15` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (32.1ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_12` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (32.9ms)[0m  [1m[35mCREATE DATABASE `help_desk_backend_test_6` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (6.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (3.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (8.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `conversations` CASCADE[0m
  [1m[35m (46.3ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (51.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (62.9ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (53.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (79.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (76.6ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (10.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (93.4ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (103.5ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (110.1ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (9.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (119.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (127.7ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (139.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (94.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (89.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (97.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (90.4ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (133.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (193.9ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (64.6ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (5.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (198.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (75.2ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (14.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (109.9ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (132.5ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (242.6ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (56.7ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (165.1ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (264.8ms)[0m  [1m[35mCREATE TABLE `conversations` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_expert_id` bigint, `created_at` datetime(6) NOT NULL, `initiator_id` bigint NOT NULL, `last_message_at` datetime(6), `status` varchar(255) DEFAULT 'waiting' NOT NULL, `title` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_conversations_on_assigned_expert_id` (`assigned_expert_id`), INDEX `index_conversations_on_initiator_id` (`initiator_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (11.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_assignments` CASCADE[0m
  [1m[35m (99.6ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (101.1ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (10.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (63.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (99.1ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (155.2ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (77.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (12.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (123.6ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (172.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (71.3ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (12.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (93.9ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (130.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (260.0ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (10.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (70.1ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (86.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (271.7ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (117.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (11.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (95.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (91.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (214.4ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (100.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (92.3ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (7.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (76.9ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (115.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (5.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (217.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (82.7ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (9.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (81.4ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (64.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (78.1ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (11.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (151.1ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (107.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (157.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (10.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (98.5ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (66.2ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (65.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.7ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (112.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (112.6ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (333.3ms)[0m  [1m[35mCREATE TABLE `expert_assignments` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `assigned_at` datetime(6) NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `expert_id` bigint NOT NULL, `resolved_at` datetime(6), `status` varchar(255) DEFAULT 'active' NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_expert_assignments_on_conversation_id` (`conversation_id`), INDEX `index_expert_assignments_on_expert_id` (`expert_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (9.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `expert_profiles` CASCADE[0m
  [1m[35m (68.0ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (304.3ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (7.6ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (220.2ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (109.7ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (79.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (89.8ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (9.0ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (56.7ms)[0m  [1m[35mCREATE TABLE `expert_profiles` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `bio` text, `created_at` datetime(6) NOT NULL, `expert_faq` text, `expertise_summary` text, `knowledge_base_links` json, `updated_at` datetime(6) NOT NULL, `user_id` bigint NOT NULL, UNIQUE INDEX `index_expert_profiles_on_user_id` (`user_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `messages` CASCADE[0m
  [1m[35m (189.6ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (7.5ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (206.5ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.3ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (65.8ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (86.4ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (8.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (172.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (144.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (139.7ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (5.1ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (218.0ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (77.0ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (50.0ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (124.5ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (101.0ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (111.6ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.4ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (230.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (57.2ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (216.6ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (337.4ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `content` text NOT NULL, `conversation_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `is_read` boolean DEFAULT FALSE NOT NULL, `sender_id` bigint NOT NULL, `sender_role` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_conversation_id` (`conversation_id`), INDEX `index_messages_on_sender_id` (`sender_id`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (4.8ms)[0m  [1m[35mDROP TABLE IF EXISTS `sessions` CASCADE[0m
  [1m[35m (52.4ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (138.7ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (222.1ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (122.1ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (3.9ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (461.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (387.6ms)[0m  [1m[35mCREATE TABLE `sessions` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `data` text, `session_id` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `index_sessions_on_session_id` (`session_id`), INDEX `index_sessions_on_updated_at` (`updated_at`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (6.2ms)[0m  [1m[35mDROP TABLE IF EXISTS `users` CASCADE[0m
  [1m[35m (267.9ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (328.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (128.8ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (354.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (525.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (352.3ms)[0m  [1m[35mCREATE TABLE `users` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `created_at` datetime(6) NOT NULL, `last_active_at` datetime(6), `password_digest` varchar(255) NOT NULL, `updated_at` datetime(6) NOT NULL, `username` varchar(255) NOT NULL, UNIQUE INDEX `index_users_on_username` (`username`)) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci[0m
  [1m[35m (657.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (690.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (692.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (391.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (580.1ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (736.5ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (784.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (790.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (289.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (583.1ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1060.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (513.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (888.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (617.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (419.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (529.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (671.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (470.0ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (664.9ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (488.4ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (576.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (455.3ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (885.7ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_514ff18f21`
FOREIGN KEY (`assigned_expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (485.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (525.5ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (864.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (756.5ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (694.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (868.4ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1008.6ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (615.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (674.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (613.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (680.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (569.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (360.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (606.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (341.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (816.4ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (765.6ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (730.8ms)[0m  [1m[35mALTER TABLE `conversations` ADD CONSTRAINT `fk_rails_bd11b77488`
FOREIGN KEY (`initiator_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (690.6ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (361.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (500.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (849.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (710.8ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (739.1ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (453.9ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (984.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (674.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (419.5ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (767.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (460.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (894.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (678.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (465.0ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (775.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (532.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (545.8ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1307.7ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_84fd845050`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (585.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (645.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (586.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (972.9ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (499.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (922.9ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (642.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (409.4ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (615.5ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (588.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (496.3ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (608.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (659.5ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (1008.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (375.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (522.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (84.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (6.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (70.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (535.2ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (7.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (6.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (579.2ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (66.9ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:39.623513', '2025-12-12 06:39:39.623515')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:39.628082', '2025-12-12 06:39:39.628083')[0m
  [1m[35m (1133.2ms)[0m  [1m[35mALTER TABLE `expert_assignments` ADD CONSTRAINT `fk_rails_affb9075b9`
FOREIGN KEY (`expert_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (857.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
------------------------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
---------------------------------------------------------------------
  [1m[35m (912.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (4.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.716688', '2025-12-12 06:39:39.716743', '$2a$04$/fdg/rc4UDU30PuwUWiBWOyO4D/5LgismxxWOX0FzZaZCNmGGkXoW', '2025-12-12 06:39:39.716688', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.718862', '2025-12-12 06:39:39.718875', '$2a$04$1L8aQvuw/CoDjE638WKC0.Wi2lQ/gnZTk5b6.RXg9MvH3AgYxRX0S', '2025-12-12 06:39:39.718862', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.728232', NULL, NULL, NULL, '2025-12-12 06:39:39.728232', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b90d59db-476f-43ca-b28f-41bfd237237c) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.734372', 1, NULL, 'waiting', 'Waiting', '2025-12-12 06:39:39.734372')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:39:39.735084', 1, NULL, 'active', 'Assigned', '2025-12-12 06:39:39.735084')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=2" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 1.6ms (9 queries, 0 cached) | GC: 6.5ms)
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.756665', '2025-12-12 06:39:39.756677', '$2a$04$REhRZO5ikhRkTH25msDF.uznlJdFTGWa0l7gchXuvUnqmT7ssAkue', '2025-12-12 06:39:39.756665', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.759059', '2025-12-12 06:39:39.759069', '$2a$04$VJJCzz7G9CMdd0A4Xh/ele/RZG8mdARMpY4uQCbIahAfbwuC5xsqW', '2025-12-12 06:39:39.759059', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.761048', NULL, NULL, NULL, '2025-12-12 06:39:39.761048', 4)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e2c5f7ba-318f-46e2-b2a3-700b70b37474) to Test(default) with arguments: 2
Started GET "/api/messages/updates?userId=3" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "3"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.770119', '2025-12-12 06:39:39.770129', '$2a$04$3W2zJBbkdU2ycwmlnQBxIO97QYP37CwVfpU25FA/fO3JzA7zeL6xO', '2025-12-12 06:39:39.770119', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.772595', '2025-12-12 06:39:39.773191', '$2a$04$x4ZEnav4b//kDg/0/Rp4iOP7fTCmoCnuHE/FE3uFXjpliFmcyMLFa', '2025-12-12 06:39:39.772595', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.774702', NULL, NULL, NULL, '2025-12-12 06:39:39.774702', 6)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 449fe1a2-956c-4264-aef4-8a0f5c077430) to Test(default) with arguments: 3
Started GET "/api/conversations/updates?userId=5" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "5"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.6ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (516.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.782522', '2025-12-12 06:39:39.782532', '$2a$04$LSxTqB7ZHopOkhJYpyNfUuhi9Cdk/07xRKKxPCzwCybM30BJhKe3W', '2025-12-12 06:39:39.782522', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.785355', '2025-12-12 06:39:39.785367', '$2a$04$Jqtz8qPiVDR7mpa24PzGx.A1LQrEOo5cHvLCgHvk1tetjvgKL0BuS', '2025-12-12 06:39:39.785355', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.786853', NULL, NULL, NULL, '2025-12-12 06:39:39.786853', 8)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f4fa0080-b2d5-446f-9155-24a1d2629b60) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.788119', 7, NULL, 'waiting', 'Test', '2025-12-12 06:39:39.788119')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.799167', '2025-12-12 06:39:39.799178', '$2a$04$JX5W0UyjP0doZLKL4YuaQO7wwIvh7FBgbxp038XI1yrlTuHF458k6', '2025-12-12 06:39:39.799167', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.801107', '2025-12-12 06:39:39.801118', '$2a$04$FyKIkzdPPRyzl/3ytB3s/Ov39zLn.HkkYeWwzz2yEdNFM0ghBk.Xy', '2025-12-12 06:39:39.801107', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.803320', NULL, NULL, NULL, '2025-12-12 06:39:39.803320', 10)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 96b04642-5365-426d-90d8-4c79a9c1248c) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:39.805514', 9, NULL, 'active', 'Active', '2025-12-12 06:39:39.805514')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:39.807487', 9, NULL, 'resolved', 'Resolved', '2025-12-12 06:39:39.807487')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=10" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mMessage Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 1.5ms (7 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.818188', '2025-12-12 06:39:39.818201', '$2a$04$3nIyzjGQnBzfxTq0d4.wbOLZA5YxlYrYyKTf3NMWjsBgVzvowSioe', '2025-12-12 06:39:39.818188', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.819842', '2025-12-12 06:39:39.819851', '$2a$04$K9hCs6rLQA2loHpXpwPh3u9EhuGY5XRvt9UZyGGTAgwZHYB9UEQjS', '2025-12-12 06:39:39.819842', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.820567', NULL, NULL, NULL, '2025-12-12 06:39:39.820567', 12)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d619f609-646a-40ec-9070-5ea73dfa3b97) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.821169', 11, NULL, 'waiting', 'Old', '2025-12-12 06:39:39.821169')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:39:39.821612' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.823433', 11, NULL, 'waiting', 'New', '2025-12-12 06:39:39.823433')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=12&since=2025-12-11T06%3A39%3A39Z" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "12", "since" => "2025-12-11T06:39:39Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 12 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 12 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.829734', '2025-12-12 06:39:39.829744', '$2a$04$NOPfeP6sD35r7HPhWoS4oOWEYrMmaWlpYF6F/J7.ynpDSUN3Zk0PS', '2025-12-12 06:39:39.829734', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.832731', '2025-12-12 06:39:39.832741', '$2a$04$3IghW62o6RinbQ7gdtu2aesqO28hOhqlqHTve9YfpeMd1G3ZVrYom', '2025-12-12 06:39:39.832731', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.833586', NULL, NULL, NULL, '2025-12-12 06:39:39.833586', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fb0d855a-e8ac-4f39-8204-7382dac3a018) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.834377', 13, NULL, 'waiting', 'As Initiator', '2025-12-12 06:39:39.834377')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=13" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "13"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mConversation Load (2.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 13 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 2.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.843838', '2025-12-12 06:39:39.843848', '$2a$04$JIs/SdnhWZbGjhQlU4RFy.qNeSFMfzzaxx6q0Y/gotCrHO02CPHnK', '2025-12-12 06:39:39.843838', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.845593', '2025-12-12 06:39:39.845605', '$2a$04$KJ.xf8VtkV/GvKVeDDROH.LzvOlOENOkmmktwhQtUgnqOM4Jk33em', '2025-12-12 06:39:39.845593', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.846427', NULL, NULL, NULL, '2025-12-12 06:39:39.846427', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 717a89b8-3fb7-40f5-b7d2-30fa1a0230d7) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.847068', 15, NULL, 'waiting', 'First', '2025-12-12 06:39:39.847068')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.857687', 15, NULL, 'waiting', 'Second', '2025-12-12 06:39:39.857687')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (564.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.868338', 15, NULL, 'waiting', 'Third', '2025-12-12 06:39:39.868338')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=15" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "15"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mConversation Load (2.5ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 15 OR `conversations`.`assigned_expert_id` = 15) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 11 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 3.0ms (9 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (7.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.883433', '2025-12-12 06:39:39.883445', '$2a$04$PBTkuVMB4pghQPv9RkLI6O1op28pes680rELwyF0mOz3Mqh8KEMZu', '2025-12-12 06:39:39.883433', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.885162', '2025-12-12 06:39:39.885172', '$2a$04$nvjyP.S6eBGiT7eIpotyV.hJ2TPsq22byUDr64.BygKq28deSZfDS', '2025-12-12 06:39:39.885162', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.886290', NULL, NULL, NULL, '2025-12-12 06:39:39.886290', 18)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: f5f16212-317d-45fd-912f-003abd5ddc95) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.886968', 17, NULL, 'waiting', 'User Conv', '2025-12-12 06:39:39.886968')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.888568', '2025-12-12 06:39:39.888580', '$2a$04$eIMaGutoCMbh6xno9k83EOqmbgcQnQbNKsHp5AL1GpJBQCyuu3HvG', '2025-12-12 06:39:39.888568', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.889092', 19, NULL, 'waiting', 'Other Conv', '2025-12-12 06:39:39.889092')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 12, '2025-12-12 06:39:39.891708', FALSE, 17, 'initiator', '2025-12-12 06:39:39.891708')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.891708', `conversations`.`updated_at` = '2025-12-12 06:39:39.892244' WHERE `conversations`.`id` = 12[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 13, '2025-12-12 06:39:39.892951', FALSE, 19, 'initiator', '2025-12-12 06:39:39.892951')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.892951', `conversations`.`updated_at` = '2025-12-12 06:39:39.893569' WHERE `conversations`.`id` = 13[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "17"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mConversation Pluck (0.4ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 12 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 0.7ms (5 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.906446', '2025-12-12 06:39:39.906457', '$2a$04$iLX9sHqwYuIL9Mol8bHGCeazOnposGQjf6T8LyNKADhs83.hAySfK', '2025-12-12 06:39:39.906446', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.908511', '2025-12-12 06:39:39.908520', '$2a$04$Efnb2HDFnPE6EXk/s0k5r.1P0t/zRhPGpA.uSZpTyYEb4BuSWCI9y', '2025-12-12 06:39:39.908511', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.909363', NULL, NULL, NULL, '2025-12-12 06:39:39.909363', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 22a65059-94c6-4904-8ac1-4311d6225586) to Test(default) with arguments: 10
Started GET "/api/expert-queue/updates?expertId=21" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "21"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.914125', '2025-12-12 06:39:39.914140', '$2a$04$zGAn9F2ngGnksgFsuuMz.eLk2OFyoZu9McPhNhGL8zrRdZrmqQOdq', '2025-12-12 06:39:39.914125', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.915973', '2025-12-12 06:39:39.915985', '$2a$04$cQpoE.q.bhLsPJ4S2xrvae.5qxoXsjiEnmDwhNtrVwaF.7GGopKr2', '2025-12-12 06:39:39.915973', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.917863', NULL, NULL, NULL, '2025-12-12 06:39:39.917863', 23)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ef67bfcb-e6db-4bd7-b065-4704294c95f3) to Test(default) with arguments: 11
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 0ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.924000', '2025-12-12 06:39:39.924012', '$2a$04$MqvzjCGTmG/SAFTjpLI2ZuytJ323e6Iap68Sextwt8mu1wjij48oi', '2025-12-12 06:39:39.924000', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.925642', '2025-12-12 06:39:39.925654', '$2a$04$y9RP7IAwVO5Gkzxc1cvcfeLPukVIWd7OFKPyy0coaKsJrwUWdg9.C', '2025-12-12 06:39:39.925642', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.926788', NULL, NULL, NULL, '2025-12-12 06:39:39.926788', 25)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad02bcc0-b2a8-4cbd-b4e6-e6c5020a749e) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.927554', 24, NULL, 'active', 'First', '2025-12-12 06:39:39.927554')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.6ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.938258', 24, NULL, 'active', 'Second', '2025-12-12 06:39:39.938258')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:39:39.949345', 24, NULL, 'active', 'Third', '2025-12-12 06:39:39.949345')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:39:39.949989' WHERE `conversations`.`id` = 14[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=25" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "25"}
  [1m[35m (658.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 25 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 14 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 16 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 15 AND `messages`.`sender_id` != 25 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.8ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.958216', '2025-12-12 06:39:39.958227', '$2a$04$Pm71jOzDm/Z59yUn7e2iD.TzfPJAnPMfQKbNWg78ip.tjkAaptQqm', '2025-12-12 06:39:39.958216', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.959775', '2025-12-12 06:39:39.959786', '$2a$04$9Z.Fxe6YgV4dSp1J1hdZzubkmHxaj7T/RcmAxv3I0Q9.Awim9Y./K', '2025-12-12 06:39:39.959775', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.960572', NULL, NULL, NULL, '2025-12-12 06:39:39.960572', 27)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 69ec1123-ed7d-4f71-9c70-20cf1fe5e16d) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (27, '2025-12-12 06:39:39.961227', 26, NULL, 'active', 'Test', '2025-12-12 06:39:39.961227')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 17, '2025-12-12 06:39:39.961832', FALSE, 27, 'expert', '2025-12-12 06:39:39.961832')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:39.961832', `conversations`.`updated_at` = '2025-12-12 06:39:39.962230' WHERE `conversations`.`id` = 17[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=26" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "26"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 26 LIMIT 1[0m
  [1m[36mConversation Pluck (1.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 26 OR `conversations`.`assigned_expert_id` = 26)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 17 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.5ms (5 queries, 0 cached) | GC: 0.1ms)
  [1m[36mTRANSACTION (7.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.975353', '2025-12-12 06:39:39.975365', '$2a$04$hrUYca/2yzeukLCywpt9Zu4rsStZxOr9Nqbu7K56fSpsOevzSmdcq', '2025-12-12 06:39:39.975353', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.976875', '2025-12-12 06:39:39.976885', '$2a$04$r44ZWXXelYQW9EtCtPZl6OYsv92SiXH.TqJyKoBv8748xNdxXzHa.', '2025-12-12 06:39:39.976875', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 29 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.977686', NULL, NULL, NULL, '2025-12-12 06:39:39.977686', 29)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a3d76343-e1da-4a95-a7a2-4bf93d736791) to Test(default) with arguments: 14
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.978344', 28, NULL, 'waiting', 'Old', '2025-12-12 06:39:39.978344')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:39:39.978838' WHERE `conversations`.`id` = 18[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:39.979232', 28, NULL, 'waiting', 'New', '2025-12-12 06:39:39.979232')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=28&since=2025-12-11T06%3A39%3A39Z" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "28", "since" => "2025-12-11T06:39:39Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 28 OR `conversations`.`assigned_expert_id` = 28) AND (updated_at >= '2025-12-11 06:39:39') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 19 AND `messages`.`sender_id` != 28 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (407.0ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
------------------------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.986557', '2025-12-12 06:39:39.986568', '$2a$04$yZUgYopi7WMJkKhkUrOS8.3RxWB5.oJ7qQVQm49qa9iF3n1TNJ9Mi', '2025-12-12 06:39:39.986557', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.988084', '2025-12-12 06:39:39.988094', '$2a$04$RAleZ4HckgJ.YjF1H04GTuczE35Tik/nFwrqYH1j/j9svFAjKMcrK', '2025-12-12 06:39:39.988084', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 31 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.988946', NULL, NULL, NULL, '2025-12-12 06:39:39.988946', 31)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e5f3f4af-885c-4bca-adb6-28c0c382694e) to Test(default) with arguments: 15
Started GET "/api/expert-queue/updates?expertId=31" for 127.0.0.1 at 2025-12-12 06:39:39 +0000
  [1m[36mActiveRecord::InternalMetadata Create (4.5ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:39.985538', '2025-12-12 06:39:39.985540')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "31"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 31 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:39.991470', '2025-12-12 06:39:39.991471')[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.996485', '2025-12-12 06:39:39.996496', '$2a$04$EkcGJZnYRBw3y.2G8Z03Z.e/eUto7rmLcVjZGTJL7eR6tz8F/0VDy', '2025-12-12 06:39:39.996485', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:39.997890', '2025-12-12 06:39:39.997901', '$2a$04$AZs0.FPTvhWxou3axzMkWOt3vix5Py3It1oTtgSIOohI51yActbqy', '2025-12-12 06:39:39.997890', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 33 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:39.998609', NULL, NULL, NULL, '2025-12-12 06:39:39.998609', 33)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: bc76623f-a0f6-46c5-b7d4-5a128763187c) to Test(default) with arguments: 16
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (33, '2025-12-12 06:39:39.999497', 32, NULL, 'active', 'Test', '2025-12-12 06:39:39.999497')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 20, '2025-12-12 06:39:40.000047', FALSE, 32, 'initiator', '2025-12-12 06:39:40.000047')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.000047', `conversations`.`updated_at` = '2025-12-12 06:39:40.000816' WHERE `conversations`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 06:39:40.001147' WHERE `messages`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 20, '2025-12-12 06:39:40.001506', FALSE, 33, 'expert', '2025-12-12 06:39:40.001506')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.001506', `conversations`.`updated_at` = '2025-12-12 06:39:40.001914' WHERE `conversations`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=32&since=2025-12-11T06%3A39%3A40Z" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "32", "since" => "2025-12-11T06:39:40Z"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 32 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 32 LIMIT 1[0m
  [1m[36mConversation Pluck (1.0ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 32 OR `conversations`.`assigned_expert_id` = 32)[0m
  [1m[35m (721.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 20 AND (created_at >= '2025-12-11 06:39:40') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 1.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.009233', '2025-12-12 06:39:40.009243', '$2a$04$sO0VkmX/Ixn2E4DCjMzmROj3bO7ExUujXRREP7BqFJi61kVCoLMQ2', '2025-12-12 06:39:40.009233', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.010677', '2025-12-12 06:39:40.010686', '$2a$04$nQlzmqeJ4M9E2mu4ozxUB.6KG3clE5Dr.3sFIB.Ce6hixvx2IlMSy', '2025-12-12 06:39:40.010677', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 35 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.011357', NULL, NULL, NULL, '2025-12-12 06:39:40.011357', 35)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eeead569-9eb7-4bac-8c95-131bceebc9a1) to Test(default) with arguments: 17
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (35, '2025-12-12 06:39:40.011953', 34, NULL, 'active', 'Test', '2025-12-12 06:39:40.011953')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.1ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 21, '2025-12-12 06:39:40.012502', FALSE, 34, 'initiator', '2025-12-12 06:39:40.012502')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.012502', `conversations`.`updated_at` = '2025-12-12 06:39:40.012824' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 21, '2025-12-12 06:39:40.023372', FALSE, 35, 'expert', '2025-12-12 06:39:40.023372')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.023372', `conversations`.`updated_at` = '2025-12-12 06:39:40.023903' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.028460', '2025-12-12 06:39:40.028516', '$2a$04$SQQ5DGT3iqOwbUCmfM3ifezhpnXS8hGnf/NdVLUgmwbEah99ez5Ma', '2025-12-12 06:39:40.028460', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.030376', '2025-12-12 06:39:40.030418', '$2a$04$wvWmvbGySMtoqrFRTvYMY.nkWLiDndfAoJ/yfoXYxcoJlZtVPjCNO', '2025-12-12 06:39:40.030376', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 21, '2025-12-12 06:39:40.034690', FALSE, 34, 'initiator', '2025-12-12 06:39:40.034690')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.034690', `conversations`.`updated_at` = '2025-12-12 06:39:40.035328' WHERE `conversations`.`id` = 21[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.035396', NULL, NULL, NULL, '2025-12-12 06:39:40.035396', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/messages/updates?userId=34" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "34"}
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad185a28-7f5c-4f4a-81bd-61267b1853f6) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 34 LIMIT 1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 34 OR `conversations`.`assigned_expert_id` = 34)[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 21 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (34, 35)[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (702.1ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.046593', 1, NULL, 'waiting', 'First', '2025-12-12 06:39:40.046593')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (9.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.048992', '2025-12-12 06:39:40.049003', '$2a$04$3f10MxKLIwMY4FHA15lF3.WisNQZzzACmZbtBrnK.qURClte7A1RG', '2025-12-12 06:39:40.048992', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.050410', '2025-12-12 06:39:40.050420', '$2a$04$TXxBx8hwwKuDyaMj6PpV2eY/Fbq7AfM1twUae/1Z/0IRrL6gvFALq', '2025-12-12 06:39:40.050410', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.051131', NULL, NULL, NULL, '2025-12-12 06:39:40.051131', 37)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7997f1e2-96c0-4095-84de-4494402db2e3) to Test(default) with arguments: 18
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (37, '2025-12-12 06:39:40.051766', 36, NULL, 'active', 'As Expert', '2025-12-12 06:39:40.051766')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=37" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "37"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 37 OR `conversations`.`assigned_expert_id` = 37) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 36 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 37 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 22 AND `messages`.`sender_id` != 37 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.057346', 1, NULL, 'waiting', 'Second', '2025-12-12 06:39:40.057346')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.058702', '2025-12-12 06:39:40.058712', '$2a$04$D.MQYtlaTwZxE6s1lbSi5emX/wepP40eS0CV7nrCIulx.3HTZyFn6', '2025-12-12 06:39:40.058702', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.060148', '2025-12-12 06:39:40.060158', '$2a$04$IA0axPYVa8gTJ0MPJRXGl.XesM8OqCyKIuxH4V9KZBU8w4HSkFf7S', '2025-12-12 06:39:40.060148', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 39 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.060834', NULL, NULL, NULL, '2025-12-12 06:39:40.060834', 39)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 52167cc9-336a-496f-a74f-dd1a9d9bbd8d) to Test(default) with arguments: 19
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 0ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.068048', 1, NULL, 'waiting', 'Third', '2025-12-12 06:39:40.068048')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (7.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.071291', '2025-12-12 06:39:40.071304', '$2a$04$lrvmxaiEspBUcpF88jKbsOfU9aAeu14YergXVGKi/mJDKYgEt4oTW', '2025-12-12 06:39:40.071291', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.072938', '2025-12-12 06:39:40.072948', '$2a$04$dJk49PwsBCMjbH3XvVUipOFI0cIK7UeatmwKagivsdUGPhddQOi.m', '2025-12-12 06:39:40.072938', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 41 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.073763', NULL, NULL, NULL, '2025-12-12 06:39:40.073763', 41)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e6d02899-9b74-41a5-91b0-2ce345bffa33) to Test(default) with arguments: 20
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=2" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.085137', '2025-12-12 06:39:40.085150', '$2a$04$cVtYU.VxVZms7gGwW7689uXHCLNOyrldK0NXDHp2m92jDkFJ1XMje', '2025-12-12 06:39:40.085137', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 42 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.085961', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.085961', 42)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 061e576a-356c-4c54-bb08-c7738701b898) to Test(default) with arguments: 21
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619] Performing GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) from Test(default) enqueued at 2025-12-12T06:39:40.087153095Z with arguments: 21
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 21 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.089282' WHERE `expert_profiles`.`id` = 21[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [eb868d67-de94-4c4a-a202-120ed80c4619] Performed GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) from Test(default) in 1.86ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eb868d67-de94-4c4a-a202-120ed80c4619) to Test(default) with arguments: 21
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 21 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.6ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.095991', '2025-12-12 06:39:40.096002', '$2a$04$AzCS7CavcQ7Ia2f/JpadQenxVZNGmtfuVB0ugTejucIwKngbt6z6q', '2025-12-12 06:39:40.095991', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 43 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.096756', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.096756', 43)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8d129919-2ac3-4079-9220-cc2106a399c4) to Test(default) with arguments: 22
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf] Performing GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) from Test(default) enqueued at 2025-12-12T06:39:40.097391761Z with arguments: "non-existent-id"
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [527e0e5a-d311-480b-9ddc-c89603a70bbf] Performed GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) from Test(default) in 0.21ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 527e0e5a-d311-480b-9ddc-c89603a70bbf) to Test(default) with arguments: "non-existent-id"
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.101659', '2025-12-12 06:39:40.101671', '$2a$04$A3/BvxUzYWwuD/YKqscA..4B2T0vTBnVeUpPysa2dXXJqlPX3Rmui', '2025-12-12 06:39:40.101659', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.103186', '2025-12-12 06:39:40.103196', '$2a$04$IwTGG1fKQA6j.OZ7dfr3AOtebHsGeGjKu/MfhlWgRO12JhFSJxVnG', '2025-12-12 06:39:40.103186', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:39:40.103849', 3, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.103849')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.104196', '2025-12-12 06:39:40.104209', '$2a$04$Y1BGF7rrGHi0wOg04mcgiuDa9RPYgYtpTj8tkOCYsKWyY8sShQbDO', '2025-12-12 06:39:40.104196', 'testuser')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.105663', '2025-12-12 06:39:40.105672', '$2a$04$xAUeqeFP1AtgiPH7ROIvfu2cZ33kTSNuvdpplhT21TRBwehapoFky', '2025-12-12 06:39:40.105663', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (45, '2025-12-12 06:39:40.106254', 44, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.106254')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 23, '2025-12-12 06:39:40.106865', FALSE, 44, 'initiator', '2025-12-12 06:39:40.106865')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.106865', `conversations`.`updated_at` = '2025-12-12 06:39:40.107225' WHERE `conversations`.`id` = 23[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/9/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "4", "content" => "Test message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "9"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 45 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 06:39:40.110582', FALSE, 3, 'initiator', '2025-12-12 06:39:40.110582')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.110582', `conversations`.`updated_at` = '2025-12-12 06:39:40.111025' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_includes_senderUsername
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.117592', '2025-12-12 06:39:40.117602', '$2a$04$lyoh9fIUMNriKnJC1fkZUeZOPZz9Rk3ifGnXoOA8N1iuRHPjvw1JC', '2025-12-12 06:39:40.117592', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.119052', '2025-12-12 06:39:40.119061', '$2a$04$DAMup5xEI0HOzGvE0.SDXuvtEZVEHFXhjuJrYGZHPBd502b8UrVgS', '2025-12-12 06:39:40.119052', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:39:40.119620', 5, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.119620')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "5", "content" => "Test message"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 06:39:40.121230', FALSE, 5, 'initiator', '2025-12-12 06:39:40.121230')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.121230', `conversations`.`updated_at` = '2025-12-12 06:39:40.121597' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '45' OR conversations.assigned_expert_id = '45') AND `messages`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 06:39:40.122672' WHERE `messages`.`id` = 9[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 9.8ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.128126', '2025-12-12 06:39:40.128140', '$2a$04$KpunQfQHcNgK09wFTLprD.y1/2KmeDCjucp5w3bN.jh.seE1bMVXe', '2025-12-12 06:39:40.128126', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.130821', '2025-12-12 06:39:40.130832', '$2a$04$F0cMlFlbZ1WgVdPwB0mWYeVqf5PD9kDfUnUH9mzf9HZTDP.3uGJKq', '2025-12-12 06:39:40.130821', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.130972', '2025-12-12 06:39:40.130986', '$2a$04$CyIgJO0FGqD01c9XqLTFe.BjqoYDe63ugWX2YLMmZRy/6UHMwN8au', '2025-12-12 06:39:40.130972', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:39:40.131868', 7, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.131868')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.133128', '2025-12-12 06:39:40.133138', '$2a$04$DN..7ORXssPoAemP8AnAx.Iadka.9TzsIFuuD5.5hXA.ogxEHK0Wi', '2025-12-12 06:39:40.133128', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (47, '2025-12-12 06:39:40.133702', 46, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.133702')[0m
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 6, '2025-12-12 06:39:40.133272', FALSE, 7, 'initiator', '2025-12-12 06:39:40.133272')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.133272', `conversations`.`updated_at` = '2025-12-12 06:39:40.134084' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.135185', '2025-12-12 06:39:40.135193', '$2a$04$V0zJwIGu8lGaVT0NDXZaMOGk5Al3Dh/LaEMoN7qyQwm0veepD.pum', '2025-12-12 06:39:40.135185', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/24/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "24"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 48 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 48 OR `conversations`.`assigned_expert_id` = 48) AND `conversations`.`id` = 24 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.144292', '2025-12-12 06:39:40.144301', '$2a$04$ZT1H72jyw6s0kkEiOAfFh.CuZOxBdLwon9MMsEFDSrq3Z4EcuObcK', '2025-12-12 06:39:40.144292', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 6, '2025-12-12 06:39:40.144796', FALSE, 8, 'expert', '2025-12-12 06:39:40.144796')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.145654', '2025-12-12 06:39:40.145663', '$2a$04$EQNxUjsYshYKAvjSyjhSv.owb3vvOUSJnlZdrDvBmr55mKq6wtahS', '2025-12-12 06:39:40.145654', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.144796', `conversations`.`updated_at` = '2025-12-12 06:39:40.145852' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (50, '2025-12-12 06:39:40.146335', 49, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.146335')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "25", "content" => "New message"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 49 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 25 LIMIT 1[0m
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 6, '2025-12-12 06:39:40.156511', FALSE, 7, 'initiator', '2025-12-12 06:39:40.156511')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 25, '2025-12-12 06:39:40.158252', FALSE, 49, 'initiator', '2025-12-12 06:39:40.158252')[0m
  [1m[36mConversation Update (0.6ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.156511', `conversations`.`updated_at` = '2025-12-12 06:39:40.158211' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.158252', `conversations`.`updated_at` = '2025-12-12 06:39:40.158679' WHERE `conversations`.`id` = 25[0m
Started GET "/conversations/6/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.3ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 25 LIMIT 1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "6"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7) AND `conversations`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (7, 8)[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 2.8ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.167908', '2025-12-12 06:39:40.167920', '$2a$04$6sSRH4xG5dK.pYBVDdDsEujvI3A0pUvYjO9U0ZSJD22XAezSb90zS', '2025-12-12 06:39:40.167908', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.169443', '2025-12-12 06:39:40.169452', '$2a$04$LS/mQ.FHsBiG4uHqsGyUjOu68iZNvlLn5PLYJGlQGGtYouwV6oxm2', '2025-12-12 06:39:40.169443', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (52, '2025-12-12 06:39:40.169997', 51, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.169997')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "26", "content" => "Expert reply"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 52 LIMIT 1[0m
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 26 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 26, '2025-12-12 06:39:40.171641', FALSE, 52, 'expert', '2025-12-12 06:39:40.171641')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.171641', `conversations`.`updated_at` = '2025-12-12 06:39:40.172046' WHERE `conversations`.`id` = 26[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.174309', '2025-12-12 06:39:40.174323', '$2a$04$jiGpZghdwB4.sFBXN/CZHuYYUrs4eiqPAGbK6PMBtJB2ulDibxAIi', '2025-12-12 06:39:40.174309', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.176269', '2025-12-12 06:39:40.176279', '$2a$04$DPLjKxKsIGMTrlCg9e3MRurbZp.NykTVaRonBNKlyipRv.iMrkSg6', '2025-12-12 06:39:40.176269', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:39:40.177754', 9, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.177754')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (820.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.179981', '2025-12-12 06:39:40.179992', '$2a$04$2u5AApsP9XmuSyPoZS3.weR3/lPRg7UO4OmxkYSLZ1FyBlD3FllDm', '2025-12-12 06:39:40.179981', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "7", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (9.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.5ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.186427', '2025-12-12 06:39:40.186439', '$2a$04$wGfCgdQQF.OGx3xiBqykCu8g1AnoXED8N94DsvV/ZlsXysnIQSkw2', '2025-12-12 06:39:40.186427', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.187874', '2025-12-12 06:39:40.187883', '$2a$04$dB9HLXpZtjUfXijyv3Qh/.x5mJH.18NvQ1wxqgvr5k3vqlp4ygCpu', '2025-12-12 06:39:40.187874', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (54, '2025-12-12 06:39:40.188436', 53, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.188436')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 53 LIMIT 1[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (1017.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.192205', '2025-12-12 06:39:40.192216', '$2a$04$ScTyGlE1LE7UBJ2D/1nMwOdSzSsnHY8G5mdIbpzxlLY93GvN7SmeO', '2025-12-12 06:39:40.192205', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.194225', '2025-12-12 06:39:40.194236', '$2a$04$6.sLj5L.zzimHSDhzLqr.O4memSDadY0obzkFPVTDY91lMbyy4A8a', '2025-12-12 06:39:40.194225', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.195693', '2025-12-12 06:39:40.195703', '$2a$04$U8ovQ8hQLssOg6SlrEsEROZPvtX8q2MGrxoQDbCfUf0kYmwooyKFC', '2025-12-12 06:39:40.195693', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (13, '2025-12-12 06:39:40.195614', 12, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.195614')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "8", "content" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.197363', '2025-12-12 06:39:40.197373', '$2a$04$T/9s35xRJ6NIVjqe1yEbN.HQuceboulaEW6pkxUg7tTz7.GEfOPK.', '2025-12-12 06:39:40.197363', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (56, '2025-12-12 06:39:40.197944', 55, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.197944')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.199628', '2025-12-12 06:39:40.199640', '$2a$04$rSaTadkCeepn8cVqztYOHOmT6GHOmob4.aba24ho.fpDhIxVcHlWS', '2025-12-12 06:39:40.199628', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.200194', 57, NULL, 'waiting', 'Other', '2025-12-12 06:39:40.200194')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 29, '2025-12-12 06:39:40.200775', FALSE, 57, 'initiator', '2025-12-12 06:39:40.200775')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.200775', `conversations`.`updated_at` = '2025-12-12 06:39:40.201178' WHERE `conversations`.`id` = 29[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/12/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "12"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 55 LIMIT 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '55' OR conversations.assigned_expert_id = '55') AND `messages`.`id` = 12 LIMIT 1[0m
Filter chain halted as :set_message rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.204979', '2025-12-12 06:39:40.204993', '$2a$04$wWWvWV6FnxrRXq5/kHNmh.rAyUOtuKnv74YJ9HfaSTYzuZyutWJzy', '2025-12-12 06:39:40.204979', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.207322', '2025-12-12 06:39:40.207332', '$2a$04$1xKjFiRAw4B9j5uLXxMJNO0aqKOYpz6CNXU9VCfUE72Oo4RkXlgI2', '2025-12-12 06:39:40.207322', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.207596', '2025-12-12 06:39:40.207609', '$2a$04$kjqAiJBPXGybvI8XgdKcIuo/ncN.zFpREvrUH1sn.9Pf.dQcZeE9.', '2025-12-12 06:39:40.207596', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.208709', '2025-12-12 06:39:40.208718', '$2a$04$LxzEcJx/k/MY4/jRDL8Z1.lwIwrIVerlKp9fQz22vaYx3cnsAaHUe', '2025-12-12 06:39:40.208709', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (59, '2025-12-12 06:39:40.209280', 58, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.209280')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 30, '2025-12-12 06:39:40.209812', FALSE, 58, 'initiator', '2025-12-12 06:39:40.209812')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 06:39:40.209964', 14, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.209964')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.209812', `conversations`.`updated_at` = '2025-12-12 06:39:40.210156' WHERE `conversations`.`id` = 30[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/13/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "13"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 58 LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '58' OR conversations.assigned_expert_id = '58') AND `messages`.`id` = 13 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 9, '2025-12-12 06:39:40.210542', TRUE, 14, 'initiator', '2025-12-12 06:39:40.210542')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.210542', `conversations`.`updated_at` = '2025-12-12 06:39:40.212315' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/9/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (568.6ms)[0m  [1m[35mALTER TABLE `expert_profiles` ADD CONSTRAINT `fk_rails_f4efc9cdf2`
FOREIGN KEY (`user_id`)
  REFERENCES `users` (`id`)
[0m
Processing by MessagesController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  Parameters: {"conversation_id" => "9"}
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 14 OR `conversations`.`assigned_expert_id` = 14) AND `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.216372', '2025-12-12 06:39:40.216384', '$2a$04$X6h5l/BRbUWZOs04/gj5weCEJ4I8el/tSRT2QTylQjtrifwe6K0mW', '2025-12-12 06:39:40.216372', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 1.5ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.217828', '2025-12-12 06:39:40.217840', '$2a$04$F3QJ5QfHTXoaa/8/OwI5YuoWGh7XEZNPnpcEGsKmjGvBxI8g9hbG2', '2025-12-12 06:39:40.217828', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (61, '2025-12-12 06:39:40.218630', 60, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.218630')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 31, '2025-12-12 06:39:40.219451', FALSE, 60, 'initiator', '2025-12-12 06:39:40.219451')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.219451', `conversations`.`updated_at` = '2025-12-12 06:39:40.219924' WHERE `conversations`.`id` = 31[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/14/read" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "14"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (10.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.231221', '2025-12-12 06:39:40.231232', '$2a$04$oRHAxPb75AsiH1mttjWz8uuIldt1sZ7mNN2OnGUZnR8c2C44r2U6G', '2025-12-12 06:39:40.231221', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.232512', '2025-12-12 06:39:40.232524', '$2a$04$HIDwMIsUh2eZH2niwNwg.O.TGRoASH9OjjjjtL2qMHk/mUOpoYHDe', '2025-12-12 06:39:40.232512', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.232906', '2025-12-12 06:39:40.232916', '$2a$04$iDlOEZlNgZhQ1GP/gOcGrekZtcnW7dwAYQJtccFALUwl9yonK2BRG', '2025-12-12 06:39:40.232906', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (63, '2025-12-12 06:39:40.233710', 62, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.233710')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/32/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "32"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.235908', '2025-12-12 06:39:40.235918', '$2a$04$kwVbXhhVH/igIaASvHr8fO6AKmfFMOJWHBhz6tbQYVP3adtwLwQ4W', '2025-12-12 06:39:40.235908', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (17, '2025-12-12 06:39:40.237354', 16, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.237354')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 10, '2025-12-12 06:39:40.238427', FALSE, 16, 'initiator', '2025-12-12 06:39:40.238427')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.238427', `conversations`.`updated_at` = '2025-12-12 06:39:40.239217' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.239714', '2025-12-12 06:39:40.239726', '$2a$04$S/F9nLCN.vdr7x7tkVrGseO8YqSUjJT4Of3PMjQrDl7sFEdXY7nfu', '2025-12-12 06:39:40.239714', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.241382', '2025-12-12 06:39:40.241394', '$2a$04$7WFgcc1Zt642/sZ9qw/taem1biubIS1hsjl2mNuCRwQx8278qWSzK', '2025-12-12 06:39:40.241382', 'expertuser')[0m
Started GET "/conversations/10/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (65, '2025-12-12 06:39:40.242005', 64, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.242005')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 16 OR `conversations`.`assigned_expert_id` = 16) AND `conversations`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "33", "content" => "New message"}
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 10 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 64 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 33 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 33, '2025-12-12 06:39:40.243490', FALSE, 64, 'initiator', '2025-12-12 06:39:40.243490')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:39:40.243490', `conversations`.`updated_at` = '2025-12-12 06:39:40.244025' WHERE `conversations`.`id` = 33[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.248057', '2025-12-12 06:39:40.248071', '$2a$04$8EpWWS5WqtzWhbdBSEtL/uGzuDoNrGBCnIKWpsd/neDgOw5PM0x/i', '2025-12-12 06:39:40.248057', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.249693', '2025-12-12 06:39:40.249703', '$2a$04$wecrYwtYjaeEvVWVNF80tONY97L7n7aAxTM5ZHumd/p0h.tjfNv7G', '2025-12-12 06:39:40.249693', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (687.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.254113', '2025-12-12 06:39:40.254126', '$2a$04$rGt3YVTesk.G6ZBpIBDzY.6Ms4bdP5TVFIwj8kSfCSMRe2C0JS6ti', '2025-12-12 06:39:40.254113', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.256790', '2025-12-12 06:39:40.256799', '$2a$04$9N1ju7CbBWOb8q8EjVsKiu48fa3T7nHWONGKLX4gnlg3BI2OArEjC', '2025-12-12 06:39:40.256790', 'newuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.257669', NULL, NULL, NULL, '2025-12-12 06:39:40.257669', 68)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c614ba9f-b338-42d9-b94d-435c4817712e) to Test(default) with arguments: 23
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 68 LIMIT 1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.255553', `users`.`updated_at` = '2025-12-12 06:39:40.262253' WHERE `users`.`id` = 18[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 7.0ms (3 queries, 0 cached) | GC: 1.2ms)
Completed 201 Created in 11ms (Views: 0.0ms | ActiveRecord: 6.2ms (6 queries, 0 cached) | GC: 0.2ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (819.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (90.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.273375', '2025-12-12 06:39:40.273387', '$2a$04$n1fsNKyALZGU1ABbCaEiq.x7I6gCauZsgQYg9ek.cPnns0DbIe11C', '2025-12-12 06:39:40.273375', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.275018', '2025-12-12 06:39:40.275030', '$2a$04$3NM8jF61m.gTGy12JKjyBuq.HyTr/dN3UYfMXhieED55jBg/iOW6m', '2025-12-12 06:39:40.275018', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.275633', `users`.`updated_at` = '2025-12-12 06:39:40.276376' WHERE `users`.`id` = 69[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.0ms | ActiveRecord: 0.2ms (1 query, 0 cached) | GC: 0.4ms)
  [1m[35m (7.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.282745', '2025-12-12 06:39:40.282756', '$2a$04$0gHEAWUy2i/Bbw7F6EfWDORJ6ra/bjwfL7zdXVQh.ly/FpWpNlzIS', '2025-12-12 06:39:40.282745', 'test')[0m
-------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#refresh as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[35m (4.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.285065', `users`.`updated_at` = '2025-12-12 06:39:40.285196' WHERE `users`.`id` = 70[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.285688', '2025-12-12 06:39:40.285698', '$2a$04$S7ckdzGcf1n1TisAgUz6yu9Gokk/uzzK4HOniksSHlE1C2bOcGDk.', '2025-12-12 06:39:40.285688', 'testuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.288197', `users`.`updated_at` = '2025-12-12 06:39:40.288344' WHERE `users`.`id` = 20[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.2ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.294343', '2025-12-12 06:39:40.294355', '$2a$04$gXicO6lofRIwregFA7WbEeMQcO.ZJiOXjS7fj7lCp5FlPzKxHRXgC', '2025-12-12 06:39:40.294343', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.296379', `users`.`updated_at` = '2025-12-12 06:39:40.296505' WHERE `users`.`id` = 71[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.2ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#logout as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 71 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.1ms)
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.308013', '2025-12-12 06:39:40.308026', '$2a$04$BEsDS/nYEm9jhxkCD4Tcau4W7v4amGtlCxQNLy/rcsylYN/tEEXXq', '2025-12-12 06:39:40.308013', 'testuser3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#refresh as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.314057', '2025-12-12 06:39:40.314067', '$2a$04$vclUYYHfszM1K0qQ55yF1.1gd6UcTJGWbQv9HQYqqE4tE3uyGoQBG', '2025-12-12 06:39:40.314057', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 73 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.314861', NULL, NULL, NULL, '2025-12-12 06:39:40.314861', 73)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 48d03c52-b07e-4b45-8dac-f67e8433c68b) to Test(default) with arguments: 24
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 73 LIMIT 1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.322020', '2025-12-12 06:39:40.322033', '$2a$04$8e7gLBhYz8zg41Dk7xH79eGmsqDBTwqWHq5VgEwbUZOBBGT.1ZTtu', '2025-12-12 06:39:40.322020', 'newexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.323006', NULL, NULL, NULL, '2025-12-12 06:39:40.323006', 74)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2069166e-e222-4d75-a561-772b48047267) to Test(default) with arguments: 25
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
Completed 201 Created in 3ms (Views: 0.0ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 74 LIMIT 1[0m
  [1m[35m (547.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.330903', '2025-12-12 06:39:40.330915', '$2a$04$dudzhEK/q/B305Qd9FtjweuIG7ElFxm3FlYSpKUkj103kNYkuk2Ta', '2025-12-12 06:39:40.330903', 'testuser4')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.333096', `users`.`updated_at` = '2025-12-12 06:39:40.333214' WHERE `users`.`id` = 75[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 75 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (53.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.341721', '2025-12-12 06:39:40.341732', '$2a$04$N1f/VAmprGpYJVE1uNCHv.JjFrrFxLe.hsDSSvG5zA0u/t0VfHAgC', '2025-12-12 06:39:40.341721', 'test')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Completed 401 Unauthorized in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.340467', '2025-12-12 06:39:40.340469')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
--------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.347480', '2025-12-12 06:39:40.347491', '$2a$04$j4CHa1IUJ.Hkrtd1PH.y2.kwqEClaOf4KkKkNpQHifHtUtU/lvkNy', '2025-12-12 06:39:40.347480', 'testlogout')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:39:40.349466', `users`.`updated_at` = '2025-12-12 06:39:40.349583' WHERE `users`.`id` = 77[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.346783', '2025-12-12 06:39:40.346784')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 0.0ms)
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by AuthController#logout as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 77 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (776.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mTRANSACTION (6.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.362343', '2025-12-12 06:39:40.362356', '$2a$04$ql/MrLmOSxJoecatr6ABUe37o4NTwPQS24Cds039Bw5IXMdWK4BN6', '2025-12-12 06:39:40.362343', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.363061', 78, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.363061')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/34" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "34"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 78 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 78 OR `conversations`.`assigned_expert_id` = 78) AND `conversations`.`id` = 34 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 78 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 34 AND `messages`.`sender_id` != 78 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.371628', '2025-12-12 06:39:40.371638', '$2a$04$d18HbpD4GURfmNwQ17hj5.zXXihLiqKNPH/cu84yfdkADS/AZbzIe', '2025-12-12 06:39:40.371628', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.372336', 79, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.372336')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 79 LIMIT 1[0m
  [1m[36mConversation Load (4.5ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 79 OR `conversations`.`assigned_expert_id` = 79) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 79 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 35 AND `messages`.`sender_id` != 79 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 6ms (Views: 0.0ms | ActiveRecord: 4.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (733.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.384287', '2025-12-12 06:39:40.384301', '$2a$04$0KoK1Njf0rhC3lUzFW8kfOXj16GneFUZZ3WaBAPHKMrCfbaMKLfAS', '2025-12-12 06:39:40.384287', 'testuser')[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.384755', '2025-12-12 06:39:40.384833', '$2a$04$.HwWxkFpEpYnqUPALbBeLusxESBJYQoa7/0XFdjXdCPaN3Vu5q0CS', '2025-12-12 06:39:40.384755', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 80 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 80 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.386146', 80, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.386146')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 36 AND `messages`.`sender_id` != 80 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (7.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (530.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.397452', '2025-12-12 06:39:40.397463', '$2a$04$uThXZc1VfT0KptptV.t5COP9HfsY7JoKDoN2/E2gYryIZefIUesXa', '2025-12-12 06:39:40.397452', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.398954', '2025-12-12 06:39:40.398964', '$2a$04$4GQIQdVRlvO/gyLhUmDRueHfzb1aJO.RlolCG/ovt84K1tmqeIw6G', '2025-12-12 06:39:40.398954', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 82 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.399759', NULL, NULL, '[]', '2025-12-12 06:39:40.399759', 82)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 48eccb48-4e5c-4209-a9f3-6c2bda525d76) to Test(default) with arguments: 26
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (82, '2025-12-12 06:39:40.400390', 81, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.400390')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/37" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "37"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 81 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 81 OR `conversations`.`assigned_expert_id` = 81) AND `conversations`.`id` = 37 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 81 LIMIT 1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 82 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 37 AND `messages`.`sender_id` != 81 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 11ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 8.9ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.414009', 1, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.414009')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.416107', '2025-12-12 06:39:40.416118', '$2a$04$XSXQi2uYyklJVEc265sNZeWXJ4Y1omG4TL8f3CYjLMDSduVck6FzC', '2025-12-12 06:39:40.416107', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 1 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.416734', 83, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.416734')[0m
Completed 201 Created in 13ms (Views: 0.2ms | ActiveRecord: 2.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 83 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 83 OR `conversations`.`assigned_expert_id` = 83) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 83 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 38 AND `messages`.`sender_id` != 83 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.421956', '2025-12-12 06:39:40.421970', '$2a$04$5idR7FP6tgTIeu9X9UCVuOxDobblV/2HiOHCEYVgy7hg7PHuPpB02', '2025-12-12 06:39:40.421956', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.423389', '2025-12-12 06:39:40.423399', '$2a$04$OM4kv4ImWiml4ASWH5HGl.XsvVyki.mtT2VajMVebGOBwizNghJ0.', '2025-12-12 06:39:40.423389', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 84 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 84 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.4ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.427707', '2025-12-12 06:39:40.427717', '$2a$04$9NWGXtd6atGL6ABbcQI52eFRnDLx/Vt6XX0d9xW7dQzSf8IhzVttC', '2025-12-12 06:39:40.427707', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#create as HTML
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  Parameters: {"title" => "Test"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.430432', '2025-12-12 06:39:40.430443', '$2a$04$djvfx78/W.wofta38Gm0UOWp0OIhAapWwyyssvGIPloi6Gt0ApqU2', '2025-12-12 06:39:40.430432', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (34.4ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.431972', '2025-12-12 06:39:40.431982', '$2a$04$Z9txy/A2ECCtIkD/iiM93.1mv4zti2WSLwwK5EpfP96w51KMPX1Na', '2025-12-12 06:39:40.431972', 'otheruser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.432498', 86, NULL, 'waiting', 'Other Conversation', '2025-12-12 06:39:40.432498')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/conversations/39" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "39"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 85 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.433364', '2025-12-12 06:39:40.433376', '$2a$04$GJ0EUzPLiRQakJPV0Quje.rHXpAO262eSlJzFHIf2lkd0oYk4tNu.', '2025-12-12 06:39:40.433364', 'testuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 85 OR `conversations`.`assigned_expert_id` = 85) AND `conversations`.`id` = 39 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.435441', '2025-12-12 06:39:40.435452', '$2a$04$z765CYq9czjyyanYMpl6oOP5ANDvU4QG5JeSEXNuCO0ihPyw/cEAK', '2025-12-12 06:39:40.435441', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SchemaMigration Load (4.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (5.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.439940', NULL, NULL, '[]', '2025-12-12 06:39:40.439940', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b4c21535-47a2-43a8-bf1d-04086e64e3df) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
----------------------------------------------------------------------
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (5, '2025-12-12 06:39:40.440842', 4, NULL, 'active', 'Test Conversation', '2025-12-12 06:39:40.440842')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.442250', '2025-12-12 06:39:40.442259', '$2a$04$8Hwj5gnuVQUc9aIj31xt2Obj0DJ.u59oqxw80vGmrCBJ3qm1wJG9q', '2025-12-12 06:39:40.442250', 'testuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 4 OR `conversations`.`assigned_expert_id` = 4) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.442779', 87, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:39:40.442779')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ConversationsController#index as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 87 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (4.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mConversation Load (6.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 87 OR `conversations`.`assigned_expert_id` = 87) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 87 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 40 AND `messages`.`sender_id` != 87 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 7ms (Views: 0.0ms | ActiveRecord: 6.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (4.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (11.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.457593', '2025-12-12 06:39:40.457605', '$2a$04$nVoP.AR0/uD7nU9WlVCMLe9vL3B7TEyabEKbdp5WV7Zsx3nkr63Iy', '2025-12-12 06:39:40.457593', 'testuser')[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.458097', '2025-12-12 06:39:40.458107', '$2a$04$u6trR7yv7S4GmJFwcS4TMeuHpOT2ozFkVWMKimlXP2ynrjKrL3eDS', '2025-12-12 06:39:40.458097', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (762.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.462998', '2025-12-12 06:39:40.463008', '$2a$04$z/ovokdDwxrBCWughPQbcu6zt/FLrwJGIfFkTiI4rUvrQELa/AfgC', '2025-12-12 06:39:40.462998', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.463074', '2025-12-12 06:39:40.463087', '$2a$04$DmN15Kdmb98w69pZLF9rMuzpkDvqGUb7aOdEwy0VvSOVqVij4e9bG', '2025-12-12 06:39:40.463074', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.464511', '2025-12-12 06:39:40.464521', '$2a$04$N6nEIbPDipFSytM0Arsi4ORmRiMtK4/bhe/cJMSXcRMdIO3lKq.9K', '2025-12-12 06:39:40.464511', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.464695', '2025-12-12 06:39:40.464704', '$2a$04$Flh4.g0M2JmNPaCE1OrqGuR17meaj2Iitqq0VRh48O67Fp5w3sVfK', '2025-12-12 06:39:40.464695', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 90 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.465345', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.465345', 8)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.465438', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.465438', 90)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8ce3305a-7244-44ad-9a48-099a3ea06dad) to Test(default) with arguments: 2
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d753b987-1f46-4eb6-9d39-71289eb73adc) to Test(default) with arguments: 27
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:39:40.466054', 7, NULL, 'active', 'Test', '2025-12-12 06:39:40.466054')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.467060', '2025-12-12 06:39:40.467069', '$2a$04$7Wu9VgjdceBEJAdxX60sUeLA0ZR.Ksy8dlJv1pk58utVjxqkJG.v2', '2025-12-12 06:39:40.467060', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 91 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.4ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.468085', 89, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.468085')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/41/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "41"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 91 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 91 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.470699', 3, '2025-12-12 06:39:40.470824', 8, NULL, 'active', '2025-12-12 06:39:40.470824')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/3/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:39:40.475710' WHERE `conversations`.`id` = 3[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.476985', '2025-12-12 06:39:40.476995', '$2a$04$Pvkbh/QzNATeD.CmZLHqw.AFsrSDRPXo/hY9w9n2GmtCUSB/wCWua', '2025-12-12 06:39:40.476985', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 3 AND `expert_assignments`.`expert_id` = 8 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:39:40.477907', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:39:40.478339' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.478569', '2025-12-12 06:39:40.478578', '$2a$04$Jge1TmcGjMax3LJCB8iYiehrFgsVdMwdWQwoARhb4RQ9qaBx.hkvO', '2025-12-12 06:39:40.478569', 'expertuser')[0m
Completed 200 OK in 7ms (Views: 0.0ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 3.3ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 93 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.479290', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.479290', 93)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 188b269c-dc64-4f21-9a23-68f4eb493afc) to Test(default) with arguments: 28
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.479935', 92, NULL, 'waiting', 'First', '2025-12-12 06:39:40.479935')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.484986', '2025-12-12 06:39:40.484996', '$2a$04$ixDZK.SqriCRe6StyIEBl.sXctjFGdD21xdeqU3XypivHXTb34aji', '2025-12-12 06:39:40.484986', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.486956', '2025-12-12 06:39:40.486968', '$2a$04$9DEW4PVT1y5fd8cdlSGN..aY7iXvfXcElgolYUYSFip85w8elnce6', '2025-12-12 06:39:40.486956', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.488312', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.488312', 10)[0m
  [1m[35m (484.9ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: cbd4b6c7-8609-4b52-903d-daeb729319c3) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.490565', 92, NULL, 'waiting', 'Second', '2025-12-12 06:39:40.490565')[0m
Processing by ExpertController#profile as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.496727', '2025-12-12 06:39:40.496745', '$2a$04$lBh/d4TC7hOvB43s425rCOeg2/y1q4wTplvORYimVsJUjj2nj8/rS', '2025-12-12 06:39:40.496727', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.499801', '2025-12-12 06:39:40.499812', '$2a$04$/5t8cbw6HE9vAmYKvJzDxOQasoaJlhBvbHace34Bf4NAPt1Fjt3Hq', '2025-12-12 06:39:40.499801', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.501303', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.501303', 12)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1e266599-9eb2-4995-869e-ec9f7c8bdb81) to Test(default) with arguments: 4
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.501404', 92, NULL, 'waiting', 'Third', '2025-12-12 06:39:40.501404')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (172.8ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 93 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 93 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 42 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 43 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 92 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 44 AND `messages`.`sender_id` != 93 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 93 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 4ms (Views: 0.0ms | ActiveRecord: 1.0ms (10 queries, 0 cached) | GC: 0.2ms)
  [1m[36mActiveRecord::SchemaMigration Load (6.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[35m (3.8ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.514014', '2025-12-12 06:39:40.514024', '$2a$04$y8eUk/PNTRfQL2jJta5K.O4VC6uV.1dWqYjKvro3yTiBxc0H7bISi', '2025-12-12 06:39:40.514014', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.514475', '2025-12-12 06:39:40.514486', '$2a$04$NYtHo/3O3.1we.Qq64DTgeKMnrU5EiXTB1z.CEJZhlZ24qbE93qI.', '2025-12-12 06:39:40.514475', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.515600', '2025-12-12 06:39:40.515612', '$2a$04$CSzC9bhpn3WyafCm4NyTdelepadngkz2SRAoY6kGX29vCQuT27JrK', '2025-12-12 06:39:40.515600', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 95 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.516560', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.516560', 95)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3effee66-0319-4397-9295-65fd2e8d9fe6) to Test(default) with arguments: 29
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.516569', '2025-12-12 06:39:40.516579', '$2a$04$qmtAOJX3UZNAeW15sCr9Guw8DcyQ6L8kJCXclW6VWzwPE..E15qL.', '2025-12-12 06:39:40.516569', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.517319', 94, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 06:39:40.517319')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.518489', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.518489', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (95, '2025-12-12 06:39:40.518250', 94, NULL, 'active', 'Assigned Conversation', '2025-12-12 06:39:40.518250')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 95 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: daec64c7-fa3b-45b4-af24-2ab0a6f1d0b0) to Test(default) with arguments: 5
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 95 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 94 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 45 AND `messages`.`sender_id` != 95 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 95 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 94 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 95 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 46 AND `messages`.`sender_id` != 95 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.525452', '2025-12-12 06:39:40.525463', '$2a$04$fhhEAsnVjvP1zqFU0P9HTOr6BWiI2EB98xcoSFnc32zAWzB4P5oFu', '2025-12-12 06:39:40.525452', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.526619', '2025-12-12 06:39:40.526630', '$2a$04$eeRbkdyc7Y/ag7cGEfn3QOsYXBd.ogABoWOczbho6RSwq2.mOOKxy', '2025-12-12 06:39:40.526619', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.527071', '2025-12-12 06:39:40.527081', '$2a$04$UPYAYbn.d/NZrw9BLKCHOubhEHNDteJD8meYIfUrOdPmHQ01CIYJq', '2025-12-12 06:39:40.527071', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 97 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.527841', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.527841', 97)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: dafba9f2-f80d-4e02-b55a-64844f00a018) to Test(default) with arguments: 30
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.529254', '2025-12-12 06:39:40.529264', '$2a$04$TKLuAFQVkU4ui6zth4RLVeTx3B3DiuE.tvTa8ntLAc0JlXZy2IxmK', '2025-12-12 06:39:40.529254', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.529597', '2025-12-12 06:39:40.529607', '$2a$04$gglNlvcM7xfGi3yQie8dL.1Q6StSP/t32mbgl.O95s.wtxhrlev3a', '2025-12-12 06:39:40.529597', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 98 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.530656', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.530656', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 98 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 98 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0a00c688-f30e-4587-9f3d-ec8da6a98bb4) to Test(default) with arguments: 6
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[35m (147.9ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 1.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.535593', '2025-12-12 06:39:40.535604', '$2a$04$H2LvggaOvboMNHWkytZQ/ue4b11tIYPaOWjAabf/8/hoi2MCHHJ1C', '2025-12-12 06:39:40.535593', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.537043', '2025-12-12 06:39:40.537052', '$2a$04$JrKEPGr54zUudnUd75YzDeoGA32Na0LM1d4f5kG3uMtdGu1zHvhLq', '2025-12-12 06:39:40.537043', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 100 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.537973', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.537973', 100)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 66260159-ee10-4bce-8b1e-8357f23e823b) to Test(default) with arguments: 31
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (100, '2025-12-12 06:39:40.538600', 99, NULL, 'active', 'Test', '2025-12-12 06:39:40.538600')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[35m (95.4ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.542086', '2025-12-12 06:39:40.542097', '$2a$04$RekidpY0FxatiEYICIAHpuYC/At5V.7wOp4XHI6GuTNm3JwSnZkWW', '2025-12-12 06:39:40.542086', 'testuser')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.542879', 47, '2025-12-12 06:39:40.543000', 100, '2025-12-12 06:39:40.539757', 'resolved', '2025-12-12 06:39:40.543000')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 100 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 100 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 100 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 47[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.542767', '2025-12-12 06:39:40.542769')[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.545338', '2025-12-12 06:39:40.545356', '$2a$04$oMctmAfasm9PpH/iuS/BhekGlTxZPYCtkkJ8a.9KVRA0Po5Z3oAEy', '2025-12-12 06:39:40.545338', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
--------------------------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.547892', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.547892', 18)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8bdb4de3-4f3b-4922-89c0-9b51aa655219) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.550123', '2025-12-12 06:39:40.550136', '$2a$04$xcWskzKAsg56.vF0kriS6eGpOqB6x.e5ZKd1VL/BT4KwjQEj17w52', '2025-12-12 06:39:40.550123', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.551601', '2025-12-12 06:39:40.551610', '$2a$04$ws9y7eAxdX5WxrJ37GqiNuBrYRU9coddQ/Tgp0Qs4CNJ/2Ueld1xO', '2025-12-12 06:39:40.551601', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 102 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.552061', '2025-12-12 06:39:40.552074', '$2a$04$anxye1TvJKRebT4jP2o0HOke8whbgrF7UP/57EJOOdYamc1Kj1cZS', '2025-12-12 06:39:40.552061', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.552360', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.552360', 102)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6cbe55d4-e898-461c-a6a5-c6768259be9f) to Test(default) with arguments: 32
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (102, '2025-12-12 06:39:40.553023', 101, NULL, 'active', 'Test', '2025-12-12 06:39:40.553023')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/48/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "48"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mActiveRecord::InternalMetadata Create (6.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.547575', '2025-12-12 06:39:40.547577')[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Filter chain halted as :ensure_expert! rendered or redirected
--------------------------------------------------------------------------------------------
Completed 403 Forbidden in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 1.0ms)
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.558101', '2025-12-12 06:39:40.558111', '$2a$04$KJL1fnZhNOblx/4gkJTBk.gVpCh56Tslytm4bacrHQdpkRULjrVQ6', '2025-12-12 06:39:40.558101', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.559535', '2025-12-12 06:39:40.559547', '$2a$04$ucxe.aJL5Ea.SdXFRQJQYeq5KUcobG77glFX6nCcAPSaxySkZO3Ea', '2025-12-12 06:39:40.559535', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 104 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.560323', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.560323', 104)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1943167c-c103-41d8-94e7-03079d7c4b75) to Test(default) with arguments: 33
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.561876', '2025-12-12 06:39:40.561886', '$2a$04$xGflwINqOfZex7V2AHJYcuPU5NGpgm/O0GOuHH1A4MWlEqGnfuBwW', '2025-12-12 06:39:40.561876', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 105 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:39:40.562576', NULL, NULL, NULL, '2025-12-12 06:39:40.562576', 105)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.562564', '2025-12-12 06:39:40.562574', '$2a$04$py0.DGUEvbZmxpFdoBWF4O5EqaRZ6pWIi9daUhtOyWTKYI/LeqbVu', '2025-12-12 06:39:40.562564', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8e498b33-cef2-43ca-a24b-7c64bcd94da7) to Test(default) with arguments: 34
  [1m[35m (44.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (105, '2025-12-12 06:39:40.563096', 103, NULL, 'active', 'Test', '2025-12-12 06:39:40.563096')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/49/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "49"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 104 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.564024', '2025-12-12 06:39:40.564034', '$2a$04$bUNSpehqKzyC/ucQQ5xRCO3vPRiCWNUEP3MXoewjWSCpAgoLrTHcy', '2025-12-12 06:39:40.564024', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 104 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 49 LIMIT 1[0m
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.1ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.564737', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.564737', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 205f41fa-dcef-4d9f-984b-42eedd3216e7) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.565367', 20, NULL, 'active', 'First', '2025-12-12 06:39:40.565367')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.569619', '2025-12-12 06:39:40.569628', '$2a$04$z.ZvqNJPXs4oU5PQToIdh.ph3cZ1cRWpn4PjYAr0FkylTPml8wVky', '2025-12-12 06:39:40.569619', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.571029', '2025-12-12 06:39:40.571039', '$2a$04$INVfWi3SdyafSkwGLOvIOev3YGhZ/OfhXIMEnKaWjjSVAI.AWDIwe', '2025-12-12 06:39:40.571029', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (109.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 107 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.571811', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.571811', 107)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9ae9fa4b-5dc1-42c4-85d2-81892d36318e) to Test(default) with arguments: 35
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mActiveRecord::InternalMetadata Create (8.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.563956', '2025-12-12 06:39:40.563957')[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 107 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 107 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.573745' WHERE `expert_profiles`.`id` = 35[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 914b063b-3235-477d-85a2-9f7629286ea5) to Test(default) with arguments: 35
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.5ms (3 queries, 0 cached) | GC: 0.2ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.576042', 20, NULL, 'active', 'Second', '2025-12-12 06:39:40.576042')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
  [1m[35m (5.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (34.5ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.579432', '2025-12-12 06:39:40.579444', '$2a$04$DykskswHoysnqhOcnAJlAePW6ZoMRS4OdVvOJzrrm4JRBt00ntwGG', '2025-12-12 06:39:40.579432', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.574171', '2025-12-12 06:39:40.574172')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.580917', '2025-12-12 06:39:40.580927', '$2a$04$UcC6s1r2lNC4MDFvMlRZr.WslIP0ynAtmsEHbWe84mwa.g6a3.W2G', '2025-12-12 06:39:40.580917', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 109 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.581686', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.581686', 109)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3fdf846d-93eb-4158-a82c-50871e8ae69f) to Test(default) with arguments: 36
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.582380', 108, NULL, 'resolved', 'First', '2025-12-12 06:39:40.582380')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.582938', 108, NULL, 'resolved', 'Second', '2025-12-12 06:39:40.582938')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.583589', 108, NULL, 'resolved', 'Third', '2025-12-12 06:39:40.583589')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 06:39:40.584020', 50, '2025-12-12 06:39:40.584197', 109, NULL, 'resolved', '2025-12-12 06:39:40.584197')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 06:39:40.584618', 51, '2025-12-12 06:39:40.584755', 109, NULL, 'resolved', '2025-12-12 06:39:40.584755')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 06:39:40.585193', 52, '2025-12-12 06:39:40.585329', 109, NULL, 'resolved', '2025-12-12 06:39:40.585329')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[35m (7.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.579557', '2025-12-12 06:39:40.579558')[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 109 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 109 LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 109 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (52, 51, 50)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (21, '2025-12-12 06:39:40.586886', 20, NULL, 'active', 'Third', '2025-12-12 06:39:40.586886')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:39:40.587511' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.587139', '2025-12-12 06:39:40.587140')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.589895', '2025-12-12 06:39:40.589966', '$2a$04$EbURxjh5Fd/yfMdV59WjpOHEMHqq4nmeKL.8K2RZwdr.GUkPP1Y/W', '2025-12-12 06:39:40.589895', 'testuser')[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 21 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.592302', '2025-12-12 06:39:40.592315', '$2a$04$Evo4PqWpKWU0eKdb9mXzhO9xyPqCIApJlbtTDPV1QH8rva0EVATaW', '2025-12-12 06:39:40.592302', 'expertuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.592801', '2025-12-12 06:39:40.592813', '$2a$04$//qRfMRD4iCIEInKPqabuukxyOQGIxikYjmpgLM4ZTgWgDeggyfNy', '2025-12-12 06:39:40.592801', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 21 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.594623', '2025-12-12 06:39:40.594635', '$2a$04$FNaw85rqlUyGFE2YwYFNluzHa5EaI/55caZflBArpPkbBbdUs.Oma', '2025-12-12 06:39:40.594623', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (550.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 111 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.595489', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.595489', 111)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b280f579-3de0-479f-94cf-e59217a1b834) to Test(default) with arguments: 37
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (106.2ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.597092', '2025-12-12 06:39:40.597102', '$2a$04$yMn/sA1z5/Bb5dbaHkhPVucBXTh7YYUcvCE6MlCRBSrsCn2dV48Oy', '2025-12-12 06:39:40.597092', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 112 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 112 LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 112 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.598669', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.598669', 2)[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 96860972-ebef-4146-8d20-873a7c7d5c55) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.600716', '2025-12-12 06:39:40.600730', '$2a$04$4nEJKzLt8WEnWiscG94xA.Zeb073uihBynUwOXC/PeYxADJwwdEJi', '2025-12-12 06:39:40.600716', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.602303', '2025-12-12 06:39:40.602313', '$2a$04$mEUAvkF7wpsGqLiCh0h0dOEJbRc3uZ.IoJyLI7rYaNuEtYGfNj/m2', '2025-12-12 06:39:40.602303', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.603090', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.603090', 23)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 13b72a07-d6dc-42d7-adae-29bfc1f9ca7b) to Test(default) with arguments: 9
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.603596', '2025-12-12 06:39:40.603607', '$2a$04$5up32y8L3hUe6HsRI51fYuhmCk3V38vngppK/9LPzCkRA3XVyIC3i', '2025-12-12 06:39:40.603596', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (5.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.604694', '2025-12-12 06:39:40.604703', '$2a$04$x/J9ReVd36MEovTvWq9IBehCjB62xw/rueKpeL9aodCJcvj/Ul0EC', '2025-12-12 06:39:40.604694', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.605215', '2025-12-12 06:39:40.605224', '$2a$04$NOvK8fa39b0JpcjoAK8azueJnLIaleVdvRCwBSLLv5zGUiyXhAAym', '2025-12-12 06:39:40.605215', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.605162', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.605162')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:39:40.605408', NULL, NULL, NULL, '2025-12-12 06:39:40.605408', 24)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 34991d8e-cedf-4325-813f-cd238fc159a5) to Test(default) with arguments: 10
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 114 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.606006', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.606006', 114)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0966ef66-a5c4-4c3d-b1ef-44db20f39b42) to Test(default) with arguments: 38
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#assignment_history as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:39:40.606037', 22, NULL, 'active', 'Test', '2025-12-12 06:39:40.606037')[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/7/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "7"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 23 LIMIT 1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 7 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (5.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.611820', '2025-12-12 06:39:40.611834', '$2a$04$G.wtW4oClJOi2oaU8ABe.uUKb4bqA4fcSVuZot4sanEG/oz9VppD6', '2025-12-12 06:39:40.611820', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.613474', '2025-12-12 06:39:40.613487', '$2a$04$3gix8omoIkGLhn1Yc1s1Ou7ZfFQIR/AQ9QC6Jy2Wsbx2CjdS7Xx0m', '2025-12-12 06:39:40.613474', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 116 LIMIT 1[0m
  [1m[35m (663.3ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.614504', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.614504', 116)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.614637', '2025-12-12 06:39:40.614648', '$2a$04$.js7pCaest7Cd8oca86xOOK8eQfqB23JeT/IwhXRc1vJdIzgRjC52', '2025-12-12 06:39:40.614637', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 88ba66ff-ba2d-4b5d-9c3f-57b5a4f2ef4a) to Test(default) with arguments: 39
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (116, '2025-12-12 06:39:40.615465', 115, NULL, 'active', 'Test', '2025-12-12 06:39:40.615465')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.615539', '2025-12-12 06:39:40.615599', '$2a$04$RgSWpS69z7RDKHdZIqCaUeSvocVgXDyKRdr1GIvh7lMJHZta3v8Rm', '2025-12-12 06:39:40.615539', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.616053', 53, '2025-12-12 06:39:40.616140', 116, NULL, 'active', '2025-12-12 06:39:40.616140')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.616238', '2025-12-12 06:39:40.616248', '$2a$04$xrpc37OITXGVRogN.wmCyegZ9bDG3Ov7tve.0JMtfymai8mzIDFD6', '2025-12-12 06:39:40.616238', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/53/unclaim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "53"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 26 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 116 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.617057', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.617057', 26)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f0b99f8-9f8b-4ed3-9d86-8a953a4e7a58) to Test(default) with arguments: 11
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 116 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 53 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.617740', '2025-12-12 06:39:40.617750', '$2a$04$qURp2fcTyIX33gR9dScRPu7OXspoIvsYxOIA.E1iLAihbd9Uqn/VO', '2025-12-12 06:39:40.617740', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:39:40.618124' WHERE `conversations`.`id` = 53[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.618776', '2025-12-12 06:39:40.618787', '$2a$04$MicYbITa5VQgy7edrPNoKuQZ4neqsOTwWKV0wpzC8pX.QkIZ0GeXm', '2025-12-12 06:39:40.618776', 'nonexpert')[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 53 AND `expert_assignments`.`expert_id` = 116 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:39:40.619240', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:39:40.619374' WHERE `expert_assignments`.`id` = 5[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 53 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 27 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (36.6ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.625264', '2025-12-12 06:39:40.625275', '$2a$04$9eQKFoiM/engpc0ujEVlA.HcOpBiRiaEW4.x1u.KmwEQD7KOroteu', '2025-12-12 06:39:40.625264', 'expert1')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 117 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.626032', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.626032', 117)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 38f1b034-bec4-4eaa-927f-a3eae903aaaf) to Test(default) with arguments: 40
  [1m[36mExpertProfile Exists? (4.6ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.627519', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.627519', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 87725589-da7b-48a9-a284-9b52600d9403) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (12.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 2, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:39:40.632834' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.633767', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.633767')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
-------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.630426', '2025-12-12 06:39:40.630428')[0m
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.635901', '2025-12-12 06:39:40.635915', '$2a$04$JH63Pg875gw6Er0tWoQPPOnakBaSz.c8zLGN7Bq0w7dWHB9XPiHNe', '2025-12-12 06:39:40.635901', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.636064', '2025-12-12 06:39:40.636079', '$2a$04$KOkAC7MANNV/x1xOx3N.8.y.pHx6zF/WVHnw2fc4EAqVy7vrin1AW', '2025-12-12 06:39:40.636064', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 118 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.636880', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.636880', 118)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.637096', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.637096', 28)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 14797cd3-3a2f-44d4-89e5-583f0068e28b) to Test(default) with arguments: 41
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.636968', 1, '2025-12-12 06:39:40.637080', 2, NULL, 'active', '2025-12-12 06:39:40.637080')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: adb3ad12-56a8-41cb-82c4-be721a25356a) to Test(default) with arguments: 12
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 2.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.637574' WHERE `expert_profiles`.`id` = 41[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d679fd81-50f8-41fc-8e24-f54db8634ceb) to Test(default) with arguments: 41
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.635758', '2025-12-12 06:39:40.635759')[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.638291', '2025-12-12 06:39:40.638370', '$2a$04$y/zgcsotqXjQ6BirYDt9vuCq87DxkfH4kOg1m0da2CqDZ64Lf/WP6', '2025-12-12 06:39:40.638291', 'testuser')[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (449.1ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.640670', '2025-12-12 06:39:40.640685', '$2a$04$6qoJuqC9uJgAL1n4dRRI3uf1UbsS6lREy.O7IsB8d9fGfy6kE2kHW', '2025-12-12 06:39:40.640670', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.643948', '2025-12-12 06:39:40.643959', '$2a$04$qqw/zBnUWm9vjAP76VbyFu2M6mB6DEIJyOOYkia2Xrym.2k240GCG', '2025-12-12 06:39:40.643948', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 119 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.644562', '2025-12-12 06:39:40.644579', '$2a$04$0r5vUrYaEzty9qyrfnXGuesdQBY0YKQG.NIVjWCZLMW9plagfK4Ca', '2025-12-12 06:39:40.644562', 'expert3')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.644745', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.644745', 119)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 711ccdd3-d321-41f2-83e2-a7e3259156be) to Test(default) with arguments: 42
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.645596', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.645596', 3)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d93256de-18fc-4c92-8193-567ec6b04fdf) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:39:40.646501', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.646501', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.647017' WHERE `expert_profiles`.`id` = 2[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a9bad8f7-81d2-4189-9b7c-1f130b9eff79) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:39:40.651839', 1, NULL, 'waiting', 'Test', '2025-12-12 06:39:40.651839')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:39:40 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 2, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:39:40.660322' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (4.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:39:40.668565', '2025-12-12 06:39:40.668657', '$2a$04$uNsaxBnGN2iVCB4tZr4Y6eMtDIiMWlZcDBLQEFCxsuW2gQxFpE9ga', '2025-12-12 06:39:40.668565', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:39:40.670990', 1, '2025-12-12 06:39:40.671101', 2, NULL, 'active', '2025-12-12 06:39:40.671101')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 0.1ms | ActiveRecord: 7.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[35m (1264.0ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:39:40.675066', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:39:40.675066', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 309f3e11-b9d9-411d-bd27-480de0aacb5c) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:39:40.676708' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 854ab244-a600-411c-bdaf-c37b064df1a6) to Test(default) with arguments: 1
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (90.5ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (4.2ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (105.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.717169', '2025-12-12 06:39:40.717171')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.5ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.722003', '2025-12-12 06:39:40.722004')[0m
  [1m[35m (539.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_7f927086d2`
FOREIGN KEY (`conversation_id`)
  REFERENCES `conversations` (`id`)
[0m
  [1m[35m (499.2ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (56.1ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.774114', '2025-12-12 06:39:40.774117')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (4.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.780139', '2025-12-12 06:39:40.780139')[0m
  [1m[35m (164.5ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (489.7ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (45.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (5.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:40.867422', '2025-12-12 06:39:40.867424')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:40.872512', '2025-12-12 06:39:40.872513')[0m
  [1m[35m (326.6ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (179.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (196.5ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (105.8ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (4.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (9.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (9.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (4.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (720.8ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[35m (55.0ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (9.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (37.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (5.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (5.7ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (34.5ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (327.4ms)[0m  [1m[35mALTER TABLE `messages` ADD CONSTRAINT `fk_rails_b8f26a382d`
FOREIGN KEY (`sender_id`)
  REFERENCES `users` (`id`)
[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (6.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Create (5.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.000874', '2025-12-12 06:39:41.000875')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (7.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.007823', '2025-12-12 06:39:41.007824')[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[35m (5.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[35m (52.3ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (31.7ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (5.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.022925', '2025-12-12 06:39:41.022926')[0m
  [1m[35m (6.1ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (31.2ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.9ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.027339', '2025-12-12 06:39:41.027340')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.1ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.029708', '2025-12-12 06:39:41.029710')[0m
  [1m[35m (6.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES (20251205114001)[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.035622', '2025-12-12 06:39:41.035623')[0m
  [1m[35m (5.9ms)[0m  [1m[32mINSERT INTO `schema_migrations` (version) VALUES
(20251110080001),
(20251110075234),
(20251110075132),
(20251110074717),
(20251110074526),
(20251110074123),
(20251110064102);[0m
  [1m[35m (43.2ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.2ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.047716', '2025-12-12 06:39:41.047717')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (6.8ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.052324', '2025-12-12 06:39:41.052324')[0m
  [1m[35m (29.8ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.4ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.059924', '2025-12-12 06:39:41.059926')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.3ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.064777', '2025-12-12 06:39:41.064778')[0m
  [1m[35m (27.4ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.0ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'test', '2025-12-12 06:39:41.076092', '2025-12-12 06:39:41.076096')[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Create (3.3ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('schema_sha1', '4739a768217d339f841c9b589dbc10128b48bd95', '2025-12-12 06:39:41.080597', '2025-12-12 06:39:41.080598')[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:39:41 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 20 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (6.9ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.6ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.4ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[36mActiveRecord::InternalMetadata Load (10.2ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (16.9ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mActiveRecord::InternalMetadata Load (31.7ms)[0m  [1m[34mSELECT * FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'schema_sha1' ORDER BY `ar_internal_metadata`.`key` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT @@FOREIGN_KEY_CHECKS[0m
  [1m[35m (0.0ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 0[0m
  [1m[36mTruncate Tables (1201.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_no_knowledge_base_links_are_provided
-------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.516881', '2025-12-12 06:43:22.516970', '$2a$04$AT.Uog4eKEHxYSkPr./5tewS6XTSgMmcwPJaljj/aBjfHHNXRSNxa', '2025-12-12 06:43:22.516881', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.523332', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.523332', 1)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f2f301d-4b08-4263-a1c7-629837b61b8f) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.530362' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1a19afb0-42b2-402b-a6ba-bbbcf0c1870d) to Test(default) with arguments: 1
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTruncate Tables (1222.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ExpertFaqServiceTest: test_scrapes_links_and_returns_LLM_output
---------------------------------------------------------------
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
ExpertFaqServiceTest: test_returns_fallback_when_scraping_yields_no_content
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.547694', '2025-12-12 06:43:22.547804', '$2a$04$6S8mTdEHzLtz6Spyc07SfugUz4U/gUI0Ro3a9tKr6icKcda0cWHYm', '2025-12-12 06:43:22.547694', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (17.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert1' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.553913', '2025-12-12 06:43:22.553928', '$2a$04$dYVlB/.6FNz.F49xp6jbE.eEolv2xjzEw50NQfAPIXCh82vKQnVge', '2025-12-12 06:43:22.553913', 'expert1')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.555123', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.555123', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e0248fac-519f-4ae9-b071-a8cb6b1bda09) to Test(default) with arguments: 2
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 1 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.558668', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.558668', 1)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
ExpertProfileTest: test_does_not_enqueue_FAQ_generation_when_unrelated_attributes_change
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.564605', '2025-12-12 06:43:22.564617', '$2a$04$/xdxWr41acYT2S3pyHVVo.Ilo7E6wDCsQvnd7oluKMsbCloWbDmwG', '2025-12-12 06:43:22.564605', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 3 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0c179ea6-1f8b-4dfd-9fb5-9dfedb6f6494) to Test(default) with arguments: 1
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.565552', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.565552', 3)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6647b019-829a-424a-a62e-54fffa7d35b7) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'New bio', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.566185' WHERE `expert_profiles`.`id` = 3[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_when_knowledge_base_links_change
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.577429', '2025-12-12 06:43:22.577440', '$2a$04$.2fI/oYdny63FUkB//zAR.5mCU2qHe2noO7tXHJCfsdiEhBt2/E1S', '2025-12-12 06:43:22.577429', 'expert3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.578254', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.578254', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b2e1b88d-7f4e-444f-8127-392933a8e3ab) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Update (0.2ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`knowledge_base_links` = '[\"https://example.com/updated\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.578792' WHERE `expert_profiles`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 441565f6-4109-425a-9c0a-745160299a76) to Test(default) with arguments: 4
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ExpertProfileTest: test_enqueues_FAQ_generation_on_create
---------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert3' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.586655', '2025-12-12 06:43:22.586664', '$2a$04$N95DO6smr4.7Ijz3Le4/YOzUp0vvtifNG4vulPcDYUVfs6O9kVm8C', '2025-12-12 06:43:22.586655', 'expert3')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (19.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.587600', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.587600', 5)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: eb48b393-b742-4731-9e7f-bba4baf7d943) to Test(default) with arguments: 5
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
CookieConfigurationTest: test_login_sets_session_cookie_with_correct_SameSite_attribute
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
CookieConfigurationTest: test_session_configuration_uses_lax_SameSite_for_development_environment
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.600861', '2025-12-12 06:43:22.600876', '$2a$04$/kbjMK7saIuBPSsLiIR0FeFrhFI9Egyh45mJx0.1mJeg06.04qrkW', '2025-12-12 06:43:22.600861', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.603354', '2025-12-12 06:43:22.603368', '$2a$04$eyHl5y6pd2TjnOGpdbSI5uaSZMvjTvwi4kDRq9k5cgetZp93H3kba', '2025-12-12 06:43:22.603354', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
CookieConfigurationTest: test_session_cookie_works_with_cross-origin_requests
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.608769', '2025-12-12 06:43:22.608779', '$2a$04$4eZb2cglV2stCK2Ma6aCkuJGvtAuncOvgzQM6G2D3BHni4vYyGNUq', '2025-12-12 06:43:22.608769', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1312.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by AuthController#login as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
----------------------------------------------------------------------------------
CookieConfigurationTest: test_register_sets_session_cookie_with_correct_attributes
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.632013', `users`.`updated_at` = '2025-12-12 06:43:22.632990' WHERE `users`.`id` = 2[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 3.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.637289', `users`.`updated_at` = '2025-12-12 06:43:22.638168' WHERE `users`.`id` = 7[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 2.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1339.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (4.1ms)[0m  [1m[31mROLLBACK[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#me as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_authentication
------------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.645327', '2025-12-12 06:43:22.645339', '$2a$04$3dhb0s8KPlD58HZm70Tp3.SU/wdghSOBSDSKoC5erj.EsY1ih1XMy', '2025-12-12 06:43:22.645327', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.646841', '2025-12-12 06:43:22.646851', '$2a$04$d7Sx5RBziW1SEsUK7efZDuaahTqPB1GhAlBbx/j8oOBsYsgrLzLaa', '2025-12-12 06:43:22.646841', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.647646', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.647646', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: afdb120f-3812-4972-923e-19f74b142aaf) to Test(default) with arguments: 2
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_expert_profile
----------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_updates_expert_profile
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.650942', '2025-12-12 06:43:22.650954', '$2a$04$ZcoZu40FE02HHW0JxKeLsOuHV6biuojket5aiJ/GY60DMhufhAi7O', '2025-12-12 06:43:22.650942', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.652411', '2025-12-12 06:43:22.652420', '$2a$04$i0bgjxnQz/Q4hY5TztxETO87CEH7rCeFsvoysnmoxYSqNxjbzR3q6', '2025-12-12 06:43:22.652411', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.653413', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.653413', 9)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.653281', 3, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.653281')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: fe072648-21a3-46a6-83a6-660dcd32f485) to Test(default) with arguments: 6
Started POST "/expert/conversations/1/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.655500', '2025-12-12 06:43:22.655515', '$2a$04$glkmfDA3vU6cwK2uB1Pfru1kttLH2ZPt4p2SNrTRR1PpCVr8DUKSm', '2025-12-12 06:43:22.655500', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#queue as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_assigned_conversations_by_updated_at_descending
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_returns_assignment_history
---------------------------------------------------------------------------
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.661826', '2025-12-12 06:43:22.661841', '$2a$04$foONGMZHwGTo06yMLqlfn.Vrc4SBkY3rPXLSxgwkmSZSgW0USTF.q', '2025-12-12 06:43:22.661826', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.663083', '2025-12-12 06:43:22.663095', '$2a$04$LTlKzcHtPAlg3He2uS.iae0iDDIDqyA8zirKJogCuvej8L1.lAHeO', '2025-12-12 06:43:22.663083', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.663386', '2025-12-12 06:43:22.663396', '$2a$04$/1qfH5b1P6TSsEDKFsYRcePFk6HikzAQ3CO2cyKb37YZE5XRBLyRa', '2025-12-12 06:43:22.663386', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.664275', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.664275', 6)[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ed2c49cd-c0d3-4028-8f89-900a94f8a8a3) to Test(default) with arguments: 3
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.664632', '2025-12-12 06:43:22.664641', '$2a$04$9wrzvoHziH6ZGxWWtEDc4e.y379X3FlqCieZxdp8nGs0hdKvlfyqS', '2025-12-12 06:43:22.664632', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.665059', 5, NULL, 'active', 'First', '2025-12-12 06:43:22.665059')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.665447', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.665447', 12)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ab3229df-83c1-4f19-bade-a5186bc1491e) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.668802', '2025-12-12 06:43:22.668865', '$2a$04$ePkpODesvyQCyueueZw0I.prIVHeNJyDKmLAy9yKutQu8a/LBzMpq', '2025-12-12 06:43:22.668802', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.670916', 11, NULL, 'active', 'Test', '2025-12-12 06:43:22.670916')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.675215', 1, '2025-12-12 06:43:22.675308', 12, '2025-12-12 06:43:22.672006', 'resolved', '2025-12-12 06:43:22.675308')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.675965', 5, NULL, 'active', 'Second', '2025-12-12 06:43:22.675965')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertAssignment Load (0.2ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 12 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.686032', '2025-12-12 06:43:22.686046', '$2a$04$xjimusJDbyivlyTnXeMgDeCzbP/4SJyCMMltTxO90p4j4qrtVOms2', '2025-12-12 06:43:22.686032', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.686808', 5, NULL, 'active', 'Third', '2025-12-12 06:43:22.686808')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:43:22.687491' WHERE `conversations`.`id` = 2[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.688026', '2025-12-12 06:43:22.688037', '$2a$04$HPlG1SXrG4vOWef64nly2.ZETxr0OWKK2GSr9vrzEcDukmbtQJkFu', '2025-12-12 06:43:22.688026', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.688880', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.688880', 14)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 0b13eb1b-f5ee-428f-9a41-05b353b25fcb) to Test(default) with arguments: 8
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.688846', '2025-12-12 06:43:22.688905', '$2a$04$bfvM21qLVPaIG7q6JM2sHeLfXG0Sce0.QMXcCtJAnSiGsjs0eESTC', '2025-12-12 06:43:22.688846', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.690912', '2025-12-12 06:43:22.690922', '$2a$04$D2FXb5wi07gZMPXn0vlbMONGrmYsrUZI7SCXatViVTncTorzHxod6', '2025-12-12 06:43:22.690912', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.691465', '2025-12-12 06:43:22.691475', '$2a$04$asu92aTJSRVIzSXmalWBcOr6KdJO23AjzAivHDLxbGxN2PKqyOZFm', '2025-12-12 06:43:22.691465', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#register as HTML
  Parameters: {"username" => "newuser", "password" => "[FILTERED]"}
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTruncate Tables (1396.1ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 2.0ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.697587', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.697587', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.698373', '2025-12-12 06:43:22.698390', '$2a$04$6RM1cSf0mYmpKReMWnKDROlUlhm0h/l78VOvWEgLvr/1dVvDkQzOK', '2025-12-12 06:43:22.698373', 'newuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 82e342a8-b552-4937-97d0-df5dce54fe15) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ExpertTest: test_GET_/expert/queue_requires_authentication
----------------------------------------------------------
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-----------------------------------------------------------
ExpertTest: test_GET_/expert/profile_returns_expert_profile
-----------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.701270', '2025-12-12 06:43:22.701283', '$2a$04$wk2DfOxwusqhMsiMNmbNd.9SjUFfPz/RLaFoYYePZrsdhmNfDD7TG', '2025-12-12 06:43:22.701270', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.702501', '2025-12-12 06:43:22.702513', '$2a$04$NJfKebtkF7wx6KHGMAEPVuhvU8m1KqmndOus03gRwSARd1fpGDgsK', '2025-12-12 06:43:22.702501', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.702889', '2025-12-12 06:43:22.702906', '$2a$04$GnPer6ID6CqDt0KYv37Bs.NPlLDYvloB7tinTdwXTjCSuwm9hG7B.', '2025-12-12 06:43:22.702889', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 17 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.703804', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.703804', 17)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.703966', '2025-12-12 06:43:22.703975', '$2a$04$.sC9PiP/X37zEKZloAW8WeRF882SH84nHLFhXStfyQ1jEKsE8k7kS', '2025-12-12 06:43:22.703966', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 59a08352-0084-4bc6-b92e-b54bf57dec06) to Test(default) with arguments: 9
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
Processing by ExpertController#queue as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.704792', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.704792', 8)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.704784', NULL, NULL, NULL, '2025-12-12 06:43:22.704784', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 101257a5-be21-458f-b1ef-c6a7e16e73eb) to Test(default) with arguments: 4
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 614d2489-2802-4699-8e5b-2ceb02fdcd62) to Test(default) with arguments: 1
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#profile as HTML
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
-----------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_returns_waiting_and_assigned_conversations
-----------------------------------------------------------------------------
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_claims_conversation
--------------------------------------------------------------------------------------
Completed 201 Created in 15ms (Views: 0.1ms | ActiveRecord: 3.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_expert_profile
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.710453', '2025-12-12 06:43:22.710466', '$2a$04$11sSEigGUtBbZxzcHOX8RudG5RN09sq1uLpSs2H96nuQJmSEVGe0e', '2025-12-12 06:43:22.710453', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.711663', '2025-12-12 06:43:22.711674', '$2a$04$55K0lt52nK/QVKp5AK4stOwjKz4cTsamvEPPQfyI.cI8X1Us8rHMO', '2025-12-12 06:43:22.711663', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.712182', '2025-12-12 06:43:22.712193', '$2a$04$7Pt9FK0fCt8S3mQsh1hrS.kYeVf.m7j5eX3mLeZ/yT6V/WOcJMIkG', '2025-12-12 06:43:22.712182', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.713144', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.713144', 19)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.713290', '2025-12-12 06:43:22.713301', '$2a$04$78RbrFGjTyt2g7qb2CCNO.0bQthaG/iwH1vjSV5oFrQ4vB7nYX5Oi', '2025-12-12 06:43:22.713290', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 76103ca0-73a5-4b34-b51b-1e8568aae337) to Test(default) with arguments: 10
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.714010', 18, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.714010')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.714209', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.714209', 10)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: da6e24d5-b625-4e86-a5da-fdedde068947) to Test(default) with arguments: 5
Started POST "/expert/conversations/2/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 19 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.715960', '2025-12-12 06:43:22.715972', '$2a$04$d226O2jvxY2FKGB/iR3jnOIoyZLH92bzLWb5ZOssU1bBREyPNX5Ri', '2025-12-12 06:43:22.715960', 'nonexpert')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 19, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:43:22.716531' WHERE `conversations`.`id` = 2[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.717316', 2, '2025-12-12 06:43:22.717426', 19, NULL, 'active', '2025-12-12 06:43:22.717426')[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_unclaims_conversation
------------------------------------------------------------------------------------------
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.0ms | ActiveRecord: 1.1ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.719423', '2025-12-12 06:43:22.719439', '$2a$04$JfWO8FIzYzjDhSfJshTo6.jgQmWIgNXyR/x4gJZfBd4mLQGFVPll6', '2025-12-12 06:43:22.719423', 'testuser')[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_creates_expert_assignment
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.721125', '2025-12-12 06:43:22.721138', '$2a$04$OpEojFpqUBAqu2e2/3Dh6ennDGqxhfSK1SiLaqi.qTnNt713QQYpi', '2025-12-12 06:43:22.721125', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.722032', '2025-12-12 06:43:22.722042', '$2a$04$tBe/xkleSa.6vyRRgVCJTuGnxCpqgSeqLiyhYHTs.B4jQJ0vR/rd6', '2025-12-12 06:43:22.722032', 'testuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.722021', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.722021', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4a3aa97b-bfbb-4ccf-99e2-07abc5509db2) to Test(default) with arguments: 2
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Updated bio", "knowledge_base_links" => ["https://newlink.com"]}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_fails_if_not_assigned_to_user
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.723514', '2025-12-12 06:43:22.723523', '$2a$04$Ld6arwArYcsngad1MN043.7RwsnzJT0VcGt/K4rgCep5NQiOsu.kO', '2025-12-12 06:43:22.723514', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.724403', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.724403', 13)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ad56452c-131e-4e0b-b400-fcf609b1ef66) to Test(default) with arguments: 6
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.724884', '2025-12-12 06:43:22.724905', '$2a$04$NfGbMB6ZSdz9udG/s0SUEO2Lose64WoCaFJLo3z1Q36th2ryh5ISa', '2025-12-12 06:43:22.724884', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.725104', 12, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.725104')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.726554', '2025-12-12 06:43:22.726564', '$2a$04$d7yQVuwtYLzPiSSoON6CVuZp3N.6/ndig/ejcWSF2Ya1AZNQH3U.K', '2025-12-12 06:43:22.726554', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.727439', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.727439', 21)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 04e751fa-d1fc-4bd4-84e6-4adcd6376fdb) to Test(default) with arguments: 11
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Count (2.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
Started POST "/expert/conversations/5/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "5"}
  [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`bio` = 'Updated bio', `expert_profiles`.`knowledge_base_links` = '[\"https://newlink.com\"]', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.728659' WHERE `expert_profiles`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.729108', '2025-12-12 06:43:22.729118', '$2a$04$w4dUP3cZTh/ORqgi6eyxCOC6sRJjQbvAOMATkrLMOeuM6k/JKTGwe', '2025-12-12 06:43:22.729108', 'otherexpert')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 560ebedd-2710-49ec-9a29-c83334e0c70b) to Test(default) with arguments: 1
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:43:22.729959', NULL, NULL, NULL, '2025-12-12 06:43:22.729959', 22)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 05069e0c-0667-4900-83e5-2f1e46301da2) to Test(default) with arguments: 12
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = 13, `conversations`.`status` = 'active', `conversations`.`updated_at` = '2025-12-12 06:43:22.730222' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.730655', 20, NULL, 'active', 'Test', '2025-12-12 06:43:22.730655')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/3/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.731007', 3, NULL, 'active', 'Test', '2025-12-12 06:43:22.731007')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "3"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 21 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 3 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.733826', 5, '2025-12-12 06:43:22.733957', 13, NULL, 'active', '2025-12-12 06:43:22.733957')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.0ms | ActiveRecord: 1.9ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertAssignment Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_assignments`[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` ORDER BY `expert_assignments`.`id` DESC LIMIT 1[0m
  [1m[36mTruncate Tables (1436.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (7.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.737765', 1, '2025-12-12 06:43:22.737870', 4, NULL, 'active', '2025-12-12 06:43:22.737870')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/queue_orders_waiting_conversations_by_created_at_ascending
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_fails_if_already_assigned
--------------------------------------------------------------------------------------------
------------------------------------------------------------
ExpertTest: test_GET_/expert/profile_requires_authentication
------------------------------------------------------------
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.740539', '2025-12-12 06:43:22.740550', '$2a$04$whFquZKzWsbY1ZJQ9whulOQmxSh3fZBGQ0zpjVuAyIyiQ7OB3ksM.', '2025-12-12 06:43:22.740539', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.740601', '2025-12-12 06:43:22.740612', '$2a$04$mDrpELFW2jzfFytedJ7Ta.RyFu0KFeprTer7OyBJGsB0Ae0MqMqcK', '2025-12-12 06:43:22.740601', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.741121', '2025-12-12 06:43:22.741141', '$2a$04$w3Cj0My6b9LUIrj8dT7Xou2w1cIvNd08Ec/EnV7Q9lgPbu/ebakRG', '2025-12-12 06:43:22.741121', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:43:22.741779' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742143', '2025-12-12 06:43:22.742152', '$2a$04$qQrJ7lowoxd2yWkyQgES/e32GR7V8tScJaKBjmPaosOJptNlBBjIq', '2025-12-12 06:43:22.742143', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742208', '2025-12-12 06:43:22.742218', '$2a$04$huM2B8njMSUEfnIzNqzOQu2KeMCeZJ6cJU/4W5989FBO3/IBS3uUm', '2025-12-12 06:43:22.742208', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.742878', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.742878', 24)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.742830', '2025-12-12 06:43:22.742843', '$2a$04$95aQifsK2dbK16ZByEmejejb81EeSjqgvhqX3vA6VGchsfHCiAYJy', '2025-12-12 06:43:22.742830', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.743007', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.743007', 15)[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b0abda24-3280-4ab7-8991-a1a540316128) to Test(default) with arguments: 13
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c5090bff-5efa-4bd6-82ca-7776e30da95a) to Test(default) with arguments: 7
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 1 AND `expert_assignments`.`expert_id` = 4 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.743697', 14, NULL, 'waiting', 'First', '2025-12-12 06:43:22.743697')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.743815', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.743815', 4)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:43:22.743595', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:43:22.743762' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5f518aac-276f-4681-8538-820822e52739) to Test(default) with arguments: 2
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otherexpert' LIMIT 1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.744489', '2025-12-12 06:43:22.744498', '$2a$04$fH/GvsNvhLp1.hPtxp4BL.BfEEaCa3EvIFlPghTZJL9ylbxD0shwS', '2025-12-12 06:43:22.744489', 'otherexpert')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by ExpertController#profile as HTML
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 25 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTruncate Tables (1445.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Other expert', '2025-12-12 06:43:22.745280', NULL, NULL, NULL, '2025-12-12 06:43:22.745280', 25)[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7c751f30-e3d9-4f1d-9a51-f5a78935281a) to Test(default) with arguments: 14
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (25, '2025-12-12 06:43:22.746008', 23, NULL, 'active', 'Test', '2025-12-12 06:43:22.746008')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/expert/conversations/4/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "4"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 24 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
---------------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_updates_assignment_to_resolved
---------------------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 24 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
Completed 422 Unprocessable Content in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.747866', '2025-12-12 06:43:22.747937', '$2a$04$IQxvI6N.MqvQJSPzaU6Zj.JO9pYomhpAUtM.ATMtMWi19OjmM9H1i', '2025-12-12 06:43:22.747866', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_orders_by_assigned_at_descending
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/claim_requires_expert_profile
------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750547', '2025-12-12 06:43:22.750558', '$2a$04$FUqUxDty2Q/xFcHwQh/7HucPdw.UirCI.CJzBvTe8cxg3jVgJfXlO', '2025-12-12 06:43:22.750547', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750840', '2025-12-12 06:43:22.750853', '$2a$04$1paChwyDF4UXnTEmS9.9U.Nhxk5eu7y2yqbpZAoUAguehhrjwYFkG', '2025-12-12 06:43:22.750840', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.750918', '2025-12-12 06:43:22.750930', '$2a$04$IeP3FlYOy6QXa2wevaTa2OXOjcP3jqpbrEwt/JwEUDXXLagGFEsJ.', '2025-12-12 06:43:22.750918', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------
ExpertTest: test_PUT_/expert/profile_requires_expert_profile
------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.752135', '2025-12-12 06:43:22.752144', '$2a$04$2NMFXsaFIM2cDlzDEbNzeOs0/dNEYkvRSL14/5ScVgbMGS2083zjm', '2025-12-12 06:43:22.752135', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.752377', '2025-12-12 06:43:22.752387', '$2a$04$vqBocly29EYd6vK1WfKvOudAg.jrwuqRH.Cn5otJ7yXgpnhS3WQfK', '2025-12-12 06:43:22.752377', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.753152', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.753152', 6)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.753252', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.753252', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.753449', '2025-12-12 06:43:22.753462', '$2a$04$puVbFpr17kqvz8sPApzsMeRE.Wc//7EI0ZFXT4zhl/IV11DUulNW6', '2025-12-12 06:43:22.753449', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5a80642f-2f2f-4f34-8e91-69b5b1d50034) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 00f51c19-0ab7-4ef8-9d47-6d63c0cd0b00) to Test(default) with arguments: 3
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------
ExpertTest: test_POST_/expert/conversations/:conversation_id/unclaim_requires_authentication
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.754428', 14, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.754428')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.754942', '2025-12-12 06:43:22.754952', '$2a$04$iTpwS0c0QcLTjzWBpqhjxe94ZiXH3KkPpvr91rUqxzbUs5RvzvBsi', '2025-12-12 06:43:22.754942', 'expertuser')[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.755361', '2025-12-12 06:43:22.755375', '$2a$04$6ySreqLNbJZGvHU0Aw0iBe4DauMXQW2fKs7l1OjXd6zkMM6n.pXLy', '2025-12-12 06:43:22.755361', 'nonexpert')[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 27 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.755750', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.755750', 27)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: deda0617-8870-40ad-9c4a-b3d17a781e51) to Test(default) with arguments: 15
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.756404', 5, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.756404')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/2/claim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'nonexpert' LIMIT 1[0m
Processing by ExpertController#claim as HTML
  Parameters: {"conversation_id" => "2"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.757381', '2025-12-12 06:43:22.757390', '$2a$04$HrzEmIlDGakKJFkeSXf9g.OcFi7FI5PCm5bjuv.oxEKSOTSCcclzK', '2025-12-12 06:43:22.757381', 'nonexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 7 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 28 LIMIT 1[0m
  [1m[36mCACHE ExpertProfile Load (0.0ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 28 LIMIT 1[0m
Filter chain halted as :ensure_expert! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.760425', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.760425', 2)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1460.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: da09e945-5482-47c4-acdb-a7313c8214ec) to Test(default) with arguments: 1
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
ExpertTest: test_PUT_/expert/profile_requires_authentication
------------------------------------------------------------
----------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_creates_a_new_conversation
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------------
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.763653', 5, NULL, 'resolved', 'First', '2025-12-12 06:43:22.763653')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.764642', 5, NULL, 'resolved', 'Second', '2025-12-12 06:43:22.764642')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.765283', '2025-12-12 06:43:22.765296', '$2a$04$oUsntTjQBDcha70Ay0abEuV4MRc06ULKe/EpkFV34lEyZCCbLWpQm', '2025-12-12 06:43:22.765283', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.765446', '2025-12-12 06:43:22.765462', '$2a$04$W9SM1xs2B/HW8E1UHFJSDeu.MXk6nMXoCRhkllYs8QG0e6bru4b9G', '2025-12-12 06:43:22.765446', 'testuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.765460', 5, NULL, 'resolved', 'Third', '2025-12-12 06:43:22.765460')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.765392', 14, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.765392')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by ExpertController#queue as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.767030', '2025-12-12 06:43:22.767041', '$2a$04$f4EZIRuTfDef6Vban3lG/.SgrVYZ1I/pvZspCccsxOnO4Tcp/c7NC', '2025-12-12 06:43:22.767030', 'expertuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 15 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 9 LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.767923', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.767923', 9)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 29 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 18f5a40a-76fd-4e04-b2ac-0e5db8fc591c) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.768415', 29, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.768415')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
Started PUT "/expert/profile" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.768770', 1, NULL, 'waiting', 'Waiting Conversation', '2025-12-12 06:43:22.768770')[0m
Processing by ExpertController#update_profile as HTML
  Parameters: {"bio" => "Test"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.769621', 1, NULL, 'active', 'Assigned Conversation', '2025-12-12 06:43:22.769621')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 14 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 15 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 15 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 29 AND `messages`.`is_read` = FALSE[0m
Completed 201 Created in 5ms (Views: 0.1ms | ActiveRecord: 1.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
ExpertTest: test_GET_/expert/assignments/history_requires_authentication
------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-09 06:43:22.766859', 1, '2025-12-12 06:43:22.775172', 6, NULL, 'resolved', '2025-12-12 06:43:22.775172')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_assignedExpertUsername_when_expert_is_assigned
--------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_returns_specific_conversation
----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.3ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-10 06:43:22.775918', 2, '2025-12-12 06:43:22.776120', 6, NULL, 'resolved', '2025-12-12 06:43:22.776120')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (0.2ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-11 06:43:22.776760', 3, '2025-12-12 06:43:22.776983', 6, NULL, 'resolved', '2025-12-12 06:43:22.776983')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
ConversationsTest: test_GET_/conversations_includes_null_assignedExpertUsername_when_no_expert_assigned
-------------------------------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.777637', '2025-12-12 06:43:22.777653', '$2a$04$ePTZJp3sEs5Y0YhHOY6YAurOhz1EUD8OocYPPt0Mt6K7BTWzFiFDC', '2025-12-12 06:43:22.777637', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#assignment_history as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.777966', '2025-12-12 06:43:22.777986', '$2a$04$Ufi5NPec0XjX/bte6MPFAOJMaL9UZN6.fD6zpjR0Pbna7vw2WiZ3y', '2025-12-12 06:43:22.777966', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.778828', 10, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.778828')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.779086', '2025-12-12 06:43:22.779106', '$2a$04$xgGVAeLF.1vqs6B/DSB9r.mbS91rYul0hYppFdQwA9Vnbkwu8iB1m', '2025-12-12 06:43:22.779086', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.779543', '2025-12-12 06:43:22.779555', '$2a$04$P3UULohcd0txkRyTvDibNuFmiTXC.DCnuvfPF5XCAMfzuuHGrrwDe', '2025-12-12 06:43:22.779543', 'expertuser')[0m
Started GET "/conversations/3" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.779928', 16, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.779928')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`expert_id` = 6 ORDER BY `expert_assignments`.`assigned_at` DESC[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 31 LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "3"}
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.780666', NULL, NULL, '[]', '2025-12-12 06:43:22.780666', 31)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b2958dd9-7234-4aa6-a944-386e73eca940) to Test(default) with arguments: 16
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
Processing by ConversationsController#index as HTML
Started GET "/expert/queue" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 10 OR `conversations`.`assigned_expert_id` = 10) AND `conversations`.`id` = 3 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (31, '2025-12-12 06:43:22.781593', 30, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.781593')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` IN (3, 2, 1)[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
Processing by ConversationsController#index as HTML
  [1m[36mConversation Load (1.0ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 16 OR `conversations`.`assigned_expert_id` = 16) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 30 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 30 OR `conversations`.`assigned_expert_id` = 30) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 16 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 30 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.2ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 31 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 30 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.8ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_response_includes_questionerUsername
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_authentication
-------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.788347', '2025-12-12 06:43:22.788366', '$2a$04$Q7Py35cVNYuaCCP9iAUviOb7bONnXBy2IIbwYGT1RMfpUovmv26Te', '2025-12-12 06:43:22.788347', 'testuser')[0m
ConversationsTest: test_GET_/conversations_requires_authentication
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-----------------------------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_includes_questionerUsername_and_assignedExpertUsername
-----------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test Conversation"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.790104', '2025-12-12 06:43:22.790118', '$2a$04$AIxG5RU.Hkuc691ki4edGuWj8FZqdODXcCSsKByLxxQzze9wPJTLq', '2025-12-12 06:43:22.790104', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
Processing by ConversationsController#index as HTML
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.790974', '2025-12-12 06:43:22.790996', '$2a$04$n7A3nQNKBdpOsOxUQVqs1u3DphZa7M4BmZo9eeXjVbIVmTSWGCDVe', '2025-12-12 06:43:22.790974', 'testuser')[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.791115', '2025-12-12 06:43:22.791132', '$2a$04$2/Kh/mM8iCBDM9xDi0y34ebGvSQKfU3r8HpeX99Lla8Ob7iuoG9n6', '2025-12-12 06:43:22.791115', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.791223', 7, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.791223')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  Parameters: {"title" => "Test"}
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser2' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.792886', '2025-12-12 06:43:22.792905', '$2a$04$RQ./K73k6AzOsB9jI0C79egiccwzieeQ1JWP94jXnc2cy9q2e7Via', '2025-12-12 06:43:22.792886', 'expertuser2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.792925', '2025-12-12 06:43:22.793004', '$2a$04$1nv2KZVOmRTpLidNVvnl..Q50uoLegRtN.X//J7/rr/MvJhXKHWBC', '2025-12-12 06:43:22.792925', 'testuser')[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.793866', NULL, NULL, '[]', '2025-12-12 06:43:22.793866', 12)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 5c797255-45b4-414f-868a-a8d5fc12faa9) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by ExpertController#queue as HTML
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 7 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.794668', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.794668')[0m
Completed 201 Created in 5ms (Views: 0.1ms | ActiveRecord: 1.9ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started GET "/conversations/4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.3ms)[0m  [1m[31mROLLBACK[0m
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "4"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.795901', '2025-12-12 06:43:22.795920', '$2a$04$39agzbi24KPwo8lmeEvq9e1RnS5RBPfW0OAI2jZFHFIttjv14.TYe', '2025-12-12 06:43:22.795901', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.795514', '2025-12-12 06:43:22.795569', '$2a$04$itMcNancEu0RtxxWhIEMoutzEIthMmBD1uNC.hlPpCgM3ilLbnC2y', '2025-12-12 06:43:22.795514', 'testuser')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 11 OR `conversations`.`assigned_expert_id` = 11) AND `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
ConversationsTest: test_POST_/conversations_requires_title
----------------------------------------------------------
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
-----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_returns_user's_conversations
-----------------------------------------------------------------------
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
ConversationsTest: test_GET_/conversations/:id_requires_user_to_own_conversation
--------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.798089', '2025-12-12 06:43:22.798102', '$2a$04$xncTDlBDRd2S/J4tJfW7H./kiR64xpg3e221Kh4PyR6TzKOWJT3a2', '2025-12-12 06:43:22.798089', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.798557', '2025-12-12 06:43:22.798571', '$2a$04$8UjRFicJcHiDEAhP8lRGjeplLeIh1E6AYLQh9mMo721jZ0D0djULa', '2025-12-12 06:43:22.798557', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#create as HTML
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.799341', '2025-12-12 06:43:22.799354', '$2a$04$Tug6C/cT86kyPpWxdKh3pOM3GQ3rn3cm/3XhIcEyYyu/mUkWEnRGe', '2025-12-12 06:43:22.799341', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.799544', '2025-12-12 06:43:22.799560', '$2a$04$cza2i0egM5M8MNEn.EWwVOct3iW3kXAbMRQg116CYbUX2dq.BeKoK', '2025-12-12 06:43:22.799544', 'testuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.800107', 33, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.800107')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' ORDER BY `conversations`.`created_at` ASC[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.0ms | ActiveRecord: 0.1ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Processing by ConversationsController#index as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.801541', '2025-12-12 06:43:22.801554', '$2a$04$vkUxgxtFkFQuFtpwPvEhE.Vs8mshuo.oFgyL655u6tLaUJ56etgNW', '2025-12-12 06:43:22.801541', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.802195', 9, NULL, 'waiting', 'Other Conversation', '2025-12-12 06:43:22.802195')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
Started GET "/conversations/5" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ConversationsController#show as HTML
  Parameters: {"id" => "5"}
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 33 OR `conversations`.`assigned_expert_id` = 33) ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
ConversationsTest: test_GET_/conversations_includes_questionerUsername
----------------------------------------------------------------------
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 8 OR `conversations`.`assigned_expert_id` = 8) AND `conversations`.`id` = 5 LIMIT 1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.803781', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.803781', 2)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 33 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 33 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 1.3ms)
----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
AuthTest: test_POST_/auth/refresh_returns_new_token_with_valid_session
----------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.805093', '2025-12-12 06:43:22.805109', '$2a$04$f917gZm6t4ecVdfZRcxGCeftrb5RIMflymfvOspUUV9W1OwPwfazS', '2025-12-12 06:43:22.805093', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: a310b345-c576-4480-9d3a-9a9804bcf3ce) to Test(default) with arguments: 1
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 2 AND `conversations`.`status` = 'active' ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.805856', 13, NULL, 'waiting', 'Test Conversation', '2025-12-12 06:43:22.805856')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.805902', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.805902', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.806283', '2025-12-12 06:43:22.806297', '$2a$04$.xFpPyBJbIsQyx5mI5esTOR7maAx/ALb6xQ4HF/KvvI9Ul693/H6e', '2025-12-12 06:43:22.806283', 'testuser2')[0m
Started GET "/conversations" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 2 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ConversationsController#index as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 2.1ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser2", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser2' LIMIT 1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) ORDER BY `conversations`.`updated_at` DESC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 3223fdc4-d623-4f3a-a14e-fe3fd12d10d6) to Test(default) with arguments: 1
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
AuthTest: test_POST_/auth/login_fails_with_invalid_credentials
--------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 13 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.808944', `users`.`updated_at` = '2025-12-12 06:43:22.809139' WHERE `users`.`id` = 19[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.809703', '2025-12-12 06:43:22.809718', '$2a$04$.QUQge5mBiw5sMZCttP.W.aW3Mb8k2UbvfkdCdhcXLZ4OGaFowC6G', '2025-12-12 06:43:22.809703', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
AuthTest: test_POST_/auth/login_authenticates_user_and_returns_token
--------------------------------------------------------------------
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
AuthTest: test_POST_/auth/logout_destroys_session
-------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.812152', '2025-12-12 06:43:22.812166', '$2a$04$tXn6FBcA.3mX2/uatgbVmulgl6Rodb9maU9R9rTaoLNJ1HDZDG3ry', '2025-12-12 06:43:22.812152', 'test')[0m
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
AuthTest: test_POST_/auth/register_fails_with_duplicate_username
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.812753', 1, NULL, 'active', 'Test', '2025-12-12 06:43:22.812753')[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.812948', '2025-12-12 06:43:22.812969', '$2a$04$XJ6guM6c3Jd/R58Mu8ugTuQMUESl.L0La0nx2DsH4PpF7NO9V30vq', '2025-12-12 06:43:22.812948', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#login as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.813919', '2025-12-12 06:43:22.813931', '$2a$04$Gn5WJlWA30/CoNL9Y0M9kuil/I0Qb489UX6TCuYSFmRAAlUDh72A6', '2025-12-12 06:43:22.813919', 'test')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.814357', 1, NULL, 'active', 'Test', '2025-12-12 06:43:22.814357')[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTruncate Tables (1480.7ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser", "password" => "[FILTERED]"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
AuthTest: test_POST_/auth/register_automatically_creates_expert_profile
-----------------------------------------------------------------------
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "newexpert", "password" => "[FILTERED]"}
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.815730', `users`.`updated_at` = '2025-12-12 06:43:22.816377' WHERE `users`.`id` = 34[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 3ms (Views: 0.0ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms (3 queries, 0 cached) | GC: 1.0ms)
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.818155', '2025-12-12 06:43:22.818169', '$2a$04$FxA4E1nNVVUy1byh2uYYqeQZmUTeMSGpVy8NJoyFuXm5xL8Na5E7O', '2025-12-12 06:43:22.818155', 'newexpert')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.817909', '2025-12-12 06:43:22.817987', '$2a$04$au/YmkmQsACnopFRReoD..vlv5rlTrlys1WlR.fsDnQiCEC3NVCOK', '2025-12-12 06:43:22.817909', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Create (1.0ms)[0m  [1m[32mINSERT INTO `expert_assignments` (`assigned_at`, `conversation_id`, `created_at`, `expert_id`, `resolved_at`, `status`, `updated_at`) VALUES ('2025-12-12 06:43:22.818291', 1, '2025-12-12 06:43:22.818407', 2, NULL, 'active', '2025-12-12 06:43:22.818407')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.819404', NULL, NULL, NULL, '2025-12-12 06:43:22.819404', 11)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1f139bb3-a282-42f5-876b-1712532e311f) to Test(default) with arguments: 4
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/expert/conversations/1/unclaim" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.820087', `users`.`updated_at` = '2025-12-12 06:43:22.820920' WHERE `users`.`id` = 3[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.821102', '2025-12-12 06:43:22.821116', '$2a$04$4zKvjQP9wTxPhFSvPp3CluXeBg7rShKOAjRcATAcZLEr8mGhV93c2', '2025-12-12 06:43:22.821102', 'expertuser')[0m
-------------------------------------------------
AuthTest: test_GET_/auth/me_fails_without_session
-------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.2ms (3 queries, 0 cached) | GC: 0.0ms)
Processing by AuthController#me as HTML
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
AuthTest: test_POST_/auth/register_creates_a_new_user_and_returns_token
-----------------------------------------------------------------------
Started POST "/auth/register" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1510.4ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
Processing by AuthController#register as HTML
  Parameters: {"username" => "test", "password" => "[FILTERED]"}
Completed 201 Created in 7ms (Views: 0.1ms | ActiveRecord: 2.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-------------------------------------------------------------
AuthTest: test_GET_/auth/me_returns_current_user_with_session
-------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'test' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.825038', '2025-12-12 06:43:22.825055', '$2a$04$TbbaRP6k3dzS06yf42YNcOi96bNFWj.W0HjHjWc6Ixv8PSQJ15qJ.', '2025-12-12 06:43:22.825038', 'test')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
---------------------------------------------------------------------------
AuthTest: test_POST_/auth/refresh_fails_with_valid_JWT_token_but_no_session
---------------------------------------------------------------------------
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.826361', NULL, NULL, NULL, '2025-12-12 06:43:22.826361', 15)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 1774f48f-94dc-4552-ab20-776b1c28efd0) to Test(default) with arguments: 6
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 15 LIMIT 1[0m
Processing by AuthController#me as HTML
  [1m[36mUser Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `users`[0m
  [1m[36mExpertProfile Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `expert_profiles`[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'newexpert' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.826958', '2025-12-12 06:43:22.826974', '$2a$04$qJA2N5EnSvTqz7Mvlxv4E.ZXm3AsUV8oT7QfEHcIfZB0mayCE9bpq', '2025-12-12 06:43:22.826958', 'testuser4')[0m
Completed 201 Created in 4ms (Views: 0.0ms | ActiveRecord: 1.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 11 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#logout as HTML
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.829606', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.829606', 2)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by AuthController#login as HTML
  Parameters: {"username" => "testuser4", "password" => "[FILTERED]"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testuser4' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
AuthTest: test_POST_/auth/logout_returns_success_message
--------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7f27feca-bcaa-4d62-850d-5a376e02795c) to Test(default) with arguments: 1
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.8ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.832344', `users`.`updated_at` = '2025-12-12 06:43:22.832494' WHERE `users`.`id` = 35[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.832712', '2025-12-12 06:43:22.832728', '$2a$04$ZUCwjwO/jeOfvgSHXl9QZeYYffKNzkObQKOaeLPrs2oAiaomd0qM2', '2025-12-12 06:43:22.832712', 'testlogout')[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
-------------------------------------------------------
  [1m[36mActiveRecord::SessionStore::Session Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `sessions`[0m
AuthTest: test_POST_/auth/refresh_fails_without_session
-------------------------------------------------------
Started POST "/auth/login" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mActiveRecord::SessionStore::Session Load (0.1ms)[0m  [1m[34mSELECT `sessions`.* FROM `sessions` ORDER BY `sessions`.`id` ASC LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
Processing by AuthController#login as HTML
------------------------------------------------------------
HealthTest: test_GET_/health_does_not_require_authentication
  Parameters: {"username" => "testlogout", "password" => "[FILTERED]"}
------------------------------------------------------------
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (3 queries, 0 cached) | GC: 1.2ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by AuthController#me as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`username` = 'testlogout' LIMIT 1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (1 query, 0 cached) | GC: 0.0ms)
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_timestamp
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE `users` SET `users`.`last_active_at` = '2025-12-12 06:43:22.835446', `users`.`updated_at` = '2025-12-12 06:43:22.836303' WHERE `users`.`id` = 12[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.2ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
HealthTest: test_GET_/health_timestamp_is_current
-------------------------------------------------
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[31mROLLBACK[0m
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Started GET "/auth/me" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
HealthTest: test_GET_/health_returns_status_ok
----------------------------------------------
Started GET "/health" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started POST "/auth/logout" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
GenerateExpertFaqJobTest: test_does_nothing_when_profile_is_missing
-------------------------------------------------------------------
Processing by AuthController#me as HTML
Processing by AuthController#logout as HTML
Processing by HealthController#index as HTML
Completed 200 OK in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 12 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 35 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.839978', '2025-12-12 06:43:22.839997', '$2a$04$.EdNIBj0qyXtZ4cQjqti/u0ju8kSlKoW82r0pY9o6pQH0VxOhR3sS', '2025-12-12 06:43:22.839978', 'expert2')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.9ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.841080', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.841080', 16)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
------------------------------------------------------------------------
GenerateExpertFaqJobTest: test_updates_expert_faq_from_generated_content
------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 6703b149-8d7c-4adb-bcb4-ca04ee35c574) to Test(default) with arguments: 7
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e] Performing GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) from Test(default) enqueued at 2025-12-12T06:43:22.842372506Z with arguments: "non-existent-id"
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/expert/assignments/history" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by ExpertController#unclaim as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expert2' LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = NULL LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [ed40490e-f11a-4b93-a4c2-d37250b7022e] Performed GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) from Test(default) in 0.46ms
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: ed40490e-f11a-4b93-a4c2-d37250b7022e) to Test(default) with arguments: "non-existent-id"
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.842978', '2025-12-12 06:43:22.842997', '$2a$04$KuVYtVl6Q4NKhDg9/Ux11.tLMupgovXsWos/JZWJuCYOiS1Zz1UZC', '2025-12-12 06:43:22.842978', 'expert2')[0m
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES (NULL, '2025-12-12 06:43:22.844005', NULL, NULL, '[\"https://example.com\"]', '2025-12-12 06:43:22.844005', 4)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 42c4c25f-dc17-45a1-b833-69cb328c8593) to Test(default) with arguments: 2
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 2 LIMIT 1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323] Performing GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) from Test(default) enqueued at 2025-12-12T06:43:22.844927688Z with arguments: 2
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_orders_by_updated_at_descending
--------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_404_for_non-existent_user
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_queue_updates
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_404_for_non-existent_user
-----------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.3ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`assigned_expert_id` = NULL, `conversations`.`status` = 'waiting', `conversations`.`updated_at` = '2025-12-12 06:43:22.848636' WHERE `conversations`.`id` = 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.849484', '2025-12-12 06:43:22.849500', '$2a$04$DQQtxxu4FTiYKSrLq2N2t.v3/UzeTzwwq1xmP2SZPlI6VAanU4kt2', '2025-12-12 06:43:22.849484', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.849813', '2025-12-12 06:43:22.849836', '$2a$04$cm0f..0SLCaUCTmJkB3ZFufy.EiLntno0NiHXrrui/SxX7m/uCXuy', '2025-12-12 06:43:22.849813', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.850037', '2025-12-12 06:43:22.850060', '$2a$04$3aczcMuQRufWca/zPVp0eu8GLbIcWZJ.rt6CrwMEM7FETp5iXWZ0S', '2025-12-12 06:43:22.850037', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`conversation_id` = 1 AND `expert_assignments`.`expert_id` = 2 AND `expert_assignments`.`status` = 'active' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851107', '2025-12-12 06:43:22.851117', '$2a$04$mqcwQI35lE6SYZ5jsqkpGeW/SX0UY4Bgxgr9iAi.uisVi4u0AvhgS', '2025-12-12 06:43:22.851107', 'expertuser')[0m
  [1m[36mExpertAssignment Update (0.2ms)[0m  [1m[33mUPDATE `expert_assignments` SET `expert_assignments`.`resolved_at` = '2025-12-12 06:43:22.850860', `expert_assignments`.`status` = 'resolved', `expert_assignments`.`updated_at` = '2025-12-12 06:43:22.851059' WHERE `expert_assignments`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851151', '2025-12-12 06:43:22.851170', '$2a$04$G64psJmaGDxOMTQ8WM0z1O87wFugf0n0D3jIbMVU7FqkHXSDRvj0K', '2025-12-12 06:43:22.851151', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 1.2ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851752', '2025-12-12 06:43:22.851768', '$2a$04$WXdPFL0ZocegPH/.j1Z.keEhG2o.MEHIwlsFy0tBPvNmK2qcjyFfG', '2025-12-12 06:43:22.851752', 'expertuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.851910', NULL, NULL, NULL, '2025-12-12 06:43:22.851910', 18)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.851950', '2025-12-12 06:43:22.851963', '$2a$04$BIoVzhbncEvLmDBjS/BmoujE/R2/9O77XekT.J4VicdC7aoz416ka', '2025-12-12 06:43:22.851950', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 4f0e40fe-46c2-406f-bd4c-09a5d9cdf01f) to Test(default) with arguments: 8
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mExpertProfile Update (0.1ms)[0m  [1m[33mUPDATE `expert_profiles` SET `expert_profiles`.`expert_faq` = 'Generated FAQ', `expert_profiles`.`updated_at` = '2025-12-12 06:43:22.852180' WHERE `expert_profiles`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323]   [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] [GenerateExpertFaqJob] [862566f3-f797-4821-9556-e896e876d323] Performed GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) from Test(default) in 7.26ms
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 14 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 862566f3-f797-4821-9556-e896e876d323) to Test(default) with arguments: 2
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertAssignment Load (0.1ms)[0m  [1m[34mSELECT `expert_assignments`.* FROM `expert_assignments` WHERE `expert_assignments`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.852754', 17, NULL, 'waiting', 'First', '2025-12-12 06:43:22.852754')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.852945', NULL, NULL, NULL, '2025-12-12 06:43:22.852945', 14)[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.853049', NULL, NULL, NULL, '2025-12-12 06:43:22.853049', 4)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Load (0.1ms)[0m  [1m[34mSELECT `expert_profiles`.* FROM `expert_profiles` WHERE `expert_profiles`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 74b5ffb5-c6fa-4b9b-94b5-d1d4ab92cab1) to Test(default) with arguments: 5
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8bb3dc89-1ea8-4c4a-8a57-0cd7bce2e1a9) to Test(default) with arguments: 2
  [1m[36mExpertProfile Delete All (0.1ms)[0m  [1m[31mDELETE FROM `expert_profiles`[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.853643', '2025-12-12 06:43:22.853659', '$2a$04$h.vsrqOOsoKRQU4hWSerPuKdspiim0oqpUbrYHXMyop.St.KrnYhu', '2025-12-12 06:43:22.853643', 'expertuser')[0m
Started GET "/api/conversations/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Delete All (0.1ms)[0m  [1m[31mDELETE FROM `users`[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.854016', 3, NULL, 'waiting', 'Waiting', '2025-12-12 06:43:22.854016')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.854734', 3, NULL, 'active', 'Assigned', '2025-12-12 06:43:22.854734')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
Processing by ExpertController#assignment_history as HTML
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Started GET "/api/expert-queue/updates?expertId=4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 37 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.856211', NULL, NULL, NULL, '2025-12-12 06:43:22.856211', 37)[0m
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "4"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8f4ca77b-7d3e-4acd-9c15-4bd3017881c8) to Test(default) with arguments: 17
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
Started GET "/api/messages/updates?userId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_only_returns_active_status_for_assigned_conversations
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_filters_by_since_timestamp
----------------------------------------------------------------------
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_requires_authentication
-----------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "999999"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.860030', '2025-12-12 06:43:22.860046', '$2a$04$vOfg3YMn0DN/VeQ/BRsCH.6B3HRb.jg8R5EPH6k88jRvlkOT8uEbq', '2025-12-12 06:43:22.860030', 'testuser')[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.860182', '2025-12-12 06:43:22.860199', '$2a$04$bSmMpC0uitD2oDqau7l5f.c7AkSKPR5idZQR8k7E8afuo1Ri4BZOC', '2025-12-12 06:43:22.860182', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
-------------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_assigned_conversations_ordered_by_updated_at_descending
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.861454', '2025-12-12 06:43:22.861474', '$2a$04$mJro/tluRtiw8kFwnv6VPempFhIumlaBOvn6kH7NswXYloy48tlSS', '2025-12-12 06:43:22.861454', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.861986', '2025-12-12 06:43:22.861998', '$2a$04$nxvZY/IbmbftsVsu7Kzt3eoqMdISEATKrd1HwbDoabnXBo6iYDMrW', '2025-12-12 06:43:22.861986', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.862044', '2025-12-12 06:43:22.862064', '$2a$04$NROidQkHvg0Sd7R5Gf/x4.xjc6a/SG1f3Ey9H2SFb3hpbAhsennsi', '2025-12-12 06:43:22.862044', 'expertuser')[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 36 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.862993', NULL, NULL, NULL, '2025-12-12 06:43:22.862993', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.863024', '2025-12-12 06:43:22.863047', '$2a$04$4xI5CyeO7QhWj/FCqeRMzuERahfAQus5dUSkL.RpuqZgvcwn7y2VK', '2025-12-12 06:43:22.863024', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 029b9cd8-3ec7-4066-8b69-ec0dffb5a815) to Test(default) with arguments: 3
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.863232', NULL, NULL, NULL, '2025-12-12 06:43:22.863232', 4)[0m
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 1.8ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: c252479b-198f-4646-afa4-5b03463ecfa7) to Test(default) with arguments: 2
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.863577', '2025-12-12 06:43:22.863595', '$2a$04$QDchry8pkDicB8z.Vs5pSu/i92XQGF6Tj8oxPmzIQIgn2O/Ej6myi', '2025-12-12 06:43:22.863577', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.863784', 17, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.863784')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.863988', 5, NULL, 'active', 'Active', '2025-12-12 06:43:22.863988')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 16 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.864313', 3, NULL, 'active', 'Test', '2025-12-12 06:43:22.864313')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.864679', NULL, NULL, NULL, '2025-12-12 06:43:22.864679', 16)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.864799', '2025-12-12 06:43:22.864810', '$2a$04$a/H53rHJ12oaxPCyS1VSwutTLFniEz0zyfA6cRlUoRoYqo5y8LAxW', '2025-12-12 06:43:22.864799', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.864768', 5, NULL, 'resolved', 'Resolved', '2025-12-12 06:43:22.864768')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b985b4de-f800-40a0-8a82-f2e9686fdea5) to Test(default) with arguments: 6
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=6" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 4 LIMIT 1[0m
Started GET "/api/expert-queue/updates?expertId=16" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.865610', NULL, NULL, NULL, '2025-12-12 06:43:22.865610', 4)[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "16"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 8f23937c-9d0c-496e-bbf8-984fe2471d44) to Test(default) with arguments: 2
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 4 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "6"}
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 1.9ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_initiator
------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_orders_by_created_at_descending
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Old message', 2, '2025-12-12 06:43:22.869511', FALSE, 3, 'initiator', '2025-12-12 06:43:22.869511')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.869511', `conversations`.`updated_at` = '2025-12-12 06:43:22.870180' WHERE `conversations`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser3' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mMessage Update (0.1ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`created_at` = '2025-12-10 06:43:22.870653' WHERE `messages`.`id` = 1[0m
-----------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_404_for_non-existent_expert
-----------------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.870830', '2025-12-12 06:43:22.870844', '$2a$04$xfvcEBc8PbYDTW5d6f15b.w3g5omO6WIelmz9evfmCIPXvpoWbWoi', '2025-12-12 06:43:22.870830', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 2, '2025-12-12 06:43:22.871165', FALSE, 4, 'expert', '2025-12-12 06:43:22.871165')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.871165', 3, NULL, 'active', 'First', '2025-12-12 06:43:22.871165')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.870890', '2025-12-12 06:43:22.870979', '$2a$04$jLSJpElWl2YuMYLUfxSy3.kgXr8NJsq0y7XNx07NBSINHriKxDBKq', '2025-12-12 06:43:22.870890', 'testuser3')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.871165', `conversations`.`updated_at` = '2025-12-12 06:43:22.871660' WHERE `conversations`.`id` = 2[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_returns_object_not_array
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Started GET "/api/messages/updates?userId=3&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872247', '2025-12-12 06:43:22.872264', '$2a$04$d6rbrh17EW0JruKVWZl6IOCjPoJeRXyWIG/ndnQH8fi.EUD621SW2', '2025-12-12 06:43:22.872247', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872572', '2025-12-12 06:43:22.872584', '$2a$04$aNRpalaXp9Kaw65erCa9jeZVBbuflsGWwgbMA0sWu43hCzTQGVED.', '2025-12-12 06:43:22.872572', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.872044', '2025-12-12 06:43:22.872062', '$2a$04$zCXt5ZGfTf.rZEAuKfyP5ef1gnqz6f/2mgPll3S2ZkY1Ud20zHhLe', '2025-12-12 06:43:22.872044', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "3", "since" => "2025-12-11T06:43:22Z"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 18 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.873589', NULL, NULL, NULL, '2025-12-12 06:43:22.873589', 18)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.873799', '2025-12-12 06:43:22.873809', '$2a$04$AlPUBnzQXCsZAkP/7SM1NeR9D.nP.L0p1DVjZ0xNPxJ8lcdWxmLbu', '2025-12-12 06:43:22.873799', 'expertuser')[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 69420e47-6a09-46b9-bb76-131146d1aec4) to Test(default) with arguments: 7
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.873852', '2025-12-12 06:43:22.873865', '$2a$04$7tlVfbWomNsSyUKuOjGhkeGZsXnINw.b1EyhK7wN4ZinU4eMX8DA6', '2025-12-12 06:43:22.873852', 'testuser')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 3 OR `conversations`.`assigned_expert_id` = 3)[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 06:43:22.874490', 17, NULL, 'active', 'Test', '2025-12-12 06:43:22.874490')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.874712', NULL, NULL, NULL, '2025-12-12 06:43:22.874712', 6)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 320f50d8-ba1e-4c98-8835-e923a409d4b2) to Test(default) with arguments: 3
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 2 AND (created_at >= '2025-12-11 06:43:22') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.874883', 17, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.874883')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=999999" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by UpdatesController#expert_queue_updates as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.875617', '2025-12-12 06:43:22.875629', '$2a$04$BheLvLnXCd/YvaFSiYNa8ufNZq2eXXh0q.fCaEsz2zY33QKB6TncS', '2025-12-12 06:43:22.875617', 'expertuser')[0m
  Parameters: {"expertId" => "999999"}
Started GET "/api/conversations/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 999999 LIMIT 1[0m
  [1m[36mUser Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.876691', NULL, NULL, NULL, '2025-12-12 06:43:22.876691', 8)[0m
  Parameters: {"userId" => "17"}
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 519af869-5e32-4e01-8e9b-c9e1bec64aad) to Test(default) with arguments: 4
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
Started GET "/api/expert-queue/updates?expertId=8" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.876572', '2025-12-12 06:43:22.876590', '$2a$04$BxBSUj9rHWChv8IFJ4Yy5OG6KPBd7Ak5WJV/qUuMZ9MdzcqV0PjwK', '2025-12-12 06:43:22.876572', 'expertuser')[0m
Processing by UpdatesController#expert_queue_updates as HTML
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First', 6, '2025-12-12 06:43:22.877526', FALSE, 17, 'initiator', '2025-12-12 06:43:22.877526')[0m
  Parameters: {"expertId" => "8"}
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.877526', `conversations`.`updated_at` = '2025-12-12 06:43:22.877985' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 8 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 39 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 7 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.879458', NULL, NULL, NULL, '2025-12-12 06:43:22.879458', 39)[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 17 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (9 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: e8c37308-14c6-40b2-bf38-77935b9ea0b4) to Test(default) with arguments: 18
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_requires_authentication
--------------------------------------------------------------------------
-------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_filters_by_since_timestamp
--------------------------------------------------------------------------
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.882145', 3, NULL, 'active', 'Second', '2025-12-12 06:43:22.882145')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_requires_authentication
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.882731', '2025-12-12 06:43:22.882744', '$2a$04$U7Qyd3fnK5d0klrwRiqU2uExLtMru465YrA5aN4D6cFGFGX56fBji', '2025-12-12 06:43:22.882731', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.882870', '2025-12-12 06:43:22.882884', '$2a$04$La52cRz61u.P53ph18sQyeAipH8XlnAy.n93OGvyii.EBB2MpMV2a', '2025-12-12 06:43:22.882870', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Create (0.5ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.883235', 38, NULL, 'waiting', 'As Initiator', '2025-12-12 06:43:22.883235')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884145', '2025-12-12 06:43:22.884158', '$2a$04$JxAW7wht7MT38eWEf.qKje8JZkwMc02vZC1t2dA7Kj8KuUSUgarai', '2025-12-12 06:43:22.884145', 'testuser')[0m
------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_returns_updated_conversations
------------------------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884418', '2025-12-12 06:43:22.884428', '$2a$04$UuXGLvmYYJsCyzwL0jwpFO51GZ3Onj.rZ0dFNedOB06YGx8/yCsha', '2025-12-12 06:43:22.884418', 'expertuser')[0m
Started GET "/api/conversations/updates?userId=38" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.884575', '2025-12-12 06:43:22.884589', '$2a$04$sl3WCyn2TH10zbUrZsmOpObqbzIQIszQWNVnCXX8V7A7c6Bf86H9e', '2025-12-12 06:43:22.884575', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  Parameters: {"userId" => "38"}
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.885387', NULL, NULL, NULL, '2025-12-12 06:43:22.885387', 6)[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.885500', NULL, NULL, NULL, '2025-12-12 06:43:22.885500', 8)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: b5aabd4d-8564-4e57-8c21-1e81bd61f923) to Test(default) with arguments: 3
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 2d751d4c-5eb9-4322-a46c-70b41e376162) to Test(default) with arguments: 4
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.885812', '2025-12-12 06:43:22.885825', '$2a$04$LxrJYYpQAyikHCnfivkMfeCWM5HMq2F0CFbQgflHHCuqF0fmQJLPG', '2025-12-12 06:43:22.885812', 'expertuser')[0m
Started GET "/api/messages/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.886127', '2025-12-12 06:43:22.886147', '$2a$04$tC5epkG4FKbjq1b7/FYAo.DGd4lBTWm5SKW0xO/oaKSyvHLVr0A6y', '2025-12-12 06:43:22.886127', 'testuser')[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.886347', 5, NULL, 'waiting', 'Old', '2025-12-12 06:43:22.886347')[0m
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:43:22.886972' WHERE `conversations`.`id` = 3[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.886984', NULL, NULL, NULL, '2025-12-12 06:43:22.886984', 10)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: d64a5fad-fb55-4c87-bb24-45af16483c0e) to Test(default) with arguments: 5
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.887466', 5, NULL, 'waiting', 'New', '2025-12-12 06:43:22.887466')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/conversations/updates?userId=9" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 38 OR `conversations`.`assigned_expert_id` = 38) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
Started GET "/api/expert-queue/updates?expertId=6&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "9"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.888052', '2025-12-12 06:43:22.888066', '$2a$04$GH4GBww1vSdI2J2r7YPnyemImOUa4VabFOowoXYj/JAjqvoYkEXQC', '2025-12-12 06:43:22.888052', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 38 LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "6", "since" => "2025-12-11T06:43:22Z"}
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 8 AND `messages`.`sender_id` != 38 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 1.8ms)
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 20 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second', 6, '2025-12-12 06:43:22.888659', FALSE, 18, 'expert', '2025-12-12 06:43:22.888659')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 6 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.889090', NULL, NULL, NULL, '2025-12-12 06:43:22.889090', 20)[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.888659', `conversations`.`updated_at` = '2025-12-12 06:43:22.889189' WHERE `conversations`.`id` = 6[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`created_at` ASC[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 26848d38-fe55-472f-91e0-387bfb589745) to Test(default) with arguments: 9
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.890058', 19, NULL, 'waiting', 'Test', '2025-12-12 06:43:22.890058')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 6 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 6 AND `conversations`.`status` = 'active' AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`updated_at` DESC[0m
-----------------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/expert-queue/updates_waiting_conversations_ordered_by_created_at_ascending
-----------------------------------------------------------------------------------------------------
Started GET "/api/conversations/updates?userId=19" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.6ms (6 queries, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "19"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 19 OR `conversations`.`assigned_expert_id` = 19) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_filters_by_since_timestamp
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_only_returns_messages_from_user's_conversations
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.892401', '2025-12-12 06:43:22.892415', '$2a$04$F6XpUHmDOcMWY0SEPGga3OujyXKE3VHEJO7V6E0PIIvw1X1anGjwq', '2025-12-12 06:43:22.892401', 'testuser')[0m
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 9 AND `messages`.`sender_id` != 19 AND `messages`.`is_read` = FALSE[0m
Completed 200 OK in 2ms (Views: 0.0ms | ActiveRecord: 0.4ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (4, '2025-12-12 06:43:22.893091', 3, NULL, 'active', 'Third', '2025-12-12 06:43:22.893091')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
----------------------------------------------------------------
UpdatesTest: test_GET_/api/messages/updates_returns_new_messages
----------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.893851', '2025-12-12 06:43:22.893863', '$2a$04$P4WXXUNKukNibBhuSC.xJugtISeLiM.fDupJoJziexR1HQ2Ht6dVm', '2025-12-12 06:43:22.893851', 'testuser')[0m
  [1m[36mConversation Update (0.2ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-12 06:43:22.893840' WHERE `conversations`.`id` = 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.894027', '2025-12-12 06:43:22.894042', '$2a$04$LeqheYjtaU7y66/NNoN6fuqINCxl3HBiAWUwESgZLYvMxLi5Qvjfq', '2025-12-12 06:43:22.894027', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.894058', '2025-12-12 06:43:22.894071', '$2a$04$UNvyRbqkW82dwCcnYL20U.u.dlUT7leKGfwkpp3eRkjNjFXhoGgp2', '2025-12-12 06:43:22.894058', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/api/expert-queue/updates?expertId=4" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 10 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.895046', NULL, NULL, NULL, '2025-12-12 06:43:22.895046', 10)[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895087', '2025-12-12 06:43:22.895099', '$2a$04$dXVolUavVehbAYOLc3GFG.gav7PV8KQMH3x.zK7SXdsB9DNJNH/jS', '2025-12-12 06:43:22.895087', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 7d22fef9-8798-4f72-8fd3-9101d14db5e8) to Test(default) with arguments: 5
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "4"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895529', '2025-12-12 06:43:22.895541', '$2a$04$/L/7rb1fKkVgJPls/Dc/VuH76QgQ/LDQaB.bE2rs23OyQYVVbLpbG', '2025-12-12 06:43:22.895529', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.895814', '2025-12-12 06:43:22.895828', '$2a$04$MFJIWf.uHrvuCFbvPJN2Be/Yls1wMOOzthAJg5QrBJD1K2/HNK16y', '2025-12-12 06:43:22.895814', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 12 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.896008', 9, NULL, 'waiting', 'First', '2025-12-12 06:43:22.896008')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.896449', NULL, NULL, NULL, '2025-12-12 06:43:22.896449', 12)[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 41 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 9c8abf0f-2ca2-4ee4-9c3d-0b992d109a0a) to Test(default) with arguments: 6
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.896737', '2025-12-12 06:43:22.896750', '$2a$04$c4PsMjnFN1xe6ceB5y.JYOiH51d51jkiUHmUoMQPfBeWlvapOS8lK', '2025-12-12 06:43:22.896737', 'expertuser')[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.896800', NULL, NULL, NULL, '2025-12-12 06:43:22.896800', 41)[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 711ab920-5671-4a1d-9ccd-b45792d1de1e) to Test(default) with arguments: 19
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (4.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.897170', 11, NULL, 'waiting', 'Old', '2025-12-12 06:43:22.897170')[0m
Processing by AuthController#refresh as HTML
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 8 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.897707', NULL, NULL, NULL, '2025-12-12 06:43:22.897707', 8)[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`updated_at` = '2025-12-10 06:43:22.897693' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------
UpdatesTest: test_GET_/api/conversations/updates_includes_conversations_as_assigned_expert
------------------------------------------------------------------------------------------
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 42ff07c7-7751-4477-bce8-a7806579c140) to Test(default) with arguments: 4
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.898207', 11, NULL, 'waiting', 'New', '2025-12-12 06:43:22.898207')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.897707', 40, NULL, 'waiting', 'User Conv', '2025-12-12 06:43:22.897707')[0m
Started GET "/api/conversations/updates?userId=11&since=2025-12-11T06%3A43%3A22Z" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:43:22.898569', 7, NULL, 'active', 'Test', '2025-12-12 06:43:22.898569')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#conversations_updates as HTML
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  Parameters: {"userId" => "11", "since" => "2025-12-11T06:43:22Z"}
Filter chain halted as :authenticate_with_session! rendered or redirected
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 401 Unauthorized in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 5, '2025-12-12 06:43:22.899321', FALSE, 8, 'expert', '2025-12-12 06:43:22.899321')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.899542', '2025-12-12 06:43:22.899557', '$2a$04$.Ysttp5NnCeLuGMojmzS4usL/fP5lOBZ7CuBe9RzoAiAeEuhDlPzG', '2025-12-12 06:43:22.899542', 'testuser')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.899321', `conversations`.`updated_at` = '2025-12-12 06:43:22.899719' WHERE `conversations`.`id` = 5[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.2ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 4 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third', 6, '2025-12-12 06:43:22.899867', FALSE, 17, 'initiator', '2025-12-12 06:43:22.899867')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Started GET "/api/messages/updates?userId=7" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.899867', `conversations`.`updated_at` = '2025-12-12 06:43:22.900404' WHERE `conversations`.`id` = 6[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "7"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.900484', '2025-12-12 06:43:22.900498', '$2a$04$/CcX8hMmUhS6Uu7m4Y85buhVGxhbFdmZVHErEkEYeTTdjam5W9xEi', '2025-12-12 06:43:22.900484', 'otheruser')[0m
Processing by AuthController#refresh as HTML
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 7 LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
Started GET "/api/messages/updates?userId=17" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.901240', '2025-12-12 06:43:22.901250', '$2a$04$Hs3GYFvQyY5CPzqOuebEF.ULO8sviVeWIMjkH0voR0C69VQDSZQ2K', '2025-12-12 06:43:22.901240', 'expertuser')[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.901205', 42, NULL, 'waiting', 'Other Conv', '2025-12-12 06:43:22.901205')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "17"}
  [1m[36mConversation Pluck (0.3ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 7 OR `conversations`.`assigned_expert_id` = 7)[0m
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 11 OR `conversations`.`assigned_expert_id` = 11) AND (updated_at >= '2025-12-11 06:43:22') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :authenticate_with_session! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 11 LIMIT 1[0m
  [1m[36mMessage Load (0.2ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 5 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mExpertProfile Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `expert_profiles` WHERE `expert_profiles`.`user_id` = 22 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
  [1m[36mExpertProfile Create (0.1ms)[0m  [1m[32mINSERT INTO `expert_profiles` (`bio`, `created_at`, `expert_faq`, `expertise_summary`, `knowledge_base_links`, `updated_at`, `user_id`) VALUES ('Expert developer', '2025-12-12 06:43:22.902158', NULL, NULL, NULL, '2025-12-12 06:43:22.902158', 22)[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 11 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Pluck (0.2ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17)[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (5 queries, 0 cached) | GC: 0.0ms)
[ActiveJob] Enqueued GenerateExpertFaqJob (Job ID: 29412bda-4173-4ef0-a170-340c76acf8d0) to Test(default) with arguments: 10
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 2.0ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages
--------------------------------------------------------------------------------
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 6 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.902987', 21, NULL, 'active', 'As Expert', '2025-12-12 06:43:22.902987')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (17, 18)[0m
Started GET "/api/conversations/updates?userId=22" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
Processing by UpdatesController#conversations_updates as HTML
  Parameters: {"userId" => "22"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTruncate Tables (1585.2ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 22 OR `conversations`.`assigned_expert_id` = 22) AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('User message', 9, '2025-12-12 06:43:22.903998', FALSE, 40, 'initiator', '2025-12-12 06:43:22.903998')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.903998', `conversations`.`updated_at` = '2025-12-12 06:43:22.904920' WHERE `conversations`.`id` = 9[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 22 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 1 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 10 AND `messages`.`sender_id` != 22 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Other message', 10, '2025-12-12 06:43:22.905427', FALSE, 42, 'initiator', '2025-12-12 06:43:22.905427')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 3 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.905427', `conversations`.`updated_at` = '2025-12-12 06:43:22.905851' WHERE `conversations`.`id` = 10[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 4 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_expert
---------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
Started GET "/api/messages/updates?userId=40" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 2 AND `messages`.`sender_id` != 4 AND `messages`.`is_read` = FALSE[0m
MessagesTest: test_PUT_/messages/:id/read_returns_403_when_marking_own_message_as_read
--------------------------------------------------------------------------------------
-------------------------------------------------------
MessagesTest: test_POST_/messages_creates_a_new_message
-------------------------------------------------------
Processing by UpdatesController#messages_updates as HTML
  Parameters: {"userId" => "40"}
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 2.3ms (13 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40 LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.906911', 9, NULL, 'waiting', 'Second', '2025-12-12 06:43:22.906911')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Pluck (0.1ms)[0m  [1m[34mSELECT `conversations`.`id` FROM `conversations` WHERE (`conversations`.`initiator_id` = 40 OR `conversations`.`assigned_expert_id` = 40)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
MessagesTest: test_POST_/messages_returns_404_for_non-existent_conversation
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 AND (created_at >= '1970-01-01 00:00:00') ORDER BY `messages`.`created_at` DESC[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.907906', '2025-12-12 06:43:22.907918', '$2a$04$EL4Jbps92Oqw97H.6NuDpujh5P095IfqUkkBWv2/Rx0wfSa/lnXE.', '2025-12-12 06:43:22.907906', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.908073', '2025-12-12 06:43:22.908087', '$2a$04$3rwHp/BBQA74e5kgGPb/HeZIuX4CCuMMDWU7CjZPsP/Jn5NFGRqdy', '2025-12-12 06:43:22.908073', 'testuser')[0m
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 40[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.908238', '2025-12-12 06:43:22.908259', '$2a$04$jw6aZWhyvrVhQ8XyiadBJOITTz/dC9n4bioi/72T2mq4pZsLlYneW', '2025-12-12 06:43:22.908238', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (5 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
MessagesTest: test_POST_/messages_updates_conversation_last_message_at
----------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909241', '2025-12-12 06:43:22.909255', '$2a$04$Q1F4tPrnIVgdvFBjRTVhJeqJlOX6gGyhNoIvrGJG0x1XCIuJHYP0C', '2025-12-12 06:43:22.909241', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909551', '2025-12-12 06:43:22.909561', '$2a$04$bHtNWqhBxxSC.tHSkyHRmO2gwhDJtQ29XDSkwGGB7cqbHJGyRv.au', '2025-12-12 06:43:22.909551', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.909738', '2025-12-12 06:43:22.909748', '$2a$04$ew8BKhnXwPNNysQImV.Ee.z99d9YdWea9jk1WGLRrHGiq/UyYRq5i', '2025-12-12 06:43:22.909738', 'expertuser')[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910025', '2025-12-12 06:43:22.910036', '$2a$04$OFdIc1O7ZSkXEvBjMYJTfukCZYetJEsScTAQEODnkRETyMKpfGsWG', '2025-12-12 06:43:22.910025', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (10, '2025-12-12 06:43:22.910196', 9, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.910196')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (14, '2025-12-12 06:43:22.910419', 13, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.910419')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910541', '2025-12-12 06:43:22.910556', '$2a$04$3FExhiJc0T0S/kScaAilbu/yKHViLiEukT4eDpwp/x3kM9XoEvbrC', '2025-12-12 06:43:22.910541', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
------------------------------------------------------------------------
MessagesTest: test_POST_/messages_sets_correct_sender_role_for_initiator
------------------------------------------------------------------------
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.910795', '2025-12-12 06:43:22.910808', '$2a$04$3holCPQ18T12aOZh9/BIgeW6BC/ERLY0kiG.UmtXWD8WJHxhSWike', '2025-12-12 06:43:22.910795', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[31mROLLBACK[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "6", "content" => "Expert reply"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (20, '2025-12-12 06:43:22.911667', 19, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.911667')[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912221', '2025-12-12 06:43:22.912235', '$2a$04$uXeAV94hGfCiS.52xPi5X.rGELqw6WDSlC8neNoyp4EnKs.75syYy', '2025-12-12 06:43:22.912221', 'expertuser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 6 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912331', '2025-12-12 06:43:22.912347', '$2a$04$VS4qsdd1nZ8Prx7h2nEhxuufdq9GDHhldX/yuvNgmp3woTPlHMPQu', '2025-12-12 06:43:22.912331', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_returns_messages_in_chronological_order
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:43:22.912958', 23, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.912958')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Expert reply', 6, '2025-12-12 06:43:22.912987', FALSE, 10, 'expert', '2025-12-12 06:43:22.912987')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.912600', '2025-12-12 06:43:22.912660', '$2a$04$6HcH.6zRqV18x13QNIg/2OylXTrEqic8rbuj8m4s2zdG9zyV6roJq', '2025-12-12 06:43:22.912600', 'testuser')[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "999999", "content" => "Test"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 7, '2025-12-12 06:43:22.913033', FALSE, 13, 'initiator', '2025-12-12 06:43:22.913033')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.912987', `conversations`.`updated_at` = '2025-12-12 06:43:22.913415' WHERE `conversations`.`id` = 6[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.913033', `conversations`.`updated_at` = '2025-12-12 06:43:22.913515' WHERE `conversations`.`id` = 7[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 999999 LIMIT 1[0m
Started PUT "/messages/1/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914019', '2025-12-12 06:43:22.914030', '$2a$04$IRbfVBOng2czEBiTScmLBukgsBIy/EarWvvY2390tG4yFbyJ7TCA2', '2025-12-12 06:43:22.914019', 'expertuser')[0m
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_requires_authentication
-----------------------------------------------------------------
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Processing by MessagesController#mark_read as HTML
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914637', '2025-12-12 06:43:22.914650', '$2a$04$8paod9x2c520EgUk2rZ5eOuEUfDtuKVyFhm0GECBVsbatGwOMnGh2', '2025-12-12 06:43:22.914637', 'testuser')[0m
  Parameters: {"id" => "1"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.914858', '2025-12-12 06:43:22.914870', '$2a$04$vsTj1LzBZcn4VCfwo34FWeEQSpJVbd7Qx/4QFG8VkBpezpE/.qg0a', '2025-12-12 06:43:22.914858', 'expertuser')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (6, '2025-12-12 06:43:22.914775', 5, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.914775')[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.916208', '2025-12-12 06:43:22.916218', '$2a$04$.vXfqVEVwYh5vKqn.OqDhu2.9grTfBwlVTkRAaVIjChbNMc4//nOK', '2025-12-12 06:43:22.916208', 'expertuser')[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '13' OR conversations.assigned_expert_id = '13') AND `messages`.`id` = 1 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 403 Forbidden in 2ms (Views: 0.1ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "4", "content" => "Test message"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (44, '2025-12-12 06:43:22.916913', 43, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.916913')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (3, '2025-12-12 06:43:22.916818', 2, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.916818')[0m
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
MessagesTest: test_POST_/messages_includes_senderUsername
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
--------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_conversation_access
--------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 5 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 4 LIMIT 1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('First message', 11, '2025-12-12 06:43:22.917562', FALSE, 43, 'initiator', '2025-12-12 06:43:22.917562')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.917562', `conversations`.`updated_at` = '2025-12-12 06:43:22.917987' WHERE `conversations`.`id` = 11[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.917860', 9, NULL, 'waiting', 'Third', '2025-12-12 06:43:22.917860')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "1", "content" => "New message"}
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.918546', '2025-12-12 06:43:22.918559', '$2a$04$gnz9tng2VN4M8VdbRcjJNO8mENM1KcQO73BDHu/iT9Aj9D8GN40cO', '2025-12-12 06:43:22.918546', 'testuser')[0m
Started GET "/api/expert-queue/updates?expertId=10" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.918609', '2025-12-12 06:43:22.918622', '$2a$04$6kL8aKD/CwaHQa.lyDhOCeTNccP6KZqHgYr1R61H5lmHvg.zclPYK', '2025-12-12 06:43:22.918609', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by UpdatesController#expert_queue_updates as HTML
  Parameters: {"expertId" => "10"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 10 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`status` = 'waiting' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_marks_message_as_read
---------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.920249', '2025-12-12 06:43:22.920262', '$2a$04$qNDDUDW2GdJnDpSGGsRp8ecGAgWCkjXI.ghVfiYbBxga8DtN3Dq..', '2025-12-12 06:43:22.920249', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.920309', '2025-12-12 06:43:22.920321', '$2a$04$/fnDO/dr1IbpOGlbzsVziuBUxqQ/KtEx4AF4OruRWiWb2oEzP1UWu', '2025-12-12 06:43:22.920309', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 4, '2025-12-12 06:43:22.920509', FALSE, 5, 'initiator', '2025-12-12 06:43:22.920509')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 4 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.920509', `conversations`.`updated_at` = '2025-12-12 06:43:22.920985' WHERE `conversations`.`id` = 4[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.921089', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.921089')[0m
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 5 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (22, '2025-12-12 06:43:22.921099', 21, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.921099')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCACHE User Load (0.0ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.921604', '2025-12-12 06:43:22.921619', '$2a$04$Bw/RJL1cFw5ROnGpKwvhG.fxpfXsFZK2aZz0JGxWaYJ10knrOxq0C', '2025-12-12 06:43:22.921604', 'testuser')[0m
  [1m[36mMessage Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM `messages` WHERE `messages`.`conversation_id` = 6 AND `messages`.`sender_id` != 10 AND `messages`.`is_read` = FALSE[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "8", "content" => "Test message"}
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`assigned_expert_id` = 10 AND `conversations`.`status` = 'active' AND (updated_at >= '1970-01-01 00:00:00') ORDER BY `conversations`.`updated_at` DESC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 21 LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (10 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.922115', 1, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.922115')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 8 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.922763', '2025-12-12 06:43:22.922773', '$2a$04$GIY9ZXgLk2mUqng9HqQkG.SfBSExHm.lSXgWS2LDPub63z2WTMYR6', '2025-12-12 06:43:22.922763', 'otheruser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
Started GET "/conversations/7/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.923243', '2025-12-12 06:43:22.923253', '$2a$04$/WTE0tynHIcp7TWyrHoaKOGx/NJVnuu9WVQcjnWuBZ58vasWBxVYi', '2025-12-12 06:43:22.923243', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "7"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 8, '2025-12-12 06:43:22.923291', FALSE, 21, 'initiator', '2025-12-12 06:43:22.923291')[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 13 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.923291', `conversations`.`updated_at` = '2025-12-12 06:43:22.923804' WHERE `conversations`.`id` = 8[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.3ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (16, '2025-12-12 06:43:22.923877', 15, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.923877')[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 13 OR `conversations`.`assigned_expert_id` = 13) AND `conversations`.`id` = 7 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Filter chain halted as :set_conversation rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
MessagesTest: test_POST_/messages_requires_conversation_access
--------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "11", "content" => "New message"}
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 8, '2025-12-12 06:43:22.924605', FALSE, 15, 'initiator', '2025-12-12 06:43:22.924605')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.924605', `conversations`.`updated_at` = '2025-12-12 06:43:22.925010' WHERE `conversations`.`id` = 8[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 11 LIMIT 1[0m
Started PUT "/messages/2/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "2"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 16 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.925994', '2025-12-12 06:43:22.926006', '$2a$04$Bcdpbz0qJofqYplNszEoLOyFaOk.u5yGmULE1VJNDNHML81craqrS', '2025-12-12 06:43:22.925994', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '16' OR conversations.assigned_expert_id = '16') AND `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Update (0.2ms)[0m  [1m[33mUPDATE `messages` SET `messages`.`is_read` = TRUE, `messages`.`updated_at` = '2025-12-12 06:43:22.926711' WHERE `messages`.`id` = 2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`id` = 2 LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.927454', '2025-12-12 06:43:22.927464', '$2a$04$FFL1tA.h5tJIulUsONLX9uQencncSbyljsfmMHNKBxpCCM58xk1Lq', '2025-12-12 06:43:22.927454', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 11, '2025-12-12 06:43:22.927708', FALSE, 23, 'initiator', '2025-12-12 06:43:22.927708')[0m
  [1m[36mMessage Create (1.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 06:43:22.926818', FALSE, 1, 'initiator', '2025-12-12 06:43:22.926818')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('New message', 1, '2025-12-12 06:43:22.927309', FALSE, 2, 'initiator', '2025-12-12 06:43:22.927309')[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (8, '2025-12-12 06:43:22.928091', 7, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.928091')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.927708', `conversations`.`updated_at` = '2025-12-12 06:43:22.928233' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.926818', `conversations`.`updated_at` = '2025-12-12 06:43:22.928390' WHERE `conversations`.`id` = 1[0m
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.927309', `conversations`.`updated_at` = '2025-12-12 06:43:22.928419' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Second message', 11, '2025-12-12 06:43:22.928664', FALSE, 44, 'expert', '2025-12-12 06:43:22.928664')[0m
Completed 201 Created in 10ms (Views: 0.1ms | ActiveRecord: 2.1ms (4 queries, 0 cached) | GC: 0.0ms)
Started GET "/conversations/1/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 11 LIMIT 1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.928664', `conversations`.`updated_at` = '2025-12-12 06:43:22.929189' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.929665', '2025-12-12 06:43:22.929679', '$2a$04$We/xvppB//838b1F1lHdPemC5UnliKOrzYoK51FWs/7H38YFwAUZS', '2025-12-12 06:43:22.929665', 'otheruser')[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "1"}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "5", "content" => "Test"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (6.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (6.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 1 OR `conversations`.`assigned_expert_id` = 1) AND `conversations`.`id` = 1 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE `conversations`.`id` = 5 LIMIT 1[0m
Completed 403 Forbidden in 1ms (Views: 0.0ms | ActiveRecord: 0.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
-------------------------------------------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_includes_all_message_fields
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
MessagesTest: test_PUT_/messages/:id/read_returns_404_for_message_in_conversation_without_access
------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
---------------------------------------------------------
MessagesTest: test_GET_/conversations/:conversation_id/messages_requires_authentication
MessagesTest: test_POST_/messages_requires_authentication
---------------------------------------------------------------------------------------
---------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
JwtServiceTest: test_decodes_a_valid_token
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
------------------------------------------------
JwtServiceTest: test_generates_a_valid_JWT_token
------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.933644', '2025-12-12 06:43:22.933658', '$2a$04$ope8KRC/OcITLKWxhYz17ebe2iWbA30P5eol9dvLZAUz9vN6lE9y.', '2025-12-12 06:43:22.933644', 'testuser')[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934036', '2025-12-12 06:43:22.934053', '$2a$04$REbq1i5WcD84ZHAUkLZlDucztGCoBLgYAEDTAjAUPgqnpxUajcsum', '2025-12-12 06:43:22.934036', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.933997', '2025-12-12 06:43:22.934015', '$2a$04$7aEXL3m2unBK5eRsLYTQSu7jPbJ3SI2EqeebCWum3uWsLJAWgrM8e', '2025-12-12 06:43:22.933997', 'testuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934136', '2025-12-12 06:43:22.934157', '$2a$04$6/qpKTRMzbJkkRxrSuJceeG6j.tAT17IOEyJ7KPCLvvsjJRs./x7K', '2025-12-12 06:43:22.934136', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934743', '2025-12-12 06:43:22.934760', '$2a$04$b1ITCjqaeabGmH5iB45.qO1THRaIl9mhk5MKJV1YAhA4g01uJFTG.', '2025-12-12 06:43:22.934743', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.934890', '2025-12-12 06:43:22.934912', '$2a$04$PUpLWAS8/FMwfA5CKMXLZe9u/RL9j8Stnp//O/EvcOmkkbh6u5lk.', '2025-12-12 06:43:22.934890', 'testuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 1 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935225', '2025-12-12 06:43:22.935235', '$2a$04$he8Yi6YLKpfUj8fHAdrlCuiR/Ly5cMBqFzOjJU/uhMsBMV9UowDVG', '2025-12-12 06:43:22.935225', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935691', '2025-12-12 06:43:22.935701', '$2a$04$Ny.RcJ9XKsXS/Yu5sWaOvuql9303Zph0u.kK3QJhszaqw/xiqEIKi', '2025-12-12 06:43:22.935691', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935844', '2025-12-12 06:43:22.935854', '$2a$04$KD0bg98Zrv1yVBNL83k1Zee4.P7EGF92LLAxbFO6ZJy8vzE8FfVwq', '2025-12-12 06:43:22.935844', 'expertuser')[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.935807', '2025-12-12 06:43:22.935820', '$2a$04$K6rcKP2h.0Qje7VTD9g.YOXhQyL5DcIUPe0qwnKwZ/kSKjeZKyLKu', '2025-12-12 06:43:22.935807', 'expertuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (18, '2025-12-12 06:43:22.935923', 17, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.935923')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (15, '2025-12-12 06:43:22.936471', 14, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936471')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (12, '2025-12-12 06:43:22.936540', 11, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936540')[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 9, '2025-12-12 06:43:22.936625', TRUE, 17, 'initiator', '2025-12-12 06:43:22.936625')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (24, '2025-12-12 06:43:22.936690', 23, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.936690')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.936625', `conversations`.`updated_at` = '2025-12-12 06:43:22.937093' WHERE `conversations`.`id` = 9[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Started GET "/conversations/8/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "8"}
Started GET "/conversations/9/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "9"}
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Processing by MessagesController#create as HTML
  Parameters: {"conversationId" => "7", "content" => "Test"}
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'otheruser' LIMIT 1[0m
Filter chain halted as :authenticate_with_jwt! rendered or redirected
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17 LIMIT 1[0m
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.938420', '2025-12-12 06:43:22.938432', '$2a$04$5Uy70jxEOlx55poWJOd29.ajB6AkAHzkvX7WuNmTd4JZwzRbaUSg2', '2025-12-12 06:43:22.938420', 'otheruser')[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 17 OR `conversations`.`assigned_expert_id` = 17) AND `conversations`.`id` = 9 LIMIT 1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 9 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (NULL, '2025-12-12 06:43:22.939009', 25, NULL, 'waiting', 'Other', '2025-12-12 06:43:22.939009')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test', 10, '2025-12-12 06:43:22.939680', FALSE, 25, 'initiator', '2025-12-12 06:43:22.939680')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.2ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Third message', 11, '2025-12-12 06:43:22.939870', FALSE, 43, 'initiator', '2025-12-12 06:43:22.939870')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.939680', `conversations`.`updated_at` = '2025-12-12 06:43:22.940123' WHERE `conversations`.`id` = 10[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 17[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.939870', `conversations`.`updated_at` = '2025-12-12 06:43:22.940343' WHERE `conversations`.`id` = 11[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/5/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[31mROLLBACK[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "5"}
Started GET "/conversations/11/messages" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 23 LIMIT 1[0m
Processing by MessagesController#index as HTML
  Parameters: {"conversation_id" => "11"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 43 LIMIT 1[0m
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` INNER JOIN `conversations` ON `conversations`.`id` = `messages`.`conversation_id` WHERE (conversations.initiator_id = '23' OR conversations.assigned_expert_id = '23') AND `messages`.`id` = 5 LIMIT 1[0m
  [1m[36mConversation Load (0.1ms)[0m  [1m[34mSELECT `conversations`.* FROM `conversations` WHERE (`conversations`.`initiator_id` = 43 OR `conversations`.`assigned_expert_id` = 43) AND `conversations`.`id` = 11 LIMIT 1[0m
Filter chain halted as :set_message rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Load (0.1ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`conversation_id` = 11 ORDER BY `messages`.`created_at` ASC[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` IN (43, 44)[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (4 queries, 0 cached) | GC: 0.5ms)
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1655.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'testuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.957112', '2025-12-12 06:43:22.957164', '$2a$04$TcUg9/.YXfu/W2qzML062ef9M4jCQRbaMYR2K3CYoqzguSZRmvACm', '2025-12-12 06:43:22.957112', 'testuser')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM `users` WHERE `users`.`username` = 'expertuser' LIMIT 1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO `users` (`created_at`, `last_active_at`, `password_digest`, `updated_at`, `username`) VALUES ('2025-12-12 06:43:22.960054', '2025-12-12 06:43:22.960065', '$2a$04$Jig4OIEOZ9hjjLIqliIvzOo6BWx7wvBdJI7/D5S0oDUyEU0UBu.B.', '2025-12-12 06:43:22.960054', 'expertuser')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.2ms)[0m  [1m[32mINSERT INTO `conversations` (`assigned_expert_id`, `created_at`, `initiator_id`, `last_message_at`, `status`, `title`, `updated_at`) VALUES (2, '2025-12-12 06:43:22.966163', 1, NULL, 'active', 'Test Conversation', '2025-12-12 06:43:22.966163')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMessage Create (0.3ms)[0m  [1m[32mINSERT INTO `messages` (`content`, `conversation_id`, `created_at`, `is_read`, `sender_id`, `sender_role`, `updated_at`) VALUES ('Test message', 1, '2025-12-12 06:43:22.971711', FALSE, 1, 'initiator', '2025-12-12 06:43:22.971711')[0m
  [1m[36mConversation Update (0.1ms)[0m  [1m[33mUPDATE `conversations` SET `conversations`.`last_message_at` = '2025-12-12 06:43:22.971711', `conversations`.`updated_at` = '2025-12-12 06:43:22.972314' WHERE `conversations`.`id` = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PUT "/messages/1/read" for 127.0.0.1 at 2025-12-12 06:43:22 +0000
  [1m[36mTruncate Tables (1678.5ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.2ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Processing by MessagesController#mark_read as HTML
  Parameters: {"id" => "1"}
Filter chain halted as :authenticate_with_jwt! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTruncate Tables (1708.0ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1718.6ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
  [1m[36mTruncate Tables (1755.3ms)[0m  [1m[35mTRUNCATE TABLE `conversations`;
TRUNCATE TABLE `expert_assignments`;
TRUNCATE TABLE `expert_profiles`;
TRUNCATE TABLE `messages`;
TRUNCATE TABLE `sessions`;
TRUNCATE TABLE `users`[0m
  [1m[35m (0.1ms)[0m  [1m[35mSET FOREIGN_KEY_CHECKS = 1[0m
Started POST "/auth/refresh" for 127.0.0.1 at 2025-12-12 06:43:23 +0000
Processing by AuthController#refresh as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 19 LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[31mROLLBACK[0m
